const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Sidebar-Bjik65Wf.js","assets/layout-dashboard-DeaJwr63.js","assets/users-DpLnCR9U.js","assets/sparkles-UEATSLya.js","assets/scan-line-3MlzyWmy.js","assets/chart-column-BOe2JW8L.js","assets/triangle-alert-DNeKoh3i.js","assets/shield-check-onJ1nUJt.js","assets/wallet-CDGTfzR9.js","assets/x-DXmm6LdO.js","assets/chevron-right-Cj_ZOtvn.js","assets/chevron-left-BkcukiiE.js","assets/refresh-cw-BtJWgR87.js","assets/inbox-BzG7f4py.js","assets/eye-BXRwIXTg.js","assets/circle-alert-BdZMCCsn.js","assets/Dashboard-JjEbyVHO.js","assets/formatters-DUYcZ69c.js","assets/dollar-sign-CEPIVv2L.js","assets/trending-up-DvWVOlY2.js","assets/CategoricalChart-WgX2r2A4.js","assets/CartesianChart-D4sRpGjt.js","assets/ActiveShapeUtils-CDJbze_U.js","assets/circle-check-DrDINw7Z.js","assets/server-CJZksbLv.js","assets/circle-x-CGEuWrt_.js","assets/file-exclamation-point-Px-HiWp-.js","assets/DocumentList-BbKQcGPz.js","assets/AnalysisViewer-DgTnw-IE.js","assets/download-0ExKlktC.js","assets/target-DElnn2XR.js","assets/bot-DLrXphgv.js","assets/scale-D6frnkbH.js","assets/octagon-alert-BNMVVp8_.js","assets/siren-oMinx-Wc.js","assets/chevron-up-DPBh8PbB.js","assets/trash-2-Cgw5-f_S.js","assets/jspdf.es.min-DvyK097u.js","assets/jspdf.plugin.autotable-Bvw_Bjh-.js","assets/xlsx-3SA47z_C.js","assets/square-ygISqYmX.js","assets/user-j9IzqvXb.js","assets/LandingPage-Crr-fdZO.js","assets/proxy-CrFM0Lip.js","assets/shield-C4uCe_rw.js","assets/circle-check-big-CBJPIpQa.js","assets/trending-down-LEykIGTE.js","assets/lock-B5cPPH7K.js","assets/globe-BXchpoHt.js","assets/database-C3AygGpd.js","assets/calculator-B2mICZGE.js","assets/check-DjJwuJFN.js","assets/clock-CG1GSdeD.js","assets/cpu-CPSQlUye.js","assets/hard-drive-BAZKRuOG.js","assets/briefcase-BI1gk-kB.js","assets/phone-BHbxto6f.js","assets/mail-D54Nputp.js","assets/message-square-C7r7TB_Q.js","assets/send-BlWWcWAI.js","assets/arrow-up-right-CsbpZt8k.js","assets/arrow-right-rbnAkDjG.js","assets/AuthPage-CvVI3Q2d.js","assets/Onboarding-8cwLllWl.js","assets/index-aIvwqzgz.js","assets/UploadPage-CjsAyWmB.js","assets/FiscalErrors-bHS0aRwk.js","assets/shield-alert-DcH0etKt.js","assets/info-BBRCXzxA.js","assets/ReportsPage-g0Jk0GlL.js","assets/landmark-Jeg2ozgt.js","assets/arrow-down-right-Bb2rAjCo.js","assets/CreditsPage-e_RoJkur.js","assets/smartphone-B4fVr7Y9.js","assets/history-DIEYzffq.js","assets/SettingsPage-B7edKY0W.js","assets/terminal-C3c6mR0i.js","assets/user-plus-B10ydgO0.js","assets/key-CTl58Ncl.js","assets/ClientsPage-DfgkNpVJ.js","assets/ToastNotification-DKNqjTiG.js","assets/UploadTray-muZt7HYf.js","assets/FiscalChat-BxTRoPFe.js","assets/NifsPage-rIgTWxqu.js","assets/external-link-BUB3nTA_.js","assets/AnalysisResultsPage-IXQN5jMC.js","assets/AnalysisCompletionPopup-DBK3YPTP.js","assets/ForcePasswordChangeModal-B34lRhpq.js","assets/CompliancePage-BqQX29Ii.js","assets/AdminPanel-Cc7qKE-4.js","assets/PerformanceServersPage-BCQkU-JW.js","assets/InstallPrompt-B4KAdt8-.js"])))=>i.map(i=>d[i]);
var ML=Object.defineProperty;var qO=l=>{throw TypeError(l)};var NL=(l,t,e)=>t in l?ML(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var Ct=(l,t,e)=>NL(l,typeof t!="symbol"?t+"":t,e),wE=(l,t,e)=>t.has(l)||qO("Cannot "+e);var c=(l,t,e)=>(wE(l,t,"read from private field"),e?e.call(l):t.get(l)),O=(l,t,e)=>t.has(l)?qO("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(l):t.set(l,e),E=(l,t,e,n)=>(wE(l,t,"write to private field"),n?n.call(l,e):t.set(l,e),e),N=(l,t,e)=>(wE(l,t,"access private method"),e);var bi=(l,t,e,n)=>({set _(s){E(l,t,s,e)},get _(){return c(l,t,n)}});function kL(l,t){for(var e=0;e<t.length;e++){const n=t[e];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in l)){const r=Object.getOwnPropertyDescriptor(n,s);r&&Object.defineProperty(l,s,r.get?r:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();var PL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zC(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function ij(l){if(Object.prototype.hasOwnProperty.call(l,"__esModule"))return l;var t=l.default;if(typeof t=="function"){var e=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(l).forEach(function(n){var s=Object.getOwnPropertyDescriptor(l,n);Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:function(){return l[n]}})}),e}var _E={exports:{}},Wg={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XO;function LL(){if(XO)return Wg;XO=1;var l=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(n,s,r){var u=null;if(r!==void 0&&(u=""+r),s.key!==void 0&&(u=""+s.key),"key"in s){r={};for(var h in s)h!=="key"&&(r[h]=s[h])}else r=s;return s=r.ref,{$$typeof:l,type:n,key:u,ref:s!==void 0?s:null,props:r}}return Wg.Fragment=t,Wg.jsx=e,Wg.jsxs=e,Wg}var YO;function IL(){return YO||(YO=1,_E.exports=LL()),_E.exports}var lt=IL(),AE={exports:{}},pe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KO;function BL(){if(KO)return pe;KO=1;var l=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),b=Symbol.for("react.activity"),_=Symbol.iterator;function S(G){return G===null||typeof G!="object"?null:(G=_&&G[_]||G["@@iterator"],typeof G=="function"?G:null)}var R={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,M={};function k(G,ft,_t){this.props=G,this.context=ft,this.refs=M,this.updater=_t||R}k.prototype.isReactComponent={},k.prototype.setState=function(G,ft){if(typeof G!="object"&&typeof G!="function"&&G!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,G,ft,"setState")},k.prototype.forceUpdate=function(G){this.updater.enqueueForceUpdate(this,G,"forceUpdate")};function I(){}I.prototype=k.prototype;function P(G,ft,_t){this.props=G,this.context=ft,this.refs=M,this.updater=_t||R}var F=P.prototype=new I;F.constructor=P,C(F,k.prototype),F.isPureReactComponent=!0;var z=Array.isArray;function j(){}var H={H:null,A:null,T:null,S:null},dt=Object.prototype.hasOwnProperty;function ct(G,ft,_t){var Mt=_t.ref;return{$$typeof:l,type:G,key:ft,ref:Mt!==void 0?Mt:null,props:_t}}function yt(G,ft){return ct(G.type,ft,G.props)}function gt(G){return typeof G=="object"&&G!==null&&G.$$typeof===l}function Pt(G){var ft={"=":"=0",":":"=2"};return"$"+G.replace(/[=:]/g,function(_t){return ft[_t]})}var Xt=/\/+/g;function Vt(G,ft){return typeof G=="object"&&G!==null&&G.key!=null?Pt(""+G.key):ft.toString(36)}function Yt(G){switch(G.status){case"fulfilled":return G.value;case"rejected":throw G.reason;default:switch(typeof G.status=="string"?G.then(j,j):(G.status="pending",G.then(function(ft){G.status==="pending"&&(G.status="fulfilled",G.value=ft)},function(ft){G.status==="pending"&&(G.status="rejected",G.reason=ft)})),G.status){case"fulfilled":return G.value;case"rejected":throw G.reason}}throw G}function J(G,ft,_t,Mt,It){var Gt=typeof G;(Gt==="undefined"||Gt==="boolean")&&(G=null);var Ft=!1;if(G===null)Ft=!0;else switch(Gt){case"bigint":case"string":case"number":Ft=!0;break;case"object":switch(G.$$typeof){case l:case t:Ft=!0;break;case m:return Ft=G._init,J(Ft(G._payload),ft,_t,Mt,It)}}if(Ft)return It=It(G),Ft=Mt===""?"."+Vt(G,0):Mt,z(It)?(_t="",Ft!=null&&(_t=Ft.replace(Xt,"$&/")+"/"),J(It,ft,_t,"",function(pi){return pi})):It!=null&&(gt(It)&&(It=yt(It,_t+(It.key==null||G&&G.key===It.key?"":(""+It.key).replace(Xt,"$&/")+"/")+Ft)),ft.push(It)),1;Ft=0;var Ke=Mt===""?".":Mt+":";if(z(G))for(var Dt=0;Dt<G.length;Dt++)Mt=G[Dt],Gt=Ke+Vt(Mt,Dt),Ft+=J(Mt,ft,_t,Gt,It);else if(Dt=S(G),typeof Dt=="function")for(G=Dt.call(G),Dt=0;!(Mt=G.next()).done;)Mt=Mt.value,Gt=Ke+Vt(Mt,Dt++),Ft+=J(Mt,ft,_t,Gt,It);else if(Gt==="object"){if(typeof G.then=="function")return J(Yt(G),ft,_t,Mt,It);throw ft=String(G),Error("Objects are not valid as a React child (found: "+(ft==="[object Object]"?"object with keys {"+Object.keys(G).join(", ")+"}":ft)+"). If you meant to render a collection of children, use an array instead.")}return Ft}function pt(G,ft,_t){if(G==null)return G;var Mt=[],It=0;return J(G,Mt,"","",function(Gt){return ft.call(_t,Gt,It++)}),Mt}function Et(G){if(G._status===-1){var ft=G._result;ft=ft(),ft.then(function(_t){(G._status===0||G._status===-1)&&(G._status=1,G._result=_t)},function(_t){(G._status===0||G._status===-1)&&(G._status=2,G._result=_t)}),G._status===-1&&(G._status=0,G._result=ft)}if(G._status===1)return G._result.default;throw G._result}var Wt=typeof reportError=="function"?reportError:function(G){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ft=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof G=="object"&&G!==null&&typeof G.message=="string"?String(G.message):String(G),error:G});if(!window.dispatchEvent(ft))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",G);return}console.error(G)},Zt={map:pt,forEach:function(G,ft,_t){pt(G,function(){ft.apply(this,arguments)},_t)},count:function(G){var ft=0;return pt(G,function(){ft++}),ft},toArray:function(G){return pt(G,function(ft){return ft})||[]},only:function(G){if(!gt(G))throw Error("React.Children.only expected to receive a single React element child.");return G}};return pe.Activity=b,pe.Children=Zt,pe.Component=k,pe.Fragment=e,pe.Profiler=s,pe.PureComponent=P,pe.StrictMode=n,pe.Suspense=f,pe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=H,pe.__COMPILER_RUNTIME={__proto__:null,c:function(G){return H.H.useMemoCache(G)}},pe.cache=function(G){return function(){return G.apply(null,arguments)}},pe.cacheSignal=function(){return null},pe.cloneElement=function(G,ft,_t){if(G==null)throw Error("The argument must be a React element, but you passed "+G+".");var Mt=C({},G.props),It=G.key;if(ft!=null)for(Gt in ft.key!==void 0&&(It=""+ft.key),ft)!dt.call(ft,Gt)||Gt==="key"||Gt==="__self"||Gt==="__source"||Gt==="ref"&&ft.ref===void 0||(Mt[Gt]=ft[Gt]);var Gt=arguments.length-2;if(Gt===1)Mt.children=_t;else if(1<Gt){for(var Ft=Array(Gt),Ke=0;Ke<Gt;Ke++)Ft[Ke]=arguments[Ke+2];Mt.children=Ft}return ct(G.type,It,Mt)},pe.createContext=function(G){return G={$$typeof:u,_currentValue:G,_currentValue2:G,_threadCount:0,Provider:null,Consumer:null},G.Provider=G,G.Consumer={$$typeof:r,_context:G},G},pe.createElement=function(G,ft,_t){var Mt,It={},Gt=null;if(ft!=null)for(Mt in ft.key!==void 0&&(Gt=""+ft.key),ft)dt.call(ft,Mt)&&Mt!=="key"&&Mt!=="__self"&&Mt!=="__source"&&(It[Mt]=ft[Mt]);var Ft=arguments.length-2;if(Ft===1)It.children=_t;else if(1<Ft){for(var Ke=Array(Ft),Dt=0;Dt<Ft;Dt++)Ke[Dt]=arguments[Dt+2];It.children=Ke}if(G&&G.defaultProps)for(Mt in Ft=G.defaultProps,Ft)It[Mt]===void 0&&(It[Mt]=Ft[Mt]);return ct(G,Gt,It)},pe.createRef=function(){return{current:null}},pe.forwardRef=function(G){return{$$typeof:h,render:G}},pe.isValidElement=gt,pe.lazy=function(G){return{$$typeof:m,_payload:{_status:-1,_result:G},_init:Et}},pe.memo=function(G,ft){return{$$typeof:p,type:G,compare:ft===void 0?null:ft}},pe.startTransition=function(G){var ft=H.T,_t={};H.T=_t;try{var Mt=G(),It=H.S;It!==null&&It(_t,Mt),typeof Mt=="object"&&Mt!==null&&typeof Mt.then=="function"&&Mt.then(j,Wt)}catch(Gt){Wt(Gt)}finally{ft!==null&&_t.types!==null&&(ft.types=_t.types),H.T=ft}},pe.unstable_useCacheRefresh=function(){return H.H.useCacheRefresh()},pe.use=function(G){return H.H.use(G)},pe.useActionState=function(G,ft,_t){return H.H.useActionState(G,ft,_t)},pe.useCallback=function(G,ft){return H.H.useCallback(G,ft)},pe.useContext=function(G){return H.H.useContext(G)},pe.useDebugValue=function(){},pe.useDeferredValue=function(G,ft){return H.H.useDeferredValue(G,ft)},pe.useEffect=function(G,ft){return H.H.useEffect(G,ft)},pe.useEffectEvent=function(G){return H.H.useEffectEvent(G)},pe.useId=function(){return H.H.useId()},pe.useImperativeHandle=function(G,ft,_t){return H.H.useImperativeHandle(G,ft,_t)},pe.useInsertionEffect=function(G,ft){return H.H.useInsertionEffect(G,ft)},pe.useLayoutEffect=function(G,ft){return H.H.useLayoutEffect(G,ft)},pe.useMemo=function(G,ft){return H.H.useMemo(G,ft)},pe.useOptimistic=function(G,ft){return H.H.useOptimistic(G,ft)},pe.useReducer=function(G,ft,_t){return H.H.useReducer(G,ft,_t)},pe.useRef=function(G){return H.H.useRef(G)},pe.useState=function(G){return H.H.useState(G)},pe.useSyncExternalStore=function(G,ft,_t){return H.H.useSyncExternalStore(G,ft,_t)},pe.useTransition=function(){return H.H.useTransition()},pe.version="19.2.3",pe}var WO;function jC(){return WO||(WO=1,AE.exports=BL()),AE.exports}var Q=jC();const Sn=zC(Q),sj=kL({__proto__:null,default:Sn},[Q]);var SE={exports:{}},Qg={},EE={exports:{}},CE={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QO;function FL(){return QO||(QO=1,(function(l){function t(J,pt){var Et=J.length;J.push(pt);t:for(;0<Et;){var Wt=Et-1>>>1,Zt=J[Wt];if(0<s(Zt,pt))J[Wt]=pt,J[Et]=Zt,Et=Wt;else break t}}function e(J){return J.length===0?null:J[0]}function n(J){if(J.length===0)return null;var pt=J[0],Et=J.pop();if(Et!==pt){J[0]=Et;t:for(var Wt=0,Zt=J.length,G=Zt>>>1;Wt<G;){var ft=2*(Wt+1)-1,_t=J[ft],Mt=ft+1,It=J[Mt];if(0>s(_t,Et))Mt<Zt&&0>s(It,_t)?(J[Wt]=It,J[Mt]=Et,Wt=Mt):(J[Wt]=_t,J[ft]=Et,Wt=ft);else if(Mt<Zt&&0>s(It,Et))J[Wt]=It,J[Mt]=Et,Wt=Mt;else break t}}return pt}function s(J,pt){var Et=J.sortIndex-pt.sortIndex;return Et!==0?Et:J.id-pt.id}if(l.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;l.unstable_now=function(){return r.now()}}else{var u=Date,h=u.now();l.unstable_now=function(){return u.now()-h}}var f=[],p=[],m=1,b=null,_=3,S=!1,R=!1,C=!1,M=!1,k=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,P=typeof setImmediate<"u"?setImmediate:null;function F(J){for(var pt=e(p);pt!==null;){if(pt.callback===null)n(p);else if(pt.startTime<=J)n(p),pt.sortIndex=pt.expirationTime,t(f,pt);else break;pt=e(p)}}function z(J){if(C=!1,F(J),!R)if(e(f)!==null)R=!0,j||(j=!0,Pt());else{var pt=e(p);pt!==null&&Yt(z,pt.startTime-J)}}var j=!1,H=-1,dt=5,ct=-1;function yt(){return M?!0:!(l.unstable_now()-ct<dt)}function gt(){if(M=!1,j){var J=l.unstable_now();ct=J;var pt=!0;try{t:{R=!1,C&&(C=!1,I(H),H=-1),S=!0;var Et=_;try{e:{for(F(J),b=e(f);b!==null&&!(b.expirationTime>J&&yt());){var Wt=b.callback;if(typeof Wt=="function"){b.callback=null,_=b.priorityLevel;var Zt=Wt(b.expirationTime<=J);if(J=l.unstable_now(),typeof Zt=="function"){b.callback=Zt,F(J),pt=!0;break e}b===e(f)&&n(f),F(J)}else n(f);b=e(f)}if(b!==null)pt=!0;else{var G=e(p);G!==null&&Yt(z,G.startTime-J),pt=!1}}break t}finally{b=null,_=Et,S=!1}pt=void 0}}finally{pt?Pt():j=!1}}}var Pt;if(typeof P=="function")Pt=function(){P(gt)};else if(typeof MessageChannel<"u"){var Xt=new MessageChannel,Vt=Xt.port2;Xt.port1.onmessage=gt,Pt=function(){Vt.postMessage(null)}}else Pt=function(){k(gt,0)};function Yt(J,pt){H=k(function(){J(l.unstable_now())},pt)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(J){J.callback=null},l.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):dt=0<J?Math.floor(1e3/J):5},l.unstable_getCurrentPriorityLevel=function(){return _},l.unstable_next=function(J){switch(_){case 1:case 2:case 3:var pt=3;break;default:pt=_}var Et=_;_=pt;try{return J()}finally{_=Et}},l.unstable_requestPaint=function(){M=!0},l.unstable_runWithPriority=function(J,pt){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var Et=_;_=J;try{return pt()}finally{_=Et}},l.unstable_scheduleCallback=function(J,pt,Et){var Wt=l.unstable_now();switch(typeof Et=="object"&&Et!==null?(Et=Et.delay,Et=typeof Et=="number"&&0<Et?Wt+Et:Wt):Et=Wt,J){case 1:var Zt=-1;break;case 2:Zt=250;break;case 5:Zt=1073741823;break;case 4:Zt=1e4;break;default:Zt=5e3}return Zt=Et+Zt,J={id:m++,callback:pt,priorityLevel:J,startTime:Et,expirationTime:Zt,sortIndex:-1},Et>Wt?(J.sortIndex=Et,t(p,J),e(f)===null&&J===e(p)&&(C?(I(H),H=-1):C=!0,Yt(z,Et-Wt))):(J.sortIndex=Zt,t(f,J),R||S||(R=!0,j||(j=!0,Pt()))),J},l.unstable_shouldYield=yt,l.unstable_wrapCallback=function(J){var pt=_;return function(){var Et=_;_=pt;try{return J.apply(this,arguments)}finally{_=Et}}}})(CE)),CE}var JO;function UL(){return JO||(JO=1,EE.exports=FL()),EE.exports}var xE={exports:{}},hs={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZO;function zL(){if(ZO)return hs;ZO=1;var l=jC();function t(f){var p="https://react.dev/errors/"+f;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)p+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+f+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var n={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},s=Symbol.for("react.portal");function r(f,p,m){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:b==null?null:""+b,children:f,containerInfo:p,implementation:m}}var u=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(f,p){if(f==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return hs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,hs.createPortal=function(f,p){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(t(299));return r(f,p,null,m)},hs.flushSync=function(f){var p=u.T,m=n.p;try{if(u.T=null,n.p=2,f)return f()}finally{u.T=p,n.p=m,n.d.f()}},hs.preconnect=function(f,p){typeof f=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,n.d.C(f,p))},hs.prefetchDNS=function(f){typeof f=="string"&&n.d.D(f)},hs.preinit=function(f,p){if(typeof f=="string"&&p&&typeof p.as=="string"){var m=p.as,b=h(m,p.crossOrigin),_=typeof p.integrity=="string"?p.integrity:void 0,S=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;m==="style"?n.d.S(f,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:b,integrity:_,fetchPriority:S}):m==="script"&&n.d.X(f,{crossOrigin:b,integrity:_,fetchPriority:S,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},hs.preinitModule=function(f,p){if(typeof f=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var m=h(p.as,p.crossOrigin);n.d.M(f,{crossOrigin:m,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&n.d.M(f)},hs.preload=function(f,p){if(typeof f=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var m=p.as,b=h(m,p.crossOrigin);n.d.L(f,m,{crossOrigin:b,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},hs.preloadModule=function(f,p){if(typeof f=="string")if(p){var m=h(p.as,p.crossOrigin);n.d.m(f,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:m,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else n.d.m(f)},hs.requestFormReset=function(f){n.d.r(f)},hs.unstable_batchedUpdates=function(f,p){return f(p)},hs.useFormState=function(f,p,m){return u.H.useFormState(f,p,m)},hs.useFormStatus=function(){return u.H.useHostTransitionStatus()},hs.version="19.2.3",hs}var tD;function jL(){if(tD)return xE.exports;tD=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(t){console.error(t)}}return l(),xE.exports=zL(),xE.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eD;function HL(){if(eD)return Qg;eD=1;var l=UL(),t=jC(),e=jL();function n(i){var a="https://react.dev/errors/"+i;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)a+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function r(i){var a=i,o=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,(a.flags&4098)!==0&&(o=a.return),i=a.return;while(i)}return a.tag===3?o:null}function u(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function h(i){if(i.tag===31){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function f(i){if(r(i)!==i)throw Error(n(188))}function p(i){var a=i.alternate;if(!a){if(a=r(i),a===null)throw Error(n(188));return a!==i?null:i}for(var o=i,d=a;;){var y=o.return;if(y===null)break;var w=y.alternate;if(w===null){if(d=y.return,d!==null){o=d;continue}break}if(y.child===w.child){for(w=y.child;w;){if(w===o)return f(y),i;if(w===d)return f(y),a;w=w.sibling}throw Error(n(188))}if(o.return!==d.return)o=y,d=w;else{for(var T=!1,B=y.child;B;){if(B===o){T=!0,o=y,d=w;break}if(B===d){T=!0,d=y,o=w;break}B=B.sibling}if(!T){for(B=w.child;B;){if(B===o){T=!0,o=w,d=y;break}if(B===d){T=!0,d=w,o=y;break}B=B.sibling}if(!T)throw Error(n(189))}}if(o.alternate!==d)throw Error(n(190))}if(o.tag!==3)throw Error(n(188));return o.stateNode.current===o?i:a}function m(i){var a=i.tag;if(a===5||a===26||a===27||a===6)return i;for(i=i.child;i!==null;){if(a=m(i),a!==null)return a;i=i.sibling}return null}var b=Object.assign,_=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),R=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),I=Symbol.for("react.consumer"),P=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),z=Symbol.for("react.suspense"),j=Symbol.for("react.suspense_list"),H=Symbol.for("react.memo"),dt=Symbol.for("react.lazy"),ct=Symbol.for("react.activity"),yt=Symbol.for("react.memo_cache_sentinel"),gt=Symbol.iterator;function Pt(i){return i===null||typeof i!="object"?null:(i=gt&&i[gt]||i["@@iterator"],typeof i=="function"?i:null)}var Xt=Symbol.for("react.client.reference");function Vt(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===Xt?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case C:return"Fragment";case k:return"Profiler";case M:return"StrictMode";case z:return"Suspense";case j:return"SuspenseList";case ct:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case R:return"Portal";case P:return i.displayName||"Context";case I:return(i._context.displayName||"Context")+".Consumer";case F:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case H:return a=i.displayName||null,a!==null?a:Vt(i.type)||"Memo";case dt:a=i._payload,i=i._init;try{return Vt(i(a))}catch{}}return null}var Yt=Array.isArray,J=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,pt=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Et={pending:!1,data:null,method:null,action:null},Wt=[],Zt=-1;function G(i){return{current:i}}function ft(i){0>Zt||(i.current=Wt[Zt],Wt[Zt]=null,Zt--)}function _t(i,a){Zt++,Wt[Zt]=i.current,i.current=a}var Mt=G(null),It=G(null),Gt=G(null),Ft=G(null);function Ke(i,a){switch(_t(Gt,a),_t(It,i),_t(Mt,null),a.nodeType){case 9:case 11:i=(i=a.documentElement)&&(i=i.namespaceURI)?mO(i):0;break;default:if(i=a.tagName,a=a.namespaceURI)a=mO(a),i=gO(a,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}ft(Mt),_t(Mt,i)}function Dt(){ft(Mt),ft(It),ft(Gt)}function pi(i){i.memoizedState!==null&&_t(Ft,i);var a=Mt.current,o=gO(a,i.type);a!==o&&(_t(It,i),_t(Mt,o))}function bn(i){It.current===i&&(ft(Mt),ft(It)),Ft.current===i&&(ft(Ft),qg._currentValue=Et)}var Ee,os;function ws(i){if(Ee===void 0)try{throw Error()}catch(o){var a=o.stack.trim().match(/\n( *(at )?)/);Ee=a&&a[1]||"",os=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ee+i+os}var Oi=!1;function Hr(i,a){if(!i||Oi)return"";Oi=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(a){var St=function(){throw Error()};if(Object.defineProperty(St.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(St,[])}catch(mt){var ht=mt}Reflect.construct(i,[],St)}else{try{St.call()}catch(mt){ht=mt}i.call(St.prototype)}}else{try{throw Error()}catch(mt){ht=mt}(St=i())&&typeof St.catch=="function"&&St.catch(function(){})}}catch(mt){if(mt&&ht&&typeof mt.stack=="string")return[mt.stack,ht.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=d.DetermineComponentFrameRoot(),T=w[0],B=w[1];if(T&&B){var V=T.split(`
`),ot=B.split(`
`);for(y=d=0;d<V.length&&!V[d].includes("DetermineComponentFrameRoot");)d++;for(;y<ot.length&&!ot[y].includes("DetermineComponentFrameRoot");)y++;if(d===V.length||y===ot.length)for(d=V.length-1,y=ot.length-1;1<=d&&0<=y&&V[d]!==ot[y];)y--;for(;1<=d&&0<=y;d--,y--)if(V[d]!==ot[y]){if(d!==1||y!==1)do if(d--,y--,0>y||V[d]!==ot[y]){var vt=`
`+V[d].replace(" at new "," at ");return i.displayName&&vt.includes("<anonymous>")&&(vt=vt.replace("<anonymous>",i.displayName)),vt}while(1<=d&&0<=y);break}}}finally{Oi=!1,Error.prepareStackTrace=o}return(o=i?i.displayName||i.name:"")?ws(o):""}function Io(i,a){switch(i.tag){case 26:case 27:case 5:return ws(i.type);case 16:return ws("Lazy");case 13:return i.child!==a&&a!==null?ws("Suspense Fallback"):ws("Suspense");case 19:return ws("SuspenseList");case 0:case 15:return Hr(i.type,!1);case 11:return Hr(i.type.render,!1);case 1:return Hr(i.type,!0);case 31:return ws("Activity");default:return""}}function Zs(i){try{var a="",o=null;do a+=Io(i,o),o=i,i=i.return;while(i);return a}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var Bo=Object.prototype.hasOwnProperty,pr=l.unstable_scheduleCallback,te=l.unstable_cancelCallback,Ht=l.unstable_shouldYield,se=l.unstable_requestPaint,oe=l.unstable_now,En=l.unstable_getCurrentPriorityLevel,mi=l.unstable_ImmediatePriority,fe=l.unstable_UserBlockingPriority,Oe=l.unstable_NormalPriority,In=l.unstable_LowPriority,Ia=l.unstable_IdlePriority,mr=l.log,$r=l.unstable_setDisableYieldValue,gi=null,$i=null;function Vi(i){if(typeof mr=="function"&&$r(i),$i&&typeof $i.setStrictMode=="function")try{$i.setStrictMode(gi,i)}catch{}}var Ut=Math.clz32?Math.clz32:Zd,Vu=Math.log,Fo=Math.LN2;function Zd(i){return i>>>=0,i===0?32:31-(Vu(i)/Fo|0)|0}var Lt=256,lc=262144,Gu=4194304;function gr(i){var a=i&42;if(a!==0)return a;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function qu(i,a,o){var d=i.pendingLanes;if(d===0)return 0;var y=0,w=i.suspendedLanes,T=i.pingedLanes;i=i.warmLanes;var B=d&134217727;return B!==0?(d=B&~w,d!==0?y=gr(d):(T&=B,T!==0?y=gr(T):o||(o=B&~i,o!==0&&(y=gr(o))))):(B=d&~w,B!==0?y=gr(B):T!==0?y=gr(T):o||(o=d&~i,o!==0&&(y=gr(o)))),y===0?0:a!==0&&a!==y&&(a&w)===0&&(w=y&-y,o=a&-a,w>=o||w===32&&(o&4194048)!==0)?a:y}function Uo(i,a){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&a)===0}function TA(i,a){switch(i){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Kv(){var i=Gu;return Gu<<=1,(Gu&62914560)===0&&(Gu=4194304),i}function Vr(i){for(var a=[],o=0;31>o;o++)a.push(i);return a}function Ba(i,a){i.pendingLanes|=a,a!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function Km(i,a,o,d,y,w){var T=i.pendingLanes;i.pendingLanes=o,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=o,i.entangledLanes&=o,i.errorRecoveryDisabledLanes&=o,i.shellSuspendCounter=0;var B=i.entanglements,V=i.expirationTimes,ot=i.hiddenUpdates;for(o=T&~o;0<o;){var vt=31-Ut(o),St=1<<vt;B[vt]=0,V[vt]=-1;var ht=ot[vt];if(ht!==null)for(ot[vt]=null,vt=0;vt<ht.length;vt++){var mt=ht[vt];mt!==null&&(mt.lane&=-536870913)}o&=~St}d!==0&&Xu(i,d,0),w!==0&&y===0&&i.tag!==0&&(i.suspendedLanes|=w&~(T&~a))}function Xu(i,a,o){i.pendingLanes|=a,i.suspendedLanes&=~a;var d=31-Ut(a);i.entangledLanes|=a,i.entanglements[d]=i.entanglements[d]|1073741824|o&261930}function dn(i,a){var o=i.entangledLanes|=a;for(i=i.entanglements;o;){var d=31-Ut(o),y=1<<d;y&a|i[d]&a&&(i[d]|=a),o&=~y}}function Wn(i,a){var o=a&-a;return o=(o&42)!==0?1:Wm(o),(o&(i.suspendedLanes|a))!==0?0:o}function Wm(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function cc(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Yu(){var i=pt.p;return i!==0?i:(i=window.event,i===void 0?32:UO(i.type))}function Ku(i,a){var o=pt.p;try{return pt.p=i,a()}finally{pt.p=o}}var Gr=Math.random().toString(36).slice(2),vn="__reactFiber$"+Gr,Qn="__reactProps$"+Gr,_s="__reactContainer$"+Gr,uc="__reactEvents$"+Gr,RA="__reactListeners$"+Gr,qr="__reactHandles$"+Gr,Qm="__reactResources$"+Gr,ta="__reactMarker$"+Gr;function tf(i){delete i[vn],delete i[Qn],delete i[uc],delete i[RA],delete i[qr]}function Xr(i){var a=i[vn];if(a)return a;for(var o=i.parentNode;o;){if(a=o[_s]||o[vn]){if(o=a.alternate,a.child!==null||o!==null&&o.child!==null)for(i=SO(i);i!==null;){if(o=i[vn])return o;i=SO(i)}return a}i=o,o=i.parentNode}return null}function tn(i){if(i=i[vn]||i[_s]){var a=i.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return i}return null}function ea(i){var a=i.tag;if(a===5||a===26||a===27||a===6)return i.stateNode;throw Error(n(33))}function ls(i){var a=i[Qm];return a||(a=i[Qm]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Jn(i){i[ta]=!0}var zo=new Set,Wu={};function yr(i,a){Yr(i,a),Yr(i+"Capture",a)}function Yr(i,a){for(Wu[i]=a,i=0;i<a.length;i++)zo.add(a[i])}var jo=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Jm={},Qu={};function Wv(i){return Bo.call(Qu,i)?!0:Bo.call(Jm,i)?!1:jo.test(i)?Qu[i]=!0:(Jm[i]=!0,!1)}function Re(i,a,o){if(Wv(a))if(o===null)i.removeAttribute(a);else{switch(typeof o){case"undefined":case"function":case"symbol":i.removeAttribute(a);return;case"boolean":var d=a.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){i.removeAttribute(a);return}}i.setAttribute(a,""+o)}}function Ju(i,a,o){if(o===null)i.removeAttribute(a);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(a);return}i.setAttribute(a,""+o)}}function Fa(i,a,o,d){if(d===null)i.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(o);return}i.setAttributeNS(a,o,""+d)}}function Gi(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function hc(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Qv(i,a,o){var d=Object.getOwnPropertyDescriptor(i.constructor.prototype,a);if(!i.hasOwnProperty(a)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var y=d.get,w=d.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return y.call(this)},set:function(T){o=""+T,w.call(this,T)}}),Object.defineProperty(i,a,{enumerable:d.enumerable}),{getValue:function(){return o},setValue:function(T){o=""+T},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function ef(i){if(!i._valueTracker){var a=hc(i)?"checked":"value";i._valueTracker=Qv(i,a,""+i[a])}}function Zm(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var o=a.getValue(),d="";return i&&(d=hc(i)?i.checked?"true":"false":i.value),i=d,i!==o?(a.setValue(i),!0):!1}function Ge(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var Zu=/[\n"\\]/g;function Di(i){return i.replace(Zu,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Kr(i,a,o,d,y,w,T,B){i.name="",T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?i.type=T:i.removeAttribute("type"),a!=null?T==="number"?(a===0&&i.value===""||i.value!=a)&&(i.value=""+Gi(a)):i.value!==""+Gi(a)&&(i.value=""+Gi(a)):T!=="submit"&&T!=="reset"||i.removeAttribute("value"),a!=null?th(i,T,Gi(a)):o!=null?th(i,T,Gi(o)):d!=null&&i.removeAttribute("value"),y==null&&w!=null&&(i.defaultChecked=!!w),y!=null&&(i.checked=y&&typeof y!="function"&&typeof y!="symbol"),B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?i.name=""+Gi(B):i.removeAttribute("name")}function nf(i,a,o,d,y,w,T,B){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(i.type=w),a!=null||o!=null){if(!(w!=="submit"&&w!=="reset"||a!=null)){ef(i);return}o=o!=null?""+Gi(o):"",a=a!=null?""+Gi(a):o,B||a===i.value||(i.value=a),i.defaultValue=a}d=d??y,d=typeof d!="function"&&typeof d!="symbol"&&!!d,i.checked=B?i.checked:!!d,i.defaultChecked=!!d,T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(i.name=T),ef(i)}function th(i,a,o){a==="number"&&Ge(i.ownerDocument)===i||i.defaultValue===""+o||(i.defaultValue=""+o)}function br(i,a,o,d){if(i=i.options,a){a={};for(var y=0;y<o.length;y++)a["$"+o[y]]=!0;for(o=0;o<i.length;o++)y=a.hasOwnProperty("$"+i[o].value),i[o].selected!==y&&(i[o].selected=y),y&&d&&(i[o].defaultSelected=!0)}else{for(o=""+Gi(o),a=null,y=0;y<i.length;y++){if(i[y].value===o){i[y].selected=!0,d&&(i[y].defaultSelected=!0);return}a!==null||i[y].disabled||(a=i[y])}a!==null&&(a.selected=!0)}}function tg(i,a,o){if(a!=null&&(a=""+Gi(a),a!==i.value&&(i.value=a),o==null)){i.defaultValue!==a&&(i.defaultValue=a);return}i.defaultValue=o!=null?""+Gi(o):""}function eh(i,a,o,d){if(a==null){if(d!=null){if(o!=null)throw Error(n(92));if(Yt(d)){if(1<d.length)throw Error(n(93));d=d[0]}o=d}o==null&&(o=""),a=o}o=Gi(a),i.defaultValue=o,d=i.textContent,d===o&&d!==""&&d!==null&&(i.value=d),ef(i)}function Ho(i,a){if(a){var o=i.firstChild;if(o&&o===i.lastChild&&o.nodeType===3){o.nodeValue=a;return}}i.textContent=a}var OA=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ie(i,a,o){var d=a.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?d?i.setProperty(a,""):a==="float"?i.cssFloat="":i[a]="":d?i.setProperty(a,o):typeof o!="number"||o===0||OA.has(a)?a==="float"?i.cssFloat=o:i[a]=(""+o).trim():i[a]=o+"px"}function eg(i,a,o){if(a!=null&&typeof a!="object")throw Error(n(62));if(i=i.style,o!=null){for(var d in o)!o.hasOwnProperty(d)||a!=null&&a.hasOwnProperty(d)||(d.indexOf("--")===0?i.setProperty(d,""):d==="float"?i.cssFloat="":i[d]="");for(var y in a)d=a[y],a.hasOwnProperty(y)&&o[y]!==d&&Ie(i,y,d)}else for(var w in a)a.hasOwnProperty(w)&&Ie(i,w,a[w])}function ng(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var DA=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),As=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function vr(i){return As.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function Ls(){}var Ua=null;function sf(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var $o=null,Cn=null;function na(i){var a=tn(i);if(a&&(i=a.stateNode)){var o=i[Qn]||null;t:switch(i=a.stateNode,a.type){case"input":if(Kr(i,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),a=o.name,o.type==="radio"&&a!=null){for(o=i;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+Di(""+a)+'"][type="radio"]'),a=0;a<o.length;a++){var d=o[a];if(d!==i&&d.form===i.form){var y=d[Qn]||null;if(!y)throw Error(n(90));Kr(d,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(a=0;a<o.length;a++)d=o[a],d.form===i.form&&Zm(d)}break t;case"textarea":tg(i,o.value,o.defaultValue);break t;case"select":a=o.value,a!=null&&br(i,!!o.multiple,a,!1)}}}var Vo=!1;function dc(i,a,o){if(Vo)return i(a,o);Vo=!0;try{var d=i(a);return d}finally{if(Vo=!1,($o!==null||Cn!==null)&&(z0(),$o&&(a=$o,i=Cn,Cn=$o=null,na(a),i)))for(a=0;a<i.length;a++)na(i[a])}}function Go(i,a){var o=i.stateNode;if(o===null)return null;var d=o[Qn]||null;if(d===null)return null;o=d[a];t:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(i=i.type,d=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!d;break t;default:i=!1}if(i)return null;if(o&&typeof o!="function")throw Error(n(231,a,typeof o));return o}var Mi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ig=!1;if(Mi)try{var cs={};Object.defineProperty(cs,"passive",{get:function(){ig=!0}}),window.addEventListener("test",cs,cs),window.removeEventListener("test",cs,cs)}catch{ig=!1}var za=null,af=null,fc=null;function pc(){if(fc)return fc;var i,a=af,o=a.length,d,y="value"in za?za.value:za.textContent,w=y.length;for(i=0;i<o&&a[i]===y[i];i++);var T=o-i;for(d=1;d<=T&&a[o-d]===y[w-d];d++);return fc=y.slice(i,1<d?1-d:void 0)}function mc(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function nh(){return!0}function Jv(){return!1}function ii(i){function a(o,d,y,w,T){this._reactName=o,this._targetInst=y,this.type=d,this.nativeEvent=w,this.target=T,this.currentTarget=null;for(var B in i)i.hasOwnProperty(B)&&(o=i[B],this[B]=o?o(w):w[B]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?nh:Jv,this.isPropagationStopped=Jv,this}return b(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=nh)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=nh)},persist:function(){},isPersistent:nh}),a}var qo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rf=ii(qo),Wr=b({},qo,{view:0,detail:0}),of=ii(Wr),ih,sg,sh,lf=b({},Wr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Xo,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==sh&&(sh&&i.type==="mousemove"?(ih=i.screenX-sh.screenX,sg=i.screenY-sh.screenY):sg=ih=0,sh=i),ih)},movementY:function(i){return"movementY"in i?i.movementY:sg}}),cf=ii(lf),ag=b({},lf,{dataTransfer:0}),Zv=ii(ag),uf=b({},Wr,{relatedTarget:0}),gc=ii(uf),hf=b({},qo,{animationName:0,elapsedTime:0,pseudoElement:0}),t0=ii(hf),MA=b({},qo,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),yc=ii(MA),rg=b({},qo,{data:0}),df=ii(rg),og={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ni={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ah(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=Ni[i])?!!a[i]:!1}function Xo(){return ah}var e0=b({},Wr,{key:function(i){if(i.key){var a=og[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=mc(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?lg[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Xo,charCode:function(i){return i.type==="keypress"?mc(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?mc(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),ff=ii(e0),n0=b({},lf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cg=ii(n0),pf=b({},Wr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Xo}),ug=ii(pf),Yo=b({},qo,{propertyName:0,elapsedTime:0,pseudoElement:0}),hg=ii(Yo),dg=b({},lf,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),mf=ii(dg),fg=b({},qo,{newState:0,oldState:0}),i0=ii(fg),NA=[9,13,27,32],rh=Mi&&"CompositionEvent"in window,Qr=null;Mi&&"documentMode"in document&&(Qr=document.documentMode);var kA=Mi&&"TextEvent"in window&&!Qr,gf=Mi&&(!rh||Qr&&8<Qr&&11>=Qr),yf=" ",s0=!1;function pg(i,a){switch(i){case"keyup":return NA.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function a0(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Ko=!1;function r0(i,a){switch(i){case"compositionend":return a0(a);case"keypress":return a.which!==32?null:(s0=!0,yf);case"textInput":return i=a.data,i===yf&&s0?null:i;default:return null}}function PA(i,a){if(Ko)return i==="compositionend"||!rh&&pg(i,a)?(i=pc(),fc=af=za=null,Ko=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return gf&&a.locale!=="ko"?null:a.data;default:return null}}var o0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bf(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!o0[i.type]:a==="textarea"}function mg(i,a,o,d){$o?Cn?Cn.push(d):Cn=[d]:$o=d,a=X0(a,"onChange"),0<a.length&&(o=new rf("onChange","change",null,o,d),i.push({event:o,listeners:a}))}var bc=null,oh=null;function LA(i){cO(i,0)}function vf(i){var a=ea(i);if(Zm(a))return i}function lh(i,a){if(i==="change")return a}var ja=!1;if(Mi){var xn;if(Mi){var vc="oninput"in document;if(!vc){var Ss=document.createElement("div");Ss.setAttribute("oninput","return;"),vc=typeof Ss.oninput=="function"}xn=vc}else xn=!1;ja=xn&&(!document.documentMode||9<document.documentMode)}function l0(){bc&&(bc.detachEvent("onpropertychange",wf),oh=bc=null)}function wf(i){if(i.propertyName==="value"&&vf(oh)){var a=[];mg(a,oh,i,sf(i)),dc(LA,a)}}function c0(i,a,o){i==="focusin"?(l0(),bc=a,oh=o,bc.attachEvent("onpropertychange",wf)):i==="focusout"&&l0()}function Wo(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return vf(oh)}function gg(i,a){if(i==="click")return vf(a)}function wc(i,a){if(i==="input"||i==="change")return vf(a)}function Jr(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var us=typeof Object.is=="function"?Object.is:Jr;function g(i,a){if(us(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var o=Object.keys(i),d=Object.keys(a);if(o.length!==d.length)return!1;for(d=0;d<o.length;d++){var y=o[d];if(!Bo.call(a,y)||!us(i[y],a[y]))return!1}return!0}function v(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function A(i,a){var o=v(i);i=0;for(var d;o;){if(o.nodeType===3){if(d=i+o.textContent.length,i<=a&&d>=a)return{node:o,offset:a-i};i=d}t:{for(;o;){if(o.nextSibling){o=o.nextSibling;break t}o=o.parentNode}o=void 0}o=v(o)}}function x(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?x(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function D(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var a=Ge(i.document);a instanceof i.HTMLIFrameElement;){try{var o=typeof a.contentWindow.location.href=="string"}catch{o=!1}if(o)i=a.contentWindow;else break;a=Ge(i.document)}return a}function L(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}var U=Mi&&"documentMode"in document&&11>=document.documentMode,$=null,X=null,Y=null,et=!1;function q(i,a,o){var d=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;et||$==null||$!==Ge(d)||(d=$,"selectionStart"in d&&L(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Y&&g(Y,d)||(Y=d,d=X0(X,"onSelect"),0<d.length&&(a=new rf("onSelect","select",null,a,o),i.push({event:a,listeners:d}),a.target=$)))}function it(i,a){var o={};return o[i.toLowerCase()]=a.toLowerCase(),o["Webkit"+i]="webkit"+a,o["Moz"+i]="moz"+a,o}var K={animationend:it("Animation","AnimationEnd"),animationiteration:it("Animation","AnimationIteration"),animationstart:it("Animation","AnimationStart"),transitionrun:it("Transition","TransitionRun"),transitionstart:it("Transition","TransitionStart"),transitioncancel:it("Transition","TransitionCancel"),transitionend:it("Transition","TransitionEnd")},Z={},tt={};Mi&&(tt=document.createElement("div").style,"AnimationEvent"in window||(delete K.animationend.animation,delete K.animationiteration.animation,delete K.animationstart.animation),"TransitionEvent"in window||delete K.transitionend.transition);function nt(i){if(Z[i])return Z[i];if(!K[i])return i;var a=K[i],o;for(o in a)if(a.hasOwnProperty(o)&&o in tt)return Z[i]=a[o];return i}var at=nt("animationend"),ut=nt("animationiteration"),bt=nt("animationstart"),At=nt("transitionrun"),Rt=nt("transitionstart"),kt=nt("transitioncancel"),xt=nt("transitionend"),Ot=new Map,Nt="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Nt.push("scrollEnd");function Tt(i,a){Ot.set(i,a),yr(a,[i])}var zt=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},ne=[],he=0,we=0;function ki(){for(var i=he,a=we=he=0;a<i;){var o=ne[a];ne[a++]=null;var d=ne[a];ne[a++]=null;var y=ne[a];ne[a++]=null;var w=ne[a];if(ne[a++]=null,d!==null&&y!==null){var T=d.pending;T===null?y.next=y:(y.next=T.next,T.next=y),d.pending=y}w!==0&&ch(o,y,w)}}function ce(i,a,o,d){ne[he++]=i,ne[he++]=a,ne[he++]=o,ne[he++]=d,we|=d,i.lanes|=d,i=i.alternate,i!==null&&(i.lanes|=d)}function si(i,a,o,d){return ce(i,a,o,d),ai(i)}function Mn(i,a){return ce(i,null,null,a),ai(i)}function ch(i,a,o){i.lanes|=o;var d=i.alternate;d!==null&&(d.lanes|=o);for(var y=!1,w=i.return;w!==null;)w.childLanes|=o,d=w.alternate,d!==null&&(d.childLanes|=o),w.tag===22&&(i=w.stateNode,i===null||i._visibility&1||(y=!0)),i=w,w=w.return;return i.tag===3?(w=i.stateNode,y&&a!==null&&(y=31-Ut(o),i=w.hiddenUpdates,d=i[y],d===null?i[y]=[a]:d.push(a),a.lane=o|536870912),w):null}function ai(i){if(50<Ug)throw Ug=0,VS=null,Error(n(185));for(var a=i.return;a!==null;)i=a,a=i.return;return i.tag===3?i.stateNode:null}var Is={};function yg(i,a,o,d){this.tag=i,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ia(i,a,o,d){return new yg(i,a,o,d)}function IA(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Qo(i,a){var o=i.alternate;return o===null?(o=ia(i.tag,a,i.key,i.mode),o.elementType=i.elementType,o.type=i.type,o.stateNode=i.stateNode,o.alternate=i,i.alternate=o):(o.pendingProps=a,o.type=i.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=i.flags&65011712,o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,a=i.dependencies,o.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},o.sibling=i.sibling,o.index=i.index,o.ref=i.ref,o.refCleanup=i.refCleanup,o}function Gx(i,a){i.flags&=65011714;var o=i.alternate;return o===null?(i.childLanes=0,i.lanes=a,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,a=o.dependencies,i.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),i}function u0(i,a,o,d,y,w){var T=0;if(d=i,typeof i=="function")IA(i)&&(T=1);else if(typeof i=="string")T=vL(i,o,Mt.current)?26:i==="html"||i==="head"||i==="body"?27:5;else t:switch(i){case ct:return i=ia(31,o,a,y),i.elementType=ct,i.lanes=w,i;case C:return uh(o.children,y,w,a);case M:T=8,y|=24;break;case k:return i=ia(12,o,a,y|2),i.elementType=k,i.lanes=w,i;case z:return i=ia(13,o,a,y),i.elementType=z,i.lanes=w,i;case j:return i=ia(19,o,a,y),i.elementType=j,i.lanes=w,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case P:T=10;break t;case I:T=9;break t;case F:T=11;break t;case H:T=14;break t;case dt:T=16,d=null;break t}T=29,o=Error(n(130,i===null?"null":typeof i,"")),d=null}return a=ia(T,o,a,y),a.elementType=i,a.type=d,a.lanes=w,a}function uh(i,a,o,d){return i=ia(7,i,d,a),i.lanes=o,i}function BA(i,a,o){return i=ia(6,i,null,a),i.lanes=o,i}function qx(i){var a=ia(18,null,null,0);return a.stateNode=i,a}function FA(i,a,o){return a=ia(4,i.children!==null?i.children:[],i.key,a),a.lanes=o,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}var Xx=new WeakMap;function Ha(i,a){if(typeof i=="object"&&i!==null){var o=Xx.get(i);return o!==void 0?o:(a={value:i,source:a,stack:Zs(a)},Xx.set(i,a),a)}return{value:i,source:a,stack:Zs(a)}}var _f=[],Af=0,h0=null,bg=0,$a=[],Va=0,_c=null,Zr=1,to="";function Jo(i,a){_f[Af++]=bg,_f[Af++]=h0,h0=i,bg=a}function Yx(i,a,o){$a[Va++]=Zr,$a[Va++]=to,$a[Va++]=_c,_c=i;var d=Zr;i=to;var y=32-Ut(d)-1;d&=~(1<<y),o+=1;var w=32-Ut(a)+y;if(30<w){var T=y-y%5;w=(d&(1<<T)-1).toString(32),d>>=T,y-=T,Zr=1<<32-Ut(a)+y|o<<y|d,to=w+i}else Zr=1<<w|o<<y|d,to=i}function UA(i){i.return!==null&&(Jo(i,1),Yx(i,1,0))}function zA(i){for(;i===h0;)h0=_f[--Af],_f[Af]=null,bg=_f[--Af],_f[Af]=null;for(;i===_c;)_c=$a[--Va],$a[Va]=null,to=$a[--Va],$a[Va]=null,Zr=$a[--Va],$a[Va]=null}function Kx(i,a){$a[Va++]=Zr,$a[Va++]=to,$a[Va++]=_c,Zr=a.id,to=a.overflow,_c=i}var qi=null,Tn=null,Be=!1,Ac=null,Ga=!1,jA=Error(n(519));function Sc(i){var a=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw vg(Ha(a,i)),jA}function Wx(i){var a=i.stateNode,o=i.type,d=i.memoizedProps;switch(a[vn]=i,a[Qn]=d,o){case"dialog":Ne("cancel",a),Ne("close",a);break;case"iframe":case"object":case"embed":Ne("load",a);break;case"video":case"audio":for(o=0;o<jg.length;o++)Ne(jg[o],a);break;case"source":Ne("error",a);break;case"img":case"image":case"link":Ne("error",a),Ne("load",a);break;case"details":Ne("toggle",a);break;case"input":Ne("invalid",a),nf(a,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":Ne("invalid",a);break;case"textarea":Ne("invalid",a),eh(a,d.value,d.defaultValue,d.children)}o=d.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||a.textContent===""+o||d.suppressHydrationWarning===!0||fO(a.textContent,o)?(d.popover!=null&&(Ne("beforetoggle",a),Ne("toggle",a)),d.onScroll!=null&&Ne("scroll",a),d.onScrollEnd!=null&&Ne("scrollend",a),d.onClick!=null&&(a.onclick=Ls),a=!0):a=!1,a||Sc(i,!0)}function Qx(i){for(qi=i.return;qi;)switch(qi.tag){case 5:case 31:case 13:Ga=!1;return;case 27:case 3:Ga=!0;return;default:qi=qi.return}}function Sf(i){if(i!==qi)return!1;if(!Be)return Qx(i),Be=!0,!1;var a=i.tag,o;if((o=a!==3&&a!==27)&&((o=a===5)&&(o=i.type,o=!(o!=="form"&&o!=="button")||aE(i.type,i.memoizedProps)),o=!o),o&&Tn&&Sc(i),Qx(i),a===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));Tn=AO(i)}else if(a===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));Tn=AO(i)}else a===27?(a=Tn,Bc(i.type)?(i=uE,uE=null,Tn=i):Tn=a):Tn=qi?Xa(i.stateNode.nextSibling):null;return!0}function hh(){Tn=qi=null,Be=!1}function HA(){var i=Ac;return i!==null&&(zs===null?zs=i:zs.push.apply(zs,i),Ac=null),i}function vg(i){Ac===null?Ac=[i]:Ac.push(i)}var $A=G(null),dh=null,Zo=null;function Ec(i,a,o){_t($A,a._currentValue),a._currentValue=o}function tl(i){i._currentValue=$A.current,ft($A)}function VA(i,a,o){for(;i!==null;){var d=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,d!==null&&(d.childLanes|=a)):d!==null&&(d.childLanes&a)!==a&&(d.childLanes|=a),i===o)break;i=i.return}}function GA(i,a,o,d){var y=i.child;for(y!==null&&(y.return=i);y!==null;){var w=y.dependencies;if(w!==null){var T=y.child;w=w.firstContext;t:for(;w!==null;){var B=w;w=y;for(var V=0;V<a.length;V++)if(B.context===a[V]){w.lanes|=o,B=w.alternate,B!==null&&(B.lanes|=o),VA(w.return,o,i),d||(T=null);break t}w=B.next}}else if(y.tag===18){if(T=y.return,T===null)throw Error(n(341));T.lanes|=o,w=T.alternate,w!==null&&(w.lanes|=o),VA(T,o,i),T=null}else T=y.child;if(T!==null)T.return=y;else for(T=y;T!==null;){if(T===i){T=null;break}if(y=T.sibling,y!==null){y.return=T.return,T=y;break}T=T.return}y=T}}function Ef(i,a,o,d){i=null;for(var y=a,w=!1;y!==null;){if(!w){if((y.flags&524288)!==0)w=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var T=y.alternate;if(T===null)throw Error(n(387));if(T=T.memoizedProps,T!==null){var B=y.type;us(y.pendingProps.value,T.value)||(i!==null?i.push(B):i=[B])}}else if(y===Ft.current){if(T=y.alternate,T===null)throw Error(n(387));T.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(i!==null?i.push(qg):i=[qg])}y=y.return}i!==null&&GA(a,i,o,d),a.flags|=262144}function d0(i){for(i=i.firstContext;i!==null;){if(!us(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function fh(i){dh=i,Zo=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Xi(i){return Jx(dh,i)}function f0(i,a){return dh===null&&fh(i),Jx(i,a)}function Jx(i,a){var o=a._currentValue;if(a={context:a,memoizedValue:o,next:null},Zo===null){if(i===null)throw Error(n(308));Zo=a,i.dependencies={lanes:0,firstContext:a},i.flags|=524288}else Zo=Zo.next=a;return o}var mP=typeof AbortController<"u"?AbortController:function(){var i=[],a=this.signal={aborted:!1,addEventListener:function(o,d){i.push(d)}};this.abort=function(){a.aborted=!0,i.forEach(function(o){return o()})}},gP=l.unstable_scheduleCallback,yP=l.unstable_NormalPriority,ri={$$typeof:P,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function qA(){return{controller:new mP,data:new Map,refCount:0}}function wg(i){i.refCount--,i.refCount===0&&gP(yP,function(){i.controller.abort()})}var _g=null,XA=0,Cf=0,xf=null;function bP(i,a){if(_g===null){var o=_g=[];XA=0,Cf=WS(),xf={status:"pending",value:void 0,then:function(d){o.push(d)}}}return XA++,a.then(Zx,Zx),a}function Zx(){if(--XA===0&&_g!==null){xf!==null&&(xf.status="fulfilled");var i=_g;_g=null,Cf=0,xf=null;for(var a=0;a<i.length;a++)(0,i[a])()}}function vP(i,a){var o=[],d={status:"pending",value:null,reason:null,then:function(y){o.push(y)}};return i.then(function(){d.status="fulfilled",d.value=a;for(var y=0;y<o.length;y++)(0,o[y])(a)},function(y){for(d.status="rejected",d.reason=y,y=0;y<o.length;y++)(0,o[y])(void 0)}),d}var tT=J.S;J.S=function(i,a){BR=oe(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&bP(i,a),tT!==null&&tT(i,a)};var ph=G(null);function YA(){var i=ph.current;return i!==null?i:fn.pooledCache}function p0(i,a){a===null?_t(ph,ph.current):_t(ph,a.pool)}function eT(){var i=YA();return i===null?null:{parent:ri._currentValue,pool:i}}var Tf=Error(n(460)),KA=Error(n(474)),m0=Error(n(542)),g0={then:function(){}};function nT(i){return i=i.status,i==="fulfilled"||i==="rejected"}function iT(i,a,o){switch(o=i[o],o===void 0?i.push(a):o!==a&&(a.then(Ls,Ls),a=o),a.status){case"fulfilled":return a.value;case"rejected":throw i=a.reason,aT(i),i;default:if(typeof a.status=="string")a.then(Ls,Ls);else{if(i=fn,i!==null&&100<i.shellSuspendCounter)throw Error(n(482));i=a,i.status="pending",i.then(function(d){if(a.status==="pending"){var y=a;y.status="fulfilled",y.value=d}},function(d){if(a.status==="pending"){var y=a;y.status="rejected",y.reason=d}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw i=a.reason,aT(i),i}throw gh=a,Tf}}function mh(i){try{var a=i._init;return a(i._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(gh=o,Tf):o}}var gh=null;function sT(){if(gh===null)throw Error(n(459));var i=gh;return gh=null,i}function aT(i){if(i===Tf||i===m0)throw Error(n(483))}var Rf=null,Ag=0;function y0(i){var a=Ag;return Ag+=1,Rf===null&&(Rf=[]),iT(Rf,i,a)}function Sg(i,a){a=a.props.ref,i.ref=a!==void 0?a:null}function b0(i,a){throw a.$$typeof===_?Error(n(525)):(i=Object.prototype.toString.call(a),Error(n(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i)))}function rT(i){function a(st,W){if(i){var rt=st.deletions;rt===null?(st.deletions=[W],st.flags|=16):rt.push(W)}}function o(st,W){if(!i)return null;for(;W!==null;)a(st,W),W=W.sibling;return null}function d(st){for(var W=new Map;st!==null;)st.key!==null?W.set(st.key,st):W.set(st.index,st),st=st.sibling;return W}function y(st,W){return st=Qo(st,W),st.index=0,st.sibling=null,st}function w(st,W,rt){return st.index=rt,i?(rt=st.alternate,rt!==null?(rt=rt.index,rt<W?(st.flags|=67108866,W):rt):(st.flags|=67108866,W)):(st.flags|=1048576,W)}function T(st){return i&&st.alternate===null&&(st.flags|=67108866),st}function B(st,W,rt,wt){return W===null||W.tag!==6?(W=BA(rt,st.mode,wt),W.return=st,W):(W=y(W,rt),W.return=st,W)}function V(st,W,rt,wt){var ie=rt.type;return ie===C?vt(st,W,rt.props.children,wt,rt.key):W!==null&&(W.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===dt&&mh(ie)===W.type)?(W=y(W,rt.props),Sg(W,rt),W.return=st,W):(W=u0(rt.type,rt.key,rt.props,null,st.mode,wt),Sg(W,rt),W.return=st,W)}function ot(st,W,rt,wt){return W===null||W.tag!==4||W.stateNode.containerInfo!==rt.containerInfo||W.stateNode.implementation!==rt.implementation?(W=FA(rt,st.mode,wt),W.return=st,W):(W=y(W,rt.children||[]),W.return=st,W)}function vt(st,W,rt,wt,ie){return W===null||W.tag!==7?(W=uh(rt,st.mode,wt,ie),W.return=st,W):(W=y(W,rt),W.return=st,W)}function St(st,W,rt){if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return W=BA(""+W,st.mode,rt),W.return=st,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case S:return rt=u0(W.type,W.key,W.props,null,st.mode,rt),Sg(rt,W),rt.return=st,rt;case R:return W=FA(W,st.mode,rt),W.return=st,W;case dt:return W=mh(W),St(st,W,rt)}if(Yt(W)||Pt(W))return W=uh(W,st.mode,rt,null),W.return=st,W;if(typeof W.then=="function")return St(st,y0(W),rt);if(W.$$typeof===P)return St(st,f0(st,W),rt);b0(st,W)}return null}function ht(st,W,rt,wt){var ie=W!==null?W.key:null;if(typeof rt=="string"&&rt!==""||typeof rt=="number"||typeof rt=="bigint")return ie!==null?null:B(st,W,""+rt,wt);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case S:return rt.key===ie?V(st,W,rt,wt):null;case R:return rt.key===ie?ot(st,W,rt,wt):null;case dt:return rt=mh(rt),ht(st,W,rt,wt)}if(Yt(rt)||Pt(rt))return ie!==null?null:vt(st,W,rt,wt,null);if(typeof rt.then=="function")return ht(st,W,y0(rt),wt);if(rt.$$typeof===P)return ht(st,W,f0(st,rt),wt);b0(st,rt)}return null}function mt(st,W,rt,wt,ie){if(typeof wt=="string"&&wt!==""||typeof wt=="number"||typeof wt=="bigint")return st=st.get(rt)||null,B(W,st,""+wt,ie);if(typeof wt=="object"&&wt!==null){switch(wt.$$typeof){case S:return st=st.get(wt.key===null?rt:wt.key)||null,V(W,st,wt,ie);case R:return st=st.get(wt.key===null?rt:wt.key)||null,ot(W,st,wt,ie);case dt:return wt=mh(wt),mt(st,W,rt,wt,ie)}if(Yt(wt)||Pt(wt))return st=st.get(rt)||null,vt(W,st,wt,ie,null);if(typeof wt.then=="function")return mt(st,W,rt,y0(wt),ie);if(wt.$$typeof===P)return mt(st,W,rt,f0(W,wt),ie);b0(W,wt)}return null}function Kt(st,W,rt,wt){for(var ie=null,$e=null,Qt=W,Ce=W=0,Pe=null;Qt!==null&&Ce<rt.length;Ce++){Qt.index>Ce?(Pe=Qt,Qt=null):Pe=Qt.sibling;var Ve=ht(st,Qt,rt[Ce],wt);if(Ve===null){Qt===null&&(Qt=Pe);break}i&&Qt&&Ve.alternate===null&&a(st,Qt),W=w(Ve,W,Ce),$e===null?ie=Ve:$e.sibling=Ve,$e=Ve,Qt=Pe}if(Ce===rt.length)return o(st,Qt),Be&&Jo(st,Ce),ie;if(Qt===null){for(;Ce<rt.length;Ce++)Qt=St(st,rt[Ce],wt),Qt!==null&&(W=w(Qt,W,Ce),$e===null?ie=Qt:$e.sibling=Qt,$e=Qt);return Be&&Jo(st,Ce),ie}for(Qt=d(Qt);Ce<rt.length;Ce++)Pe=mt(Qt,st,Ce,rt[Ce],wt),Pe!==null&&(i&&Pe.alternate!==null&&Qt.delete(Pe.key===null?Ce:Pe.key),W=w(Pe,W,Ce),$e===null?ie=Pe:$e.sibling=Pe,$e=Pe);return i&&Qt.forEach(function(Hc){return a(st,Hc)}),Be&&Jo(st,Ce),ie}function ae(st,W,rt,wt){if(rt==null)throw Error(n(151));for(var ie=null,$e=null,Qt=W,Ce=W=0,Pe=null,Ve=rt.next();Qt!==null&&!Ve.done;Ce++,Ve=rt.next()){Qt.index>Ce?(Pe=Qt,Qt=null):Pe=Qt.sibling;var Hc=ht(st,Qt,Ve.value,wt);if(Hc===null){Qt===null&&(Qt=Pe);break}i&&Qt&&Hc.alternate===null&&a(st,Qt),W=w(Hc,W,Ce),$e===null?ie=Hc:$e.sibling=Hc,$e=Hc,Qt=Pe}if(Ve.done)return o(st,Qt),Be&&Jo(st,Ce),ie;if(Qt===null){for(;!Ve.done;Ce++,Ve=rt.next())Ve=St(st,Ve.value,wt),Ve!==null&&(W=w(Ve,W,Ce),$e===null?ie=Ve:$e.sibling=Ve,$e=Ve);return Be&&Jo(st,Ce),ie}for(Qt=d(Qt);!Ve.done;Ce++,Ve=rt.next())Ve=mt(Qt,st,Ce,Ve.value,wt),Ve!==null&&(i&&Ve.alternate!==null&&Qt.delete(Ve.key===null?Ce:Ve.key),W=w(Ve,W,Ce),$e===null?ie=Ve:$e.sibling=Ve,$e=Ve);return i&&Qt.forEach(function(DL){return a(st,DL)}),Be&&Jo(st,Ce),ie}function sn(st,W,rt,wt){if(typeof rt=="object"&&rt!==null&&rt.type===C&&rt.key===null&&(rt=rt.props.children),typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case S:t:{for(var ie=rt.key;W!==null;){if(W.key===ie){if(ie=rt.type,ie===C){if(W.tag===7){o(st,W.sibling),wt=y(W,rt.props.children),wt.return=st,st=wt;break t}}else if(W.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===dt&&mh(ie)===W.type){o(st,W.sibling),wt=y(W,rt.props),Sg(wt,rt),wt.return=st,st=wt;break t}o(st,W);break}else a(st,W);W=W.sibling}rt.type===C?(wt=uh(rt.props.children,st.mode,wt,rt.key),wt.return=st,st=wt):(wt=u0(rt.type,rt.key,rt.props,null,st.mode,wt),Sg(wt,rt),wt.return=st,st=wt)}return T(st);case R:t:{for(ie=rt.key;W!==null;){if(W.key===ie)if(W.tag===4&&W.stateNode.containerInfo===rt.containerInfo&&W.stateNode.implementation===rt.implementation){o(st,W.sibling),wt=y(W,rt.children||[]),wt.return=st,st=wt;break t}else{o(st,W);break}else a(st,W);W=W.sibling}wt=FA(rt,st.mode,wt),wt.return=st,st=wt}return T(st);case dt:return rt=mh(rt),sn(st,W,rt,wt)}if(Yt(rt))return Kt(st,W,rt,wt);if(Pt(rt)){if(ie=Pt(rt),typeof ie!="function")throw Error(n(150));return rt=ie.call(rt),ae(st,W,rt,wt)}if(typeof rt.then=="function")return sn(st,W,y0(rt),wt);if(rt.$$typeof===P)return sn(st,W,f0(st,rt),wt);b0(st,rt)}return typeof rt=="string"&&rt!==""||typeof rt=="number"||typeof rt=="bigint"?(rt=""+rt,W!==null&&W.tag===6?(o(st,W.sibling),wt=y(W,rt),wt.return=st,st=wt):(o(st,W),wt=BA(rt,st.mode,wt),wt.return=st,st=wt),T(st)):o(st,W)}return function(st,W,rt,wt){try{Ag=0;var ie=sn(st,W,rt,wt);return Rf=null,ie}catch(Qt){if(Qt===Tf||Qt===m0)throw Qt;var $e=ia(29,Qt,null,st.mode);return $e.lanes=wt,$e.return=st,$e}finally{}}}var yh=rT(!0),oT=rT(!1),Cc=!1;function WA(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function QA(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function xc(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Tc(i,a,o){var d=i.updateQueue;if(d===null)return null;if(d=d.shared,(qe&2)!==0){var y=d.pending;return y===null?a.next=a:(a.next=y.next,y.next=a),d.pending=a,a=ai(i),ch(i,null,o),a}return ce(i,d,a,o),ai(i)}function Eg(i,a,o){if(a=a.updateQueue,a!==null&&(a=a.shared,(o&4194048)!==0)){var d=a.lanes;d&=i.pendingLanes,o|=d,a.lanes=o,dn(i,o)}}function JA(i,a){var o=i.updateQueue,d=i.alternate;if(d!==null&&(d=d.updateQueue,o===d)){var y=null,w=null;if(o=o.firstBaseUpdate,o!==null){do{var T={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};w===null?y=w=T:w=w.next=T,o=o.next}while(o!==null);w===null?y=w=a:w=w.next=a}else y=w=a;o={baseState:d.baseState,firstBaseUpdate:y,lastBaseUpdate:w,shared:d.shared,callbacks:d.callbacks},i.updateQueue=o;return}i=o.lastBaseUpdate,i===null?o.firstBaseUpdate=a:i.next=a,o.lastBaseUpdate=a}var ZA=!1;function Cg(){if(ZA){var i=xf;if(i!==null)throw i}}function xg(i,a,o,d){ZA=!1;var y=i.updateQueue;Cc=!1;var w=y.firstBaseUpdate,T=y.lastBaseUpdate,B=y.shared.pending;if(B!==null){y.shared.pending=null;var V=B,ot=V.next;V.next=null,T===null?w=ot:T.next=ot,T=V;var vt=i.alternate;vt!==null&&(vt=vt.updateQueue,B=vt.lastBaseUpdate,B!==T&&(B===null?vt.firstBaseUpdate=ot:B.next=ot,vt.lastBaseUpdate=V))}if(w!==null){var St=y.baseState;T=0,vt=ot=V=null,B=w;do{var ht=B.lane&-536870913,mt=ht!==B.lane;if(mt?(ke&ht)===ht:(d&ht)===ht){ht!==0&&ht===Cf&&(ZA=!0),vt!==null&&(vt=vt.next={lane:0,tag:B.tag,payload:B.payload,callback:null,next:null});t:{var Kt=i,ae=B;ht=a;var sn=o;switch(ae.tag){case 1:if(Kt=ae.payload,typeof Kt=="function"){St=Kt.call(sn,St,ht);break t}St=Kt;break t;case 3:Kt.flags=Kt.flags&-65537|128;case 0:if(Kt=ae.payload,ht=typeof Kt=="function"?Kt.call(sn,St,ht):Kt,ht==null)break t;St=b({},St,ht);break t;case 2:Cc=!0}}ht=B.callback,ht!==null&&(i.flags|=64,mt&&(i.flags|=8192),mt=y.callbacks,mt===null?y.callbacks=[ht]:mt.push(ht))}else mt={lane:ht,tag:B.tag,payload:B.payload,callback:B.callback,next:null},vt===null?(ot=vt=mt,V=St):vt=vt.next=mt,T|=ht;if(B=B.next,B===null){if(B=y.shared.pending,B===null)break;mt=B,B=mt.next,mt.next=null,y.lastBaseUpdate=mt,y.shared.pending=null}}while(!0);vt===null&&(V=St),y.baseState=V,y.firstBaseUpdate=ot,y.lastBaseUpdate=vt,w===null&&(y.shared.lanes=0),Nc|=T,i.lanes=T,i.memoizedState=St}}function lT(i,a){if(typeof i!="function")throw Error(n(191,i));i.call(a)}function cT(i,a){var o=i.callbacks;if(o!==null)for(i.callbacks=null,i=0;i<o.length;i++)lT(o[i],a)}var Of=G(null),v0=G(0);function uT(i,a){i=cl,_t(v0,i),_t(Of,a),cl=i|a.baseLanes}function tS(){_t(v0,cl),_t(Of,Of.current)}function eS(){cl=v0.current,ft(Of),ft(v0)}var sa=G(null),qa=null;function Rc(i){var a=i.alternate;_t(Zn,Zn.current&1),_t(sa,i),qa===null&&(a===null||Of.current!==null||a.memoizedState!==null)&&(qa=i)}function nS(i){_t(Zn,Zn.current),_t(sa,i),qa===null&&(qa=i)}function hT(i){i.tag===22?(_t(Zn,Zn.current),_t(sa,i),qa===null&&(qa=i)):Oc()}function Oc(){_t(Zn,Zn.current),_t(sa,sa.current)}function aa(i){ft(sa),qa===i&&(qa=null),ft(Zn)}var Zn=G(0);function w0(i){for(var a=i;a!==null;){if(a.tag===13){var o=a.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||lE(o)||cE(o)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var el=0,_e=null,en=null,oi=null,_0=!1,Df=!1,bh=!1,A0=0,Tg=0,Mf=null,wP=0;function Hn(){throw Error(n(321))}function iS(i,a){if(a===null)return!1;for(var o=0;o<a.length&&o<i.length;o++)if(!us(i[o],a[o]))return!1;return!0}function sS(i,a,o,d,y,w){return el=w,_e=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,J.H=i===null||i.memoizedState===null?YT:vS,bh=!1,w=o(d,y),bh=!1,Df&&(w=fT(a,o,d,y)),dT(i),w}function dT(i){J.H=Dg;var a=en!==null&&en.next!==null;if(el=0,oi=en=_e=null,_0=!1,Tg=0,Mf=null,a)throw Error(n(300));i===null||li||(i=i.dependencies,i!==null&&d0(i)&&(li=!0))}function fT(i,a,o,d){_e=i;var y=0;do{if(Df&&(Mf=null),Tg=0,Df=!1,25<=y)throw Error(n(301));if(y+=1,oi=en=null,i.updateQueue!=null){var w=i.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}J.H=KT,w=a(o,d)}while(Df);return w}function _P(){var i=J.H,a=i.useState()[0];return a=typeof a.then=="function"?Rg(a):a,i=i.useState()[0],(en!==null?en.memoizedState:null)!==i&&(_e.flags|=1024),a}function aS(){var i=A0!==0;return A0=0,i}function rS(i,a,o){a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~o}function oS(i){if(_0){for(i=i.memoizedState;i!==null;){var a=i.queue;a!==null&&(a.pending=null),i=i.next}_0=!1}el=0,oi=en=_e=null,Df=!1,Tg=A0=0,Mf=null}function Es(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oi===null?_e.memoizedState=oi=i:oi=oi.next=i,oi}function ti(){if(en===null){var i=_e.alternate;i=i!==null?i.memoizedState:null}else i=en.next;var a=oi===null?_e.memoizedState:oi.next;if(a!==null)oi=a,en=i;else{if(i===null)throw _e.alternate===null?Error(n(467)):Error(n(310));en=i,i={memoizedState:en.memoizedState,baseState:en.baseState,baseQueue:en.baseQueue,queue:en.queue,next:null},oi===null?_e.memoizedState=oi=i:oi=oi.next=i}return oi}function S0(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Rg(i){var a=Tg;return Tg+=1,Mf===null&&(Mf=[]),i=iT(Mf,i,a),a=_e,(oi===null?a.memoizedState:oi.next)===null&&(a=a.alternate,J.H=a===null||a.memoizedState===null?YT:vS),i}function E0(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Rg(i);if(i.$$typeof===P)return Xi(i)}throw Error(n(438,String(i)))}function lS(i){var a=null,o=_e.updateQueue;if(o!==null&&(a=o.memoCache),a==null){var d=_e.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(a={data:d.data.map(function(y){return y.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),o===null&&(o=S0(),_e.updateQueue=o),o.memoCache=a,o=a.data[a.index],o===void 0)for(o=a.data[a.index]=Array(i),d=0;d<i;d++)o[d]=yt;return a.index++,o}function nl(i,a){return typeof a=="function"?a(i):a}function C0(i){var a=ti();return cS(a,en,i)}function cS(i,a,o){var d=i.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=o;var y=i.baseQueue,w=d.pending;if(w!==null){if(y!==null){var T=y.next;y.next=w.next,w.next=T}a.baseQueue=y=w,d.pending=null}if(w=i.baseState,y===null)i.memoizedState=w;else{a=y.next;var B=T=null,V=null,ot=a,vt=!1;do{var St=ot.lane&-536870913;if(St!==ot.lane?(ke&St)===St:(el&St)===St){var ht=ot.revertLane;if(ht===0)V!==null&&(V=V.next={lane:0,revertLane:0,gesture:null,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),St===Cf&&(vt=!0);else if((el&ht)===ht){ot=ot.next,ht===Cf&&(vt=!0);continue}else St={lane:0,revertLane:ot.revertLane,gesture:null,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null},V===null?(B=V=St,T=w):V=V.next=St,_e.lanes|=ht,Nc|=ht;St=ot.action,bh&&o(w,St),w=ot.hasEagerState?ot.eagerState:o(w,St)}else ht={lane:St,revertLane:ot.revertLane,gesture:ot.gesture,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null},V===null?(B=V=ht,T=w):V=V.next=ht,_e.lanes|=St,Nc|=St;ot=ot.next}while(ot!==null&&ot!==a);if(V===null?T=w:V.next=B,!us(w,i.memoizedState)&&(li=!0,vt&&(o=xf,o!==null)))throw o;i.memoizedState=w,i.baseState=T,i.baseQueue=V,d.lastRenderedState=w}return y===null&&(d.lanes=0),[i.memoizedState,d.dispatch]}function uS(i){var a=ti(),o=a.queue;if(o===null)throw Error(n(311));o.lastRenderedReducer=i;var d=o.dispatch,y=o.pending,w=a.memoizedState;if(y!==null){o.pending=null;var T=y=y.next;do w=i(w,T.action),T=T.next;while(T!==y);us(w,a.memoizedState)||(li=!0),a.memoizedState=w,a.baseQueue===null&&(a.baseState=w),o.lastRenderedState=w}return[w,d]}function pT(i,a,o){var d=_e,y=ti(),w=Be;if(w){if(o===void 0)throw Error(n(407));o=o()}else o=a();var T=!us((en||y).memoizedState,o);if(T&&(y.memoizedState=o,li=!0),y=y.queue,fS(yT.bind(null,d,y,i),[i]),y.getSnapshot!==a||T||oi!==null&&oi.memoizedState.tag&1){if(d.flags|=2048,Nf(9,{destroy:void 0},gT.bind(null,d,y,o,a),null),fn===null)throw Error(n(349));w||(el&127)!==0||mT(d,a,o)}return o}function mT(i,a,o){i.flags|=16384,i={getSnapshot:a,value:o},a=_e.updateQueue,a===null?(a=S0(),_e.updateQueue=a,a.stores=[i]):(o=a.stores,o===null?a.stores=[i]:o.push(i))}function gT(i,a,o,d){a.value=o,a.getSnapshot=d,bT(a)&&vT(i)}function yT(i,a,o){return o(function(){bT(a)&&vT(i)})}function bT(i){var a=i.getSnapshot;i=i.value;try{var o=a();return!us(i,o)}catch{return!0}}function vT(i){var a=Mn(i,2);a!==null&&js(a,i,2)}function hS(i){var a=Es();if(typeof i=="function"){var o=i;if(i=o(),bh){Vi(!0);try{o()}finally{Vi(!1)}}}return a.memoizedState=a.baseState=i,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:nl,lastRenderedState:i},a}function wT(i,a,o,d){return i.baseState=o,cS(i,en,typeof d=="function"?d:nl)}function AP(i,a,o,d,y){if(R0(i))throw Error(n(485));if(i=a.action,i!==null){var w={payload:y,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(T){w.listeners.push(T)}};J.T!==null?o(!0):w.isTransition=!1,d(w),o=a.pending,o===null?(w.next=a.pending=w,_T(a,w)):(w.next=o.next,a.pending=o.next=w)}}function _T(i,a){var o=a.action,d=a.payload,y=i.state;if(a.isTransition){var w=J.T,T={};J.T=T;try{var B=o(y,d),V=J.S;V!==null&&V(T,B),AT(i,a,B)}catch(ot){dS(i,a,ot)}finally{w!==null&&T.types!==null&&(w.types=T.types),J.T=w}}else try{w=o(y,d),AT(i,a,w)}catch(ot){dS(i,a,ot)}}function AT(i,a,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(d){ST(i,a,d)},function(d){return dS(i,a,d)}):ST(i,a,o)}function ST(i,a,o){a.status="fulfilled",a.value=o,ET(a),i.state=o,a=i.pending,a!==null&&(o=a.next,o===a?i.pending=null:(o=o.next,a.next=o,_T(i,o)))}function dS(i,a,o){var d=i.pending;if(i.pending=null,d!==null){d=d.next;do a.status="rejected",a.reason=o,ET(a),a=a.next;while(a!==d)}i.action=null}function ET(i){i=i.listeners;for(var a=0;a<i.length;a++)(0,i[a])()}function CT(i,a){return a}function xT(i,a){if(Be){var o=fn.formState;if(o!==null){t:{var d=_e;if(Be){if(Tn){e:{for(var y=Tn,w=Ga;y.nodeType!==8;){if(!w){y=null;break e}if(y=Xa(y.nextSibling),y===null){y=null;break e}}w=y.data,y=w==="F!"||w==="F"?y:null}if(y){Tn=Xa(y.nextSibling),d=y.data==="F!";break t}}Sc(d)}d=!1}d&&(a=o[0])}}return o=Es(),o.memoizedState=o.baseState=a,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:CT,lastRenderedState:a},o.queue=d,o=GT.bind(null,_e,d),d.dispatch=o,d=hS(!1),w=bS.bind(null,_e,!1,d.queue),d=Es(),y={state:a,dispatch:null,action:i,pending:null},d.queue=y,o=AP.bind(null,_e,y,w,o),y.dispatch=o,d.memoizedState=i,[a,o,!1]}function TT(i){var a=ti();return RT(a,en,i)}function RT(i,a,o){if(a=cS(i,a,CT)[0],i=C0(nl)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var d=Rg(a)}catch(T){throw T===Tf?m0:T}else d=a;a=ti();var y=a.queue,w=y.dispatch;return o!==a.memoizedState&&(_e.flags|=2048,Nf(9,{destroy:void 0},SP.bind(null,y,o),null)),[d,w,i]}function SP(i,a){i.action=a}function OT(i){var a=ti(),o=en;if(o!==null)return RT(a,o,i);ti(),a=a.memoizedState,o=ti();var d=o.queue.dispatch;return o.memoizedState=i,[a,d,!1]}function Nf(i,a,o,d){return i={tag:i,create:o,deps:d,inst:a,next:null},a=_e.updateQueue,a===null&&(a=S0(),_e.updateQueue=a),o=a.lastEffect,o===null?a.lastEffect=i.next=i:(d=o.next,o.next=i,i.next=d,a.lastEffect=i),i}function DT(){return ti().memoizedState}function x0(i,a,o,d){var y=Es();_e.flags|=i,y.memoizedState=Nf(1|a,{destroy:void 0},o,d===void 0?null:d)}function T0(i,a,o,d){var y=ti();d=d===void 0?null:d;var w=y.memoizedState.inst;en!==null&&d!==null&&iS(d,en.memoizedState.deps)?y.memoizedState=Nf(a,w,o,d):(_e.flags|=i,y.memoizedState=Nf(1|a,w,o,d))}function MT(i,a){x0(8390656,8,i,a)}function fS(i,a){T0(2048,8,i,a)}function EP(i){_e.flags|=4;var a=_e.updateQueue;if(a===null)a=S0(),_e.updateQueue=a,a.events=[i];else{var o=a.events;o===null?a.events=[i]:o.push(i)}}function NT(i){var a=ti().memoizedState;return EP({ref:a,nextImpl:i}),function(){if((qe&2)!==0)throw Error(n(440));return a.impl.apply(void 0,arguments)}}function kT(i,a){return T0(4,2,i,a)}function PT(i,a){return T0(4,4,i,a)}function LT(i,a){if(typeof a=="function"){i=i();var o=a(i);return function(){typeof o=="function"?o():a(null)}}if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function IT(i,a,o){o=o!=null?o.concat([i]):null,T0(4,4,LT.bind(null,a,i),o)}function pS(){}function BT(i,a){var o=ti();a=a===void 0?null:a;var d=o.memoizedState;return a!==null&&iS(a,d[1])?d[0]:(o.memoizedState=[i,a],i)}function FT(i,a){var o=ti();a=a===void 0?null:a;var d=o.memoizedState;if(a!==null&&iS(a,d[1]))return d[0];if(d=i(),bh){Vi(!0);try{i()}finally{Vi(!1)}}return o.memoizedState=[d,a],d}function mS(i,a,o){return o===void 0||(el&1073741824)!==0&&(ke&261930)===0?i.memoizedState=a:(i.memoizedState=o,i=UR(),_e.lanes|=i,Nc|=i,o)}function UT(i,a,o,d){return us(o,a)?o:Of.current!==null?(i=mS(i,o,d),us(i,a)||(li=!0),i):(el&42)===0||(el&1073741824)!==0&&(ke&261930)===0?(li=!0,i.memoizedState=o):(i=UR(),_e.lanes|=i,Nc|=i,a)}function zT(i,a,o,d,y){var w=pt.p;pt.p=w!==0&&8>w?w:8;var T=J.T,B={};J.T=B,bS(i,!1,a,o);try{var V=y(),ot=J.S;if(ot!==null&&ot(B,V),V!==null&&typeof V=="object"&&typeof V.then=="function"){var vt=vP(V,d);Og(i,a,vt,la(i))}else Og(i,a,d,la(i))}catch(St){Og(i,a,{then:function(){},status:"rejected",reason:St},la())}finally{pt.p=w,T!==null&&B.types!==null&&(T.types=B.types),J.T=T}}function CP(){}function gS(i,a,o,d){if(i.tag!==5)throw Error(n(476));var y=jT(i).queue;zT(i,y,a,Et,o===null?CP:function(){return HT(i),o(d)})}function jT(i){var a=i.memoizedState;if(a!==null)return a;a={memoizedState:Et,baseState:Et,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:nl,lastRenderedState:Et},next:null};var o={};return a.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:nl,lastRenderedState:o},next:null},i.memoizedState=a,i=i.alternate,i!==null&&(i.memoizedState=a),a}function HT(i){var a=jT(i);a.next===null&&(a=i.alternate.memoizedState),Og(i,a.next.queue,{},la())}function yS(){return Xi(qg)}function $T(){return ti().memoizedState}function VT(){return ti().memoizedState}function xP(i){for(var a=i.return;a!==null;){switch(a.tag){case 24:case 3:var o=la();i=xc(o);var d=Tc(a,i,o);d!==null&&(js(d,a,o),Eg(d,a,o)),a={cache:qA()},i.payload=a;return}a=a.return}}function TP(i,a,o){var d=la();o={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},R0(i)?qT(a,o):(o=si(i,a,o,d),o!==null&&(js(o,i,d),XT(o,a,d)))}function GT(i,a,o){var d=la();Og(i,a,o,d)}function Og(i,a,o,d){var y={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(R0(i))qT(a,y);else{var w=i.alternate;if(i.lanes===0&&(w===null||w.lanes===0)&&(w=a.lastRenderedReducer,w!==null))try{var T=a.lastRenderedState,B=w(T,o);if(y.hasEagerState=!0,y.eagerState=B,us(B,T))return ce(i,a,y,0),fn===null&&ki(),!1}catch{}finally{}if(o=si(i,a,y,d),o!==null)return js(o,i,d),XT(o,a,d),!0}return!1}function bS(i,a,o,d){if(d={lane:2,revertLane:WS(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},R0(i)){if(a)throw Error(n(479))}else a=si(i,o,d,2),a!==null&&js(a,i,2)}function R0(i){var a=i.alternate;return i===_e||a!==null&&a===_e}function qT(i,a){Df=_0=!0;var o=i.pending;o===null?a.next=a:(a.next=o.next,o.next=a),i.pending=a}function XT(i,a,o){if((o&4194048)!==0){var d=a.lanes;d&=i.pendingLanes,o|=d,a.lanes=o,dn(i,o)}}var Dg={readContext:Xi,use:E0,useCallback:Hn,useContext:Hn,useEffect:Hn,useImperativeHandle:Hn,useLayoutEffect:Hn,useInsertionEffect:Hn,useMemo:Hn,useReducer:Hn,useRef:Hn,useState:Hn,useDebugValue:Hn,useDeferredValue:Hn,useTransition:Hn,useSyncExternalStore:Hn,useId:Hn,useHostTransitionStatus:Hn,useFormState:Hn,useActionState:Hn,useOptimistic:Hn,useMemoCache:Hn,useCacheRefresh:Hn};Dg.useEffectEvent=Hn;var YT={readContext:Xi,use:E0,useCallback:function(i,a){return Es().memoizedState=[i,a===void 0?null:a],i},useContext:Xi,useEffect:MT,useImperativeHandle:function(i,a,o){o=o!=null?o.concat([i]):null,x0(4194308,4,LT.bind(null,a,i),o)},useLayoutEffect:function(i,a){return x0(4194308,4,i,a)},useInsertionEffect:function(i,a){x0(4,2,i,a)},useMemo:function(i,a){var o=Es();a=a===void 0?null:a;var d=i();if(bh){Vi(!0);try{i()}finally{Vi(!1)}}return o.memoizedState=[d,a],d},useReducer:function(i,a,o){var d=Es();if(o!==void 0){var y=o(a);if(bh){Vi(!0);try{o(a)}finally{Vi(!1)}}}else y=a;return d.memoizedState=d.baseState=y,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:y},d.queue=i,i=i.dispatch=TP.bind(null,_e,i),[d.memoizedState,i]},useRef:function(i){var a=Es();return i={current:i},a.memoizedState=i},useState:function(i){i=hS(i);var a=i.queue,o=GT.bind(null,_e,a);return a.dispatch=o,[i.memoizedState,o]},useDebugValue:pS,useDeferredValue:function(i,a){var o=Es();return mS(o,i,a)},useTransition:function(){var i=hS(!1);return i=zT.bind(null,_e,i.queue,!0,!1),Es().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,a,o){var d=_e,y=Es();if(Be){if(o===void 0)throw Error(n(407));o=o()}else{if(o=a(),fn===null)throw Error(n(349));(ke&127)!==0||mT(d,a,o)}y.memoizedState=o;var w={value:o,getSnapshot:a};return y.queue=w,MT(yT.bind(null,d,w,i),[i]),d.flags|=2048,Nf(9,{destroy:void 0},gT.bind(null,d,w,o,a),null),o},useId:function(){var i=Es(),a=fn.identifierPrefix;if(Be){var o=to,d=Zr;o=(d&~(1<<32-Ut(d)-1)).toString(32)+o,a="_"+a+"R_"+o,o=A0++,0<o&&(a+="H"+o.toString(32)),a+="_"}else o=wP++,a="_"+a+"r_"+o.toString(32)+"_";return i.memoizedState=a},useHostTransitionStatus:yS,useFormState:xT,useActionState:xT,useOptimistic:function(i){var a=Es();a.memoizedState=a.baseState=i;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=o,a=bS.bind(null,_e,!0,o),o.dispatch=a,[i,a]},useMemoCache:lS,useCacheRefresh:function(){return Es().memoizedState=xP.bind(null,_e)},useEffectEvent:function(i){var a=Es(),o={impl:i};return a.memoizedState=o,function(){if((qe&2)!==0)throw Error(n(440));return o.impl.apply(void 0,arguments)}}},vS={readContext:Xi,use:E0,useCallback:BT,useContext:Xi,useEffect:fS,useImperativeHandle:IT,useInsertionEffect:kT,useLayoutEffect:PT,useMemo:FT,useReducer:C0,useRef:DT,useState:function(){return C0(nl)},useDebugValue:pS,useDeferredValue:function(i,a){var o=ti();return UT(o,en.memoizedState,i,a)},useTransition:function(){var i=C0(nl)[0],a=ti().memoizedState;return[typeof i=="boolean"?i:Rg(i),a]},useSyncExternalStore:pT,useId:$T,useHostTransitionStatus:yS,useFormState:TT,useActionState:TT,useOptimistic:function(i,a){var o=ti();return wT(o,en,i,a)},useMemoCache:lS,useCacheRefresh:VT};vS.useEffectEvent=NT;var KT={readContext:Xi,use:E0,useCallback:BT,useContext:Xi,useEffect:fS,useImperativeHandle:IT,useInsertionEffect:kT,useLayoutEffect:PT,useMemo:FT,useReducer:uS,useRef:DT,useState:function(){return uS(nl)},useDebugValue:pS,useDeferredValue:function(i,a){var o=ti();return en===null?mS(o,i,a):UT(o,en.memoizedState,i,a)},useTransition:function(){var i=uS(nl)[0],a=ti().memoizedState;return[typeof i=="boolean"?i:Rg(i),a]},useSyncExternalStore:pT,useId:$T,useHostTransitionStatus:yS,useFormState:OT,useActionState:OT,useOptimistic:function(i,a){var o=ti();return en!==null?wT(o,en,i,a):(o.baseState=i,[i,o.queue.dispatch])},useMemoCache:lS,useCacheRefresh:VT};KT.useEffectEvent=NT;function wS(i,a,o,d){a=i.memoizedState,o=o(d,a),o=o==null?a:b({},a,o),i.memoizedState=o,i.lanes===0&&(i.updateQueue.baseState=o)}var _S={enqueueSetState:function(i,a,o){i=i._reactInternals;var d=la(),y=xc(d);y.payload=a,o!=null&&(y.callback=o),a=Tc(i,y,d),a!==null&&(js(a,i,d),Eg(a,i,d))},enqueueReplaceState:function(i,a,o){i=i._reactInternals;var d=la(),y=xc(d);y.tag=1,y.payload=a,o!=null&&(y.callback=o),a=Tc(i,y,d),a!==null&&(js(a,i,d),Eg(a,i,d))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var o=la(),d=xc(o);d.tag=2,a!=null&&(d.callback=a),a=Tc(i,d,o),a!==null&&(js(a,i,o),Eg(a,i,o))}};function WT(i,a,o,d,y,w,T){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(d,w,T):a.prototype&&a.prototype.isPureReactComponent?!g(o,d)||!g(y,w):!0}function QT(i,a,o,d){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(o,d),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(o,d),a.state!==i&&_S.enqueueReplaceState(a,a.state,null)}function vh(i,a){var o=a;if("ref"in a){o={};for(var d in a)d!=="ref"&&(o[d]=a[d])}if(i=i.defaultProps){o===a&&(o=b({},o));for(var y in i)o[y]===void 0&&(o[y]=i[y])}return o}function JT(i){zt(i)}function ZT(i){console.error(i)}function tR(i){zt(i)}function O0(i,a){try{var o=i.onUncaughtError;o(a.value,{componentStack:a.stack})}catch(d){setTimeout(function(){throw d})}}function eR(i,a,o){try{var d=i.onCaughtError;d(o.value,{componentStack:o.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function AS(i,a,o){return o=xc(o),o.tag=3,o.payload={element:null},o.callback=function(){O0(i,a)},o}function nR(i){return i=xc(i),i.tag=3,i}function iR(i,a,o,d){var y=o.type.getDerivedStateFromError;if(typeof y=="function"){var w=d.value;i.payload=function(){return y(w)},i.callback=function(){eR(a,o,d)}}var T=o.stateNode;T!==null&&typeof T.componentDidCatch=="function"&&(i.callback=function(){eR(a,o,d),typeof y!="function"&&(kc===null?kc=new Set([this]):kc.add(this));var B=d.stack;this.componentDidCatch(d.value,{componentStack:B!==null?B:""})})}function RP(i,a,o,d,y){if(o.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(a=o.alternate,a!==null&&Ef(a,o,y,!0),o=sa.current,o!==null){switch(o.tag){case 31:case 13:return qa===null?j0():o.alternate===null&&$n===0&&($n=3),o.flags&=-257,o.flags|=65536,o.lanes=y,d===g0?o.flags|=16384:(a=o.updateQueue,a===null?o.updateQueue=new Set([d]):a.add(d),XS(i,d,y)),!1;case 22:return o.flags|=65536,d===g0?o.flags|=16384:(a=o.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([d])},o.updateQueue=a):(o=a.retryQueue,o===null?a.retryQueue=new Set([d]):o.add(d)),XS(i,d,y)),!1}throw Error(n(435,o.tag))}return XS(i,d,y),j0(),!1}if(Be)return a=sa.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=y,d!==jA&&(i=Error(n(422),{cause:d}),vg(Ha(i,o)))):(d!==jA&&(a=Error(n(423),{cause:d}),vg(Ha(a,o))),i=i.current.alternate,i.flags|=65536,y&=-y,i.lanes|=y,d=Ha(d,o),y=AS(i.stateNode,d,y),JA(i,y),$n!==4&&($n=2)),!1;var w=Error(n(520),{cause:d});if(w=Ha(w,o),Fg===null?Fg=[w]:Fg.push(w),$n!==4&&($n=2),a===null)return!0;d=Ha(d,o),o=a;do{switch(o.tag){case 3:return o.flags|=65536,i=y&-y,o.lanes|=i,i=AS(o.stateNode,d,i),JA(o,i),!1;case 1:if(a=o.type,w=o.stateNode,(o.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(kc===null||!kc.has(w))))return o.flags|=65536,y&=-y,o.lanes|=y,y=nR(y),iR(y,i,o,d),JA(o,y),!1}o=o.return}while(o!==null);return!1}var SS=Error(n(461)),li=!1;function Yi(i,a,o,d){a.child=i===null?oT(a,null,o,d):yh(a,i.child,o,d)}function sR(i,a,o,d,y){o=o.render;var w=a.ref;if("ref"in d){var T={};for(var B in d)B!=="ref"&&(T[B]=d[B])}else T=d;return fh(a),d=sS(i,a,o,T,w,y),B=aS(),i!==null&&!li?(rS(i,a,y),il(i,a,y)):(Be&&B&&UA(a),a.flags|=1,Yi(i,a,d,y),a.child)}function aR(i,a,o,d,y){if(i===null){var w=o.type;return typeof w=="function"&&!IA(w)&&w.defaultProps===void 0&&o.compare===null?(a.tag=15,a.type=w,rR(i,a,w,d,y)):(i=u0(o.type,null,d,a,a.mode,y),i.ref=a.ref,i.return=a,a.child=i)}if(w=i.child,!MS(i,y)){var T=w.memoizedProps;if(o=o.compare,o=o!==null?o:g,o(T,d)&&i.ref===a.ref)return il(i,a,y)}return a.flags|=1,i=Qo(w,d),i.ref=a.ref,i.return=a,a.child=i}function rR(i,a,o,d,y){if(i!==null){var w=i.memoizedProps;if(g(w,d)&&i.ref===a.ref)if(li=!1,a.pendingProps=d=w,MS(i,y))(i.flags&131072)!==0&&(li=!0);else return a.lanes=i.lanes,il(i,a,y)}return ES(i,a,o,d,y)}function oR(i,a,o,d){var y=d.children,w=i!==null?i.memoizedState:null;if(i===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((a.flags&128)!==0){if(w=w!==null?w.baseLanes|o:o,i!==null){for(d=a.child=i.child,y=0;d!==null;)y=y|d.lanes|d.childLanes,d=d.sibling;d=y&~w}else d=0,a.child=null;return lR(i,a,w,o,d)}if((o&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},i!==null&&p0(a,w!==null?w.cachePool:null),w!==null?uT(a,w):tS(),hT(a);else return d=a.lanes=536870912,lR(i,a,w!==null?w.baseLanes|o:o,o,d)}else w!==null?(p0(a,w.cachePool),uT(a,w),Oc(),a.memoizedState=null):(i!==null&&p0(a,null),tS(),Oc());return Yi(i,a,y,o),a.child}function Mg(i,a){return i!==null&&i.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function lR(i,a,o,d,y){var w=YA();return w=w===null?null:{parent:ri._currentValue,pool:w},a.memoizedState={baseLanes:o,cachePool:w},i!==null&&p0(a,null),tS(),hT(a),i!==null&&Ef(i,a,d,!0),a.childLanes=y,null}function D0(i,a){return a=N0({mode:a.mode,children:a.children},i.mode),a.ref=i.ref,i.child=a,a.return=i,a}function cR(i,a,o){return yh(a,i.child,null,o),i=D0(a,a.pendingProps),i.flags|=2,aa(a),a.memoizedState=null,i}function OP(i,a,o){var d=a.pendingProps,y=(a.flags&128)!==0;if(a.flags&=-129,i===null){if(Be){if(d.mode==="hidden")return i=D0(a,d),a.lanes=536870912,Mg(null,i);if(nS(a),(i=Tn)?(i=_O(i,Ga),i=i!==null&&i.data==="&"?i:null,i!==null&&(a.memoizedState={dehydrated:i,treeContext:_c!==null?{id:Zr,overflow:to}:null,retryLane:536870912,hydrationErrors:null},o=qx(i),o.return=a,a.child=o,qi=a,Tn=null)):i=null,i===null)throw Sc(a);return a.lanes=536870912,null}return D0(a,d)}var w=i.memoizedState;if(w!==null){var T=w.dehydrated;if(nS(a),y)if(a.flags&256)a.flags&=-257,a=cR(i,a,o);else if(a.memoizedState!==null)a.child=i.child,a.flags|=128,a=null;else throw Error(n(558));else if(li||Ef(i,a,o,!1),y=(o&i.childLanes)!==0,li||y){if(d=fn,d!==null&&(T=Wn(d,o),T!==0&&T!==w.retryLane))throw w.retryLane=T,Mn(i,T),js(d,i,T),SS;j0(),a=cR(i,a,o)}else i=w.treeContext,Tn=Xa(T.nextSibling),qi=a,Be=!0,Ac=null,Ga=!1,i!==null&&Kx(a,i),a=D0(a,d),a.flags|=4096;return a}return i=Qo(i.child,{mode:d.mode,children:d.children}),i.ref=a.ref,a.child=i,i.return=a,i}function M0(i,a){var o=a.ref;if(o===null)i!==null&&i.ref!==null&&(a.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(n(284));(i===null||i.ref!==o)&&(a.flags|=4194816)}}function ES(i,a,o,d,y){return fh(a),o=sS(i,a,o,d,void 0,y),d=aS(),i!==null&&!li?(rS(i,a,y),il(i,a,y)):(Be&&d&&UA(a),a.flags|=1,Yi(i,a,o,y),a.child)}function uR(i,a,o,d,y,w){return fh(a),a.updateQueue=null,o=fT(a,d,o,y),dT(i),d=aS(),i!==null&&!li?(rS(i,a,w),il(i,a,w)):(Be&&d&&UA(a),a.flags|=1,Yi(i,a,o,w),a.child)}function hR(i,a,o,d,y){if(fh(a),a.stateNode===null){var w=Is,T=o.contextType;typeof T=="object"&&T!==null&&(w=Xi(T)),w=new o(d,w),a.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=_S,a.stateNode=w,w._reactInternals=a,w=a.stateNode,w.props=d,w.state=a.memoizedState,w.refs={},WA(a),T=o.contextType,w.context=typeof T=="object"&&T!==null?Xi(T):Is,w.state=a.memoizedState,T=o.getDerivedStateFromProps,typeof T=="function"&&(wS(a,o,T,d),w.state=a.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(T=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),T!==w.state&&_S.enqueueReplaceState(w,w.state,null),xg(a,d,w,y),Cg(),w.state=a.memoizedState),typeof w.componentDidMount=="function"&&(a.flags|=4194308),d=!0}else if(i===null){w=a.stateNode;var B=a.memoizedProps,V=vh(o,B);w.props=V;var ot=w.context,vt=o.contextType;T=Is,typeof vt=="object"&&vt!==null&&(T=Xi(vt));var St=o.getDerivedStateFromProps;vt=typeof St=="function"||typeof w.getSnapshotBeforeUpdate=="function",B=a.pendingProps!==B,vt||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(B||ot!==T)&&QT(a,w,d,T),Cc=!1;var ht=a.memoizedState;w.state=ht,xg(a,d,w,y),Cg(),ot=a.memoizedState,B||ht!==ot||Cc?(typeof St=="function"&&(wS(a,o,St,d),ot=a.memoizedState),(V=Cc||WT(a,o,V,d,ht,ot,T))?(vt||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(a.flags|=4194308)):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=d,a.memoizedState=ot),w.props=d,w.state=ot,w.context=T,d=V):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),d=!1)}else{w=a.stateNode,QA(i,a),T=a.memoizedProps,vt=vh(o,T),w.props=vt,St=a.pendingProps,ht=w.context,ot=o.contextType,V=Is,typeof ot=="object"&&ot!==null&&(V=Xi(ot)),B=o.getDerivedStateFromProps,(ot=typeof B=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(T!==St||ht!==V)&&QT(a,w,d,V),Cc=!1,ht=a.memoizedState,w.state=ht,xg(a,d,w,y),Cg();var mt=a.memoizedState;T!==St||ht!==mt||Cc||i!==null&&i.dependencies!==null&&d0(i.dependencies)?(typeof B=="function"&&(wS(a,o,B,d),mt=a.memoizedState),(vt=Cc||WT(a,o,vt,d,ht,mt,V)||i!==null&&i.dependencies!==null&&d0(i.dependencies))?(ot||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(d,mt,V),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(d,mt,V)),typeof w.componentDidUpdate=="function"&&(a.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof w.componentDidUpdate!="function"||T===i.memoizedProps&&ht===i.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||T===i.memoizedProps&&ht===i.memoizedState||(a.flags|=1024),a.memoizedProps=d,a.memoizedState=mt),w.props=d,w.state=mt,w.context=V,d=vt):(typeof w.componentDidUpdate!="function"||T===i.memoizedProps&&ht===i.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||T===i.memoizedProps&&ht===i.memoizedState||(a.flags|=1024),d=!1)}return w=d,M0(i,a),d=(a.flags&128)!==0,w||d?(w=a.stateNode,o=d&&typeof o.getDerivedStateFromError!="function"?null:w.render(),a.flags|=1,i!==null&&d?(a.child=yh(a,i.child,null,y),a.child=yh(a,null,o,y)):Yi(i,a,o,y),a.memoizedState=w.state,i=a.child):i=il(i,a,y),i}function dR(i,a,o,d){return hh(),a.flags|=256,Yi(i,a,o,d),a.child}var CS={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function xS(i){return{baseLanes:i,cachePool:eT()}}function TS(i,a,o){return i=i!==null?i.childLanes&~o:0,a&&(i|=oa),i}function fR(i,a,o){var d=a.pendingProps,y=!1,w=(a.flags&128)!==0,T;if((T=w)||(T=i!==null&&i.memoizedState===null?!1:(Zn.current&2)!==0),T&&(y=!0,a.flags&=-129),T=(a.flags&32)!==0,a.flags&=-33,i===null){if(Be){if(y?Rc(a):Oc(),(i=Tn)?(i=_O(i,Ga),i=i!==null&&i.data!=="&"?i:null,i!==null&&(a.memoizedState={dehydrated:i,treeContext:_c!==null?{id:Zr,overflow:to}:null,retryLane:536870912,hydrationErrors:null},o=qx(i),o.return=a,a.child=o,qi=a,Tn=null)):i=null,i===null)throw Sc(a);return cE(i)?a.lanes=32:a.lanes=536870912,null}var B=d.children;return d=d.fallback,y?(Oc(),y=a.mode,B=N0({mode:"hidden",children:B},y),d=uh(d,y,o,null),B.return=a,d.return=a,B.sibling=d,a.child=B,d=a.child,d.memoizedState=xS(o),d.childLanes=TS(i,T,o),a.memoizedState=CS,Mg(null,d)):(Rc(a),RS(a,B))}var V=i.memoizedState;if(V!==null&&(B=V.dehydrated,B!==null)){if(w)a.flags&256?(Rc(a),a.flags&=-257,a=OS(i,a,o)):a.memoizedState!==null?(Oc(),a.child=i.child,a.flags|=128,a=null):(Oc(),B=d.fallback,y=a.mode,d=N0({mode:"visible",children:d.children},y),B=uh(B,y,o,null),B.flags|=2,d.return=a,B.return=a,d.sibling=B,a.child=d,yh(a,i.child,null,o),d=a.child,d.memoizedState=xS(o),d.childLanes=TS(i,T,o),a.memoizedState=CS,a=Mg(null,d));else if(Rc(a),cE(B)){if(T=B.nextSibling&&B.nextSibling.dataset,T)var ot=T.dgst;T=ot,d=Error(n(419)),d.stack="",d.digest=T,vg({value:d,source:null,stack:null}),a=OS(i,a,o)}else if(li||Ef(i,a,o,!1),T=(o&i.childLanes)!==0,li||T){if(T=fn,T!==null&&(d=Wn(T,o),d!==0&&d!==V.retryLane))throw V.retryLane=d,Mn(i,d),js(T,i,d),SS;lE(B)||j0(),a=OS(i,a,o)}else lE(B)?(a.flags|=192,a.child=i.child,a=null):(i=V.treeContext,Tn=Xa(B.nextSibling),qi=a,Be=!0,Ac=null,Ga=!1,i!==null&&Kx(a,i),a=RS(a,d.children),a.flags|=4096);return a}return y?(Oc(),B=d.fallback,y=a.mode,V=i.child,ot=V.sibling,d=Qo(V,{mode:"hidden",children:d.children}),d.subtreeFlags=V.subtreeFlags&65011712,ot!==null?B=Qo(ot,B):(B=uh(B,y,o,null),B.flags|=2),B.return=a,d.return=a,d.sibling=B,a.child=d,Mg(null,d),d=a.child,B=i.child.memoizedState,B===null?B=xS(o):(y=B.cachePool,y!==null?(V=ri._currentValue,y=y.parent!==V?{parent:V,pool:V}:y):y=eT(),B={baseLanes:B.baseLanes|o,cachePool:y}),d.memoizedState=B,d.childLanes=TS(i,T,o),a.memoizedState=CS,Mg(i.child,d)):(Rc(a),o=i.child,i=o.sibling,o=Qo(o,{mode:"visible",children:d.children}),o.return=a,o.sibling=null,i!==null&&(T=a.deletions,T===null?(a.deletions=[i],a.flags|=16):T.push(i)),a.child=o,a.memoizedState=null,o)}function RS(i,a){return a=N0({mode:"visible",children:a},i.mode),a.return=i,i.child=a}function N0(i,a){return i=ia(22,i,null,a),i.lanes=0,i}function OS(i,a,o){return yh(a,i.child,null,o),i=RS(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function pR(i,a,o){i.lanes|=a;var d=i.alternate;d!==null&&(d.lanes|=a),VA(i.return,a,o)}function DS(i,a,o,d,y,w){var T=i.memoizedState;T===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:d,tail:o,tailMode:y,treeForkCount:w}:(T.isBackwards=a,T.rendering=null,T.renderingStartTime=0,T.last=d,T.tail=o,T.tailMode=y,T.treeForkCount=w)}function mR(i,a,o){var d=a.pendingProps,y=d.revealOrder,w=d.tail;d=d.children;var T=Zn.current,B=(T&2)!==0;if(B?(T=T&1|2,a.flags|=128):T&=1,_t(Zn,T),Yi(i,a,d,o),d=Be?bg:0,!B&&i!==null&&(i.flags&128)!==0)t:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&pR(i,o,a);else if(i.tag===19)pR(i,o,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break t;for(;i.sibling===null;){if(i.return===null||i.return===a)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(y){case"forwards":for(o=a.child,y=null;o!==null;)i=o.alternate,i!==null&&w0(i)===null&&(y=o),o=o.sibling;o=y,o===null?(y=a.child,a.child=null):(y=o.sibling,o.sibling=null),DS(a,!1,y,o,w,d);break;case"backwards":case"unstable_legacy-backwards":for(o=null,y=a.child,a.child=null;y!==null;){if(i=y.alternate,i!==null&&w0(i)===null){a.child=y;break}i=y.sibling,y.sibling=o,o=y,y=i}DS(a,!0,o,null,w,d);break;case"together":DS(a,!1,null,null,void 0,d);break;default:a.memoizedState=null}return a.child}function il(i,a,o){if(i!==null&&(a.dependencies=i.dependencies),Nc|=a.lanes,(o&a.childLanes)===0)if(i!==null){if(Ef(i,a,o,!1),(o&a.childLanes)===0)return null}else return null;if(i!==null&&a.child!==i.child)throw Error(n(153));if(a.child!==null){for(i=a.child,o=Qo(i,i.pendingProps),a.child=o,o.return=a;i.sibling!==null;)i=i.sibling,o=o.sibling=Qo(i,i.pendingProps),o.return=a;o.sibling=null}return a.child}function MS(i,a){return(i.lanes&a)!==0?!0:(i=i.dependencies,!!(i!==null&&d0(i)))}function DP(i,a,o){switch(a.tag){case 3:Ke(a,a.stateNode.containerInfo),Ec(a,ri,i.memoizedState.cache),hh();break;case 27:case 5:pi(a);break;case 4:Ke(a,a.stateNode.containerInfo);break;case 10:Ec(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,nS(a),null;break;case 13:var d=a.memoizedState;if(d!==null)return d.dehydrated!==null?(Rc(a),a.flags|=128,null):(o&a.child.childLanes)!==0?fR(i,a,o):(Rc(a),i=il(i,a,o),i!==null?i.sibling:null);Rc(a);break;case 19:var y=(i.flags&128)!==0;if(d=(o&a.childLanes)!==0,d||(Ef(i,a,o,!1),d=(o&a.childLanes)!==0),y){if(d)return mR(i,a,o);a.flags|=128}if(y=a.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),_t(Zn,Zn.current),d)break;return null;case 22:return a.lanes=0,oR(i,a,o,a.pendingProps);case 24:Ec(a,ri,i.memoizedState.cache)}return il(i,a,o)}function gR(i,a,o){if(i!==null)if(i.memoizedProps!==a.pendingProps)li=!0;else{if(!MS(i,o)&&(a.flags&128)===0)return li=!1,DP(i,a,o);li=(i.flags&131072)!==0}else li=!1,Be&&(a.flags&1048576)!==0&&Yx(a,bg,a.index);switch(a.lanes=0,a.tag){case 16:t:{var d=a.pendingProps;if(i=mh(a.elementType),a.type=i,typeof i=="function")IA(i)?(d=vh(i,d),a.tag=1,a=hR(null,a,i,d,o)):(a.tag=0,a=ES(null,a,i,d,o));else{if(i!=null){var y=i.$$typeof;if(y===F){a.tag=11,a=sR(null,a,i,d,o);break t}else if(y===H){a.tag=14,a=aR(null,a,i,d,o);break t}}throw a=Vt(i)||i,Error(n(306,a,""))}}return a;case 0:return ES(i,a,a.type,a.pendingProps,o);case 1:return d=a.type,y=vh(d,a.pendingProps),hR(i,a,d,y,o);case 3:t:{if(Ke(a,a.stateNode.containerInfo),i===null)throw Error(n(387));d=a.pendingProps;var w=a.memoizedState;y=w.element,QA(i,a),xg(a,d,null,o);var T=a.memoizedState;if(d=T.cache,Ec(a,ri,d),d!==w.cache&&GA(a,[ri],o,!0),Cg(),d=T.element,w.isDehydrated)if(w={element:d,isDehydrated:!1,cache:T.cache},a.updateQueue.baseState=w,a.memoizedState=w,a.flags&256){a=dR(i,a,d,o);break t}else if(d!==y){y=Ha(Error(n(424)),a),vg(y),a=dR(i,a,d,o);break t}else{switch(i=a.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Tn=Xa(i.firstChild),qi=a,Be=!0,Ac=null,Ga=!0,o=oT(a,null,d,o),a.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(hh(),d===y){a=il(i,a,o);break t}Yi(i,a,d,o)}a=a.child}return a;case 26:return M0(i,a),i===null?(o=TO(a.type,null,a.pendingProps,null))?a.memoizedState=o:Be||(o=a.type,i=a.pendingProps,d=Y0(Gt.current).createElement(o),d[vn]=a,d[Qn]=i,Ki(d,o,i),Jn(d),a.stateNode=d):a.memoizedState=TO(a.type,i.memoizedProps,a.pendingProps,i.memoizedState),null;case 27:return pi(a),i===null&&Be&&(d=a.stateNode=EO(a.type,a.pendingProps,Gt.current),qi=a,Ga=!0,y=Tn,Bc(a.type)?(uE=y,Tn=Xa(d.firstChild)):Tn=y),Yi(i,a,a.pendingProps.children,o),M0(i,a),i===null&&(a.flags|=4194304),a.child;case 5:return i===null&&Be&&((y=d=Tn)&&(d=rL(d,a.type,a.pendingProps,Ga),d!==null?(a.stateNode=d,qi=a,Tn=Xa(d.firstChild),Ga=!1,y=!0):y=!1),y||Sc(a)),pi(a),y=a.type,w=a.pendingProps,T=i!==null?i.memoizedProps:null,d=w.children,aE(y,w)?d=null:T!==null&&aE(y,T)&&(a.flags|=32),a.memoizedState!==null&&(y=sS(i,a,_P,null,null,o),qg._currentValue=y),M0(i,a),Yi(i,a,d,o),a.child;case 6:return i===null&&Be&&((i=o=Tn)&&(o=oL(o,a.pendingProps,Ga),o!==null?(a.stateNode=o,qi=a,Tn=null,i=!0):i=!1),i||Sc(a)),null;case 13:return fR(i,a,o);case 4:return Ke(a,a.stateNode.containerInfo),d=a.pendingProps,i===null?a.child=yh(a,null,d,o):Yi(i,a,d,o),a.child;case 11:return sR(i,a,a.type,a.pendingProps,o);case 7:return Yi(i,a,a.pendingProps,o),a.child;case 8:return Yi(i,a,a.pendingProps.children,o),a.child;case 12:return Yi(i,a,a.pendingProps.children,o),a.child;case 10:return d=a.pendingProps,Ec(a,a.type,d.value),Yi(i,a,d.children,o),a.child;case 9:return y=a.type._context,d=a.pendingProps.children,fh(a),y=Xi(y),d=d(y),a.flags|=1,Yi(i,a,d,o),a.child;case 14:return aR(i,a,a.type,a.pendingProps,o);case 15:return rR(i,a,a.type,a.pendingProps,o);case 19:return mR(i,a,o);case 31:return OP(i,a,o);case 22:return oR(i,a,o,a.pendingProps);case 24:return fh(a),d=Xi(ri),i===null?(y=YA(),y===null&&(y=fn,w=qA(),y.pooledCache=w,w.refCount++,w!==null&&(y.pooledCacheLanes|=o),y=w),a.memoizedState={parent:d,cache:y},WA(a),Ec(a,ri,y)):((i.lanes&o)!==0&&(QA(i,a),xg(a,null,null,o),Cg()),y=i.memoizedState,w=a.memoizedState,y.parent!==d?(y={parent:d,cache:d},a.memoizedState=y,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=y),Ec(a,ri,d)):(d=w.cache,Ec(a,ri,d),d!==y.cache&&GA(a,[ri],o,!0))),Yi(i,a,a.pendingProps.children,o),a.child;case 29:throw a.pendingProps}throw Error(n(156,a.tag))}function sl(i){i.flags|=4}function NS(i,a,o,d,y){if((a=(i.mode&32)!==0)&&(a=!1),a){if(i.flags|=16777216,(y&335544128)===y)if(i.stateNode.complete)i.flags|=8192;else if($R())i.flags|=8192;else throw gh=g0,KA}else i.flags&=-16777217}function yR(i,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!NO(a))if($R())i.flags|=8192;else throw gh=g0,KA}function k0(i,a){a!==null&&(i.flags|=4),i.flags&16384&&(a=i.tag!==22?Kv():536870912,i.lanes|=a,If|=a)}function Ng(i,a){if(!Be)switch(i.tailMode){case"hidden":a=i.tail;for(var o=null;a!==null;)a.alternate!==null&&(o=a),a=a.sibling;o===null?i.tail=null:o.sibling=null;break;case"collapsed":o=i.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:d.sibling=null}}function Rn(i){var a=i.alternate!==null&&i.alternate.child===i.child,o=0,d=0;if(a)for(var y=i.child;y!==null;)o|=y.lanes|y.childLanes,d|=y.subtreeFlags&65011712,d|=y.flags&65011712,y.return=i,y=y.sibling;else for(y=i.child;y!==null;)o|=y.lanes|y.childLanes,d|=y.subtreeFlags,d|=y.flags,y.return=i,y=y.sibling;return i.subtreeFlags|=d,i.childLanes=o,a}function MP(i,a,o){var d=a.pendingProps;switch(zA(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rn(a),null;case 1:return Rn(a),null;case 3:return o=a.stateNode,d=null,i!==null&&(d=i.memoizedState.cache),a.memoizedState.cache!==d&&(a.flags|=2048),tl(ri),Dt(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(i===null||i.child===null)&&(Sf(a)?sl(a):i===null||i.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,HA())),Rn(a),null;case 26:var y=a.type,w=a.memoizedState;return i===null?(sl(a),w!==null?(Rn(a),yR(a,w)):(Rn(a),NS(a,y,null,d,o))):w?w!==i.memoizedState?(sl(a),Rn(a),yR(a,w)):(Rn(a),a.flags&=-16777217):(i=i.memoizedProps,i!==d&&sl(a),Rn(a),NS(a,y,i,d,o)),null;case 27:if(bn(a),o=Gt.current,y=a.type,i!==null&&a.stateNode!=null)i.memoizedProps!==d&&sl(a);else{if(!d){if(a.stateNode===null)throw Error(n(166));return Rn(a),null}i=Mt.current,Sf(a)?Wx(a):(i=EO(y,d,o),a.stateNode=i,sl(a))}return Rn(a),null;case 5:if(bn(a),y=a.type,i!==null&&a.stateNode!=null)i.memoizedProps!==d&&sl(a);else{if(!d){if(a.stateNode===null)throw Error(n(166));return Rn(a),null}if(w=Mt.current,Sf(a))Wx(a);else{var T=Y0(Gt.current);switch(w){case 1:w=T.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:w=T.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":w=T.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":w=T.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":w=T.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof d.is=="string"?T.createElement("select",{is:d.is}):T.createElement("select"),d.multiple?w.multiple=!0:d.size&&(w.size=d.size);break;default:w=typeof d.is=="string"?T.createElement(y,{is:d.is}):T.createElement(y)}}w[vn]=a,w[Qn]=d;t:for(T=a.child;T!==null;){if(T.tag===5||T.tag===6)w.appendChild(T.stateNode);else if(T.tag!==4&&T.tag!==27&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===a)break t;for(;T.sibling===null;){if(T.return===null||T.return===a)break t;T=T.return}T.sibling.return=T.return,T=T.sibling}a.stateNode=w;t:switch(Ki(w,y,d),y){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break t;case"img":d=!0;break t;default:d=!1}d&&sl(a)}}return Rn(a),NS(a,a.type,i===null?null:i.memoizedProps,a.pendingProps,o),null;case 6:if(i&&a.stateNode!=null)i.memoizedProps!==d&&sl(a);else{if(typeof d!="string"&&a.stateNode===null)throw Error(n(166));if(i=Gt.current,Sf(a)){if(i=a.stateNode,o=a.memoizedProps,d=null,y=qi,y!==null)switch(y.tag){case 27:case 5:d=y.memoizedProps}i[vn]=a,i=!!(i.nodeValue===o||d!==null&&d.suppressHydrationWarning===!0||fO(i.nodeValue,o)),i||Sc(a,!0)}else i=Y0(i).createTextNode(d),i[vn]=a,a.stateNode=i}return Rn(a),null;case 31:if(o=a.memoizedState,i===null||i.memoizedState!==null){if(d=Sf(a),o!==null){if(i===null){if(!d)throw Error(n(318));if(i=a.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(557));i[vn]=a}else hh(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Rn(a),i=!1}else o=HA(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=o),i=!0;if(!i)return a.flags&256?(aa(a),a):(aa(a),null);if((a.flags&128)!==0)throw Error(n(558))}return Rn(a),null;case 13:if(d=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(y=Sf(a),d!==null&&d.dehydrated!==null){if(i===null){if(!y)throw Error(n(318));if(y=a.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));y[vn]=a}else hh(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Rn(a),y=!1}else y=HA(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=y),y=!0;if(!y)return a.flags&256?(aa(a),a):(aa(a),null)}return aa(a),(a.flags&128)!==0?(a.lanes=o,a):(o=d!==null,i=i!==null&&i.memoizedState!==null,o&&(d=a.child,y=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(y=d.alternate.memoizedState.cachePool.pool),w=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(w=d.memoizedState.cachePool.pool),w!==y&&(d.flags|=2048)),o!==i&&o&&(a.child.flags|=8192),k0(a,a.updateQueue),Rn(a),null);case 4:return Dt(),i===null&&tE(a.stateNode.containerInfo),Rn(a),null;case 10:return tl(a.type),Rn(a),null;case 19:if(ft(Zn),d=a.memoizedState,d===null)return Rn(a),null;if(y=(a.flags&128)!==0,w=d.rendering,w===null)if(y)Ng(d,!1);else{if($n!==0||i!==null&&(i.flags&128)!==0)for(i=a.child;i!==null;){if(w=w0(i),w!==null){for(a.flags|=128,Ng(d,!1),i=w.updateQueue,a.updateQueue=i,k0(a,i),a.subtreeFlags=0,i=o,o=a.child;o!==null;)Gx(o,i),o=o.sibling;return _t(Zn,Zn.current&1|2),Be&&Jo(a,d.treeForkCount),a.child}i=i.sibling}d.tail!==null&&oe()>F0&&(a.flags|=128,y=!0,Ng(d,!1),a.lanes=4194304)}else{if(!y)if(i=w0(w),i!==null){if(a.flags|=128,y=!0,i=i.updateQueue,a.updateQueue=i,k0(a,i),Ng(d,!0),d.tail===null&&d.tailMode==="hidden"&&!w.alternate&&!Be)return Rn(a),null}else 2*oe()-d.renderingStartTime>F0&&o!==536870912&&(a.flags|=128,y=!0,Ng(d,!1),a.lanes=4194304);d.isBackwards?(w.sibling=a.child,a.child=w):(i=d.last,i!==null?i.sibling=w:a.child=w,d.last=w)}return d.tail!==null?(i=d.tail,d.rendering=i,d.tail=i.sibling,d.renderingStartTime=oe(),i.sibling=null,o=Zn.current,_t(Zn,y?o&1|2:o&1),Be&&Jo(a,d.treeForkCount),i):(Rn(a),null);case 22:case 23:return aa(a),eS(),d=a.memoizedState!==null,i!==null?i.memoizedState!==null!==d&&(a.flags|=8192):d&&(a.flags|=8192),d?(o&536870912)!==0&&(a.flags&128)===0&&(Rn(a),a.subtreeFlags&6&&(a.flags|=8192)):Rn(a),o=a.updateQueue,o!==null&&k0(a,o.retryQueue),o=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(o=i.memoizedState.cachePool.pool),d=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),d!==o&&(a.flags|=2048),i!==null&&ft(ph),null;case 24:return o=null,i!==null&&(o=i.memoizedState.cache),a.memoizedState.cache!==o&&(a.flags|=2048),tl(ri),Rn(a),null;case 25:return null;case 30:return null}throw Error(n(156,a.tag))}function NP(i,a){switch(zA(a),a.tag){case 1:return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return tl(ri),Dt(),i=a.flags,(i&65536)!==0&&(i&128)===0?(a.flags=i&-65537|128,a):null;case 26:case 27:case 5:return bn(a),null;case 31:if(a.memoizedState!==null){if(aa(a),a.alternate===null)throw Error(n(340));hh()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 13:if(aa(a),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(n(340));hh()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return ft(Zn),null;case 4:return Dt(),null;case 10:return tl(a.type),null;case 22:case 23:return aa(a),eS(),i!==null&&ft(ph),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 24:return tl(ri),null;case 25:return null;default:return null}}function bR(i,a){switch(zA(a),a.tag){case 3:tl(ri),Dt();break;case 26:case 27:case 5:bn(a);break;case 4:Dt();break;case 31:a.memoizedState!==null&&aa(a);break;case 13:aa(a);break;case 19:ft(Zn);break;case 10:tl(a.type);break;case 22:case 23:aa(a),eS(),i!==null&&ft(ph);break;case 24:tl(ri)}}function kg(i,a){try{var o=a.updateQueue,d=o!==null?o.lastEffect:null;if(d!==null){var y=d.next;o=y;do{if((o.tag&i)===i){d=void 0;var w=o.create,T=o.inst;d=w(),T.destroy=d}o=o.next}while(o!==y)}}catch(B){Qe(a,a.return,B)}}function Dc(i,a,o){try{var d=a.updateQueue,y=d!==null?d.lastEffect:null;if(y!==null){var w=y.next;d=w;do{if((d.tag&i)===i){var T=d.inst,B=T.destroy;if(B!==void 0){T.destroy=void 0,y=a;var V=o,ot=B;try{ot()}catch(vt){Qe(y,V,vt)}}}d=d.next}while(d!==w)}}catch(vt){Qe(a,a.return,vt)}}function vR(i){var a=i.updateQueue;if(a!==null){var o=i.stateNode;try{cT(a,o)}catch(d){Qe(i,i.return,d)}}}function wR(i,a,o){o.props=vh(i.type,i.memoizedProps),o.state=i.memoizedState;try{o.componentWillUnmount()}catch(d){Qe(i,a,d)}}function Pg(i,a){try{var o=i.ref;if(o!==null){switch(i.tag){case 26:case 27:case 5:var d=i.stateNode;break;case 30:d=i.stateNode;break;default:d=i.stateNode}typeof o=="function"?i.refCleanup=o(d):o.current=d}}catch(y){Qe(i,a,y)}}function eo(i,a){var o=i.ref,d=i.refCleanup;if(o!==null)if(typeof d=="function")try{d()}catch(y){Qe(i,a,y)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(y){Qe(i,a,y)}else o.current=null}function _R(i){var a=i.type,o=i.memoizedProps,d=i.stateNode;try{t:switch(a){case"button":case"input":case"select":case"textarea":o.autoFocus&&d.focus();break t;case"img":o.src?d.src=o.src:o.srcSet&&(d.srcset=o.srcSet)}}catch(y){Qe(i,i.return,y)}}function kS(i,a,o){try{var d=i.stateNode;tL(d,i.type,o,a),d[Qn]=a}catch(y){Qe(i,i.return,y)}}function AR(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Bc(i.type)||i.tag===4}function PS(i){t:for(;;){for(;i.sibling===null;){if(i.return===null||AR(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Bc(i.type)||i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function LS(i,a,o){var d=i.tag;if(d===5||d===6)i=i.stateNode,a?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(i,a):(a=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,a.appendChild(i),o=o._reactRootContainer,o!=null||a.onclick!==null||(a.onclick=Ls));else if(d!==4&&(d===27&&Bc(i.type)&&(o=i.stateNode,a=null),i=i.child,i!==null))for(LS(i,a,o),i=i.sibling;i!==null;)LS(i,a,o),i=i.sibling}function P0(i,a,o){var d=i.tag;if(d===5||d===6)i=i.stateNode,a?o.insertBefore(i,a):o.appendChild(i);else if(d!==4&&(d===27&&Bc(i.type)&&(o=i.stateNode),i=i.child,i!==null))for(P0(i,a,o),i=i.sibling;i!==null;)P0(i,a,o),i=i.sibling}function SR(i){var a=i.stateNode,o=i.memoizedProps;try{for(var d=i.type,y=a.attributes;y.length;)a.removeAttributeNode(y[0]);Ki(a,d,o),a[vn]=i,a[Qn]=o}catch(w){Qe(i,i.return,w)}}var al=!1,ci=!1,IS=!1,ER=typeof WeakSet=="function"?WeakSet:Set,Pi=null;function kP(i,a){if(i=i.containerInfo,iE=ew,i=D(i),L(i)){if("selectionStart"in i)var o={start:i.selectionStart,end:i.selectionEnd};else t:{o=(o=i.ownerDocument)&&o.defaultView||window;var d=o.getSelection&&o.getSelection();if(d&&d.rangeCount!==0){o=d.anchorNode;var y=d.anchorOffset,w=d.focusNode;d=d.focusOffset;try{o.nodeType,w.nodeType}catch{o=null;break t}var T=0,B=-1,V=-1,ot=0,vt=0,St=i,ht=null;e:for(;;){for(var mt;St!==o||y!==0&&St.nodeType!==3||(B=T+y),St!==w||d!==0&&St.nodeType!==3||(V=T+d),St.nodeType===3&&(T+=St.nodeValue.length),(mt=St.firstChild)!==null;)ht=St,St=mt;for(;;){if(St===i)break e;if(ht===o&&++ot===y&&(B=T),ht===w&&++vt===d&&(V=T),(mt=St.nextSibling)!==null)break;St=ht,ht=St.parentNode}St=mt}o=B===-1||V===-1?null:{start:B,end:V}}else o=null}o=o||{start:0,end:0}}else o=null;for(sE={focusedElem:i,selectionRange:o},ew=!1,Pi=a;Pi!==null;)if(a=Pi,i=a.child,(a.subtreeFlags&1028)!==0&&i!==null)i.return=a,Pi=i;else for(;Pi!==null;){switch(a=Pi,w=a.alternate,i=a.flags,a.tag){case 0:if((i&4)!==0&&(i=a.updateQueue,i=i!==null?i.events:null,i!==null))for(o=0;o<i.length;o++)y=i[o],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&w!==null){i=void 0,o=a,y=w.memoizedProps,w=w.memoizedState,d=o.stateNode;try{var Kt=vh(o.type,y);i=d.getSnapshotBeforeUpdate(Kt,w),d.__reactInternalSnapshotBeforeUpdate=i}catch(ae){Qe(o,o.return,ae)}}break;case 3:if((i&1024)!==0){if(i=a.stateNode.containerInfo,o=i.nodeType,o===9)oE(i);else if(o===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":oE(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(n(163))}if(i=a.sibling,i!==null){i.return=a.return,Pi=i;break}Pi=a.return}}function CR(i,a,o){var d=o.flags;switch(o.tag){case 0:case 11:case 15:ol(i,o),d&4&&kg(5,o);break;case 1:if(ol(i,o),d&4)if(i=o.stateNode,a===null)try{i.componentDidMount()}catch(T){Qe(o,o.return,T)}else{var y=vh(o.type,a.memoizedProps);a=a.memoizedState;try{i.componentDidUpdate(y,a,i.__reactInternalSnapshotBeforeUpdate)}catch(T){Qe(o,o.return,T)}}d&64&&vR(o),d&512&&Pg(o,o.return);break;case 3:if(ol(i,o),d&64&&(i=o.updateQueue,i!==null)){if(a=null,o.child!==null)switch(o.child.tag){case 27:case 5:a=o.child.stateNode;break;case 1:a=o.child.stateNode}try{cT(i,a)}catch(T){Qe(o,o.return,T)}}break;case 27:a===null&&d&4&&SR(o);case 26:case 5:ol(i,o),a===null&&d&4&&_R(o),d&512&&Pg(o,o.return);break;case 12:ol(i,o);break;case 31:ol(i,o),d&4&&RR(i,o);break;case 13:ol(i,o),d&4&&OR(i,o),d&64&&(i=o.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(o=HP.bind(null,o),lL(i,o))));break;case 22:if(d=o.memoizedState!==null||al,!d){a=a!==null&&a.memoizedState!==null||ci,y=al;var w=ci;al=d,(ci=a)&&!w?ll(i,o,(o.subtreeFlags&8772)!==0):ol(i,o),al=y,ci=w}break;case 30:break;default:ol(i,o)}}function xR(i){var a=i.alternate;a!==null&&(i.alternate=null,xR(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&tf(a)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Nn=null,Bs=!1;function rl(i,a,o){for(o=o.child;o!==null;)TR(i,a,o),o=o.sibling}function TR(i,a,o){if($i&&typeof $i.onCommitFiberUnmount=="function")try{$i.onCommitFiberUnmount(gi,o)}catch{}switch(o.tag){case 26:ci||eo(o,a),rl(i,a,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:ci||eo(o,a);var d=Nn,y=Bs;Bc(o.type)&&(Nn=o.stateNode,Bs=!1),rl(i,a,o),$g(o.stateNode),Nn=d,Bs=y;break;case 5:ci||eo(o,a);case 6:if(d=Nn,y=Bs,Nn=null,rl(i,a,o),Nn=d,Bs=y,Nn!==null)if(Bs)try{(Nn.nodeType===9?Nn.body:Nn.nodeName==="HTML"?Nn.ownerDocument.body:Nn).removeChild(o.stateNode)}catch(w){Qe(o,a,w)}else try{Nn.removeChild(o.stateNode)}catch(w){Qe(o,a,w)}break;case 18:Nn!==null&&(Bs?(i=Nn,vO(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,o.stateNode),Vf(i)):vO(Nn,o.stateNode));break;case 4:d=Nn,y=Bs,Nn=o.stateNode.containerInfo,Bs=!0,rl(i,a,o),Nn=d,Bs=y;break;case 0:case 11:case 14:case 15:Dc(2,o,a),ci||Dc(4,o,a),rl(i,a,o);break;case 1:ci||(eo(o,a),d=o.stateNode,typeof d.componentWillUnmount=="function"&&wR(o,a,d)),rl(i,a,o);break;case 21:rl(i,a,o);break;case 22:ci=(d=ci)||o.memoizedState!==null,rl(i,a,o),ci=d;break;default:rl(i,a,o)}}function RR(i,a){if(a.memoizedState===null&&(i=a.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{Vf(i)}catch(o){Qe(a,a.return,o)}}}function OR(i,a){if(a.memoizedState===null&&(i=a.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Vf(i)}catch(o){Qe(a,a.return,o)}}function PP(i){switch(i.tag){case 31:case 13:case 19:var a=i.stateNode;return a===null&&(a=i.stateNode=new ER),a;case 22:return i=i.stateNode,a=i._retryCache,a===null&&(a=i._retryCache=new ER),a;default:throw Error(n(435,i.tag))}}function L0(i,a){var o=PP(i);a.forEach(function(d){if(!o.has(d)){o.add(d);var y=$P.bind(null,i,d);d.then(y,y)}})}function Fs(i,a){var o=a.deletions;if(o!==null)for(var d=0;d<o.length;d++){var y=o[d],w=i,T=a,B=T;t:for(;B!==null;){switch(B.tag){case 27:if(Bc(B.type)){Nn=B.stateNode,Bs=!1;break t}break;case 5:Nn=B.stateNode,Bs=!1;break t;case 3:case 4:Nn=B.stateNode.containerInfo,Bs=!0;break t}B=B.return}if(Nn===null)throw Error(n(160));TR(w,T,y),Nn=null,Bs=!1,w=y.alternate,w!==null&&(w.return=null),y.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)DR(a,i),a=a.sibling}var wr=null;function DR(i,a){var o=i.alternate,d=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:Fs(a,i),Us(i),d&4&&(Dc(3,i,i.return),kg(3,i),Dc(5,i,i.return));break;case 1:Fs(a,i),Us(i),d&512&&(ci||o===null||eo(o,o.return)),d&64&&al&&(i=i.updateQueue,i!==null&&(d=i.callbacks,d!==null&&(o=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=o===null?d:o.concat(d))));break;case 26:var y=wr;if(Fs(a,i),Us(i),d&512&&(ci||o===null||eo(o,o.return)),d&4){var w=o!==null?o.memoizedState:null;if(d=i.memoizedState,o===null)if(d===null)if(i.stateNode===null){t:{d=i.type,o=i.memoizedProps,y=y.ownerDocument||y;e:switch(d){case"title":w=y.getElementsByTagName("title")[0],(!w||w[ta]||w[vn]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=y.createElement(d),y.head.insertBefore(w,y.querySelector("head > title"))),Ki(w,d,o),w[vn]=i,Jn(w),d=w;break t;case"link":var T=DO("link","href",y).get(d+(o.href||""));if(T){for(var B=0;B<T.length;B++)if(w=T[B],w.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&w.getAttribute("rel")===(o.rel==null?null:o.rel)&&w.getAttribute("title")===(o.title==null?null:o.title)&&w.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){T.splice(B,1);break e}}w=y.createElement(d),Ki(w,d,o),y.head.appendChild(w);break;case"meta":if(T=DO("meta","content",y).get(d+(o.content||""))){for(B=0;B<T.length;B++)if(w=T[B],w.getAttribute("content")===(o.content==null?null:""+o.content)&&w.getAttribute("name")===(o.name==null?null:o.name)&&w.getAttribute("property")===(o.property==null?null:o.property)&&w.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&w.getAttribute("charset")===(o.charSet==null?null:o.charSet)){T.splice(B,1);break e}}w=y.createElement(d),Ki(w,d,o),y.head.appendChild(w);break;default:throw Error(n(468,d))}w[vn]=i,Jn(w),d=w}i.stateNode=d}else MO(y,i.type,i.stateNode);else i.stateNode=OO(y,d,i.memoizedProps);else w!==d?(w===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):w.count--,d===null?MO(y,i.type,i.stateNode):OO(y,d,i.memoizedProps)):d===null&&i.stateNode!==null&&kS(i,i.memoizedProps,o.memoizedProps)}break;case 27:Fs(a,i),Us(i),d&512&&(ci||o===null||eo(o,o.return)),o!==null&&d&4&&kS(i,i.memoizedProps,o.memoizedProps);break;case 5:if(Fs(a,i),Us(i),d&512&&(ci||o===null||eo(o,o.return)),i.flags&32){y=i.stateNode;try{Ho(y,"")}catch(Kt){Qe(i,i.return,Kt)}}d&4&&i.stateNode!=null&&(y=i.memoizedProps,kS(i,y,o!==null?o.memoizedProps:y)),d&1024&&(IS=!0);break;case 6:if(Fs(a,i),Us(i),d&4){if(i.stateNode===null)throw Error(n(162));d=i.memoizedProps,o=i.stateNode;try{o.nodeValue=d}catch(Kt){Qe(i,i.return,Kt)}}break;case 3:if(Q0=null,y=wr,wr=K0(a.containerInfo),Fs(a,i),wr=y,Us(i),d&4&&o!==null&&o.memoizedState.isDehydrated)try{Vf(a.containerInfo)}catch(Kt){Qe(i,i.return,Kt)}IS&&(IS=!1,MR(i));break;case 4:d=wr,wr=K0(i.stateNode.containerInfo),Fs(a,i),Us(i),wr=d;break;case 12:Fs(a,i),Us(i);break;case 31:Fs(a,i),Us(i),d&4&&(d=i.updateQueue,d!==null&&(i.updateQueue=null,L0(i,d)));break;case 13:Fs(a,i),Us(i),i.child.flags&8192&&i.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(B0=oe()),d&4&&(d=i.updateQueue,d!==null&&(i.updateQueue=null,L0(i,d)));break;case 22:y=i.memoizedState!==null;var V=o!==null&&o.memoizedState!==null,ot=al,vt=ci;if(al=ot||y,ci=vt||V,Fs(a,i),ci=vt,al=ot,Us(i),d&8192)t:for(a=i.stateNode,a._visibility=y?a._visibility&-2:a._visibility|1,y&&(o===null||V||al||ci||wh(i)),o=null,a=i;;){if(a.tag===5||a.tag===26){if(o===null){V=o=a;try{if(w=V.stateNode,y)T=w.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none";else{B=V.stateNode;var St=V.memoizedProps.style,ht=St!=null&&St.hasOwnProperty("display")?St.display:null;B.style.display=ht==null||typeof ht=="boolean"?"":(""+ht).trim()}}catch(Kt){Qe(V,V.return,Kt)}}}else if(a.tag===6){if(o===null){V=a;try{V.stateNode.nodeValue=y?"":V.memoizedProps}catch(Kt){Qe(V,V.return,Kt)}}}else if(a.tag===18){if(o===null){V=a;try{var mt=V.stateNode;y?wO(mt,!0):wO(V.stateNode,!1)}catch(Kt){Qe(V,V.return,Kt)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===i)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break t;for(;a.sibling===null;){if(a.return===null||a.return===i)break t;o===a&&(o=null),a=a.return}o===a&&(o=null),a.sibling.return=a.return,a=a.sibling}d&4&&(d=i.updateQueue,d!==null&&(o=d.retryQueue,o!==null&&(d.retryQueue=null,L0(i,o))));break;case 19:Fs(a,i),Us(i),d&4&&(d=i.updateQueue,d!==null&&(i.updateQueue=null,L0(i,d)));break;case 30:break;case 21:break;default:Fs(a,i),Us(i)}}function Us(i){var a=i.flags;if(a&2){try{for(var o,d=i.return;d!==null;){if(AR(d)){o=d;break}d=d.return}if(o==null)throw Error(n(160));switch(o.tag){case 27:var y=o.stateNode,w=PS(i);P0(i,w,y);break;case 5:var T=o.stateNode;o.flags&32&&(Ho(T,""),o.flags&=-33);var B=PS(i);P0(i,B,T);break;case 3:case 4:var V=o.stateNode.containerInfo,ot=PS(i);LS(i,ot,V);break;default:throw Error(n(161))}}catch(vt){Qe(i,i.return,vt)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function MR(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var a=i;MR(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),i=i.sibling}}function ol(i,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)CR(i,a.alternate,a),a=a.sibling}function wh(i){for(i=i.child;i!==null;){var a=i;switch(a.tag){case 0:case 11:case 14:case 15:Dc(4,a,a.return),wh(a);break;case 1:eo(a,a.return);var o=a.stateNode;typeof o.componentWillUnmount=="function"&&wR(a,a.return,o),wh(a);break;case 27:$g(a.stateNode);case 26:case 5:eo(a,a.return),wh(a);break;case 22:a.memoizedState===null&&wh(a);break;case 30:wh(a);break;default:wh(a)}i=i.sibling}}function ll(i,a,o){for(o=o&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var d=a.alternate,y=i,w=a,T=w.flags;switch(w.tag){case 0:case 11:case 15:ll(y,w,o),kg(4,w);break;case 1:if(ll(y,w,o),d=w,y=d.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(ot){Qe(d,d.return,ot)}if(d=w,y=d.updateQueue,y!==null){var B=d.stateNode;try{var V=y.shared.hiddenCallbacks;if(V!==null)for(y.shared.hiddenCallbacks=null,y=0;y<V.length;y++)lT(V[y],B)}catch(ot){Qe(d,d.return,ot)}}o&&T&64&&vR(w),Pg(w,w.return);break;case 27:SR(w);case 26:case 5:ll(y,w,o),o&&d===null&&T&4&&_R(w),Pg(w,w.return);break;case 12:ll(y,w,o);break;case 31:ll(y,w,o),o&&T&4&&RR(y,w);break;case 13:ll(y,w,o),o&&T&4&&OR(y,w);break;case 22:w.memoizedState===null&&ll(y,w,o),Pg(w,w.return);break;case 30:break;default:ll(y,w,o)}a=a.sibling}}function BS(i,a){var o=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(o=i.memoizedState.cachePool.pool),i=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(i=a.memoizedState.cachePool.pool),i!==o&&(i!=null&&i.refCount++,o!=null&&wg(o))}function FS(i,a){i=null,a.alternate!==null&&(i=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==i&&(a.refCount++,i!=null&&wg(i))}function _r(i,a,o,d){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)NR(i,a,o,d),a=a.sibling}function NR(i,a,o,d){var y=a.flags;switch(a.tag){case 0:case 11:case 15:_r(i,a,o,d),y&2048&&kg(9,a);break;case 1:_r(i,a,o,d);break;case 3:_r(i,a,o,d),y&2048&&(i=null,a.alternate!==null&&(i=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==i&&(a.refCount++,i!=null&&wg(i)));break;case 12:if(y&2048){_r(i,a,o,d),i=a.stateNode;try{var w=a.memoizedProps,T=w.id,B=w.onPostCommit;typeof B=="function"&&B(T,a.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(V){Qe(a,a.return,V)}}else _r(i,a,o,d);break;case 31:_r(i,a,o,d);break;case 13:_r(i,a,o,d);break;case 23:break;case 22:w=a.stateNode,T=a.alternate,a.memoizedState!==null?w._visibility&2?_r(i,a,o,d):Lg(i,a):w._visibility&2?_r(i,a,o,d):(w._visibility|=2,kf(i,a,o,d,(a.subtreeFlags&10256)!==0||!1)),y&2048&&BS(T,a);break;case 24:_r(i,a,o,d),y&2048&&FS(a.alternate,a);break;default:_r(i,a,o,d)}}function kf(i,a,o,d,y){for(y=y&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var w=i,T=a,B=o,V=d,ot=T.flags;switch(T.tag){case 0:case 11:case 15:kf(w,T,B,V,y),kg(8,T);break;case 23:break;case 22:var vt=T.stateNode;T.memoizedState!==null?vt._visibility&2?kf(w,T,B,V,y):Lg(w,T):(vt._visibility|=2,kf(w,T,B,V,y)),y&&ot&2048&&BS(T.alternate,T);break;case 24:kf(w,T,B,V,y),y&&ot&2048&&FS(T.alternate,T);break;default:kf(w,T,B,V,y)}a=a.sibling}}function Lg(i,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var o=i,d=a,y=d.flags;switch(d.tag){case 22:Lg(o,d),y&2048&&BS(d.alternate,d);break;case 24:Lg(o,d),y&2048&&FS(d.alternate,d);break;default:Lg(o,d)}a=a.sibling}}var Ig=8192;function Pf(i,a,o){if(i.subtreeFlags&Ig)for(i=i.child;i!==null;)kR(i,a,o),i=i.sibling}function kR(i,a,o){switch(i.tag){case 26:Pf(i,a,o),i.flags&Ig&&i.memoizedState!==null&&wL(o,wr,i.memoizedState,i.memoizedProps);break;case 5:Pf(i,a,o);break;case 3:case 4:var d=wr;wr=K0(i.stateNode.containerInfo),Pf(i,a,o),wr=d;break;case 22:i.memoizedState===null&&(d=i.alternate,d!==null&&d.memoizedState!==null?(d=Ig,Ig=16777216,Pf(i,a,o),Ig=d):Pf(i,a,o));break;default:Pf(i,a,o)}}function PR(i){var a=i.alternate;if(a!==null&&(i=a.child,i!==null)){a.child=null;do a=i.sibling,i.sibling=null,i=a;while(i!==null)}}function Bg(i){var a=i.deletions;if((i.flags&16)!==0){if(a!==null)for(var o=0;o<a.length;o++){var d=a[o];Pi=d,IR(d,i)}PR(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)LR(i),i=i.sibling}function LR(i){switch(i.tag){case 0:case 11:case 15:Bg(i),i.flags&2048&&Dc(9,i,i.return);break;case 3:Bg(i);break;case 12:Bg(i);break;case 22:var a=i.stateNode;i.memoizedState!==null&&a._visibility&2&&(i.return===null||i.return.tag!==13)?(a._visibility&=-3,I0(i)):Bg(i);break;default:Bg(i)}}function I0(i){var a=i.deletions;if((i.flags&16)!==0){if(a!==null)for(var o=0;o<a.length;o++){var d=a[o];Pi=d,IR(d,i)}PR(i)}for(i=i.child;i!==null;){switch(a=i,a.tag){case 0:case 11:case 15:Dc(8,a,a.return),I0(a);break;case 22:o=a.stateNode,o._visibility&2&&(o._visibility&=-3,I0(a));break;default:I0(a)}i=i.sibling}}function IR(i,a){for(;Pi!==null;){var o=Pi;switch(o.tag){case 0:case 11:case 15:Dc(8,o,a);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var d=o.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:wg(o.memoizedState.cache)}if(d=o.child,d!==null)d.return=o,Pi=d;else t:for(o=i;Pi!==null;){d=Pi;var y=d.sibling,w=d.return;if(xR(d),d===o){Pi=null;break t}if(y!==null){y.return=w,Pi=y;break t}Pi=w}}}var LP={getCacheForType:function(i){var a=Xi(ri),o=a.data.get(i);return o===void 0&&(o=i(),a.data.set(i,o)),o},cacheSignal:function(){return Xi(ri).controller.signal}},IP=typeof WeakMap=="function"?WeakMap:Map,qe=0,fn=null,Me=null,ke=0,We=0,ra=null,Mc=!1,Lf=!1,US=!1,cl=0,$n=0,Nc=0,_h=0,zS=0,oa=0,If=0,Fg=null,zs=null,jS=!1,B0=0,BR=0,F0=1/0,U0=null,kc=null,yi=0,Pc=null,Bf=null,ul=0,HS=0,$S=null,FR=null,Ug=0,VS=null;function la(){return(qe&2)!==0&&ke!==0?ke&-ke:J.T!==null?WS():Yu()}function UR(){if(oa===0)if((ke&536870912)===0||Be){var i=lc;lc<<=1,(lc&3932160)===0&&(lc=262144),oa=i}else oa=536870912;return i=sa.current,i!==null&&(i.flags|=32),oa}function js(i,a,o){(i===fn&&(We===2||We===9)||i.cancelPendingCommit!==null)&&(Ff(i,0),Lc(i,ke,oa,!1)),Ba(i,o),((qe&2)===0||i!==fn)&&(i===fn&&((qe&2)===0&&(_h|=o),$n===4&&Lc(i,ke,oa,!1)),no(i))}function zR(i,a,o){if((qe&6)!==0)throw Error(n(327));var d=!o&&(a&127)===0&&(a&i.expiredLanes)===0||Uo(i,a),y=d?UP(i,a):qS(i,a,!0),w=d;do{if(y===0){Lf&&!d&&Lc(i,a,0,!1);break}else{if(o=i.current.alternate,w&&!BP(o)){y=qS(i,a,!1),w=!1;continue}if(y===2){if(w=a,i.errorRecoveryDisabledLanes&w)var T=0;else T=i.pendingLanes&-536870913,T=T!==0?T:T&536870912?536870912:0;if(T!==0){a=T;t:{var B=i;y=Fg;var V=B.current.memoizedState.isDehydrated;if(V&&(Ff(B,T).flags|=256),T=qS(B,T,!1),T!==2){if(US&&!V){B.errorRecoveryDisabledLanes|=w,_h|=w,y=4;break t}w=zs,zs=y,w!==null&&(zs===null?zs=w:zs.push.apply(zs,w))}y=T}if(w=!1,y!==2)continue}}if(y===1){Ff(i,0),Lc(i,a,0,!0);break}t:{switch(d=i,w=y,w){case 0:case 1:throw Error(n(345));case 4:if((a&4194048)!==a)break;case 6:Lc(d,a,oa,!Mc);break t;case 2:zs=null;break;case 3:case 5:break;default:throw Error(n(329))}if((a&62914560)===a&&(y=B0+300-oe(),10<y)){if(Lc(d,a,oa,!Mc),qu(d,0,!0)!==0)break t;ul=a,d.timeoutHandle=yO(jR.bind(null,d,o,zs,U0,jS,a,oa,_h,If,Mc,w,"Throttled",-0,0),y);break t}jR(d,o,zs,U0,jS,a,oa,_h,If,Mc,w,null,-0,0)}}break}while(!0);no(i)}function jR(i,a,o,d,y,w,T,B,V,ot,vt,St,ht,mt){if(i.timeoutHandle=-1,St=a.subtreeFlags,St&8192||(St&16785408)===16785408){St={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ls},kR(a,w,St);var Kt=(w&62914560)===w?B0-oe():(w&4194048)===w?BR-oe():0;if(Kt=_L(St,Kt),Kt!==null){ul=w,i.cancelPendingCommit=Kt(KR.bind(null,i,a,w,o,d,y,T,B,V,vt,St,null,ht,mt)),Lc(i,w,T,!ot);return}}KR(i,a,w,o,d,y,T,B,V)}function BP(i){for(var a=i;;){var o=a.tag;if((o===0||o===11||o===15)&&a.flags&16384&&(o=a.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var d=0;d<o.length;d++){var y=o[d],w=y.getSnapshot;y=y.value;try{if(!us(w(),y))return!1}catch{return!1}}if(o=a.child,a.subtreeFlags&16384&&o!==null)o.return=a,a=o;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Lc(i,a,o,d){a&=~zS,a&=~_h,i.suspendedLanes|=a,i.pingedLanes&=~a,d&&(i.warmLanes|=a),d=i.expirationTimes;for(var y=a;0<y;){var w=31-Ut(y),T=1<<w;d[w]=-1,y&=~T}o!==0&&Xu(i,o,a)}function z0(){return(qe&6)===0?(zg(0),!1):!0}function GS(){if(Me!==null){if(We===0)var i=Me.return;else i=Me,Zo=dh=null,oS(i),Rf=null,Ag=0,i=Me;for(;i!==null;)bR(i.alternate,i),i=i.return;Me=null}}function Ff(i,a){var o=i.timeoutHandle;o!==-1&&(i.timeoutHandle=-1,iL(o)),o=i.cancelPendingCommit,o!==null&&(i.cancelPendingCommit=null,o()),ul=0,GS(),fn=i,Me=o=Qo(i.current,null),ke=a,We=0,ra=null,Mc=!1,Lf=Uo(i,a),US=!1,If=oa=zS=_h=Nc=$n=0,zs=Fg=null,jS=!1,(a&8)!==0&&(a|=a&32);var d=i.entangledLanes;if(d!==0)for(i=i.entanglements,d&=a;0<d;){var y=31-Ut(d),w=1<<y;a|=i[y],d&=~w}return cl=a,ki(),o}function HR(i,a){_e=null,J.H=Dg,a===Tf||a===m0?(a=sT(),We=3):a===KA?(a=sT(),We=4):We=a===SS?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,ra=a,Me===null&&($n=1,O0(i,Ha(a,i.current)))}function $R(){var i=sa.current;return i===null?!0:(ke&4194048)===ke?qa===null:(ke&62914560)===ke||(ke&536870912)!==0?i===qa:!1}function VR(){var i=J.H;return J.H=Dg,i===null?Dg:i}function GR(){var i=J.A;return J.A=LP,i}function j0(){$n=4,Mc||(ke&4194048)!==ke&&sa.current!==null||(Lf=!0),(Nc&134217727)===0&&(_h&134217727)===0||fn===null||Lc(fn,ke,oa,!1)}function qS(i,a,o){var d=qe;qe|=2;var y=VR(),w=GR();(fn!==i||ke!==a)&&(U0=null,Ff(i,a)),a=!1;var T=$n;t:do try{if(We!==0&&Me!==null){var B=Me,V=ra;switch(We){case 8:GS(),T=6;break t;case 3:case 2:case 9:case 6:sa.current===null&&(a=!0);var ot=We;if(We=0,ra=null,Uf(i,B,V,ot),o&&Lf){T=0;break t}break;default:ot=We,We=0,ra=null,Uf(i,B,V,ot)}}FP(),T=$n;break}catch(vt){HR(i,vt)}while(!0);return a&&i.shellSuspendCounter++,Zo=dh=null,qe=d,J.H=y,J.A=w,Me===null&&(fn=null,ke=0,ki()),T}function FP(){for(;Me!==null;)qR(Me)}function UP(i,a){var o=qe;qe|=2;var d=VR(),y=GR();fn!==i||ke!==a?(U0=null,F0=oe()+500,Ff(i,a)):Lf=Uo(i,a);t:do try{if(We!==0&&Me!==null){a=Me;var w=ra;e:switch(We){case 1:We=0,ra=null,Uf(i,a,w,1);break;case 2:case 9:if(nT(w)){We=0,ra=null,XR(a);break}a=function(){We!==2&&We!==9||fn!==i||(We=7),no(i)},w.then(a,a);break t;case 3:We=7;break t;case 4:We=5;break t;case 7:nT(w)?(We=0,ra=null,XR(a)):(We=0,ra=null,Uf(i,a,w,7));break;case 5:var T=null;switch(Me.tag){case 26:T=Me.memoizedState;case 5:case 27:var B=Me;if(T?NO(T):B.stateNode.complete){We=0,ra=null;var V=B.sibling;if(V!==null)Me=V;else{var ot=B.return;ot!==null?(Me=ot,H0(ot)):Me=null}break e}}We=0,ra=null,Uf(i,a,w,5);break;case 6:We=0,ra=null,Uf(i,a,w,6);break;case 8:GS(),$n=6;break t;default:throw Error(n(462))}}zP();break}catch(vt){HR(i,vt)}while(!0);return Zo=dh=null,J.H=d,J.A=y,qe=o,Me!==null?0:(fn=null,ke=0,ki(),$n)}function zP(){for(;Me!==null&&!Ht();)qR(Me)}function qR(i){var a=gR(i.alternate,i,cl);i.memoizedProps=i.pendingProps,a===null?H0(i):Me=a}function XR(i){var a=i,o=a.alternate;switch(a.tag){case 15:case 0:a=uR(o,a,a.pendingProps,a.type,void 0,ke);break;case 11:a=uR(o,a,a.pendingProps,a.type.render,a.ref,ke);break;case 5:oS(a);default:bR(o,a),a=Me=Gx(a,cl),a=gR(o,a,cl)}i.memoizedProps=i.pendingProps,a===null?H0(i):Me=a}function Uf(i,a,o,d){Zo=dh=null,oS(a),Rf=null,Ag=0;var y=a.return;try{if(RP(i,y,a,o,ke)){$n=1,O0(i,Ha(o,i.current)),Me=null;return}}catch(w){if(y!==null)throw Me=y,w;$n=1,O0(i,Ha(o,i.current)),Me=null;return}a.flags&32768?(Be||d===1?i=!0:Lf||(ke&536870912)!==0?i=!1:(Mc=i=!0,(d===2||d===9||d===3||d===6)&&(d=sa.current,d!==null&&d.tag===13&&(d.flags|=16384))),YR(a,i)):H0(a)}function H0(i){var a=i;do{if((a.flags&32768)!==0){YR(a,Mc);return}i=a.return;var o=MP(a.alternate,a,cl);if(o!==null){Me=o;return}if(a=a.sibling,a!==null){Me=a;return}Me=a=i}while(a!==null);$n===0&&($n=5)}function YR(i,a){do{var o=NP(i.alternate,i);if(o!==null){o.flags&=32767,Me=o;return}if(o=i.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!a&&(i=i.sibling,i!==null)){Me=i;return}Me=i=o}while(i!==null);$n=6,Me=null}function KR(i,a,o,d,y,w,T,B,V){i.cancelPendingCommit=null;do $0();while(yi!==0);if((qe&6)!==0)throw Error(n(327));if(a!==null){if(a===i.current)throw Error(n(177));if(w=a.lanes|a.childLanes,w|=we,Km(i,o,w,T,B,V),i===fn&&(Me=fn=null,ke=0),Bf=a,Pc=i,ul=o,HS=w,$S=y,FR=d,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,VP(Oe,function(){return tO(),null})):(i.callbackNode=null,i.callbackPriority=0),d=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||d){d=J.T,J.T=null,y=pt.p,pt.p=2,T=qe,qe|=4;try{kP(i,a,o)}finally{qe=T,pt.p=y,J.T=d}}yi=1,WR(),QR(),JR()}}function WR(){if(yi===1){yi=0;var i=Pc,a=Bf,o=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||o){o=J.T,J.T=null;var d=pt.p;pt.p=2;var y=qe;qe|=4;try{DR(a,i);var w=sE,T=D(i.containerInfo),B=w.focusedElem,V=w.selectionRange;if(T!==B&&B&&B.ownerDocument&&x(B.ownerDocument.documentElement,B)){if(V!==null&&L(B)){var ot=V.start,vt=V.end;if(vt===void 0&&(vt=ot),"selectionStart"in B)B.selectionStart=ot,B.selectionEnd=Math.min(vt,B.value.length);else{var St=B.ownerDocument||document,ht=St&&St.defaultView||window;if(ht.getSelection){var mt=ht.getSelection(),Kt=B.textContent.length,ae=Math.min(V.start,Kt),sn=V.end===void 0?ae:Math.min(V.end,Kt);!mt.extend&&ae>sn&&(T=sn,sn=ae,ae=T);var st=A(B,ae),W=A(B,sn);if(st&&W&&(mt.rangeCount!==1||mt.anchorNode!==st.node||mt.anchorOffset!==st.offset||mt.focusNode!==W.node||mt.focusOffset!==W.offset)){var rt=St.createRange();rt.setStart(st.node,st.offset),mt.removeAllRanges(),ae>sn?(mt.addRange(rt),mt.extend(W.node,W.offset)):(rt.setEnd(W.node,W.offset),mt.addRange(rt))}}}}for(St=[],mt=B;mt=mt.parentNode;)mt.nodeType===1&&St.push({element:mt,left:mt.scrollLeft,top:mt.scrollTop});for(typeof B.focus=="function"&&B.focus(),B=0;B<St.length;B++){var wt=St[B];wt.element.scrollLeft=wt.left,wt.element.scrollTop=wt.top}}ew=!!iE,sE=iE=null}finally{qe=y,pt.p=d,J.T=o}}i.current=a,yi=2}}function QR(){if(yi===2){yi=0;var i=Pc,a=Bf,o=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||o){o=J.T,J.T=null;var d=pt.p;pt.p=2;var y=qe;qe|=4;try{CR(i,a.alternate,a)}finally{qe=y,pt.p=d,J.T=o}}yi=3}}function JR(){if(yi===4||yi===3){yi=0,se();var i=Pc,a=Bf,o=ul,d=FR;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?yi=5:(yi=0,Bf=Pc=null,ZR(i,i.pendingLanes));var y=i.pendingLanes;if(y===0&&(kc=null),cc(o),a=a.stateNode,$i&&typeof $i.onCommitFiberRoot=="function")try{$i.onCommitFiberRoot(gi,a,void 0,(a.current.flags&128)===128)}catch{}if(d!==null){a=J.T,y=pt.p,pt.p=2,J.T=null;try{for(var w=i.onRecoverableError,T=0;T<d.length;T++){var B=d[T];w(B.value,{componentStack:B.stack})}}finally{J.T=a,pt.p=y}}(ul&3)!==0&&$0(),no(i),y=i.pendingLanes,(o&261930)!==0&&(y&42)!==0?i===VS?Ug++:(Ug=0,VS=i):Ug=0,zg(0)}}function ZR(i,a){(i.pooledCacheLanes&=a)===0&&(a=i.pooledCache,a!=null&&(i.pooledCache=null,wg(a)))}function $0(){return WR(),QR(),JR(),tO()}function tO(){if(yi!==5)return!1;var i=Pc,a=HS;HS=0;var o=cc(ul),d=J.T,y=pt.p;try{pt.p=32>o?32:o,J.T=null,o=$S,$S=null;var w=Pc,T=ul;if(yi=0,Bf=Pc=null,ul=0,(qe&6)!==0)throw Error(n(331));var B=qe;if(qe|=4,LR(w.current),NR(w,w.current,T,o),qe=B,zg(0,!1),$i&&typeof $i.onPostCommitFiberRoot=="function")try{$i.onPostCommitFiberRoot(gi,w)}catch{}return!0}finally{pt.p=y,J.T=d,ZR(i,a)}}function eO(i,a,o){a=Ha(o,a),a=AS(i.stateNode,a,2),i=Tc(i,a,2),i!==null&&(Ba(i,2),no(i))}function Qe(i,a,o){if(i.tag===3)eO(i,i,o);else for(;a!==null;){if(a.tag===3){eO(a,i,o);break}else if(a.tag===1){var d=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(kc===null||!kc.has(d))){i=Ha(o,i),o=nR(2),d=Tc(a,o,2),d!==null&&(iR(o,d,a,i),Ba(d,2),no(d));break}}a=a.return}}function XS(i,a,o){var d=i.pingCache;if(d===null){d=i.pingCache=new IP;var y=new Set;d.set(a,y)}else y=d.get(a),y===void 0&&(y=new Set,d.set(a,y));y.has(o)||(US=!0,y.add(o),i=jP.bind(null,i,a,o),a.then(i,i))}function jP(i,a,o){var d=i.pingCache;d!==null&&d.delete(a),i.pingedLanes|=i.suspendedLanes&o,i.warmLanes&=~o,fn===i&&(ke&o)===o&&($n===4||$n===3&&(ke&62914560)===ke&&300>oe()-B0?(qe&2)===0&&Ff(i,0):zS|=o,If===ke&&(If=0)),no(i)}function nO(i,a){a===0&&(a=Kv()),i=Mn(i,a),i!==null&&(Ba(i,a),no(i))}function HP(i){var a=i.memoizedState,o=0;a!==null&&(o=a.retryLane),nO(i,o)}function $P(i,a){var o=0;switch(i.tag){case 31:case 13:var d=i.stateNode,y=i.memoizedState;y!==null&&(o=y.retryLane);break;case 19:d=i.stateNode;break;case 22:d=i.stateNode._retryCache;break;default:throw Error(n(314))}d!==null&&d.delete(a),nO(i,o)}function VP(i,a){return pr(i,a)}var V0=null,zf=null,YS=!1,G0=!1,KS=!1,Ic=0;function no(i){i!==zf&&i.next===null&&(zf===null?V0=zf=i:zf=zf.next=i),G0=!0,YS||(YS=!0,qP())}function zg(i,a){if(!KS&&G0){KS=!0;do for(var o=!1,d=V0;d!==null;){if(i!==0){var y=d.pendingLanes;if(y===0)var w=0;else{var T=d.suspendedLanes,B=d.pingedLanes;w=(1<<31-Ut(42|i)+1)-1,w&=y&~(T&~B),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(o=!0,rO(d,w))}else w=ke,w=qu(d,d===fn?w:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(w&3)===0||Uo(d,w)||(o=!0,rO(d,w));d=d.next}while(o);KS=!1}}function GP(){iO()}function iO(){G0=YS=!1;var i=0;Ic!==0&&nL()&&(i=Ic);for(var a=oe(),o=null,d=V0;d!==null;){var y=d.next,w=sO(d,a);w===0?(d.next=null,o===null?V0=y:o.next=y,y===null&&(zf=o)):(o=d,(i!==0||(w&3)!==0)&&(G0=!0)),d=y}yi!==0&&yi!==5||zg(i),Ic!==0&&(Ic=0)}function sO(i,a){for(var o=i.suspendedLanes,d=i.pingedLanes,y=i.expirationTimes,w=i.pendingLanes&-62914561;0<w;){var T=31-Ut(w),B=1<<T,V=y[T];V===-1?((B&o)===0||(B&d)!==0)&&(y[T]=TA(B,a)):V<=a&&(i.expiredLanes|=B),w&=~B}if(a=fn,o=ke,o=qu(i,i===a?o:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),d=i.callbackNode,o===0||i===a&&(We===2||We===9)||i.cancelPendingCommit!==null)return d!==null&&d!==null&&te(d),i.callbackNode=null,i.callbackPriority=0;if((o&3)===0||Uo(i,o)){if(a=o&-o,a===i.callbackPriority)return a;switch(d!==null&&te(d),cc(o)){case 2:case 8:o=fe;break;case 32:o=Oe;break;case 268435456:o=Ia;break;default:o=Oe}return d=aO.bind(null,i),o=pr(o,d),i.callbackPriority=a,i.callbackNode=o,a}return d!==null&&d!==null&&te(d),i.callbackPriority=2,i.callbackNode=null,2}function aO(i,a){if(yi!==0&&yi!==5)return i.callbackNode=null,i.callbackPriority=0,null;var o=i.callbackNode;if($0()&&i.callbackNode!==o)return null;var d=ke;return d=qu(i,i===fn?d:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),d===0?null:(zR(i,d,a),sO(i,oe()),i.callbackNode!=null&&i.callbackNode===o?aO.bind(null,i):null)}function rO(i,a){if($0())return null;zR(i,a,!0)}function qP(){sL(function(){(qe&6)!==0?pr(mi,GP):iO()})}function WS(){if(Ic===0){var i=Cf;i===0&&(i=Lt,Lt<<=1,(Lt&261888)===0&&(Lt=256)),Ic=i}return Ic}function oO(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:vr(""+i)}function lO(i,a){var o=a.ownerDocument.createElement("input");return o.name=a.name,o.value=a.value,i.id&&o.setAttribute("form",i.id),a.parentNode.insertBefore(o,a),i=new FormData(i),o.parentNode.removeChild(o),i}function XP(i,a,o,d,y){if(a==="submit"&&o&&o.stateNode===y){var w=oO((y[Qn]||null).action),T=d.submitter;T&&(a=(a=T[Qn]||null)?oO(a.formAction):T.getAttribute("formAction"),a!==null&&(w=a,T=null));var B=new rf("action","action",null,d,y);i.push({event:B,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Ic!==0){var V=T?lO(y,T):new FormData(y);gS(o,{pending:!0,data:V,method:y.method,action:w},null,V)}}else typeof w=="function"&&(B.preventDefault(),V=T?lO(y,T):new FormData(y),gS(o,{pending:!0,data:V,method:y.method,action:w},w,V))},currentTarget:y}]})}}for(var QS=0;QS<Nt.length;QS++){var JS=Nt[QS],YP=JS.toLowerCase(),KP=JS[0].toUpperCase()+JS.slice(1);Tt(YP,"on"+KP)}Tt(at,"onAnimationEnd"),Tt(ut,"onAnimationIteration"),Tt(bt,"onAnimationStart"),Tt("dblclick","onDoubleClick"),Tt("focusin","onFocus"),Tt("focusout","onBlur"),Tt(At,"onTransitionRun"),Tt(Rt,"onTransitionStart"),Tt(kt,"onTransitionCancel"),Tt(xt,"onTransitionEnd"),Yr("onMouseEnter",["mouseout","mouseover"]),Yr("onMouseLeave",["mouseout","mouseover"]),Yr("onPointerEnter",["pointerout","pointerover"]),Yr("onPointerLeave",["pointerout","pointerover"]),yr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),yr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),yr("onBeforeInput",["compositionend","keypress","textInput","paste"]),yr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),yr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),yr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),WP=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(jg));function cO(i,a){a=(a&4)!==0;for(var o=0;o<i.length;o++){var d=i[o],y=d.event;d=d.listeners;t:{var w=void 0;if(a)for(var T=d.length-1;0<=T;T--){var B=d[T],V=B.instance,ot=B.currentTarget;if(B=B.listener,V!==w&&y.isPropagationStopped())break t;w=B,y.currentTarget=ot;try{w(y)}catch(vt){zt(vt)}y.currentTarget=null,w=V}else for(T=0;T<d.length;T++){if(B=d[T],V=B.instance,ot=B.currentTarget,B=B.listener,V!==w&&y.isPropagationStopped())break t;w=B,y.currentTarget=ot;try{w(y)}catch(vt){zt(vt)}y.currentTarget=null,w=V}}}}function Ne(i,a){var o=a[uc];o===void 0&&(o=a[uc]=new Set);var d=i+"__bubble";o.has(d)||(uO(a,i,2,!1),o.add(d))}function ZS(i,a,o){var d=0;a&&(d|=4),uO(o,i,d,a)}var q0="_reactListening"+Math.random().toString(36).slice(2);function tE(i){if(!i[q0]){i[q0]=!0,zo.forEach(function(o){o!=="selectionchange"&&(WP.has(o)||ZS(o,!1,i),ZS(o,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[q0]||(a[q0]=!0,ZS("selectionchange",!1,a))}}function uO(i,a,o,d){switch(UO(a)){case 2:var y=EL;break;case 8:y=CL;break;default:y=mE}o=y.bind(null,a,o,i),y=void 0,!ig||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(y=!0),d?y!==void 0?i.addEventListener(a,o,{capture:!0,passive:y}):i.addEventListener(a,o,!0):y!==void 0?i.addEventListener(a,o,{passive:y}):i.addEventListener(a,o,!1)}function eE(i,a,o,d,y){var w=d;if((a&1)===0&&(a&2)===0&&d!==null)t:for(;;){if(d===null)return;var T=d.tag;if(T===3||T===4){var B=d.stateNode.containerInfo;if(B===y)break;if(T===4)for(T=d.return;T!==null;){var V=T.tag;if((V===3||V===4)&&T.stateNode.containerInfo===y)return;T=T.return}for(;B!==null;){if(T=Xr(B),T===null)return;if(V=T.tag,V===5||V===6||V===26||V===27){d=w=T;continue t}B=B.parentNode}}d=d.return}dc(function(){var ot=w,vt=sf(o),St=[];t:{var ht=Ot.get(i);if(ht!==void 0){var mt=rf,Kt=i;switch(i){case"keypress":if(mc(o)===0)break t;case"keydown":case"keyup":mt=ff;break;case"focusin":Kt="focus",mt=gc;break;case"focusout":Kt="blur",mt=gc;break;case"beforeblur":case"afterblur":mt=gc;break;case"click":if(o.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":mt=cf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":mt=Zv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":mt=ug;break;case at:case ut:case bt:mt=t0;break;case xt:mt=hg;break;case"scroll":case"scrollend":mt=of;break;case"wheel":mt=mf;break;case"copy":case"cut":case"paste":mt=yc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":mt=cg;break;case"toggle":case"beforetoggle":mt=i0}var ae=(a&4)!==0,sn=!ae&&(i==="scroll"||i==="scrollend"),st=ae?ht!==null?ht+"Capture":null:ht;ae=[];for(var W=ot,rt;W!==null;){var wt=W;if(rt=wt.stateNode,wt=wt.tag,wt!==5&&wt!==26&&wt!==27||rt===null||st===null||(wt=Go(W,st),wt!=null&&ae.push(Hg(W,wt,rt))),sn)break;W=W.return}0<ae.length&&(ht=new mt(ht,Kt,null,o,vt),St.push({event:ht,listeners:ae}))}}if((a&7)===0){t:{if(ht=i==="mouseover"||i==="pointerover",mt=i==="mouseout"||i==="pointerout",ht&&o!==Ua&&(Kt=o.relatedTarget||o.fromElement)&&(Xr(Kt)||Kt[_s]))break t;if((mt||ht)&&(ht=vt.window===vt?vt:(ht=vt.ownerDocument)?ht.defaultView||ht.parentWindow:window,mt?(Kt=o.relatedTarget||o.toElement,mt=ot,Kt=Kt?Xr(Kt):null,Kt!==null&&(sn=r(Kt),ae=Kt.tag,Kt!==sn||ae!==5&&ae!==27&&ae!==6)&&(Kt=null)):(mt=null,Kt=ot),mt!==Kt)){if(ae=cf,wt="onMouseLeave",st="onMouseEnter",W="mouse",(i==="pointerout"||i==="pointerover")&&(ae=cg,wt="onPointerLeave",st="onPointerEnter",W="pointer"),sn=mt==null?ht:ea(mt),rt=Kt==null?ht:ea(Kt),ht=new ae(wt,W+"leave",mt,o,vt),ht.target=sn,ht.relatedTarget=rt,wt=null,Xr(vt)===ot&&(ae=new ae(st,W+"enter",Kt,o,vt),ae.target=rt,ae.relatedTarget=sn,wt=ae),sn=wt,mt&&Kt)e:{for(ae=QP,st=mt,W=Kt,rt=0,wt=st;wt;wt=ae(wt))rt++;wt=0;for(var ie=W;ie;ie=ae(ie))wt++;for(;0<rt-wt;)st=ae(st),rt--;for(;0<wt-rt;)W=ae(W),wt--;for(;rt--;){if(st===W||W!==null&&st===W.alternate){ae=st;break e}st=ae(st),W=ae(W)}ae=null}else ae=null;mt!==null&&hO(St,ht,mt,ae,!1),Kt!==null&&sn!==null&&hO(St,sn,Kt,ae,!0)}}t:{if(ht=ot?ea(ot):window,mt=ht.nodeName&&ht.nodeName.toLowerCase(),mt==="select"||mt==="input"&&ht.type==="file")var $e=lh;else if(bf(ht))if(ja)$e=wc;else{$e=Wo;var Qt=c0}else mt=ht.nodeName,!mt||mt.toLowerCase()!=="input"||ht.type!=="checkbox"&&ht.type!=="radio"?ot&&ng(ot.elementType)&&($e=lh):$e=gg;if($e&&($e=$e(i,ot))){mg(St,$e,o,vt);break t}Qt&&Qt(i,ht,ot),i==="focusout"&&ot&&ht.type==="number"&&ot.memoizedProps.value!=null&&th(ht,"number",ht.value)}switch(Qt=ot?ea(ot):window,i){case"focusin":(bf(Qt)||Qt.contentEditable==="true")&&($=Qt,X=ot,Y=null);break;case"focusout":Y=X=$=null;break;case"mousedown":et=!0;break;case"contextmenu":case"mouseup":case"dragend":et=!1,q(St,o,vt);break;case"selectionchange":if(U)break;case"keydown":case"keyup":q(St,o,vt)}var Ce;if(rh)t:{switch(i){case"compositionstart":var Pe="onCompositionStart";break t;case"compositionend":Pe="onCompositionEnd";break t;case"compositionupdate":Pe="onCompositionUpdate";break t}Pe=void 0}else Ko?pg(i,o)&&(Pe="onCompositionEnd"):i==="keydown"&&o.keyCode===229&&(Pe="onCompositionStart");Pe&&(gf&&o.locale!=="ko"&&(Ko||Pe!=="onCompositionStart"?Pe==="onCompositionEnd"&&Ko&&(Ce=pc()):(za=vt,af="value"in za?za.value:za.textContent,Ko=!0)),Qt=X0(ot,Pe),0<Qt.length&&(Pe=new df(Pe,i,null,o,vt),St.push({event:Pe,listeners:Qt}),Ce?Pe.data=Ce:(Ce=a0(o),Ce!==null&&(Pe.data=Ce)))),(Ce=kA?r0(i,o):PA(i,o))&&(Pe=X0(ot,"onBeforeInput"),0<Pe.length&&(Qt=new df("onBeforeInput","beforeinput",null,o,vt),St.push({event:Qt,listeners:Pe}),Qt.data=Ce)),XP(St,i,ot,o,vt)}cO(St,a)})}function Hg(i,a,o){return{instance:i,listener:a,currentTarget:o}}function X0(i,a){for(var o=a+"Capture",d=[];i!==null;){var y=i,w=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||w===null||(y=Go(i,o),y!=null&&d.unshift(Hg(i,y,w)),y=Go(i,a),y!=null&&d.push(Hg(i,y,w))),i.tag===3)return d;i=i.return}return[]}function QP(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function hO(i,a,o,d,y){for(var w=a._reactName,T=[];o!==null&&o!==d;){var B=o,V=B.alternate,ot=B.stateNode;if(B=B.tag,V!==null&&V===d)break;B!==5&&B!==26&&B!==27||ot===null||(V=ot,y?(ot=Go(o,w),ot!=null&&T.unshift(Hg(o,ot,V))):y||(ot=Go(o,w),ot!=null&&T.push(Hg(o,ot,V)))),o=o.return}T.length!==0&&i.push({event:a,listeners:T})}var JP=/\r\n?/g,ZP=/\u0000|\uFFFD/g;function dO(i){return(typeof i=="string"?i:""+i).replace(JP,`
`).replace(ZP,"")}function fO(i,a){return a=dO(a),dO(i)===a}function nn(i,a,o,d,y,w){switch(o){case"children":typeof d=="string"?a==="body"||a==="textarea"&&d===""||Ho(i,d):(typeof d=="number"||typeof d=="bigint")&&a!=="body"&&Ho(i,""+d);break;case"className":Ju(i,"class",d);break;case"tabIndex":Ju(i,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":Ju(i,o,d);break;case"style":eg(i,d,w);break;case"data":if(a!=="object"){Ju(i,"data",d);break}case"src":case"href":if(d===""&&(a!=="a"||o!=="href")){i.removeAttribute(o);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){i.removeAttribute(o);break}d=vr(""+d),i.setAttribute(o,d);break;case"action":case"formAction":if(typeof d=="function"){i.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(o==="formAction"?(a!=="input"&&nn(i,a,"name",y.name,y,null),nn(i,a,"formEncType",y.formEncType,y,null),nn(i,a,"formMethod",y.formMethod,y,null),nn(i,a,"formTarget",y.formTarget,y,null)):(nn(i,a,"encType",y.encType,y,null),nn(i,a,"method",y.method,y,null),nn(i,a,"target",y.target,y,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){i.removeAttribute(o);break}d=vr(""+d),i.setAttribute(o,d);break;case"onClick":d!=null&&(i.onclick=Ls);break;case"onScroll":d!=null&&Ne("scroll",i);break;case"onScrollEnd":d!=null&&Ne("scrollend",i);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(o=d.__html,o!=null){if(y.children!=null)throw Error(n(60));i.innerHTML=o}}break;case"multiple":i.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":i.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){i.removeAttribute("xlink:href");break}o=vr(""+d),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(o,""+d):i.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(o,""):i.removeAttribute(o);break;case"capture":case"download":d===!0?i.setAttribute(o,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(o,d):i.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?i.setAttribute(o,d):i.removeAttribute(o);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?i.removeAttribute(o):i.setAttribute(o,d);break;case"popover":Ne("beforetoggle",i),Ne("toggle",i),Re(i,"popover",d);break;case"xlinkActuate":Fa(i,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":Fa(i,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":Fa(i,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":Fa(i,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":Fa(i,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":Fa(i,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":Fa(i,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":Fa(i,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":Fa(i,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":Re(i,"is",d);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=DA.get(o)||o,Re(i,o,d))}}function nE(i,a,o,d,y,w){switch(o){case"style":eg(i,d,w);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(o=d.__html,o!=null){if(y.children!=null)throw Error(n(60));i.innerHTML=o}}break;case"children":typeof d=="string"?Ho(i,d):(typeof d=="number"||typeof d=="bigint")&&Ho(i,""+d);break;case"onScroll":d!=null&&Ne("scroll",i);break;case"onScrollEnd":d!=null&&Ne("scrollend",i);break;case"onClick":d!=null&&(i.onclick=Ls);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Wu.hasOwnProperty(o))t:{if(o[0]==="o"&&o[1]==="n"&&(y=o.endsWith("Capture"),a=o.slice(2,y?o.length-7:void 0),w=i[Qn]||null,w=w!=null?w[o]:null,typeof w=="function"&&i.removeEventListener(a,w,y),typeof d=="function")){typeof w!="function"&&w!==null&&(o in i?i[o]=null:i.hasAttribute(o)&&i.removeAttribute(o)),i.addEventListener(a,d,y);break t}o in i?i[o]=d:d===!0?i.setAttribute(o,""):Re(i,o,d)}}}function Ki(i,a,o){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ne("error",i),Ne("load",i);var d=!1,y=!1,w;for(w in o)if(o.hasOwnProperty(w)){var T=o[w];if(T!=null)switch(w){case"src":d=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:nn(i,a,w,T,o,null)}}y&&nn(i,a,"srcSet",o.srcSet,o,null),d&&nn(i,a,"src",o.src,o,null);return;case"input":Ne("invalid",i);var B=w=T=y=null,V=null,ot=null;for(d in o)if(o.hasOwnProperty(d)){var vt=o[d];if(vt!=null)switch(d){case"name":y=vt;break;case"type":T=vt;break;case"checked":V=vt;break;case"defaultChecked":ot=vt;break;case"value":w=vt;break;case"defaultValue":B=vt;break;case"children":case"dangerouslySetInnerHTML":if(vt!=null)throw Error(n(137,a));break;default:nn(i,a,d,vt,o,null)}}nf(i,w,B,V,ot,T,y,!1);return;case"select":Ne("invalid",i),d=T=w=null;for(y in o)if(o.hasOwnProperty(y)&&(B=o[y],B!=null))switch(y){case"value":w=B;break;case"defaultValue":T=B;break;case"multiple":d=B;default:nn(i,a,y,B,o,null)}a=w,o=T,i.multiple=!!d,a!=null?br(i,!!d,a,!1):o!=null&&br(i,!!d,o,!0);return;case"textarea":Ne("invalid",i),w=y=d=null;for(T in o)if(o.hasOwnProperty(T)&&(B=o[T],B!=null))switch(T){case"value":d=B;break;case"defaultValue":y=B;break;case"children":w=B;break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(n(91));break;default:nn(i,a,T,B,o,null)}eh(i,d,y,w);return;case"option":for(V in o)if(o.hasOwnProperty(V)&&(d=o[V],d!=null))switch(V){case"selected":i.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:nn(i,a,V,d,o,null)}return;case"dialog":Ne("beforetoggle",i),Ne("toggle",i),Ne("cancel",i),Ne("close",i);break;case"iframe":case"object":Ne("load",i);break;case"video":case"audio":for(d=0;d<jg.length;d++)Ne(jg[d],i);break;case"image":Ne("error",i),Ne("load",i);break;case"details":Ne("toggle",i);break;case"embed":case"source":case"link":Ne("error",i),Ne("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ot in o)if(o.hasOwnProperty(ot)&&(d=o[ot],d!=null))switch(ot){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:nn(i,a,ot,d,o,null)}return;default:if(ng(a)){for(vt in o)o.hasOwnProperty(vt)&&(d=o[vt],d!==void 0&&nE(i,a,vt,d,o,void 0));return}}for(B in o)o.hasOwnProperty(B)&&(d=o[B],d!=null&&nn(i,a,B,d,o,null))}function tL(i,a,o,d){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,w=null,T=null,B=null,V=null,ot=null,vt=null;for(mt in o){var St=o[mt];if(o.hasOwnProperty(mt)&&St!=null)switch(mt){case"checked":break;case"value":break;case"defaultValue":V=St;default:d.hasOwnProperty(mt)||nn(i,a,mt,null,d,St)}}for(var ht in d){var mt=d[ht];if(St=o[ht],d.hasOwnProperty(ht)&&(mt!=null||St!=null))switch(ht){case"type":w=mt;break;case"name":y=mt;break;case"checked":ot=mt;break;case"defaultChecked":vt=mt;break;case"value":T=mt;break;case"defaultValue":B=mt;break;case"children":case"dangerouslySetInnerHTML":if(mt!=null)throw Error(n(137,a));break;default:mt!==St&&nn(i,a,ht,mt,d,St)}}Kr(i,T,B,V,ot,vt,w,y);return;case"select":mt=T=B=ht=null;for(w in o)if(V=o[w],o.hasOwnProperty(w)&&V!=null)switch(w){case"value":break;case"multiple":mt=V;default:d.hasOwnProperty(w)||nn(i,a,w,null,d,V)}for(y in d)if(w=d[y],V=o[y],d.hasOwnProperty(y)&&(w!=null||V!=null))switch(y){case"value":ht=w;break;case"defaultValue":B=w;break;case"multiple":T=w;default:w!==V&&nn(i,a,y,w,d,V)}a=B,o=T,d=mt,ht!=null?br(i,!!o,ht,!1):!!d!=!!o&&(a!=null?br(i,!!o,a,!0):br(i,!!o,o?[]:"",!1));return;case"textarea":mt=ht=null;for(B in o)if(y=o[B],o.hasOwnProperty(B)&&y!=null&&!d.hasOwnProperty(B))switch(B){case"value":break;case"children":break;default:nn(i,a,B,null,d,y)}for(T in d)if(y=d[T],w=o[T],d.hasOwnProperty(T)&&(y!=null||w!=null))switch(T){case"value":ht=y;break;case"defaultValue":mt=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(n(91));break;default:y!==w&&nn(i,a,T,y,d,w)}tg(i,ht,mt);return;case"option":for(var Kt in o)if(ht=o[Kt],o.hasOwnProperty(Kt)&&ht!=null&&!d.hasOwnProperty(Kt))switch(Kt){case"selected":i.selected=!1;break;default:nn(i,a,Kt,null,d,ht)}for(V in d)if(ht=d[V],mt=o[V],d.hasOwnProperty(V)&&ht!==mt&&(ht!=null||mt!=null))switch(V){case"selected":i.selected=ht&&typeof ht!="function"&&typeof ht!="symbol";break;default:nn(i,a,V,ht,d,mt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ae in o)ht=o[ae],o.hasOwnProperty(ae)&&ht!=null&&!d.hasOwnProperty(ae)&&nn(i,a,ae,null,d,ht);for(ot in d)if(ht=d[ot],mt=o[ot],d.hasOwnProperty(ot)&&ht!==mt&&(ht!=null||mt!=null))switch(ot){case"children":case"dangerouslySetInnerHTML":if(ht!=null)throw Error(n(137,a));break;default:nn(i,a,ot,ht,d,mt)}return;default:if(ng(a)){for(var sn in o)ht=o[sn],o.hasOwnProperty(sn)&&ht!==void 0&&!d.hasOwnProperty(sn)&&nE(i,a,sn,void 0,d,ht);for(vt in d)ht=d[vt],mt=o[vt],!d.hasOwnProperty(vt)||ht===mt||ht===void 0&&mt===void 0||nE(i,a,vt,ht,d,mt);return}}for(var st in o)ht=o[st],o.hasOwnProperty(st)&&ht!=null&&!d.hasOwnProperty(st)&&nn(i,a,st,null,d,ht);for(St in d)ht=d[St],mt=o[St],!d.hasOwnProperty(St)||ht===mt||ht==null&&mt==null||nn(i,a,St,ht,d,mt)}function pO(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function eL(){if(typeof performance.getEntriesByType=="function"){for(var i=0,a=0,o=performance.getEntriesByType("resource"),d=0;d<o.length;d++){var y=o[d],w=y.transferSize,T=y.initiatorType,B=y.duration;if(w&&B&&pO(T)){for(T=0,B=y.responseEnd,d+=1;d<o.length;d++){var V=o[d],ot=V.startTime;if(ot>B)break;var vt=V.transferSize,St=V.initiatorType;vt&&pO(St)&&(V=V.responseEnd,T+=vt*(V<B?1:(B-ot)/(V-ot)))}if(--d,a+=8*(w+T)/(y.duration/1e3),i++,10<i)break}}if(0<i)return a/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var iE=null,sE=null;function Y0(i){return i.nodeType===9?i:i.ownerDocument}function mO(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function gO(i,a){if(i===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&a==="foreignObject"?0:i}function aE(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var rE=null;function nL(){var i=window.event;return i&&i.type==="popstate"?i===rE?!1:(rE=i,!0):(rE=null,!1)}var yO=typeof setTimeout=="function"?setTimeout:void 0,iL=typeof clearTimeout=="function"?clearTimeout:void 0,bO=typeof Promise=="function"?Promise:void 0,sL=typeof queueMicrotask=="function"?queueMicrotask:typeof bO<"u"?function(i){return bO.resolve(null).then(i).catch(aL)}:yO;function aL(i){setTimeout(function(){throw i})}function Bc(i){return i==="head"}function vO(i,a){var o=a,d=0;do{var y=o.nextSibling;if(i.removeChild(o),y&&y.nodeType===8)if(o=y.data,o==="/$"||o==="/&"){if(d===0){i.removeChild(y),Vf(a);return}d--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")d++;else if(o==="html")$g(i.ownerDocument.documentElement);else if(o==="head"){o=i.ownerDocument.head,$g(o);for(var w=o.firstChild;w;){var T=w.nextSibling,B=w.nodeName;w[ta]||B==="SCRIPT"||B==="STYLE"||B==="LINK"&&w.rel.toLowerCase()==="stylesheet"||o.removeChild(w),w=T}}else o==="body"&&$g(i.ownerDocument.body);o=y}while(o);Vf(a)}function wO(i,a){var o=i;i=0;do{var d=o.nextSibling;if(o.nodeType===1?a?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(a?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),d&&d.nodeType===8)if(o=d.data,o==="/$"){if(i===0)break;i--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||i++;o=d}while(o)}function oE(i){var a=i.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var o=a;switch(a=a.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":oE(o),tf(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}i.removeChild(o)}}function rL(i,a,o,d){for(;i.nodeType===1;){var y=o;if(i.nodeName.toLowerCase()!==a.toLowerCase()){if(!d&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(d){if(!i[ta])switch(a){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(w=i.getAttribute("rel"),w==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(w!==y.rel||i.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||i.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||i.getAttribute("title")!==(y.title==null?null:y.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(w=i.getAttribute("src"),(w!==(y.src==null?null:y.src)||i.getAttribute("type")!==(y.type==null?null:y.type)||i.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&w&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(a==="input"&&i.type==="hidden"){var w=y.name==null?null:""+y.name;if(y.type==="hidden"&&i.getAttribute("name")===w)return i}else return i;if(i=Xa(i.nextSibling),i===null)break}return null}function oL(i,a,o){if(a==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!o||(i=Xa(i.nextSibling),i===null))return null;return i}function _O(i,a){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!a||(i=Xa(i.nextSibling),i===null))return null;return i}function lE(i){return i.data==="$?"||i.data==="$~"}function cE(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function lL(i,a){var o=i.ownerDocument;if(i.data==="$~")i._reactRetry=a;else if(i.data!=="$?"||o.readyState!=="loading")a();else{var d=function(){a(),o.removeEventListener("DOMContentLoaded",d)};o.addEventListener("DOMContentLoaded",d),i._reactRetry=d}}function Xa(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return i}var uE=null;function AO(i){i=i.nextSibling;for(var a=0;i;){if(i.nodeType===8){var o=i.data;if(o==="/$"||o==="/&"){if(a===0)return Xa(i.nextSibling);a--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||a++}i=i.nextSibling}return null}function SO(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var o=i.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(a===0)return i;a--}else o!=="/$"&&o!=="/&"||a++}i=i.previousSibling}return null}function EO(i,a,o){switch(a=Y0(o),i){case"html":if(i=a.documentElement,!i)throw Error(n(452));return i;case"head":if(i=a.head,!i)throw Error(n(453));return i;case"body":if(i=a.body,!i)throw Error(n(454));return i;default:throw Error(n(451))}}function $g(i){for(var a=i.attributes;a.length;)i.removeAttributeNode(a[0]);tf(i)}var Ya=new Map,CO=new Set;function K0(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var hl=pt.d;pt.d={f:cL,r:uL,D:hL,C:dL,L:fL,m:pL,X:gL,S:mL,M:yL};function cL(){var i=hl.f(),a=z0();return i||a}function uL(i){var a=tn(i);a!==null&&a.tag===5&&a.type==="form"?HT(a):hl.r(i)}var jf=typeof document>"u"?null:document;function xO(i,a,o){var d=jf;if(d&&typeof a=="string"&&a){var y=Di(a);y='link[rel="'+i+'"][href="'+y+'"]',typeof o=="string"&&(y+='[crossorigin="'+o+'"]'),CO.has(y)||(CO.add(y),i={rel:i,crossOrigin:o,href:a},d.querySelector(y)===null&&(a=d.createElement("link"),Ki(a,"link",i),Jn(a),d.head.appendChild(a)))}}function hL(i){hl.D(i),xO("dns-prefetch",i,null)}function dL(i,a){hl.C(i,a),xO("preconnect",i,a)}function fL(i,a,o){hl.L(i,a,o);var d=jf;if(d&&i&&a){var y='link[rel="preload"][as="'+Di(a)+'"]';a==="image"&&o&&o.imageSrcSet?(y+='[imagesrcset="'+Di(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(y+='[imagesizes="'+Di(o.imageSizes)+'"]')):y+='[href="'+Di(i)+'"]';var w=y;switch(a){case"style":w=Hf(i);break;case"script":w=$f(i)}Ya.has(w)||(i=b({rel:"preload",href:a==="image"&&o&&o.imageSrcSet?void 0:i,as:a},o),Ya.set(w,i),d.querySelector(y)!==null||a==="style"&&d.querySelector(Vg(w))||a==="script"&&d.querySelector(Gg(w))||(a=d.createElement("link"),Ki(a,"link",i),Jn(a),d.head.appendChild(a)))}}function pL(i,a){hl.m(i,a);var o=jf;if(o&&i){var d=a&&typeof a.as=="string"?a.as:"script",y='link[rel="modulepreload"][as="'+Di(d)+'"][href="'+Di(i)+'"]',w=y;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=$f(i)}if(!Ya.has(w)&&(i=b({rel:"modulepreload",href:i},a),Ya.set(w,i),o.querySelector(y)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(Gg(w)))return}d=o.createElement("link"),Ki(d,"link",i),Jn(d),o.head.appendChild(d)}}}function mL(i,a,o){hl.S(i,a,o);var d=jf;if(d&&i){var y=ls(d).hoistableStyles,w=Hf(i);a=a||"default";var T=y.get(w);if(!T){var B={loading:0,preload:null};if(T=d.querySelector(Vg(w)))B.loading=5;else{i=b({rel:"stylesheet",href:i,"data-precedence":a},o),(o=Ya.get(w))&&hE(i,o);var V=T=d.createElement("link");Jn(V),Ki(V,"link",i),V._p=new Promise(function(ot,vt){V.onload=ot,V.onerror=vt}),V.addEventListener("load",function(){B.loading|=1}),V.addEventListener("error",function(){B.loading|=2}),B.loading|=4,W0(T,a,d)}T={type:"stylesheet",instance:T,count:1,state:B},y.set(w,T)}}}function gL(i,a){hl.X(i,a);var o=jf;if(o&&i){var d=ls(o).hoistableScripts,y=$f(i),w=d.get(y);w||(w=o.querySelector(Gg(y)),w||(i=b({src:i,async:!0},a),(a=Ya.get(y))&&dE(i,a),w=o.createElement("script"),Jn(w),Ki(w,"link",i),o.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},d.set(y,w))}}function yL(i,a){hl.M(i,a);var o=jf;if(o&&i){var d=ls(o).hoistableScripts,y=$f(i),w=d.get(y);w||(w=o.querySelector(Gg(y)),w||(i=b({src:i,async:!0,type:"module"},a),(a=Ya.get(y))&&dE(i,a),w=o.createElement("script"),Jn(w),Ki(w,"link",i),o.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},d.set(y,w))}}function TO(i,a,o,d){var y=(y=Gt.current)?K0(y):null;if(!y)throw Error(n(446));switch(i){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(a=Hf(o.href),o=ls(y).hoistableStyles,d=o.get(a),d||(d={type:"style",instance:null,count:0,state:null},o.set(a,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){i=Hf(o.href);var w=ls(y).hoistableStyles,T=w.get(i);if(T||(y=y.ownerDocument||y,T={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(i,T),(w=y.querySelector(Vg(i)))&&!w._p&&(T.instance=w,T.state.loading=5),Ya.has(i)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},Ya.set(i,o),w||bL(y,i,o,T.state))),a&&d===null)throw Error(n(528,""));return T}if(a&&d!==null)throw Error(n(529,""));return null;case"script":return a=o.async,o=o.src,typeof o=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=$f(o),o=ls(y).hoistableScripts,d=o.get(a),d||(d={type:"script",instance:null,count:0,state:null},o.set(a,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,i))}}function Hf(i){return'href="'+Di(i)+'"'}function Vg(i){return'link[rel="stylesheet"]['+i+"]"}function RO(i){return b({},i,{"data-precedence":i.precedence,precedence:null})}function bL(i,a,o,d){i.querySelector('link[rel="preload"][as="style"]['+a+"]")?d.loading=1:(a=i.createElement("link"),d.preload=a,a.addEventListener("load",function(){return d.loading|=1}),a.addEventListener("error",function(){return d.loading|=2}),Ki(a,"link",o),Jn(a),i.head.appendChild(a))}function $f(i){return'[src="'+Di(i)+'"]'}function Gg(i){return"script[async]"+i}function OO(i,a,o){if(a.count++,a.instance===null)switch(a.type){case"style":var d=i.querySelector('style[data-href~="'+Di(o.href)+'"]');if(d)return a.instance=d,Jn(d),d;var y=b({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return d=(i.ownerDocument||i).createElement("style"),Jn(d),Ki(d,"style",y),W0(d,o.precedence,i),a.instance=d;case"stylesheet":y=Hf(o.href);var w=i.querySelector(Vg(y));if(w)return a.state.loading|=4,a.instance=w,Jn(w),w;d=RO(o),(y=Ya.get(y))&&hE(d,y),w=(i.ownerDocument||i).createElement("link"),Jn(w);var T=w;return T._p=new Promise(function(B,V){T.onload=B,T.onerror=V}),Ki(w,"link",d),a.state.loading|=4,W0(w,o.precedence,i),a.instance=w;case"script":return w=$f(o.src),(y=i.querySelector(Gg(w)))?(a.instance=y,Jn(y),y):(d=o,(y=Ya.get(w))&&(d=b({},o),dE(d,y)),i=i.ownerDocument||i,y=i.createElement("script"),Jn(y),Ki(y,"link",d),i.head.appendChild(y),a.instance=y);case"void":return null;default:throw Error(n(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(d=a.instance,a.state.loading|=4,W0(d,o.precedence,i));return a.instance}function W0(i,a,o){for(var d=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=d.length?d[d.length-1]:null,w=y,T=0;T<d.length;T++){var B=d[T];if(B.dataset.precedence===a)w=B;else if(w!==y)break}w?w.parentNode.insertBefore(i,w.nextSibling):(a=o.nodeType===9?o.head:o,a.insertBefore(i,a.firstChild))}function hE(i,a){i.crossOrigin==null&&(i.crossOrigin=a.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=a.referrerPolicy),i.title==null&&(i.title=a.title)}function dE(i,a){i.crossOrigin==null&&(i.crossOrigin=a.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=a.referrerPolicy),i.integrity==null&&(i.integrity=a.integrity)}var Q0=null;function DO(i,a,o){if(Q0===null){var d=new Map,y=Q0=new Map;y.set(o,d)}else y=Q0,d=y.get(o),d||(d=new Map,y.set(o,d));if(d.has(i))return d;for(d.set(i,null),o=o.getElementsByTagName(i),y=0;y<o.length;y++){var w=o[y];if(!(w[ta]||w[vn]||i==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var T=w.getAttribute(a)||"";T=i+T;var B=d.get(T);B?B.push(w):d.set(T,[w])}}return d}function MO(i,a,o){i=i.ownerDocument||i,i.head.insertBefore(o,a==="title"?i.querySelector("head > title"):null)}function vL(i,a,o){if(o===1||a.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return i=a.disabled,typeof a.precedence=="string"&&i==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function NO(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function wL(i,a,o,d){if(o.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var y=Hf(d.href),w=a.querySelector(Vg(y));if(w){a=w._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(i.count++,i=J0.bind(i),a.then(i,i)),o.state.loading|=4,o.instance=w,Jn(w);return}w=a.ownerDocument||a,d=RO(d),(y=Ya.get(y))&&hE(d,y),w=w.createElement("link"),Jn(w);var T=w;T._p=new Promise(function(B,V){T.onload=B,T.onerror=V}),Ki(w,"link",d),o.instance=w}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(o,a),(a=o.state.preload)&&(o.state.loading&3)===0&&(i.count++,o=J0.bind(i),a.addEventListener("load",o),a.addEventListener("error",o))}}var fE=0;function _L(i,a){return i.stylesheets&&i.count===0&&tw(i,i.stylesheets),0<i.count||0<i.imgCount?function(o){var d=setTimeout(function(){if(i.stylesheets&&tw(i,i.stylesheets),i.unsuspend){var w=i.unsuspend;i.unsuspend=null,w()}},6e4+a);0<i.imgBytes&&fE===0&&(fE=62500*eL());var y=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&tw(i,i.stylesheets),i.unsuspend)){var w=i.unsuspend;i.unsuspend=null,w()}},(i.imgBytes>fE?50:800)+a);return i.unsuspend=o,function(){i.unsuspend=null,clearTimeout(d),clearTimeout(y)}}:null}function J0(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)tw(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Z0=null;function tw(i,a){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Z0=new Map,a.forEach(AL,i),Z0=null,J0.call(i))}function AL(i,a){if(!(a.state.loading&4)){var o=Z0.get(i);if(o)var d=o.get(null);else{o=new Map,Z0.set(i,o);for(var y=i.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<y.length;w++){var T=y[w];(T.nodeName==="LINK"||T.getAttribute("media")!=="not all")&&(o.set(T.dataset.precedence,T),d=T)}d&&o.set(null,d)}y=a.instance,T=y.getAttribute("data-precedence"),w=o.get(T)||d,w===d&&o.set(null,y),o.set(T,y),this.count++,d=J0.bind(this),y.addEventListener("load",d),y.addEventListener("error",d),w?w.parentNode.insertBefore(y,w.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(y,i.firstChild)),a.state.loading|=4}}var qg={$$typeof:P,Provider:null,Consumer:null,_currentValue:Et,_currentValue2:Et,_threadCount:0};function SL(i,a,o,d,y,w,T,B,V){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Vr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vr(0),this.hiddenUpdates=Vr(null),this.identifierPrefix=d,this.onUncaughtError=y,this.onCaughtError=w,this.onRecoverableError=T,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=V,this.incompleteTransitions=new Map}function kO(i,a,o,d,y,w,T,B,V,ot,vt,St){return i=new SL(i,a,o,T,V,ot,vt,St,B),a=1,w===!0&&(a|=24),w=ia(3,null,null,a),i.current=w,w.stateNode=i,a=qA(),a.refCount++,i.pooledCache=a,a.refCount++,w.memoizedState={element:d,isDehydrated:o,cache:a},WA(w),i}function PO(i){return i?(i=Is,i):Is}function LO(i,a,o,d,y,w){y=PO(y),d.context===null?d.context=y:d.pendingContext=y,d=xc(a),d.payload={element:o},w=w===void 0?null:w,w!==null&&(d.callback=w),o=Tc(i,d,a),o!==null&&(js(o,i,a),Eg(o,i,a))}function IO(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var o=i.retryLane;i.retryLane=o!==0&&o<a?o:a}}function pE(i,a){IO(i,a),(i=i.alternate)&&IO(i,a)}function BO(i){if(i.tag===13||i.tag===31){var a=Mn(i,67108864);a!==null&&js(a,i,67108864),pE(i,67108864)}}function FO(i){if(i.tag===13||i.tag===31){var a=la();a=Wm(a);var o=Mn(i,a);o!==null&&js(o,i,a),pE(i,a)}}var ew=!0;function EL(i,a,o,d){var y=J.T;J.T=null;var w=pt.p;try{pt.p=2,mE(i,a,o,d)}finally{pt.p=w,J.T=y}}function CL(i,a,o,d){var y=J.T;J.T=null;var w=pt.p;try{pt.p=8,mE(i,a,o,d)}finally{pt.p=w,J.T=y}}function mE(i,a,o,d){if(ew){var y=gE(d);if(y===null)eE(i,a,d,nw,o),zO(i,d);else if(TL(y,i,a,o,d))d.stopPropagation();else if(zO(i,d),a&4&&-1<xL.indexOf(i)){for(;y!==null;){var w=tn(y);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var T=gr(w.pendingLanes);if(T!==0){var B=w;for(B.pendingLanes|=2,B.entangledLanes|=2;T;){var V=1<<31-Ut(T);B.entanglements[1]|=V,T&=~V}no(w),(qe&6)===0&&(F0=oe()+500,zg(0))}}break;case 31:case 13:B=Mn(w,2),B!==null&&js(B,w,2),z0(),pE(w,2)}if(w=gE(d),w===null&&eE(i,a,d,nw,o),w===y)break;y=w}y!==null&&d.stopPropagation()}else eE(i,a,d,null,o)}}function gE(i){return i=sf(i),yE(i)}var nw=null;function yE(i){if(nw=null,i=Xr(i),i!==null){var a=r(i);if(a===null)i=null;else{var o=a.tag;if(o===13){if(i=u(a),i!==null)return i;i=null}else if(o===31){if(i=h(a),i!==null)return i;i=null}else if(o===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null)}}return nw=i,null}function UO(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(En()){case mi:return 2;case fe:return 8;case Oe:case In:return 32;case Ia:return 268435456;default:return 32}default:return 32}}var bE=!1,Fc=null,Uc=null,zc=null,Xg=new Map,Yg=new Map,jc=[],xL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function zO(i,a){switch(i){case"focusin":case"focusout":Fc=null;break;case"dragenter":case"dragleave":Uc=null;break;case"mouseover":case"mouseout":zc=null;break;case"pointerover":case"pointerout":Xg.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Yg.delete(a.pointerId)}}function Kg(i,a,o,d,y,w){return i===null||i.nativeEvent!==w?(i={blockedOn:a,domEventName:o,eventSystemFlags:d,nativeEvent:w,targetContainers:[y]},a!==null&&(a=tn(a),a!==null&&BO(a)),i):(i.eventSystemFlags|=d,a=i.targetContainers,y!==null&&a.indexOf(y)===-1&&a.push(y),i)}function TL(i,a,o,d,y){switch(a){case"focusin":return Fc=Kg(Fc,i,a,o,d,y),!0;case"dragenter":return Uc=Kg(Uc,i,a,o,d,y),!0;case"mouseover":return zc=Kg(zc,i,a,o,d,y),!0;case"pointerover":var w=y.pointerId;return Xg.set(w,Kg(Xg.get(w)||null,i,a,o,d,y)),!0;case"gotpointercapture":return w=y.pointerId,Yg.set(w,Kg(Yg.get(w)||null,i,a,o,d,y)),!0}return!1}function jO(i){var a=Xr(i.target);if(a!==null){var o=r(a);if(o!==null){if(a=o.tag,a===13){if(a=u(o),a!==null){i.blockedOn=a,Ku(i.priority,function(){FO(o)});return}}else if(a===31){if(a=h(o),a!==null){i.blockedOn=a,Ku(i.priority,function(){FO(o)});return}}else if(a===3&&o.stateNode.current.memoizedState.isDehydrated){i.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}i.blockedOn=null}function iw(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var o=gE(i.nativeEvent);if(o===null){o=i.nativeEvent;var d=new o.constructor(o.type,o);Ua=d,o.target.dispatchEvent(d),Ua=null}else return a=tn(o),a!==null&&BO(a),i.blockedOn=o,!1;a.shift()}return!0}function HO(i,a,o){iw(i)&&o.delete(a)}function RL(){bE=!1,Fc!==null&&iw(Fc)&&(Fc=null),Uc!==null&&iw(Uc)&&(Uc=null),zc!==null&&iw(zc)&&(zc=null),Xg.forEach(HO),Yg.forEach(HO)}function sw(i,a){i.blockedOn===a&&(i.blockedOn=null,bE||(bE=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,RL)))}var aw=null;function $O(i){aw!==i&&(aw=i,l.unstable_scheduleCallback(l.unstable_NormalPriority,function(){aw===i&&(aw=null);for(var a=0;a<i.length;a+=3){var o=i[a],d=i[a+1],y=i[a+2];if(typeof d!="function"){if(yE(d||o)===null)continue;break}var w=tn(o);w!==null&&(i.splice(a,3),a-=3,gS(w,{pending:!0,data:y,method:o.method,action:d},d,y))}}))}function Vf(i){function a(V){return sw(V,i)}Fc!==null&&sw(Fc,i),Uc!==null&&sw(Uc,i),zc!==null&&sw(zc,i),Xg.forEach(a),Yg.forEach(a);for(var o=0;o<jc.length;o++){var d=jc[o];d.blockedOn===i&&(d.blockedOn=null)}for(;0<jc.length&&(o=jc[0],o.blockedOn===null);)jO(o),o.blockedOn===null&&jc.shift();if(o=(i.ownerDocument||i).$$reactFormReplay,o!=null)for(d=0;d<o.length;d+=3){var y=o[d],w=o[d+1],T=y[Qn]||null;if(typeof w=="function")T||$O(o);else if(T){var B=null;if(w&&w.hasAttribute("formAction")){if(y=w,T=w[Qn]||null)B=T.formAction;else if(yE(y)!==null)continue}else B=T.action;typeof B=="function"?o[d+1]=B:(o.splice(d,3),d-=3),$O(o)}}}function VO(){function i(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(T){return y=T})},focusReset:"manual",scroll:"manual"})}function a(){y!==null&&(y(),y=null),d||setTimeout(o,20)}function o(){if(!d&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,y=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(o,100),function(){d=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),y!==null&&(y(),y=null)}}}function vE(i){this._internalRoot=i}rw.prototype.render=vE.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(n(409));var o=a.current,d=la();LO(o,d,i,a,null,null)},rw.prototype.unmount=vE.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;LO(i.current,2,null,i,null,null),z0(),a[_s]=null}};function rw(i){this._internalRoot=i}rw.prototype.unstable_scheduleHydration=function(i){if(i){var a=Yu();i={blockedOn:null,target:i,priority:a};for(var o=0;o<jc.length&&a!==0&&a<jc[o].priority;o++);jc.splice(o,0,i),o===0&&jO(i)}};var GO=t.version;if(GO!=="19.2.3")throw Error(n(527,GO,"19.2.3"));pt.findDOMNode=function(i){var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(n(188)):(i=Object.keys(i).join(","),Error(n(268,i)));return i=p(a),i=i!==null?m(i):null,i=i===null?null:i.stateNode,i};var OL={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:J,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ow=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ow.isDisabled&&ow.supportsFiber)try{gi=ow.inject(OL),$i=ow}catch{}}return Qg.createRoot=function(i,a){if(!s(i))throw Error(n(299));var o=!1,d="",y=JT,w=ZT,T=tR;return a!=null&&(a.unstable_strictMode===!0&&(o=!0),a.identifierPrefix!==void 0&&(d=a.identifierPrefix),a.onUncaughtError!==void 0&&(y=a.onUncaughtError),a.onCaughtError!==void 0&&(w=a.onCaughtError),a.onRecoverableError!==void 0&&(T=a.onRecoverableError)),a=kO(i,1,!1,null,null,o,d,null,y,w,T,VO),i[_s]=a.current,tE(i),new vE(a)},Qg.hydrateRoot=function(i,a,o){if(!s(i))throw Error(n(299));var d=!1,y="",w=JT,T=ZT,B=tR,V=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(y=o.identifierPrefix),o.onUncaughtError!==void 0&&(w=o.onUncaughtError),o.onCaughtError!==void 0&&(T=o.onCaughtError),o.onRecoverableError!==void 0&&(B=o.onRecoverableError),o.formState!==void 0&&(V=o.formState)),a=kO(i,1,!0,a,o??null,d,y,V,w,T,B,VO),a.context=PO(null),o=a.current,d=la(),d=Wm(d),y=xc(d),y.callback=null,Tc(o,y,d),o=d,a.current.lanes=o,Ba(a,o),no(a),i[_s]=a.current,tE(i),new rw(a)},Qg.version="19.2.3",Qg}var nD;function $L(){if(nD)return SE.exports;nD=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(t){console.error(t)}}return l(),SE.exports=HL(),SE.exports}var VL=$L();const GL=zC(VL);/**
 * react-router v7.12.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var iD="popstate";function qL(l={}){function t(n,s){let{pathname:r,search:u,hash:h}=n.location;return WE("",{pathname:r,search:u,hash:h},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function e(n,s){return typeof s=="string"?s:Py(s)}return YL(t,e,null,l)}function xi(l,t){if(l===!1||l===null||typeof l>"u")throw new Error(t)}function zr(l,t){if(!l){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function XL(){return Math.random().toString(36).substring(2,10)}function sD(l,t){return{usr:l.state,key:l.key,idx:t}}function WE(l,t,e=null,n){return{pathname:typeof l=="string"?l:l.pathname,search:"",hash:"",...typeof t=="string"?Nv(t):t,state:e,key:t&&t.key||n||XL()}}function Py({pathname:l="/",search:t="",hash:e=""}){return t&&t!=="?"&&(l+=t.charAt(0)==="?"?t:"?"+t),e&&e!=="#"&&(l+=e.charAt(0)==="#"?e:"#"+e),l}function Nv(l){let t={};if(l){let e=l.indexOf("#");e>=0&&(t.hash=l.substring(e),l=l.substring(0,e));let n=l.indexOf("?");n>=0&&(t.search=l.substring(n),l=l.substring(0,n)),l&&(t.pathname=l)}return t}function YL(l,t,e,n={}){let{window:s=document.defaultView,v5Compat:r=!1}=n,u=s.history,h="POP",f=null,p=m();p==null&&(p=0,u.replaceState({...u.state,idx:p},""));function m(){return(u.state||{idx:null}).idx}function b(){h="POP";let M=m(),k=M==null?null:M-p;p=M,f&&f({action:h,location:C.location,delta:k})}function _(M,k){h="PUSH";let I=WE(C.location,M,k);p=m()+1;let P=sD(I,p),F=C.createHref(I);try{u.pushState(P,"",F)}catch(z){if(z instanceof DOMException&&z.name==="DataCloneError")throw z;s.location.assign(F)}r&&f&&f({action:h,location:C.location,delta:1})}function S(M,k){h="REPLACE";let I=WE(C.location,M,k);p=m();let P=sD(I,p),F=C.createHref(I);u.replaceState(P,"",F),r&&f&&f({action:h,location:C.location,delta:0})}function R(M){return KL(M)}let C={get action(){return h},get location(){return l(s,u)},listen(M){if(f)throw new Error("A history only accepts one active listener");return s.addEventListener(iD,b),f=M,()=>{s.removeEventListener(iD,b),f=null}},createHref(M){return t(s,M)},createURL:R,encodeLocation(M){let k=R(M);return{pathname:k.pathname,search:k.search,hash:k.hash}},push:_,replace:S,go(M){return u.go(M)}};return C}function KL(l,t=!1){let e="http://localhost";typeof window<"u"&&(e=window.location.origin!=="null"?window.location.origin:window.location.href),xi(e,"No window.location.(origin|href) available to create URL");let n=typeof l=="string"?l:Py(l);return n=n.replace(/ $/,"%20"),!t&&n.startsWith("//")&&(n=e+n),new URL(n,e)}function hM(l,t,e="/"){return WL(l,t,e,!1)}function WL(l,t,e,n){let s=typeof t=="string"?Nv(t):t,r=sc(s.pathname||"/",e);if(r==null)return null;let u=dM(l);QL(u);let h=null;for(let f=0;h==null&&f<u.length;++f){let p=lI(r);h=rI(u[f],p,n)}return h}function dM(l,t=[],e=[],n="",s=!1){let r=(u,h,f=s,p)=>{let m={relativePath:p===void 0?u.path||"":p,caseSensitive:u.caseSensitive===!0,childrenIndex:h,route:u};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(n)&&f)return;xi(m.relativePath.startsWith(n),`Absolute route path "${m.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(n.length)}let b=tc([n,m.relativePath]),_=e.concat(m);u.children&&u.children.length>0&&(xi(u.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${b}".`),dM(u.children,t,_,b,f)),!(u.path==null&&!u.index)&&t.push({path:b,score:sI(b,u.index),routesMeta:_})};return l.forEach((u,h)=>{var f;if(u.path===""||!((f=u.path)!=null&&f.includes("?")))r(u,h);else for(let p of fM(u.path))r(u,h,!0,p)}),t}function fM(l){let t=l.split("/");if(t.length===0)return[];let[e,...n]=t,s=e.endsWith("?"),r=e.replace(/\?$/,"");if(n.length===0)return s?[r,""]:[r];let u=fM(n.join("/")),h=[];return h.push(...u.map(f=>f===""?r:[r,f].join("/"))),s&&h.push(...u),h.map(f=>l.startsWith("/")&&f===""?"/":f)}function QL(l){l.sort((t,e)=>t.score!==e.score?e.score-t.score:aI(t.routesMeta.map(n=>n.childrenIndex),e.routesMeta.map(n=>n.childrenIndex)))}var JL=/^:[\w-]+$/,ZL=3,tI=2,eI=1,nI=10,iI=-2,aD=l=>l==="*";function sI(l,t){let e=l.split("/"),n=e.length;return e.some(aD)&&(n+=iI),t&&(n+=tI),e.filter(s=>!aD(s)).reduce((s,r)=>s+(JL.test(r)?ZL:r===""?eI:nI),n)}function aI(l,t){return l.length===t.length&&l.slice(0,-1).every((n,s)=>n===t[s])?l[l.length-1]-t[t.length-1]:0}function rI(l,t,e=!1){let{routesMeta:n}=l,s={},r="/",u=[];for(let h=0;h<n.length;++h){let f=n[h],p=h===n.length-1,m=r==="/"?t:t.slice(r.length)||"/",b=__({path:f.relativePath,caseSensitive:f.caseSensitive,end:p},m),_=f.route;if(!b&&p&&e&&!n[n.length-1].route.index&&(b=__({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},m)),!b)return null;Object.assign(s,b.params),u.push({params:s,pathname:tc([r,b.pathname]),pathnameBase:dI(tc([r,b.pathnameBase])),route:_}),b.pathnameBase!=="/"&&(r=tc([r,b.pathnameBase]))}return u}function __(l,t){typeof l=="string"&&(l={path:l,caseSensitive:!1,end:!0});let[e,n]=oI(l.path,l.caseSensitive,l.end),s=t.match(e);if(!s)return null;let r=s[0],u=r.replace(/(.)\/+$/,"$1"),h=s.slice(1);return{params:n.reduce((p,{paramName:m,isOptional:b},_)=>{if(m==="*"){let R=h[_]||"";u=r.slice(0,r.length-R.length).replace(/(.)\/+$/,"$1")}const S=h[_];return b&&!S?p[m]=void 0:p[m]=(S||"").replace(/%2F/g,"/"),p},{}),pathname:r,pathnameBase:u,pattern:l}}function oI(l,t=!1,e=!0){zr(l==="*"||!l.endsWith("*")||l.endsWith("/*"),`Route path "${l}" will be treated as if it were "${l.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${l.replace(/\*$/,"/*")}".`);let n=[],s="^"+l.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,h,f)=>(n.push({paramName:h,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return l.endsWith("*")?(n.push({paramName:"*"}),s+=l==="*"||l==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):e?s+="\\/*$":l!==""&&l!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),n]}function lI(l){try{return l.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return zr(!1,`The URL path "${l}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),l}}function sc(l,t){if(t==="/")return l;if(!l.toLowerCase().startsWith(t.toLowerCase()))return null;let e=t.endsWith("/")?t.length-1:t.length,n=l.charAt(e);return n&&n!=="/"?null:l.slice(e)||"/"}var pM=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,cI=l=>pM.test(l);function uI(l,t="/"){let{pathname:e,search:n="",hash:s=""}=typeof l=="string"?Nv(l):l,r;if(e)if(cI(e))r=e;else{if(e.includes("//")){let u=e;e=e.replace(/\/\/+/g,"/"),zr(!1,`Pathnames cannot have embedded double slashes - normalizing ${u} -> ${e}`)}e.startsWith("/")?r=rD(e.substring(1),"/"):r=rD(e,t)}else r=t;return{pathname:r,search:fI(n),hash:pI(s)}}function rD(l,t){let e=t.replace(/\/+$/,"").split("/");return l.split("/").forEach(s=>{s===".."?e.length>1&&e.pop():s!=="."&&e.push(s)}),e.length>1?e.join("/"):"/"}function TE(l,t,e,n){return`Cannot include a '${l}' character in a manually specified \`to.${t}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${e}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function hI(l){return l.filter((t,e)=>e===0||t.route.path&&t.route.path.length>0)}function mM(l){let t=hI(l);return t.map((e,n)=>n===t.length-1?e.pathname:e.pathnameBase)}function gM(l,t,e,n=!1){let s;typeof l=="string"?s=Nv(l):(s={...l},xi(!s.pathname||!s.pathname.includes("?"),TE("?","pathname","search",s)),xi(!s.pathname||!s.pathname.includes("#"),TE("#","pathname","hash",s)),xi(!s.search||!s.search.includes("#"),TE("#","search","hash",s)));let r=l===""||s.pathname==="",u=r?"/":s.pathname,h;if(u==null)h=e;else{let b=t.length-1;if(!n&&u.startsWith("..")){let _=u.split("/");for(;_[0]==="..";)_.shift(),b-=1;s.pathname=_.join("/")}h=b>=0?t[b]:"/"}let f=uI(s,h),p=u&&u!=="/"&&u.endsWith("/"),m=(r||u===".")&&e.endsWith("/");return!f.pathname.endsWith("/")&&(p||m)&&(f.pathname+="/"),f}var tc=l=>l.join("/").replace(/\/\/+/g,"/"),dI=l=>l.replace(/\/+$/,"").replace(/^\/*/,"/"),fI=l=>!l||l==="?"?"":l.startsWith("?")?l:"?"+l,pI=l=>!l||l==="#"?"":l.startsWith("#")?l:"#"+l,mI=class{constructor(l,t,e,n=!1){this.status=l,this.statusText=t||"",this.internal=n,e instanceof Error?(this.data=e.toString(),this.error=e):this.data=e}};function gI(l){return l!=null&&typeof l.status=="number"&&typeof l.statusText=="string"&&typeof l.internal=="boolean"&&"data"in l}function yI(l){return l.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var yM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function bM(l,t){let e=l;if(typeof e!="string"||!pM.test(e))return{absoluteURL:void 0,isExternal:!1,to:e};let n=e,s=!1;if(yM)try{let r=new URL(window.location.href),u=e.startsWith("//")?new URL(r.protocol+e):new URL(e),h=sc(u.pathname,t);u.origin===r.origin&&h!=null?e=h+u.search+u.hash:s=!0}catch{zr(!1,`<Link to="${e}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:n,isExternal:s,to:e}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var vM=["POST","PUT","PATCH","DELETE"];new Set(vM);var bI=["GET",...vM];new Set(bI);var Gm=Q.createContext(null);Gm.displayName="DataRouter";var aA=Q.createContext(null);aA.displayName="DataRouterState";var vI=Q.createContext(!1),wM=Q.createContext({isTransitioning:!1});wM.displayName="ViewTransition";var wI=Q.createContext(new Map);wI.displayName="Fetchers";var _I=Q.createContext(null);_I.displayName="Await";var fr=Q.createContext(null);fr.displayName="Navigation";var rA=Q.createContext(null);rA.displayName="Location";var oc=Q.createContext({outlet:null,matches:[],isDataRoute:!1});oc.displayName="Route";var HC=Q.createContext(null);HC.displayName="RouteError";var _M="REACT_ROUTER_ERROR",AI="REDIRECT",SI="ROUTE_ERROR_RESPONSE";function EI(l){if(l.startsWith(`${_M}:${AI}:{`))try{let t=JSON.parse(l.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function CI(l){if(l.startsWith(`${_M}:${SI}:{`))try{let t=JSON.parse(l.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new mI(t.status,t.statusText,t.data)}catch{}}function xI(l,{relative:t}={}){xi(kv(),"useHref() may be used only in the context of a <Router> component.");let{basename:e,navigator:n}=Q.useContext(fr),{hash:s,pathname:r,search:u}=Pv(l,{relative:t}),h=r;return e!=="/"&&(h=r==="/"?e:tc([e,r])),n.createHref({pathname:h,search:u,hash:s})}function kv(){return Q.useContext(rA)!=null}function Wd(){return xi(kv(),"useLocation() may be used only in the context of a <Router> component."),Q.useContext(rA).location}var AM="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function SM(l){Q.useContext(fr).static||Q.useLayoutEffect(l)}function TI(){let{isDataRoute:l}=Q.useContext(oc);return l?zI():RI()}function RI(){xi(kv(),"useNavigate() may be used only in the context of a <Router> component.");let l=Q.useContext(Gm),{basename:t,navigator:e}=Q.useContext(fr),{matches:n}=Q.useContext(oc),{pathname:s}=Wd(),r=JSON.stringify(mM(n)),u=Q.useRef(!1);return SM(()=>{u.current=!0}),Q.useCallback((f,p={})=>{if(zr(u.current,AM),!u.current)return;if(typeof f=="number"){e.go(f);return}let m=gM(f,JSON.parse(r),s,p.relative==="path");l==null&&t!=="/"&&(m.pathname=m.pathname==="/"?t:tc([t,m.pathname])),(p.replace?e.replace:e.push)(m,p.state,p)},[t,e,r,s,l])}Q.createContext(null);function Pv(l,{relative:t}={}){let{matches:e}=Q.useContext(oc),{pathname:n}=Wd(),s=JSON.stringify(mM(e));return Q.useMemo(()=>gM(l,JSON.parse(s),n,t==="path"),[l,s,n,t])}function OI(l,t,e,n,s){xi(kv(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=Q.useContext(fr),{matches:u}=Q.useContext(oc),h=u[u.length-1],f=h?h.params:{},p=h?h.pathname:"/",m=h?h.pathnameBase:"/",b=h&&h.route;{let I=b&&b.path||"";CM(p,!b||I.endsWith("*")||I.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${p}" (under <Route path="${I}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${I}"> to <Route path="${I==="/"?"*":`${I}/*`}">.`)}let _=Wd(),S;S=_;let R=S.pathname||"/",C=R;if(m!=="/"){let I=m.replace(/^\//,"").split("/");C="/"+R.replace(/^\//,"").split("/").slice(I.length).join("/")}let M=hM(l,{pathname:C});return zr(b||M!=null,`No routes matched location "${S.pathname}${S.search}${S.hash}" `),zr(M==null||M[M.length-1].route.element!==void 0||M[M.length-1].route.Component!==void 0||M[M.length-1].route.lazy!==void 0,`Matched leaf route at location "${S.pathname}${S.search}${S.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),PI(M&&M.map(I=>Object.assign({},I,{params:Object.assign({},f,I.params),pathname:tc([m,r.encodeLocation?r.encodeLocation(I.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:I.pathname]),pathnameBase:I.pathnameBase==="/"?m:tc([m,r.encodeLocation?r.encodeLocation(I.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:I.pathnameBase])})),u,e,n,s)}function DI(){let l=UI(),t=gI(l)?`${l.status} ${l.statusText}`:l instanceof Error?l.message:JSON.stringify(l),e=l instanceof Error?l.stack:null,n="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:n},r={padding:"2px 4px",backgroundColor:n},u=null;return console.error("Error handled by React Router default ErrorBoundary:",l),u=Q.createElement(Q.Fragment,null,Q.createElement("p",null," Hey developer "),Q.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Q.createElement("code",{style:r},"ErrorBoundary")," or"," ",Q.createElement("code",{style:r},"errorElement")," prop on your route.")),Q.createElement(Q.Fragment,null,Q.createElement("h2",null,"Unexpected Application Error!"),Q.createElement("h3",{style:{fontStyle:"italic"}},t),e?Q.createElement("pre",{style:s},e):null,u)}var MI=Q.createElement(DI,null),EM=class extends Q.Component{constructor(l){super(l),this.state={location:l.location,revalidation:l.revalidation,error:l.error}}static getDerivedStateFromError(l){return{error:l}}static getDerivedStateFromProps(l,t){return t.location!==l.location||t.revalidation!=="idle"&&l.revalidation==="idle"?{error:l.error,location:l.location,revalidation:l.revalidation}:{error:l.error!==void 0?l.error:t.error,location:t.location,revalidation:l.revalidation||t.revalidation}}componentDidCatch(l,t){this.props.onError?this.props.onError(l,t):console.error("React Router caught the following error during render",l)}render(){let l=this.state.error;if(this.context&&typeof l=="object"&&l&&"digest"in l&&typeof l.digest=="string"){const e=CI(l.digest);e&&(l=e)}let t=l!==void 0?Q.createElement(oc.Provider,{value:this.props.routeContext},Q.createElement(HC.Provider,{value:l,children:this.props.component})):this.props.children;return this.context?Q.createElement(NI,{error:l},t):t}};EM.contextType=vI;var RE=new WeakMap;function NI({children:l,error:t}){let{basename:e}=Q.useContext(fr);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let n=EI(t.digest);if(n){let s=RE.get(t);if(s)throw s;let r=bM(n.location,e);if(yM&&!RE.get(t))if(r.isExternal||n.reloadDocument)window.location.href=r.absoluteURL||r.to;else{const u=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(r.to,{replace:n.replace}));throw RE.set(t,u),u}return Q.createElement("meta",{httpEquiv:"refresh",content:`0;url=${r.absoluteURL||r.to}`})}}return l}function kI({routeContext:l,match:t,children:e}){let n=Q.useContext(Gm);return n&&n.static&&n.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=t.route.id),Q.createElement(oc.Provider,{value:l},e)}function PI(l,t=[],e=null,n=null,s=null){if(l==null){if(!e)return null;if(e.errors)l=e.matches;else if(t.length===0&&!e.initialized&&e.matches.length>0)l=e.matches;else return null}let r=l,u=e==null?void 0:e.errors;if(u!=null){let m=r.findIndex(b=>b.route.id&&(u==null?void 0:u[b.route.id])!==void 0);xi(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),r=r.slice(0,Math.min(r.length,m+1))}let h=!1,f=-1;if(e)for(let m=0;m<r.length;m++){let b=r[m];if((b.route.HydrateFallback||b.route.hydrateFallbackElement)&&(f=m),b.route.id){let{loaderData:_,errors:S}=e,R=b.route.loader&&!_.hasOwnProperty(b.route.id)&&(!S||S[b.route.id]===void 0);if(b.route.lazy||R){h=!0,f>=0?r=r.slice(0,f+1):r=[r[0]];break}}}let p=e&&n?(m,b)=>{var _,S;n(m,{location:e.location,params:((S=(_=e.matches)==null?void 0:_[0])==null?void 0:S.params)??{},unstable_pattern:yI(e.matches),errorInfo:b})}:void 0;return r.reduceRight((m,b,_)=>{let S,R=!1,C=null,M=null;e&&(S=u&&b.route.id?u[b.route.id]:void 0,C=b.route.errorElement||MI,h&&(f<0&&_===0?(CM("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),R=!0,M=null):f===_&&(R=!0,M=b.route.hydrateFallbackElement||null)));let k=t.concat(r.slice(0,_+1)),I=()=>{let P;return S?P=C:R?P=M:b.route.Component?P=Q.createElement(b.route.Component,null):b.route.element?P=b.route.element:P=m,Q.createElement(kI,{match:b,routeContext:{outlet:m,matches:k,isDataRoute:e!=null},children:P})};return e&&(b.route.ErrorBoundary||b.route.errorElement||_===0)?Q.createElement(EM,{location:e.location,revalidation:e.revalidation,component:C,error:S,children:I(),routeContext:{outlet:null,matches:k,isDataRoute:!0},onError:p}):I()},null)}function $C(l){return`${l} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function LI(l){let t=Q.useContext(Gm);return xi(t,$C(l)),t}function II(l){let t=Q.useContext(aA);return xi(t,$C(l)),t}function BI(l){let t=Q.useContext(oc);return xi(t,$C(l)),t}function VC(l){let t=BI(l),e=t.matches[t.matches.length-1];return xi(e.route.id,`${l} can only be used on routes that contain a unique "id"`),e.route.id}function FI(){return VC("useRouteId")}function UI(){var n;let l=Q.useContext(HC),t=II("useRouteError"),e=VC("useRouteError");return l!==void 0?l:(n=t.errors)==null?void 0:n[e]}function zI(){let{router:l}=LI("useNavigate"),t=VC("useNavigate"),e=Q.useRef(!1);return SM(()=>{e.current=!0}),Q.useCallback(async(s,r={})=>{zr(e.current,AM),e.current&&(typeof s=="number"?await l.navigate(s):await l.navigate(s,{fromRouteId:t,...r}))},[l,t])}var oD={};function CM(l,t,e){!t&&!oD[l]&&(oD[l]=!0,zr(!1,e))}Q.memo(jI);function jI({routes:l,future:t,state:e,onError:n}){return OI(l,void 0,e,n,t)}function HI({basename:l="/",children:t=null,location:e,navigationType:n="POP",navigator:s,static:r=!1,unstable_useTransitions:u}){xi(!kv(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let h=l.replace(/^\/*/,"/"),f=Q.useMemo(()=>({basename:h,navigator:s,static:r,unstable_useTransitions:u,future:{}}),[h,s,r,u]);typeof e=="string"&&(e=Nv(e));let{pathname:p="/",search:m="",hash:b="",state:_=null,key:S="default"}=e,R=Q.useMemo(()=>{let C=sc(p,h);return C==null?null:{location:{pathname:C,search:m,hash:b,state:_,key:S},navigationType:n}},[h,p,m,b,_,S,n]);return zr(R!=null,`<Router basename="${h}"> is not able to match the URL "${p}${m}${b}" because it does not start with the basename, so the <Router> won't render anything.`),R==null?null:Q.createElement(fr.Provider,{value:f},Q.createElement(rA.Provider,{children:t,value:R}))}var Mw="get",Nw="application/x-www-form-urlencoded";function oA(l){return typeof HTMLElement<"u"&&l instanceof HTMLElement}function $I(l){return oA(l)&&l.tagName.toLowerCase()==="button"}function VI(l){return oA(l)&&l.tagName.toLowerCase()==="form"}function GI(l){return oA(l)&&l.tagName.toLowerCase()==="input"}function qI(l){return!!(l.metaKey||l.altKey||l.ctrlKey||l.shiftKey)}function XI(l,t){return l.button===0&&(!t||t==="_self")&&!qI(l)}var lw=null;function YI(){if(lw===null)try{new FormData(document.createElement("form"),0),lw=!1}catch{lw=!0}return lw}var KI=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function OE(l){return l!=null&&!KI.has(l)?(zr(!1,`"${l}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Nw}"`),null):l}function WI(l,t){let e,n,s,r,u;if(VI(l)){let h=l.getAttribute("action");n=h?sc(h,t):null,e=l.getAttribute("method")||Mw,s=OE(l.getAttribute("enctype"))||Nw,r=new FormData(l)}else if($I(l)||GI(l)&&(l.type==="submit"||l.type==="image")){let h=l.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=l.getAttribute("formaction")||h.getAttribute("action");if(n=f?sc(f,t):null,e=l.getAttribute("formmethod")||h.getAttribute("method")||Mw,s=OE(l.getAttribute("formenctype"))||OE(h.getAttribute("enctype"))||Nw,r=new FormData(h,l),!YI()){let{name:p,type:m,value:b}=l;if(m==="image"){let _=p?`${p}.`:"";r.append(`${_}x`,"0"),r.append(`${_}y`,"0")}else p&&r.append(p,b)}}else{if(oA(l))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');e=Mw,n=null,s=Nw,u=l}return r&&s==="text/plain"&&(u=r,r=void 0),{action:n,method:e.toLowerCase(),encType:s,formData:r,body:u}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function GC(l,t){if(l===!1||l===null||typeof l>"u")throw new Error(t)}function QI(l,t,e,n){let s=typeof l=="string"?new URL(l,typeof window>"u"?"server://singlefetch/":window.location.origin):l;return e?s.pathname.endsWith("/")?s.pathname=`${s.pathname}_.${n}`:s.pathname=`${s.pathname}.${n}`:s.pathname==="/"?s.pathname=`_root.${n}`:t&&sc(s.pathname,t)==="/"?s.pathname=`${t.replace(/\/$/,"")}/_root.${n}`:s.pathname=`${s.pathname.replace(/\/$/,"")}.${n}`,s}async function JI(l,t){if(l.id in t)return t[l.id];try{let e=await import(l.module);return t[l.id]=e,e}catch(e){return console.error(`Error loading route module \`${l.module}\`, reloading page...`),console.error(e),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ZI(l){return l==null?!1:l.href==null?l.rel==="preload"&&typeof l.imageSrcSet=="string"&&typeof l.imageSizes=="string":typeof l.rel=="string"&&typeof l.href=="string"}async function tB(l,t,e){let n=await Promise.all(l.map(async s=>{let r=t.routes[s.route.id];if(r){let u=await JI(r,e);return u.links?u.links():[]}return[]}));return sB(n.flat(1).filter(ZI).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function lD(l,t,e,n,s,r){let u=(f,p)=>e[p]?f.route.id!==e[p].route.id:!0,h=(f,p)=>{var m;return e[p].pathname!==f.pathname||((m=e[p].route.path)==null?void 0:m.endsWith("*"))&&e[p].params["*"]!==f.params["*"]};return r==="assets"?t.filter((f,p)=>u(f,p)||h(f,p)):r==="data"?t.filter((f,p)=>{var b;let m=n.routes[f.route.id];if(!m||!m.hasLoader)return!1;if(u(f,p)||h(f,p))return!0;if(f.route.shouldRevalidate){let _=f.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((b=e[0])==null?void 0:b.params)||{},nextUrl:new URL(l,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof _=="boolean")return _}return!0}):[]}function eB(l,t,{includeHydrateFallback:e}={}){return nB(l.map(n=>{let s=t.routes[n.route.id];if(!s)return[];let r=[s.module];return s.clientActionModule&&(r=r.concat(s.clientActionModule)),s.clientLoaderModule&&(r=r.concat(s.clientLoaderModule)),e&&s.hydrateFallbackModule&&(r=r.concat(s.hydrateFallbackModule)),s.imports&&(r=r.concat(s.imports)),r}).flat(1))}function nB(l){return[...new Set(l)]}function iB(l){let t={},e=Object.keys(l).sort();for(let n of e)t[n]=l[n];return t}function sB(l,t){let e=new Set;return new Set(t),l.reduce((n,s)=>{let r=JSON.stringify(iB(s));return e.has(r)||(e.add(r),n.push({key:r,link:s})),n},[])}function xM(){let l=Q.useContext(Gm);return GC(l,"You must render this element inside a <DataRouterContext.Provider> element"),l}function aB(){let l=Q.useContext(aA);return GC(l,"You must render this element inside a <DataRouterStateContext.Provider> element"),l}var qC=Q.createContext(void 0);qC.displayName="FrameworkContext";function TM(){let l=Q.useContext(qC);return GC(l,"You must render this element inside a <HydratedRouter> element"),l}function rB(l,t){let e=Q.useContext(qC),[n,s]=Q.useState(!1),[r,u]=Q.useState(!1),{onFocus:h,onBlur:f,onMouseEnter:p,onMouseLeave:m,onTouchStart:b}=t,_=Q.useRef(null);Q.useEffect(()=>{if(l==="render"&&u(!0),l==="viewport"){let C=k=>{k.forEach(I=>{u(I.isIntersecting)})},M=new IntersectionObserver(C,{threshold:.5});return _.current&&M.observe(_.current),()=>{M.disconnect()}}},[l]),Q.useEffect(()=>{if(n){let C=setTimeout(()=>{u(!0)},100);return()=>{clearTimeout(C)}}},[n]);let S=()=>{s(!0)},R=()=>{s(!1),u(!1)};return e?l!=="intent"?[r,_,{}]:[r,_,{onFocus:Jg(h,S),onBlur:Jg(f,R),onMouseEnter:Jg(p,S),onMouseLeave:Jg(m,R),onTouchStart:Jg(b,S)}]:[!1,_,{}]}function Jg(l,t){return e=>{l&&l(e),e.defaultPrevented||t(e)}}function oB({page:l,...t}){let{router:e}=xM(),n=Q.useMemo(()=>hM(e.routes,l,e.basename),[e.routes,l,e.basename]);return n?Q.createElement(cB,{page:l,matches:n,...t}):null}function lB(l){let{manifest:t,routeModules:e}=TM(),[n,s]=Q.useState([]);return Q.useEffect(()=>{let r=!1;return tB(l,t,e).then(u=>{r||s(u)}),()=>{r=!0}},[l,t,e]),n}function cB({page:l,matches:t,...e}){let n=Wd(),{future:s,manifest:r,routeModules:u}=TM(),{basename:h}=xM(),{loaderData:f,matches:p}=aB(),m=Q.useMemo(()=>lD(l,t,p,r,n,"data"),[l,t,p,r,n]),b=Q.useMemo(()=>lD(l,t,p,r,n,"assets"),[l,t,p,r,n]),_=Q.useMemo(()=>{if(l===n.pathname+n.search+n.hash)return[];let C=new Set,M=!1;if(t.forEach(I=>{var F;let P=r.routes[I.route.id];!P||!P.hasLoader||(!m.some(z=>z.route.id===I.route.id)&&I.route.id in f&&((F=u[I.route.id])!=null&&F.shouldRevalidate)||P.hasClientLoader?M=!0:C.add(I.route.id))}),C.size===0)return[];let k=QI(l,h,s.unstable_trailingSlashAwareDataRequests,"data");return M&&C.size>0&&k.searchParams.set("_routes",t.filter(I=>C.has(I.route.id)).map(I=>I.route.id).join(",")),[k.pathname+k.search]},[h,s.unstable_trailingSlashAwareDataRequests,f,n,r,m,t,l,u]),S=Q.useMemo(()=>eB(b,r),[b,r]),R=lB(b);return Q.createElement(Q.Fragment,null,_.map(C=>Q.createElement("link",{key:C,rel:"prefetch",as:"fetch",href:C,...e})),S.map(C=>Q.createElement("link",{key:C,rel:"modulepreload",href:C,...e})),R.map(({key:C,link:M})=>Q.createElement("link",{key:C,nonce:e.nonce,...M})))}function uB(...l){return t=>{l.forEach(e=>{typeof e=="function"?e(t):e!=null&&(e.current=t)})}}var hB=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{hB&&(window.__reactRouterVersion="7.12.0")}catch{}function dB({basename:l,children:t,unstable_useTransitions:e,window:n}){let s=Q.useRef();s.current==null&&(s.current=qL({window:n,v5Compat:!0}));let r=s.current,[u,h]=Q.useState({action:r.action,location:r.location}),f=Q.useCallback(p=>{e===!1?h(p):Q.startTransition(()=>h(p))},[e]);return Q.useLayoutEffect(()=>r.listen(f),[r,f]),Q.createElement(HI,{basename:l,children:t,location:u.location,navigationType:u.action,navigator:r,unstable_useTransitions:e})}var RM=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,OM=Q.forwardRef(function({onClick:t,discover:e="render",prefetch:n="none",relative:s,reloadDocument:r,replace:u,state:h,target:f,to:p,preventScrollReset:m,viewTransition:b,unstable_defaultShouldRevalidate:_,...S},R){let{basename:C,unstable_useTransitions:M}=Q.useContext(fr),k=typeof p=="string"&&RM.test(p),I=bM(p,C);p=I.to;let P=xI(p,{relative:s}),[F,z,j]=rB(n,S),H=gB(p,{replace:u,state:h,target:f,preventScrollReset:m,relative:s,viewTransition:b,unstable_defaultShouldRevalidate:_,unstable_useTransitions:M});function dt(yt){t&&t(yt),yt.defaultPrevented||H(yt)}let ct=Q.createElement("a",{...S,...j,href:I.absoluteURL||P,onClick:I.isExternal||r?t:dt,ref:uB(R,z),target:f,"data-discover":!k&&e==="render"?"true":void 0});return F&&!k?Q.createElement(Q.Fragment,null,ct,Q.createElement(oB,{page:P})):ct});OM.displayName="Link";var fB=Q.forwardRef(function({"aria-current":t="page",caseSensitive:e=!1,className:n="",end:s=!1,style:r,to:u,viewTransition:h,children:f,...p},m){let b=Pv(u,{relative:p.relative}),_=Wd(),S=Q.useContext(aA),{navigator:R,basename:C}=Q.useContext(fr),M=S!=null&&_B(b)&&h===!0,k=R.encodeLocation?R.encodeLocation(b).pathname:b.pathname,I=_.pathname,P=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;e||(I=I.toLowerCase(),P=P?P.toLowerCase():null,k=k.toLowerCase()),P&&C&&(P=sc(P,C)||P);const F=k!=="/"&&k.endsWith("/")?k.length-1:k.length;let z=I===k||!s&&I.startsWith(k)&&I.charAt(F)==="/",j=P!=null&&(P===k||!s&&P.startsWith(k)&&P.charAt(k.length)==="/"),H={isActive:z,isPending:j,isTransitioning:M},dt=z?t:void 0,ct;typeof n=="function"?ct=n(H):ct=[n,z?"active":null,j?"pending":null,M?"transitioning":null].filter(Boolean).join(" ");let yt=typeof r=="function"?r(H):r;return Q.createElement(OM,{...p,"aria-current":dt,className:ct,ref:m,style:yt,to:u,viewTransition:h},typeof f=="function"?f(H):f)});fB.displayName="NavLink";var pB=Q.forwardRef(({discover:l="render",fetcherKey:t,navigate:e,reloadDocument:n,replace:s,state:r,method:u=Mw,action:h,onSubmit:f,relative:p,preventScrollReset:m,viewTransition:b,unstable_defaultShouldRevalidate:_,...S},R)=>{let{unstable_useTransitions:C}=Q.useContext(fr),M=vB(),k=wB(h,{relative:p}),I=u.toLowerCase()==="get"?"get":"post",P=typeof h=="string"&&RM.test(h),F=z=>{if(f&&f(z),z.defaultPrevented)return;z.preventDefault();let j=z.nativeEvent.submitter,H=(j==null?void 0:j.getAttribute("formmethod"))||u,dt=()=>M(j||z.currentTarget,{fetcherKey:t,method:H,navigate:e,replace:s,state:r,relative:p,preventScrollReset:m,viewTransition:b,unstable_defaultShouldRevalidate:_});C&&e!==!1?Q.startTransition(()=>dt()):dt()};return Q.createElement("form",{ref:R,method:I,action:k,onSubmit:n?f:F,...S,"data-discover":!P&&l==="render"?"true":void 0})});pB.displayName="Form";function mB(l){return`${l} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function DM(l){let t=Q.useContext(Gm);return xi(t,mB(l)),t}function gB(l,{target:t,replace:e,state:n,preventScrollReset:s,relative:r,viewTransition:u,unstable_defaultShouldRevalidate:h,unstable_useTransitions:f}={}){let p=TI(),m=Wd(),b=Pv(l,{relative:r});return Q.useCallback(_=>{if(XI(_,t)){_.preventDefault();let S=e!==void 0?e:Py(m)===Py(b),R=()=>p(l,{replace:S,state:n,preventScrollReset:s,relative:r,viewTransition:u,unstable_defaultShouldRevalidate:h});f?Q.startTransition(()=>R()):R()}},[m,p,b,e,n,t,l,s,r,u,h,f])}var yB=0,bB=()=>`__${String(++yB)}__`;function vB(){let{router:l}=DM("useSubmit"),{basename:t}=Q.useContext(fr),e=FI(),n=l.fetch,s=l.navigate;return Q.useCallback(async(r,u={})=>{let{action:h,method:f,encType:p,formData:m,body:b}=WI(r,t);if(u.navigate===!1){let _=u.fetcherKey||bB();await n(_,e,u.action||h,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:m,body:b,formMethod:u.method||f,formEncType:u.encType||p,flushSync:u.flushSync})}else await s(u.action||h,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:m,body:b,formMethod:u.method||f,formEncType:u.encType||p,replace:u.replace,state:u.state,fromRouteId:e,flushSync:u.flushSync,viewTransition:u.viewTransition})},[n,s,t,e])}function wB(l,{relative:t}={}){let{basename:e}=Q.useContext(fr),n=Q.useContext(oc);xi(n,"useFormAction must be used inside a RouteContext");let[s]=n.matches.slice(-1),r={...Pv(l||".",{relative:t})},u=Wd();if(l==null){r.search=u.search;let h=new URLSearchParams(r.search),f=h.getAll("index");if(f.some(m=>m==="")){h.delete("index"),f.filter(b=>b).forEach(b=>h.append("index",b));let m=h.toString();r.search=m?`?${m}`:""}}return(!l||l===".")&&s.route.index&&(r.search=r.search?r.search.replace(/^\?/,"?index&"):"?index"),e!=="/"&&(r.pathname=r.pathname==="/"?e:tc([e,r.pathname])),Py(r)}function _B(l,{relative:t}={}){let e=Q.useContext(wM);xi(e!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=DM("useViewTransitionState"),s=Pv(l,{relative:t});if(!e.isTransitioning)return!1;let r=sc(e.currentLocation.pathname,n)||e.currentLocation.pathname,u=sc(e.nextLocation.pathname,n)||e.nextLocation.pathname;return __(s.pathname,u)!=null||__(s.pathname,r)!=null}const AB="modulepreload",SB=function(l){return"/"+l},cD={},Dn=function(t,e,n){let s=Promise.resolve();if(e&&e.length>0){let u=function(p){return Promise.all(p.map(m=>Promise.resolve(m).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),f=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));s=u(e.map(p=>{if(p=SB(p),p in cD)return;cD[p]=!0;const m=p.endsWith(".css"),b=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const _=document.createElement("link");if(_.rel=m?"stylesheet":AB,m||(_.as="script"),_.crossOrigin="",_.href=p,f&&_.setAttribute("nonce",f),document.head.appendChild(_),m)return new Promise((S,R)=>{_.addEventListener("load",S),_.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${p}`)))})}))}function r(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return s.then(u=>{for(const h of u||[])h.status==="rejected"&&r(h.reason);return t().catch(r)})};var ze=(l=>(l.PROCESSING="PROCESSING",l.COMPLETED="COMPLETED",l.ERROR="ERROR",l.ARCHIVED="ARCHIVED",l.PENDING_REVIEW="PENDING_REVIEW",l.APROVADO="APROVADO",l.REJEITADO="REJEITADO",l.APROVADO_USUARIO="APROVADO_USUARIO",l))(ze||{}),pp=(l=>(l.RECEIPT="RECEIPT",l.INVOICE="INVOICE",l.CONTRACT="CONTRACT",l.TAX_FORM="TAX_FORM",l.UNKNOWN="UNKNOWN",l))(pp||{});/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EB=l=>l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),CB=l=>l.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,e,n)=>n?n.toUpperCase():e.toLowerCase()),uD=l=>{const t=CB(l);return t.charAt(0).toUpperCase()+t.slice(1)},MM=(...l)=>l.filter((t,e,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===e).join(" ").trim(),xB=l=>{for(const t in l)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var TB={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RB=Q.forwardRef(({color:l="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:n,className:s="",children:r,iconNode:u,...h},f)=>Q.createElement("svg",{ref:f,...TB,width:t,height:t,stroke:l,strokeWidth:n?Number(e)*24/Number(t):e,className:MM("lucide",s),...!r&&!xB(h)&&{"aria-hidden":"true"},...h},[...u.map(([p,m])=>Q.createElement(p,m)),...Array.isArray(r)?r:[r]]));/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=(l,t)=>{const e=Q.forwardRef(({className:n,...s},r)=>Q.createElement(RB,{ref:r,iconNode:t,className:MM(`lucide-${EB(uD(l))}`,`lucide-${l}`,n),...s}));return e.displayName=uD(l),e};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OB=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],DB=Ps("activity",OB);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MB=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],NB=Ps("bell",MB);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kB=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]],cw=Ps("brain-circuit",kB);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PB=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],Zg=Ps("building-2",PB);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LB=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],IB=Ps("chevron-down",LB);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BB=[["path",{d:"M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3",key:"11bfej"}]],FB=Ps("command",BB);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UB=[["path",{d:"M20 4v7a4 4 0 0 1-4 4H4",key:"6o5b7l"}],["path",{d:"m9 10-5 5 5 5",key:"1kshq7"}]],zB=Ps("corner-down-left",UB);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jB=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],HB=Ps("file-text",jB);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $B=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],VB=Ps("loader-circle",$B);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GB=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],qB=Ps("log-out",GB);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XB=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],YB=Ps("menu",XB);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KB=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],WB=Ps("plus",KB);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QB=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],JB=Ps("search",QB);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZB=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],tF=Ps("settings",ZB);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eF=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],hD=Ps("zap",eF),de="/api";console.log("KwikDocs API initialized at:",de);const aj=Object.freeze(Object.defineProperty({__proto__:null,API_BASE_URL:de},Symbol.toStringTag,{value:"Module"})),Wf={login:async(l,t)=>{var e;try{const n=await fetch(`${de}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l,password:t})});if(!n.ok){const r=await n.json();throw new Error(r.error||"Falha no login")}const s=await n.json();return localStorage.setItem("auth_token",s.token),(e=s.user)!=null&&e.id&&localStorage.setItem("user_id",s.user.id),s.user}catch(n){throw console.error("Login error:",n),new Error(n.message||"Erro ao conectar com o servidor")}},register:async(l,t,e,n="ACCOUNTANT",s)=>{try{const r=await fetch(`${de}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l,email:t,password:e,role:n,ownerId:s})});if(!r.ok){const u=await r.json();throw new Error(u.error||"Falha no registo")}return Wf.login(t,e)}catch(r){throw console.error("Register error:",r),new Error(r.message||"Erro ao registar usurio")}},logout:async()=>{localStorage.removeItem("auth_token"),localStorage.removeItem("user_id")},getCurrentUser:async()=>{const l=localStorage.getItem("auth_token");if(localStorage.getItem("user_id")&&l)try{const e=await fetch(`${de}/auth/me`,{headers:{Authorization:`Bearer ${l}`}});if(e.ok)return(await e.json()).user}catch(e){console.warn("Failed to fetch fresh user data",e)}return null},isAuthenticated:()=>!!localStorage.getItem("auth_token"),getSystemLogs:async()=>{const l=localStorage.getItem("auth_token");if(!l)return[];try{const t=await fetch(`${de}/system/logs`,{headers:{Authorization:`Bearer ${l}`}});return t.ok?await t.json():[]}catch(t){return console.error("Failed to fetch system logs",t),[]}},createTeamMember:async l=>{const t=localStorage.getItem("auth_token"),e=await fetch(`${de}/team/member`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(l)});if(!e.ok){const s=await e.json();throw new Error(s.error||"Erro ao criar membro")}return(await e.json()).member},changePassword:async l=>{const t=localStorage.getItem("auth_token"),e=await fetch(`${de}/auth/change-password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({password:l})});if(!e.ok){const n=await e.json();throw new Error(n.error||"Erro ao alterar senha")}},updateUserPrompts:async l=>{const t=localStorage.getItem("auth_token"),e=await fetch(`${de}/users/prompts`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({prompts:l})});if(!e.ok){const n=await e.json();throw new Error(n.error||"Erro ao atualizar prompts")}},addCredits:async(l,t)=>{const e=localStorage.getItem("auth_token"),n=await fetch(`${de}/users/${l}/credits`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({amount:t})});if(!n.ok){const s=await n.json();throw new Error(s.error||"Erro ao adicionar crditos")}},getTeam:async(l,t)=>{const e=localStorage.getItem("auth_token"),n=t&&t!=="ALL"?`${de}/team?companyId=${t}`:`${de}/team`,s=await fetch(n,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Falha ao buscar equipe");return(await s.json()).map(u=>({...u,companyId:u.company_id||u.companyId}))},getTeamStats:async l=>{const t=localStorage.getItem("auth_token"),e=l&&l!=="ALL"?`${de}/team/stats?companyId=${l}`:`${de}/team/stats`,n=await fetch(e,{headers:{Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("Falha ao carregar estatsticas");return await n.json()},setUserStatus:async(l,t)=>{const e=localStorage.getItem("auth_token");if(!(await fetch(`${de}/team/status/${l}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({isActive:t})})).ok)throw new Error("Erro ao atualizar status")},deleteTeamMember:async l=>{const t=localStorage.getItem("auth_token"),e=await fetch(`${de}/team/member/${l}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!e.ok){const n=await e.json();throw new Error(n.error||"Erro ao remover membro")}},getFaturixStats:async(l,t,e)=>{const n=localStorage.getItem("auth_token");if(!n)throw new Error("Not authenticated");let s=`${de}/faturix/stats`;const r=new URLSearchParams;l&&r.append("companyId",l),t&&r.append("month",t.toString()),e&&r.append("year",e.toString()),r.toString()&&(s+=`?${r.toString()}`);const u=await fetch(s,{headers:{Authorization:`Bearer ${n}`}});if(!u.ok)throw new Error("Failed to fetch stats");return u.json()},getFaturixAudits:async()=>{const l=localStorage.getItem("auth_token");if(!l)throw new Error("Not authenticated");const t=await fetch(`${de}/faturix/audits`,{headers:{Authorization:`Bearer ${l}`}});if(!t.ok)throw new Error("Failed to fetch audits");return t.json()},getFiscalEntities:async l=>{const t=localStorage.getItem("auth_token");if(!t)throw new Error("Not authenticated");let e=`${de}/fiscal/entities`;l&&(e+=`?companyId=${l}`);const n=await fetch(e,{headers:{Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("Failed to fetch entities");return n.json()},getPlans:async()=>{const l=localStorage.getItem("auth_token");if(!l)throw new Error("Not authenticated");const t=await fetch(`${de}/plans`,{headers:{Authorization:`Bearer ${l}`}});if(!t.ok)throw new Error("Falha ao buscar planos de licena");return t.json()}},NM=Q.createContext(void 0),nF=({children:l})=>{const[t,e]=Q.useState(null),[n,s]=Q.useState(!0);Q.useEffect(()=>{(async()=>{const m=await Wf.getCurrentUser();m?e(m):(localStorage.removeItem("auth_token"),localStorage.removeItem("user_id"),e(null)),s(!1)})()},[]);const r=async(p,m)=>{const b=await Wf.login(p,m);e(b)},u=async(p,m,b)=>{const _=await Wf.register(p,m,b);e(_)},h=async()=>{await Wf.logout(),e(null)},f=async()=>{const p=await Wf.getCurrentUser();e(p)};return lt.jsx(NM.Provider,{value:{user:t,isAuthenticated:!!t,isLoading:n,login:r,register:u,logout:h,refreshUser:f},children:l})},kM=()=>{const l=Q.useContext(NM);if(l===void 0)throw new Error("useAuth must be used within an AuthProvider");return l},iF={async getAll(){const l=localStorage.getItem("auth_token"),t=await fetch(`${de}/admin/settings`,{headers:{Authorization:`Bearer ${l}`}});if(!t.ok)throw new Error("Falha ao carregar configuraes");return t.json()},async update(l,t){const e=localStorage.getItem("auth_token"),n=await fetch(`${de}/admin/settings`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({key:l,value:t})});if(!n.ok){const s=await n.json();throw new Error(s.error||"Falha ao atualizar configurao")}},async getPublicConfig(){const l=await fetch(`${de}/config`);return l.ok?l.json():(console.warn("Failed to fetch public config, using defaults"),{})}},sF={getAllClients:async()=>{const l=localStorage.getItem("auth_token"),t=await fetch(`${de}/companies`,{headers:{Authorization:`Bearer ${l}`}});if(!t.ok)throw new Error("Falha ao carregar empresas");return(await t.json()).map(n=>({id:n.id,name:n.name,nif:n.nif,email:n.email,status:n.status,plan:n.plan,regime:n.regime,credits:n.credits,isVerified:n.is_verified,createdAt:new Date(n.created_at),address:n.address,phone:n.phone,website:n.website,sector:n.sector,cae:n.cae}))},getClientById:async l=>{const t=localStorage.getItem("auth_token"),e=await fetch(`${de}/companies/${l}`,{headers:{Authorization:`Bearer ${t}`}});if(e.status===404)return;if(!e.ok)throw new Error("Erro ao buscar empresa");const n=await e.json();return{id:n.id,name:n.name,nif:n.nif,email:n.email,status:n.status,plan:n.plan,regime:n.regime,fiscal_status:n.fiscal_status,is_defaulter:n.is_defaulter,fiscal_residence:n.fiscal_residence,credits:n.credits,isVerified:n.is_verified,createdAt:new Date(n.created_at),address:n.address,phone:n.phone,website:n.website,sector:n.sector,cae:n.cae}},validateNif:async(l,t)=>{var u;const n=(await iF.getPublicConfig()).nif_webhook_url||"https://n8n.conversio.ao/webhook-test/validar_nif_empresa",s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nif:l,userId:t})});if(!s.ok)throw new Error("Erro na validao do NIF.");const r=await s.json();return Array.isArray(r)&&((u=r[0])!=null&&u.output)?r[0].output:r},createClient:async l=>{const t=localStorage.getItem("auth_token"),e=await fetch(`${de}/companies`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(l)});if(!e.ok){const n=await e.json();throw new Error(n.error||"Erro ao criar empresa")}return await e.json()},updateClient:async(l,t)=>{const e=localStorage.getItem("auth_token"),n=await fetch(`${de}/companies/${l}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(t)});if(!n.ok){const s=await n.json();throw new Error(s.error||"Erro ao atualizar empresa")}return await n.json()},deleteClient:async l=>{const t=localStorage.getItem("auth_token");if(!(await fetch(`${de}/companies/${l}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok)throw new Error("Erro ao deletar empresa")},updateClientStatus:async(l,t)=>{const e=localStorage.getItem("auth_token"),n=await fetch(`${de}/companies/${l}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({status:t})});if(!n.ok){const s=await n.json();throw new Error(s.error||"Erro ao atualizar status")}return await n.json()},purchaseCredits:async(l,t,e,n)=>{const s=localStorage.getItem("auth_token"),r=await fetch(`${de}/billing/topup`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({companyId:l,amount:t.price,credits:t.credits,method:e,description:`Recarga: Plano ${t.name} (${t.credits} Crditos)`,proof:n==null?void 0:n.proof,paymentDetails:n})});if(!r.ok){const u=await r.json();throw new Error(u.error||"Erro ao processar compra")}return!0},getTransactionHistory:async(l,t=1,e=10)=>{const n=localStorage.getItem("auth_token"),s=await fetch(`${de}/transactions?companyId=${l}&page=${t}&limit=${e}`,{headers:{Authorization:`Bearer ${n}`}});if(!s.ok)throw new Error("Erro ao carregar histrico");const r=await s.json();return{data:(r.data||[]).map(f=>({id:f.id,companyId:f.company_id,userId:f.user_id,userName:f.user_name,amount:parseFloat(f.amount),credits:f.credits,type:f.type,method:f.method,status:f.status,date:new Date(f.created_at),description:f.description,invoiceUrl:"#"})),pagination:r.pagination}},getClientStats:async l=>{const t=localStorage.getItem("auth_token"),e=await fetch(`${de}/companies/${l}/stats`,{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Erro ao buscar estatsticas");return await e.json()},getCompanyDocCount:async l=>{const t=localStorage.getItem("auth_token"),e=await fetch(`${de}/companies/${l}/doc-count`,{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Erro ao buscar contagem");return(await e.json()).count},getCreditPackages:async()=>{const l=localStorage.getItem("auth_token"),t=await fetch(`${de}/credits/packages`,{headers:{Authorization:`Bearer ${l}`}});if(!t.ok)throw new Error("Erro ao carregar pacotes de crditos");return await t.json()}},QE="RFC3986",JE={RFC1738:l=>String(l).replace(/%20/g,"+"),RFC3986:l=>String(l)},aF="RFC1738",rF=Array.isArray,io=(()=>{const l=[];for(let t=0;t<256;++t)l.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return l})(),DE=1024,oF=(l,t,e,n,s)=>{if(l.length===0)return l;let r=l;if(typeof l=="symbol"?r=Symbol.prototype.toString.call(l):typeof l!="string"&&(r=String(l)),e==="iso-8859-1")return escape(r).replace(/%u[0-9a-f]{4}/gi,function(h){return"%26%23"+parseInt(h.slice(2),16)+"%3B"});let u="";for(let h=0;h<r.length;h+=DE){const f=r.length>=DE?r.slice(h,h+DE):r,p=[];for(let m=0;m<f.length;++m){let b=f.charCodeAt(m);if(b===45||b===46||b===95||b===126||b>=48&&b<=57||b>=65&&b<=90||b>=97&&b<=122||s===aF&&(b===40||b===41)){p[p.length]=f.charAt(m);continue}if(b<128){p[p.length]=io[b];continue}if(b<2048){p[p.length]=io[192|b>>6]+io[128|b&63];continue}if(b<55296||b>=57344){p[p.length]=io[224|b>>12]+io[128|b>>6&63]+io[128|b&63];continue}m+=1,b=65536+((b&1023)<<10|f.charCodeAt(m)&1023),p[p.length]=io[240|b>>18]+io[128|b>>12&63]+io[128|b>>6&63]+io[128|b&63]}u+=p.join("")}return u};function lF(l){return!l||typeof l!="object"?!1:!!(l.constructor&&l.constructor.isBuffer&&l.constructor.isBuffer(l))}function dD(l,t){if(rF(l)){const e=[];for(let n=0;n<l.length;n+=1)e.push(t(l[n]));return e}return t(l)}const cF=Object.prototype.hasOwnProperty,PM={brackets(l){return String(l)+"[]"},comma:"comma",indices(l,t){return String(l)+"["+t+"]"},repeat(l){return String(l)}},oo=Array.isArray,uF=Array.prototype.push,LM=function(l,t){uF.apply(l,oo(t)?t:[t])},hF=Date.prototype.toISOString,Ai={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:oF,encodeValuesOnly:!1,format:QE,formatter:JE[QE],indices:!1,serializeDate(l){return hF.call(l)},skipNulls:!1,strictNullHandling:!1};function dF(l){return typeof l=="string"||typeof l=="number"||typeof l=="boolean"||typeof l=="symbol"||typeof l=="bigint"}const ME={};function IM(l,t,e,n,s,r,u,h,f,p,m,b,_,S,R,C,M,k){let I=l,P=k,F=0,z=!1;for(;(P=P.get(ME))!==void 0&&!z;){const yt=P.get(l);if(F+=1,typeof yt<"u"){if(yt===F)throw new RangeError("Cyclic object value");z=!0}typeof P.get(ME)>"u"&&(F=0)}if(typeof p=="function"?I=p(t,I):I instanceof Date?I=_==null?void 0:_(I):e==="comma"&&oo(I)&&(I=dD(I,function(yt){return yt instanceof Date?_==null?void 0:_(yt):yt})),I===null){if(r)return f&&!C?f(t,Ai.encoder,M,"key",S):t;I=""}if(dF(I)||lF(I)){if(f){const yt=C?t:f(t,Ai.encoder,M,"key",S);return[(R==null?void 0:R(yt))+"="+(R==null?void 0:R(f(I,Ai.encoder,M,"value",S)))]}return[(R==null?void 0:R(t))+"="+(R==null?void 0:R(String(I)))]}const j=[];if(typeof I>"u")return j;let H;if(e==="comma"&&oo(I))C&&f&&(I=dD(I,f)),H=[{value:I.length>0?I.join(",")||null:void 0}];else if(oo(p))H=p;else{const yt=Object.keys(I);H=m?yt.sort(m):yt}const dt=h?String(t).replace(/\./g,"%2E"):String(t),ct=n&&oo(I)&&I.length===1?dt+"[]":dt;if(s&&oo(I)&&I.length===0)return ct+"[]";for(let yt=0;yt<H.length;++yt){const gt=H[yt],Pt=typeof gt=="object"&&typeof gt.value<"u"?gt.value:I[gt];if(u&&Pt===null)continue;const Xt=b&&h?gt.replace(/\./g,"%2E"):gt,Vt=oo(I)?typeof e=="function"?e(ct,Xt):ct:ct+(b?"."+Xt:"["+Xt+"]");k.set(l,F);const Yt=new WeakMap;Yt.set(ME,k),LM(j,IM(Pt,Vt,e,n,s,r,u,h,e==="comma"&&C&&oo(I)?null:f,p,m,b,_,S,R,C,M,Yt))}return j}function fF(l=Ai){if(typeof l.allowEmptyArrays<"u"&&typeof l.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof l.encodeDotInKeys<"u"&&typeof l.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(l.encoder!==null&&typeof l.encoder<"u"&&typeof l.encoder!="function")throw new TypeError("Encoder has to be a function.");const t=l.charset||Ai.charset;if(typeof l.charset<"u"&&l.charset!=="utf-8"&&l.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let e=QE;if(typeof l.format<"u"){if(!cF.call(JE,l.format))throw new TypeError("Unknown format option provided.");e=l.format}const n=JE[e];let s=Ai.filter;(typeof l.filter=="function"||oo(l.filter))&&(s=l.filter);let r;if(l.arrayFormat&&l.arrayFormat in PM?r=l.arrayFormat:"indices"in l?r=l.indices?"indices":"repeat":r=Ai.arrayFormat,"commaRoundTrip"in l&&typeof l.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const u=typeof l.allowDots>"u"?l.encodeDotInKeys?!0:Ai.allowDots:!!l.allowDots;return{addQueryPrefix:typeof l.addQueryPrefix=="boolean"?l.addQueryPrefix:Ai.addQueryPrefix,allowDots:u,allowEmptyArrays:typeof l.allowEmptyArrays=="boolean"?!!l.allowEmptyArrays:Ai.allowEmptyArrays,arrayFormat:r,charset:t,charsetSentinel:typeof l.charsetSentinel=="boolean"?l.charsetSentinel:Ai.charsetSentinel,commaRoundTrip:!!l.commaRoundTrip,delimiter:typeof l.delimiter>"u"?Ai.delimiter:l.delimiter,encode:typeof l.encode=="boolean"?l.encode:Ai.encode,encodeDotInKeys:typeof l.encodeDotInKeys=="boolean"?l.encodeDotInKeys:Ai.encodeDotInKeys,encoder:typeof l.encoder=="function"?l.encoder:Ai.encoder,encodeValuesOnly:typeof l.encodeValuesOnly=="boolean"?l.encodeValuesOnly:Ai.encodeValuesOnly,filter:s,format:e,formatter:n,serializeDate:typeof l.serializeDate=="function"?l.serializeDate:Ai.serializeDate,skipNulls:typeof l.skipNulls=="boolean"?l.skipNulls:Ai.skipNulls,sort:typeof l.sort=="function"?l.sort:null,strictNullHandling:typeof l.strictNullHandling=="boolean"?l.strictNullHandling:Ai.strictNullHandling}}function pF(l,t={}){let e=l;const n=fF(t);let s,r;typeof n.filter=="function"?(r=n.filter,e=r("",e)):oo(n.filter)&&(r=n.filter,s=r);const u=[];if(typeof e!="object"||e===null)return"";const h=PM[n.arrayFormat],f=h==="comma"&&n.commaRoundTrip;s||(s=Object.keys(e)),n.sort&&s.sort(n.sort);const p=new WeakMap;for(let _=0;_<s.length;++_){const S=s[_];n.skipNulls&&e[S]===null||LM(u,IM(e[S],S,h,f,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,p))}const m=u.join(n.delimiter);let b=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?b+="utf8=%26%2310003%3B&":b+="utf8=%E2%9C%93&"),m.length>0?b+m:""}const Qf="4.104.0";let fD=!1,Ny,BM,FM,ZE,UM,zM,jM,HM,$M;function mF(l,t={auto:!1}){if(fD)throw new Error(`you must \`import 'openai/shims/${l.kind}'\` before importing anything else from openai`);if(Ny)throw new Error(`can't \`import 'openai/shims/${l.kind}'\` after \`import 'openai/shims/${Ny}'\``);fD=t.auto,Ny=l.kind,BM=l.fetch,FM=l.FormData,ZE=l.File,UM=l.ReadableStream,zM=l.getMultipartRequestOptions,jM=l.getDefaultAgent,HM=l.fileFromPath,$M=l.isFsReadStream}class gF{constructor(t){this.body=t}get[Symbol.toStringTag](){return"MultipartBody"}}function yF({manuallyImported:l}={}){const t=l?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let e,n,s,r;try{e=fetch,n=Request,s=Response,r=Headers}catch(u){throw new Error(`this environment is missing the following Web Fetch API type: ${u.message}. ${t}`)}return{kind:"web",fetch:e,Request:n,Response:s,Headers:r,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(u,h)=>({...h,body:new gF(u)}),getDefaultAgent:u=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:u=>!1}}const VM=()=>{Ny||mF(yF(),{auto:!0})};VM();class le extends Error{}class rs extends le{constructor(t,e,n,s){super(`${rs.makeMessage(t,e,n)}`),this.status=t,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=e;const r=e;this.code=r==null?void 0:r.code,this.param=r==null?void 0:r.param,this.type=r==null?void 0:r.type}static makeMessage(t,e,n){const s=e!=null&&e.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):n;return t&&s?`${t} ${s}`:t?`${t} status code (no body)`:s||"(no status code or body)"}static generate(t,e,n,s){if(!t||!s)return new lA({message:n,cause:e1(e)});const r=e==null?void 0:e.error;return t===400?new GM(t,r,n,s):t===401?new qM(t,r,n,s):t===403?new XM(t,r,n,s):t===404?new YM(t,r,n,s):t===409?new KM(t,r,n,s):t===422?new WM(t,r,n,s):t===429?new QM(t,r,n,s):t>=500?new JM(t,r,n,s):new rs(t,r,n,s)}}class ur extends rs{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class lA extends rs{constructor({message:t,cause:e}){super(void 0,void 0,t||"Connection error.",void 0),e&&(this.cause=e)}}class XC extends lA{constructor({message:t}={}){super({message:t??"Request timed out."})}}class GM extends rs{}class qM extends rs{}class XM extends rs{}class YM extends rs{}class KM extends rs{}class WM extends rs{}class QM extends rs{}class JM extends rs{}class ZM extends le{constructor(){super("Could not parse response content as the length limit was reached")}}class tN extends le{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var uw=function(l,t,e,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?l!==t||!s:!t.has(l))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(l,e):s?s.value=e:t.set(l,e),e},Ah=function(l,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?l!==t||!n:!t.has(l))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(l):n?n.value:t.get(l)},ua;class cA{constructor(){ua.set(this,void 0),this.buffer=new Uint8Array,uw(this,ua,null,"f")}decode(t){if(t==null)return[];const e=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let n=new Uint8Array(this.buffer.length+e.length);n.set(this.buffer),n.set(e,this.buffer.length),this.buffer=n;const s=[];let r;for(;(r=bF(this.buffer,Ah(this,ua,"f")))!=null;){if(r.carriage&&Ah(this,ua,"f")==null){uw(this,ua,r.index,"f");continue}if(Ah(this,ua,"f")!=null&&(r.index!==Ah(this,ua,"f")+1||r.carriage)){s.push(this.decodeText(this.buffer.slice(0,Ah(this,ua,"f")-1))),this.buffer=this.buffer.slice(Ah(this,ua,"f")),uw(this,ua,null,"f");continue}const u=Ah(this,ua,"f")!==null?r.preceding-1:r.preceding,h=this.decodeText(this.buffer.slice(0,u));s.push(h),this.buffer=this.buffer.slice(r.index),uw(this,ua,null,"f")}return s}decodeText(t){if(t==null)return"";if(typeof t=="string")return t;if(typeof Buffer<"u"){if(t instanceof Buffer)return t.toString();if(t instanceof Uint8Array)return Buffer.from(t).toString();throw new le(`Unexpected: received non-Uint8Array (${t.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(t instanceof Uint8Array||t instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(t);throw new le(`Unexpected: received non-Uint8Array/ArrayBuffer (${t.constructor.name}) in a web platform. Please report this error.`)}throw new le("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}ua=new WeakMap;cA.NEWLINE_CHARS=new Set([`
`,"\r"]);cA.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function bF(l,t){for(let s=t??0;s<l.length;s++){if(l[s]===10)return{preceding:s,index:s+1,carriage:!1};if(l[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function vF(l){for(let n=0;n<l.length-1;n++){if(l[n]===10&&l[n+1]===10||l[n]===13&&l[n+1]===13)return n+2;if(l[n]===13&&l[n+1]===10&&n+3<l.length&&l[n+2]===13&&l[n+3]===10)return n+4}return-1}function eN(l){if(l[Symbol.asyncIterator])return l;const t=l.getReader();return{async next(){try{const e=await t.read();return e!=null&&e.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class ko{constructor(t,e){this.iterator=t,this.controller=e}static fromSSEResponse(t,e){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const u of wF(t,e))if(!r){if(u.data.startsWith("[DONE]")){r=!0;continue}if(u.event===null||u.event.startsWith("response.")||u.event.startsWith("transcript.")){let h;try{h=JSON.parse(u.data)}catch(f){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),f}if(h&&h.error)throw new rs(void 0,h.error,void 0,lN(t.headers));yield h}else{let h;try{h=JSON.parse(u.data)}catch(f){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),f}if(u.event=="error")throw new rs(void 0,h.error,h.message,void 0);yield{event:u.event,data:h}}}r=!0}catch(u){if(u instanceof Error&&u.name==="AbortError")return;throw u}finally{r||e.abort()}}return new ko(s,e)}static fromReadableStream(t,e){let n=!1;async function*s(){const u=new cA,h=eN(t);for await(const f of h)for(const p of u.decode(f))yield p;for(const f of u.flush())yield f}async function*r(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let u=!1;try{for await(const h of s())u||h&&(yield JSON.parse(h));u=!0}catch(h){if(h instanceof Error&&h.name==="AbortError")return;throw h}finally{u||e.abort()}}return new ko(r,e)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],e=[],n=this.iterator(),s=r=>({next:()=>{if(r.length===0){const u=n.next();t.push(u),e.push(u)}return r.shift()}});return[new ko(()=>s(t),this.controller),new ko(()=>s(e),this.controller)]}toReadableStream(){const t=this;let e;const n=new TextEncoder;return new UM({async start(){e=t[Symbol.asyncIterator]()},async pull(s){try{const{value:r,done:u}=await e.next();if(u)return s.close();const h=n.encode(JSON.stringify(r)+`
`);s.enqueue(h)}catch(r){s.error(r)}},async cancel(){var s;await((s=e.return)==null?void 0:s.call(e))}})}}async function*wF(l,t){if(!l.body)throw t.abort(),new le("Attempted to iterate over a response with no body");const e=new AF,n=new cA,s=eN(l.body);for await(const r of _F(s))for(const u of n.decode(r)){const h=e.decode(u);h&&(yield h)}for(const r of n.flush()){const u=e.decode(r);u&&(yield u)}}async function*_F(l){let t=new Uint8Array;for await(const e of l){if(e==null)continue;const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let s=new Uint8Array(t.length+n.length);s.set(t),s.set(n,t.length),t=s;let r;for(;(r=vF(t))!==-1;)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}class AF{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(t),t.startsWith(":"))return null;let[e,n,s]=SF(t,":");return s.startsWith(" ")&&(s=s.substring(1)),e==="event"?this.event=s:e==="data"&&this.data.push(s),null}}function SF(l,t){const e=l.indexOf(t);return e!==-1?[l.substring(0,e),t,l.substring(e+t.length)]:[l,"",""]}const nN=l=>l!=null&&typeof l=="object"&&typeof l.url=="string"&&typeof l.blob=="function",iN=l=>l!=null&&typeof l=="object"&&typeof l.name=="string"&&typeof l.lastModified=="number"&&uA(l),uA=l=>l!=null&&typeof l=="object"&&typeof l.size=="number"&&typeof l.type=="string"&&typeof l.text=="function"&&typeof l.slice=="function"&&typeof l.arrayBuffer=="function",EF=l=>iN(l)||nN(l)||$M(l);async function sN(l,t,e){var s;if(l=await l,iN(l))return l;if(nN(l)){const r=await l.blob();t||(t=new URL(l.url).pathname.split(/[\\/]/).pop()??"unknown_file");const u=uA(r)?[await r.arrayBuffer()]:[r];return new ZE(u,t,e)}const n=await CF(l);if(t||(t=TF(l)??"unknown_file"),!(e!=null&&e.type)){const r=(s=n[0])==null?void 0:s.type;typeof r=="string"&&(e={...e,type:r})}return new ZE(n,t,e)}async function CF(l){var e;let t=[];if(typeof l=="string"||ArrayBuffer.isView(l)||l instanceof ArrayBuffer)t.push(l);else if(uA(l))t.push(await l.arrayBuffer());else if(RF(l))for await(const n of l)t.push(n);else throw new Error(`Unexpected data type: ${typeof l}; constructor: ${(e=l==null?void 0:l.constructor)==null?void 0:e.name}; props: ${xF(l)}`);return t}function xF(l){return`[${Object.getOwnPropertyNames(l).map(e=>`"${e}"`).join(", ")}]`}function TF(l){var t;return NE(l.name)||NE(l.filename)||((t=NE(l.path))==null?void 0:t.split(/[\\/]/).pop())}const NE=l=>{if(typeof l=="string")return l;if(typeof Buffer<"u"&&l instanceof Buffer)return String(l)},RF=l=>l!=null&&typeof l=="object"&&typeof l[Symbol.asyncIterator]=="function",pD=l=>l&&typeof l=="object"&&l.body&&l[Symbol.toStringTag]==="MultipartBody",qd=async l=>{const t=await OF(l.body);return zM(t,l)},OF=async l=>{const t=new FM;return await Promise.all(Object.entries(l||{}).map(([e,n])=>t1(t,e,n))),t},t1=async(l,t,e)=>{if(e!==void 0){if(e==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")l.append(t,String(e));else if(EF(e)){const n=await sN(e);l.append(t,n)}else if(Array.isArray(e))await Promise.all(e.map(n=>t1(l,t+"[]",n)));else if(typeof e=="object")await Promise.all(Object.entries(e).map(([n,s])=>t1(l,`${t}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${e} instead`)}};var mp={},DF=function(l,t,e,n,s){if(typeof t=="function"?l!==t||!0:!t.has(l))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(l,e),e},MF=function(l,t,e,n){if(typeof t=="function"?l!==t||!n:!t.has(l))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(l):n?n.value:t.get(l)},hw;VM();async function aN(l){var u;const{response:t}=l;if(l.options.stream)return Fu("response",t.status,t.url,t.headers,t.body),l.options.__streamClass?l.options.__streamClass.fromSSEResponse(t,l.controller):ko.fromSSEResponse(t,l.controller);if(t.status===204)return null;if(l.options.__binaryResponse)return t;const e=t.headers.get("content-type"),n=(u=e==null?void 0:e.split(";")[0])==null?void 0:u.trim();if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.endsWith("+json"))){const h=await t.json();return Fu("response",t.status,t.url,t.headers,h),rN(h,t)}const r=await t.text();return Fu("response",t.status,t.url,t.headers,r),r}function rN(l,t){return!l||typeof l!="object"||Array.isArray(l)?l:Object.defineProperty(l,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class hA extends Promise{constructor(t,e=aN){super(n=>{n(null)}),this.responsePromise=t,this.parseResponse=e}_thenUnwrap(t){return new hA(this.responsePromise,async e=>rN(t(await this.parseResponse(e),e),e.response))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,e]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:e,request_id:e.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(t,e){return this.parse().then(t,e)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}class NF{constructor({baseURL:t,maxRetries:e=2,timeout:n=6e5,httpAgent:s,fetch:r}){this.baseURL=t,this.maxRetries=kE("maxRetries",e),this.timeout=kE("timeout",n),this.httpAgent=s,this.fetch=r??BM}authHeaders(t){return{}}defaultHeaders(t){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...BF(),...this.authHeaders(t)}}validateHeaders(t,e){}defaultIdempotencyKey(){return`stainless-node-retry-${jF()}`}get(t,e){return this.methodRequest("get",t,e)}post(t,e){return this.methodRequest("post",t,e)}patch(t,e){return this.methodRequest("patch",t,e)}put(t,e){return this.methodRequest("put",t,e)}delete(t,e){return this.methodRequest("delete",t,e)}methodRequest(t,e,n){return this.request(Promise.resolve(n).then(async s=>{const r=s&&uA(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:t,path:e,...s,body:r}}))}getAPIList(t,e,n){return this.requestAPIList(e,{method:"get",path:t,...n})}calculateContentLength(t){if(typeof t=="string"){if(typeof Buffer<"u")return Buffer.byteLength(t,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(t).length.toString()}else if(ArrayBuffer.isView(t))return t.byteLength.toString();return null}buildRequest(t,{retryCount:e=0}={}){var C;const n={...t},{method:s,path:r,query:u,headers:h={}}=n,f=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:pD(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,p=this.calculateContentLength(f),m=this.buildURL(r,u);"timeout"in n&&kE("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const b=n.httpAgent??this.httpAgent??jM(m),_=n.timeout+1e3;typeof((C=b==null?void 0:b.options)==null?void 0:C.timeout)=="number"&&_>(b.options.timeout??0)&&(b.options.timeout=_),this.idempotencyHeader&&s!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),h[this.idempotencyHeader]=t.idempotencyKey);const S=this.buildHeaders({options:n,headers:h,contentLength:p,retryCount:e});return{req:{method:s,...f&&{body:f},headers:S,...b&&{agent:b},signal:n.signal??null},url:m,timeout:n.timeout}}buildHeaders({options:t,headers:e,contentLength:n,retryCount:s}){const r={};n&&(r["content-length"]=n);const u=this.defaultHeaders(t);return bD(r,u),bD(r,e),pD(t.body)&&Ny!=="node"&&delete r["content-type"],fw(u,"x-stainless-retry-count")===void 0&&fw(e,"x-stainless-retry-count")===void 0&&(r["x-stainless-retry-count"]=String(s)),fw(u,"x-stainless-timeout")===void 0&&fw(e,"x-stainless-timeout")===void 0&&t.timeout&&(r["x-stainless-timeout"]=String(Math.trunc(t.timeout/1e3))),this.validateHeaders(r,e),r}async prepareOptions(t){}async prepareRequest(t,{url:e,options:n}){}parseHeaders(t){return t?Symbol.iterator in t?Object.fromEntries(Array.from(t).map(e=>[...e])):{...t}:{}}makeStatusError(t,e,n,s){return rs.generate(t,e,n,s)}request(t,e=null){return new hA(this.makeRequest(t,e))}async makeRequest(t,e){var b,_;const n=await t,s=n.maxRetries??this.maxRetries;e==null&&(e=s),await this.prepareOptions(n);const{req:r,url:u,timeout:h}=this.buildRequest(n,{retryCount:s-e});if(await this.prepareRequest(r,{url:u,options:n}),Fu("request",u,n,r.headers),(b=n.signal)!=null&&b.aborted)throw new ur;const f=new AbortController,p=await this.fetchWithTimeout(u,r,h,f).catch(e1);if(p instanceof Error){if((_=n.signal)!=null&&_.aborted)throw new ur;if(e)return this.retryRequest(n,e);throw p.name==="AbortError"?new XC:new lA({cause:p})}const m=lN(p.headers);if(!p.ok){if(e&&this.shouldRetry(p)){const I=`retrying, ${e} attempts remaining`;return Fu(`response (error; ${I})`,p.status,u,m),this.retryRequest(n,e,m)}const S=await p.text().catch(I=>e1(I).message),R=FF(S),C=R?void 0:S;throw Fu(`response (error; ${e?"(error; no more retries left)":"(error; not retryable)"})`,p.status,u,m,C),this.makeStatusError(p.status,R,C,m)}return{response:p,options:n,controller:f}}requestAPIList(t,e){const n=this.makeRequest(e,null);return new kF(this,n,t)}buildURL(t,e){const n=zF(t)?new URL(t):new URL(this.baseURL+(this.baseURL.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),s=this.defaultQuery();return cN(s)||(e={...s,...e}),typeof e=="object"&&e&&!Array.isArray(e)&&(n.search=this.stringifyQuery(e)),n.toString()}stringifyQuery(t){return Object.entries(t).filter(([e,n])=>typeof n<"u").map(([e,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(e)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(e)}=`;throw new le(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(t,e,n,s){const{signal:r,...u}=e||{};r&&r.addEventListener("abort",()=>s.abort());const h=setTimeout(()=>s.abort(),n),f={signal:s.signal,...u};return f.method&&(f.method=f.method.toUpperCase()),this.fetch.call(void 0,t,f).finally(()=>{clearTimeout(h)})}shouldRetry(t){const e=t.headers.get("x-should-retry");return e==="true"?!0:e==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,e,n){let s;const r=n==null?void 0:n["retry-after-ms"];if(r){const h=parseFloat(r);Number.isNaN(h)||(s=h)}const u=n==null?void 0:n["retry-after"];if(u&&!s){const h=parseFloat(u);Number.isNaN(h)?s=Date.parse(u)-Date.now():s=h*1e3}if(!(s&&0<=s&&s<60*1e3)){const h=t.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(e,h)}return await Lv(s),this.makeRequest(t,e-1)}calculateDefaultRetryTimeoutMillis(t,e){const r=e-t,u=Math.min(.5*Math.pow(2,r),8),h=1-Math.random()*.25;return u*h*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Qf}`}}class oN{constructor(t,e,n,s){hw.set(this,void 0),DF(this,hw,t),this.options=s,this.response=e,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const t=this.nextPageInfo();if(!t)throw new le("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const e={...this.options};if("params"in t&&typeof e.query=="object")e.query={...e.query,...t.params};else if("url"in t){const n=[...Object.entries(e.query||{}),...t.url.searchParams.entries()];for(const[s,r]of n)t.url.searchParams.set(s,r);e.query=void 0,e.path=t.url.toString()}return await MF(this,hw,"f").requestAPIList(this.constructor,e)}async*iterPages(){let t=this;for(yield t;t.hasNextPage();)t=await t.getNextPage(),yield t}async*[(hw=new WeakMap,Symbol.asyncIterator)](){for await(const t of this.iterPages())for(const e of t.getPaginatedItems())yield e}}class kF extends hA{constructor(t,e,n){super(e,async s=>new n(t,s.response,await aN(s),s.options))}async*[Symbol.asyncIterator](){const t=await this;for await(const e of t)yield e}}const lN=l=>new Proxy(Object.fromEntries(l.entries()),{get(t,e){const n=e.toString();return t[n.toLowerCase()]||t[n]}}),PF={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},jn=l=>typeof l=="object"&&l!==null&&!cN(l)&&Object.keys(l).every(t=>uN(PF,t)),LF=()=>{var t;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Qf,"X-Stainless-OS":gD(Deno.build.os),"X-Stainless-Arch":mD(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Qf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Qf,"X-Stainless-OS":gD(process.platform),"X-Stainless-Arch":mD(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const l=IF();return l?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Qf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${l.browser}`,"X-Stainless-Runtime-Version":l.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Qf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function IF(){if(typeof navigator>"u"||!navigator)return null;const l=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:e}of l){const n=e.exec(navigator.userAgent);if(n){const s=n[1]||0,r=n[2]||0,u=n[3]||0;return{browser:t,version:`${s}.${r}.${u}`}}}return null}const mD=l=>l==="x32"?"x32":l==="x86_64"||l==="x64"?"x64":l==="arm"?"arm":l==="aarch64"||l==="arm64"?"arm64":l?`other:${l}`:"unknown",gD=l=>(l=l.toLowerCase(),l.includes("ios")?"iOS":l==="android"?"Android":l==="darwin"?"MacOS":l==="win32"?"Windows":l==="freebsd"?"FreeBSD":l==="openbsd"?"OpenBSD":l==="linux"?"Linux":l?`Other:${l}`:"Unknown");let yD;const BF=()=>yD??(yD=LF()),FF=l=>{try{return JSON.parse(l)}catch{return}},UF=/^[a-z][a-z0-9+.-]*:/i,zF=l=>UF.test(l),Lv=l=>new Promise(t=>setTimeout(t,l)),kE=(l,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new le(`${l} must be an integer`);if(t<0)throw new le(`${l} must be a positive integer`);return t},e1=l=>{if(l instanceof Error)return l;if(typeof l=="object"&&l!==null)try{return new Error(JSON.stringify(l))}catch{}return new Error(l)},dw=l=>{var t,e,n,s;if(typeof process<"u")return((t=mp==null?void 0:mp[l])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(s=(n=(e=Deno.env)==null?void 0:e.get)==null?void 0:n.call(e,l))==null?void 0:s.trim()};function cN(l){if(!l)return!0;for(const t in l)return!1;return!0}function uN(l,t){return Object.prototype.hasOwnProperty.call(l,t)}function bD(l,t){for(const e in t){if(!uN(t,e))continue;const n=e.toLowerCase();if(!n)continue;const s=t[e];s===null?delete l[n]:s!==void 0&&(l[n]=s)}}const vD=new Set(["authorization","api-key"]);function Fu(l,...t){if(typeof process<"u"&&(mp==null?void 0:mp.DEBUG)==="true"){const e=t.map(n=>{if(!n)return n;if(n.headers){const r={...n,headers:{...n.headers}};for(const u in n.headers)vD.has(u.toLowerCase())&&(r.headers[u]="REDACTED");return r}let s=null;for(const r in n)vD.has(r.toLowerCase())&&(s??(s={...n}),s[r]="REDACTED");return s??n});console.log(`OpenAI:DEBUG:${l}`,...e)}}const jF=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,l=>{const t=Math.random()*16|0;return(l==="x"?t:t&3|8).toString(16)}),HF=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",$F=l=>typeof(l==null?void 0:l.get)=="function",fw=(l,t)=>{var n;const e=t.toLowerCase();if($F(l)){const s=((n=t[0])==null?void 0:n.toUpperCase())+t.substring(1).replace(/([^\w])(\w)/g,(r,u,h)=>u+h.toUpperCase());for(const r of[t,e,t.toUpperCase(),s]){const u=l.get(r);if(u)return u}}for(const[s,r]of Object.entries(l))if(s.toLowerCase()===e)return Array.isArray(r)?(r.length<=1||console.warn(`Received ${r.length} entries for the ${t} header, using the first entry.`),r[0]):r},VF=l=>{if(typeof Buffer<"u"){const t=Buffer.from(l,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}else{const t=atob(l),e=t.length,n=new Uint8Array(e);for(let s=0;s<e;s++)n[s]=t.charCodeAt(s);return Array.from(new Float32Array(n.buffer))}};function PE(l){return l!=null&&typeof l=="object"&&!Array.isArray(l)}class dA extends oN{constructor(t,e,n,s){super(t,e,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Ri extends oN{constructor(t,e,n,s){super(t,e,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const t=this.nextPageInfo();if(!t)return null;if("params"in t)return t.params;const e=Object.fromEntries(t.url.searchParams);return Object.keys(e).length?e:null}nextPageInfo(){var n;const t=this.getPaginatedItems();if(!t.length)return null;const e=(n=t[t.length-1])==null?void 0:n.id;return e?{params:{after:e}}:null}}class ue{constructor(t){this._client=t}}let hN=class extends ue{list(t,e={},n){return jn(e)?this.list(t,{},e):this._client.getAPIList(`/chat/completions/${t}/messages`,GF,{query:e,...n})}},fA=class extends ue{constructor(){super(...arguments),this.messages=new hN(this._client)}create(t,e){return this._client.post("/chat/completions",{body:t,...e,stream:t.stream??!1})}retrieve(t,e){return this._client.get(`/chat/completions/${t}`,e)}update(t,e,n){return this._client.post(`/chat/completions/${t}`,{body:e,...n})}list(t={},e){return jn(t)?this.list({},t):this._client.getAPIList("/chat/completions",pA,{query:t,...e})}del(t,e){return this._client.delete(`/chat/completions/${t}`,e)}};class pA extends Ri{}class GF extends Ri{}fA.ChatCompletionsPage=pA;fA.Messages=hN;let mA=class extends ue{constructor(){super(...arguments),this.completions=new fA(this._client)}};mA.Completions=fA;mA.ChatCompletionsPage=pA;class dN extends ue{create(t,e){return this._client.post("/audio/speech",{body:t,...e,headers:{Accept:"application/octet-stream",...e==null?void 0:e.headers},__binaryResponse:!0})}}class fN extends ue{create(t,e){return this._client.post("/audio/transcriptions",qd({body:t,...e,stream:t.stream??!1,__metadata:{model:t.model}}))}}class pN extends ue{create(t,e){return this._client.post("/audio/translations",qd({body:t,...e,__metadata:{model:t.model}}))}}let Iv=class extends ue{constructor(){super(...arguments),this.transcriptions=new fN(this._client),this.translations=new pN(this._client),this.speech=new dN(this._client)}};Iv.Transcriptions=fN;Iv.Translations=pN;Iv.Speech=dN;class YC extends ue{create(t,e){return this._client.post("/batches",{body:t,...e})}retrieve(t,e){return this._client.get(`/batches/${t}`,e)}list(t={},e){return jn(t)?this.list({},t):this._client.getAPIList("/batches",KC,{query:t,...e})}cancel(t,e){return this._client.post(`/batches/${t}/cancel`,e)}}class KC extends Ri{}YC.BatchesPage=KC;var Sr=function(l,t,e,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?l!==t||!s:!t.has(l))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(l,e):s?s.value=e:t.set(l,e),e},Bn=function(l,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?l!==t||!n:!t.has(l))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(l):n?n.value:t.get(l)},n1,kw,Pw,ay,ry,Lw,oy,fl,ly,A_,S_,Jf,mN;class WC{constructor(){n1.add(this),this.controller=new AbortController,kw.set(this,void 0),Pw.set(this,()=>{}),ay.set(this,()=>{}),ry.set(this,void 0),Lw.set(this,()=>{}),oy.set(this,()=>{}),fl.set(this,{}),ly.set(this,!1),A_.set(this,!1),S_.set(this,!1),Jf.set(this,!1),Sr(this,kw,new Promise((t,e)=>{Sr(this,Pw,t,"f"),Sr(this,ay,e,"f")}),"f"),Sr(this,ry,new Promise((t,e)=>{Sr(this,Lw,t,"f"),Sr(this,oy,e,"f")}),"f"),Bn(this,kw,"f").catch(()=>{}),Bn(this,ry,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emitFinal(),this._emit("end")},Bn(this,n1,"m",mN).bind(this))},0)}_connected(){this.ended||(Bn(this,Pw,"f").call(this),this._emit("connect"))}get ended(){return Bn(this,ly,"f")}get errored(){return Bn(this,A_,"f")}get aborted(){return Bn(this,S_,"f")}abort(){this.controller.abort()}on(t,e){return(Bn(this,fl,"f")[t]||(Bn(this,fl,"f")[t]=[])).push({listener:e}),this}off(t,e){const n=Bn(this,fl,"f")[t];if(!n)return this;const s=n.findIndex(r=>r.listener===e);return s>=0&&n.splice(s,1),this}once(t,e){return(Bn(this,fl,"f")[t]||(Bn(this,fl,"f")[t]=[])).push({listener:e,once:!0}),this}emitted(t){return new Promise((e,n)=>{Sr(this,Jf,!0,"f"),t!=="error"&&this.once("error",n),this.once(t,e)})}async done(){Sr(this,Jf,!0,"f"),await Bn(this,ry,"f")}_emit(t,...e){if(Bn(this,ly,"f"))return;t==="end"&&(Sr(this,ly,!0,"f"),Bn(this,Lw,"f").call(this));const n=Bn(this,fl,"f")[t];if(n&&(Bn(this,fl,"f")[t]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...e))),t==="abort"){const s=e[0];!Bn(this,Jf,"f")&&!(n!=null&&n.length)&&Promise.reject(s),Bn(this,ay,"f").call(this,s),Bn(this,oy,"f").call(this,s),this._emit("end");return}if(t==="error"){const s=e[0];!Bn(this,Jf,"f")&&!(n!=null&&n.length)&&Promise.reject(s),Bn(this,ay,"f").call(this,s),Bn(this,oy,"f").call(this,s),this._emit("end")}}_emitFinal(){}}kw=new WeakMap,Pw=new WeakMap,ay=new WeakMap,ry=new WeakMap,Lw=new WeakMap,oy=new WeakMap,fl=new WeakMap,ly=new WeakMap,A_=new WeakMap,S_=new WeakMap,Jf=new WeakMap,n1=new WeakSet,mN=function(t){if(Sr(this,A_,!0,"f"),t instanceof Error&&t.name==="AbortError"&&(t=new ur),t instanceof ur)return Sr(this,S_,!0,"f"),this._emit("abort",t);if(t instanceof le)return this._emit("error",t);if(t instanceof Error){const e=new le(t.message);return e.cause=t,this._emit("error",e)}return this._emit("error",new le(String(t)))};var ee=function(l,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?l!==t||!n:!t.has(l))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(l):n?n.value:t.get(l)},ca=function(l,t,e,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?l!==t||!s:!t.has(l))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(l,e):s?s.value=e:t.set(l,e),e},ns,i1,lo,Iw,Cr,Dh,op,xh,E_,ha,Bw,Fw,ky,cy,uy,wD,_D,AD,SD,ED,CD,xD;class Fr extends WC{constructor(){super(...arguments),ns.add(this),i1.set(this,[]),lo.set(this,{}),Iw.set(this,{}),Cr.set(this,void 0),Dh.set(this,void 0),op.set(this,void 0),xh.set(this,void 0),E_.set(this,void 0),ha.set(this,void 0),Bw.set(this,void 0),Fw.set(this,void 0),ky.set(this,void 0)}[(i1=new WeakMap,lo=new WeakMap,Iw=new WeakMap,Cr=new WeakMap,Dh=new WeakMap,op=new WeakMap,xh=new WeakMap,E_=new WeakMap,ha=new WeakMap,Bw=new WeakMap,Fw=new WeakMap,ky=new WeakMap,ns=new WeakSet,Symbol.asyncIterator)](){const t=[],e=[];let n=!1;return this.on("event",s=>{const r=e.shift();r?r.resolve(s):t.push(s)}),this.on("end",()=>{n=!0;for(const s of e)s.resolve(void 0);e.length=0}),this.on("abort",s=>{n=!0;for(const r of e)r.reject(s);e.length=0}),this.on("error",s=>{n=!0;for(const r of e)r.reject(s);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((r,u)=>e.push({resolve:r,reject:u})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(t){const e=new Fr;return e._run(()=>e._fromReadableStream(t)),e}async _fromReadableStream(t,e){var r;const n=e==null?void 0:e.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=ko.fromReadableStream(t,this.controller);for await(const u of s)ee(this,ns,"m",cy).call(this,u);if((r=s.controller.signal)!=null&&r.aborted)throw new ur;return this._addRun(ee(this,ns,"m",uy).call(this))}toReadableStream(){return new ko(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(t,e,n,s,r){const u=new Fr;return u._run(()=>u._runToolAssistantStream(t,e,n,s,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),u}async _createToolAssistantStream(t,e,n,s,r){var p;const u=r==null?void 0:r.signal;u&&(u.aborted&&this.controller.abort(),u.addEventListener("abort",()=>this.controller.abort()));const h={...s,stream:!0},f=await t.submitToolOutputs(e,n,h,{...r,signal:this.controller.signal});this._connected();for await(const m of f)ee(this,ns,"m",cy).call(this,m);if((p=f.controller.signal)!=null&&p.aborted)throw new ur;return this._addRun(ee(this,ns,"m",uy).call(this))}static createThreadAssistantStream(t,e,n){const s=new Fr;return s._run(()=>s._threadAssistantStream(t,e,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(t,e,n,s){const r=new Fr;return r._run(()=>r._runAssistantStream(t,e,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return ee(this,Bw,"f")}currentRun(){return ee(this,Fw,"f")}currentMessageSnapshot(){return ee(this,Cr,"f")}currentRunStepSnapshot(){return ee(this,ky,"f")}async finalRunSteps(){return await this.done(),Object.values(ee(this,lo,"f"))}async finalMessages(){return await this.done(),Object.values(ee(this,Iw,"f"))}async finalRun(){if(await this.done(),!ee(this,Dh,"f"))throw Error("Final run was not received.");return ee(this,Dh,"f")}async _createThreadAssistantStream(t,e,n){var h;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const r={...e,stream:!0},u=await t.createAndRun(r,{...n,signal:this.controller.signal});this._connected();for await(const f of u)ee(this,ns,"m",cy).call(this,f);if((h=u.controller.signal)!=null&&h.aborted)throw new ur;return this._addRun(ee(this,ns,"m",uy).call(this))}async _createAssistantStream(t,e,n,s){var f;const r=s==null?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const u={...n,stream:!0},h=await t.create(e,u,{...s,signal:this.controller.signal});this._connected();for await(const p of h)ee(this,ns,"m",cy).call(this,p);if((f=h.controller.signal)!=null&&f.aborted)throw new ur;return this._addRun(ee(this,ns,"m",uy).call(this))}static accumulateDelta(t,e){for(const[n,s]of Object.entries(e)){if(!t.hasOwnProperty(n)){t[n]=s;continue}let r=t[n];if(r==null){t[n]=s;continue}if(n==="index"||n==="type"){t[n]=s;continue}if(typeof r=="string"&&typeof s=="string")r+=s;else if(typeof r=="number"&&typeof s=="number")r+=s;else if(PE(r)&&PE(s))r=this.accumulateDelta(r,s);else if(Array.isArray(r)&&Array.isArray(s)){if(r.every(u=>typeof u=="string"||typeof u=="number")){r.push(...s);continue}for(const u of s){if(!PE(u))throw new Error(`Expected array delta entry to be an object but got: ${u}`);const h=u.index;if(h==null)throw console.error(u),new Error("Expected array delta entry to have an `index` property");if(typeof h!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${h}`);const f=r[h];f==null?r.push(u):r[h]=this.accumulateDelta(f,u)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${r}`);t[n]=r}return t}_addRun(t){return t}async _threadAssistantStream(t,e,n){return await this._createThreadAssistantStream(e,t,n)}async _runAssistantStream(t,e,n,s){return await this._createAssistantStream(e,t,n,s)}async _runToolAssistantStream(t,e,n,s,r){return await this._createToolAssistantStream(n,t,e,s,r)}}cy=function(t){if(!this.ended)switch(ca(this,Bw,t,"f"),ee(this,ns,"m",AD).call(this,t),t.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":ee(this,ns,"m",xD).call(this,t);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ee(this,ns,"m",_D).call(this,t);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":ee(this,ns,"m",wD).call(this,t);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},uy=function(){if(this.ended)throw new le("stream has ended, this shouldn't happen");if(!ee(this,Dh,"f"))throw Error("Final run has not been received");return ee(this,Dh,"f")},wD=function(t){const[e,n]=ee(this,ns,"m",ED).call(this,t,ee(this,Cr,"f"));ca(this,Cr,e,"f"),ee(this,Iw,"f")[e.id]=e;for(const s of n){const r=e.content[s.index];(r==null?void 0:r.type)=="text"&&this._emit("textCreated",r.text)}switch(t.event){case"thread.message.created":this._emit("messageCreated",t.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",t.data.delta,e),t.data.delta.content)for(const s of t.data.delta.content){if(s.type=="text"&&s.text){let r=s.text,u=e.content[s.index];if(u&&u.type=="text")this._emit("textDelta",r,u.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=ee(this,op,"f")){if(ee(this,xh,"f"))switch(ee(this,xh,"f").type){case"text":this._emit("textDone",ee(this,xh,"f").text,ee(this,Cr,"f"));break;case"image_file":this._emit("imageFileDone",ee(this,xh,"f").image_file,ee(this,Cr,"f"));break}ca(this,op,s.index,"f")}ca(this,xh,e.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(ee(this,op,"f")!==void 0){const s=t.data.content[ee(this,op,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,ee(this,Cr,"f"));break;case"text":this._emit("textDone",s.text,ee(this,Cr,"f"));break}}ee(this,Cr,"f")&&this._emit("messageDone",t.data),ca(this,Cr,void 0,"f")}},_D=function(t){const e=ee(this,ns,"m",SD).call(this,t);switch(ca(this,ky,e,"f"),t.event){case"thread.run.step.created":this._emit("runStepCreated",t.data);break;case"thread.run.step.delta":const n=t.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&e.step_details.type=="tool_calls")for(const r of n.step_details.tool_calls)r.index==ee(this,E_,"f")?this._emit("toolCallDelta",r,e.step_details.tool_calls[r.index]):(ee(this,ha,"f")&&this._emit("toolCallDone",ee(this,ha,"f")),ca(this,E_,r.index,"f"),ca(this,ha,e.step_details.tool_calls[r.index],"f"),ee(this,ha,"f")&&this._emit("toolCallCreated",ee(this,ha,"f")));this._emit("runStepDelta",t.data.delta,e);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ca(this,ky,void 0,"f"),t.data.step_details.type=="tool_calls"&&ee(this,ha,"f")&&(this._emit("toolCallDone",ee(this,ha,"f")),ca(this,ha,void 0,"f")),this._emit("runStepDone",t.data,e);break}},AD=function(t){ee(this,i1,"f").push(t),this._emit("event",t)},SD=function(t){switch(t.event){case"thread.run.step.created":return ee(this,lo,"f")[t.data.id]=t.data,t.data;case"thread.run.step.delta":let e=ee(this,lo,"f")[t.data.id];if(!e)throw Error("Received a RunStepDelta before creation of a snapshot");let n=t.data;if(n.delta){const s=Fr.accumulateDelta(e,n.delta);ee(this,lo,"f")[t.data.id]=s}return ee(this,lo,"f")[t.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":ee(this,lo,"f")[t.data.id]=t.data;break}if(ee(this,lo,"f")[t.data.id])return ee(this,lo,"f")[t.data.id];throw new Error("No snapshot available")},ED=function(t,e){let n=[];switch(t.event){case"thread.message.created":return[t.data,n];case"thread.message.delta":if(!e)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=t.data;if(s.delta.content)for(const r of s.delta.content)if(r.index in e.content){let u=e.content[r.index];e.content[r.index]=ee(this,ns,"m",CD).call(this,r,u)}else e.content[r.index]=r,n.push(r);return[e,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(e)return[e,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},CD=function(t,e){return Fr.accumulateDelta(e,t)},xD=function(t){switch(ca(this,Fw,t.data,"f"),t.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":ca(this,Dh,t.data,"f"),ee(this,ha,"f")&&(this._emit("toolCallDone",ee(this,ha,"f")),ca(this,ha,void 0,"f"));break}};class QC extends ue{create(t,e){return this._client.post("/assistants",{body:t,...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers}})}retrieve(t,e){return this._client.get(`/assistants/${t}`,{...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers}})}update(t,e,n){return this._client.post(`/assistants/${t}`,{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(t={},e){return jn(t)?this.list({},t):this._client.getAPIList("/assistants",JC,{query:t,...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers}})}del(t,e){return this._client.delete(`/assistants/${t}`,{...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers}})}}class JC extends Ri{}QC.AssistantsPage=JC;function TD(l){return typeof l.parse=="function"}const gp=l=>(l==null?void 0:l.role)==="assistant",gN=l=>(l==null?void 0:l.role)==="function",yN=l=>(l==null?void 0:l.role)==="tool";function ZC(l){return(l==null?void 0:l.$brand)==="auto-parseable-response-format"}function Bv(l){return(l==null?void 0:l.$brand)==="auto-parseable-tool"}function qF(l,t){return!t||!bN(t)?{...l,choices:l.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}:tx(l,t)}function tx(l,t){const e=l.choices.map(n=>{var s;if(n.finish_reason==="length")throw new ZM;if(n.finish_reason==="content_filter")throw new tN;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((s=n.message.tool_calls)==null?void 0:s.map(r=>YF(t,r)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?XF(t,n.message.content):null}}});return{...l,choices:e}}function XF(l,t){var e,n;return((e=l.response_format)==null?void 0:e.type)!=="json_schema"?null:((n=l.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in l.response_format?l.response_format.$parseRaw(t):JSON.parse(t):null}function YF(l,t){var n;const e=(n=l.tools)==null?void 0:n.find(s=>{var r;return((r=s.function)==null?void 0:r.name)===t.function.name});return{...t,function:{...t.function,parsed_arguments:Bv(e)?e.$parseRaw(t.function.arguments):e!=null&&e.function.strict?JSON.parse(t.function.arguments):null}}}function KF(l,t){var n;if(!l)return!1;const e=(n=l.tools)==null?void 0:n.find(s=>{var r;return((r=s.function)==null?void 0:r.name)===t.function.name});return Bv(e)||(e==null?void 0:e.function.strict)||!1}function bN(l){var t;return ZC(l.response_format)?!0:((t=l.tools)==null?void 0:t.some(e=>Bv(e)||e.type==="function"&&e.function.strict===!0))??!1}function WF(l){for(const t of l??[]){if(t.type!=="function")throw new le(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(t.function.strict!==!0)throw new le(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var $s=function(l,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?l!==t||!n:!t.has(l))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(l):n?n.value:t.get(l)},fs,s1,C_,a1,r1,o1,vN,l1;const RD=10;class wN extends WC{constructor(){super(...arguments),fs.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(t){var n;this._chatCompletions.push(t),this._emit("chatCompletion",t);const e=(n=t.choices[0])==null?void 0:n.message;return e&&this._addMessage(e),t}_addMessage(t,e=!0){if("content"in t||(t.content=null),this.messages.push(t),e){if(this._emit("message",t),(gN(t)||yN(t))&&t.content)this._emit("functionCallResult",t.content);else if(gp(t)&&t.function_call)this._emit("functionCall",t.function_call);else if(gp(t)&&t.tool_calls)for(const n of t.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const t=this._chatCompletions[this._chatCompletions.length-1];if(!t)throw new le("stream ended without producing a ChatCompletion");return t}async finalContent(){return await this.done(),$s(this,fs,"m",s1).call(this)}async finalMessage(){return await this.done(),$s(this,fs,"m",C_).call(this)}async finalFunctionCall(){return await this.done(),$s(this,fs,"m",a1).call(this)}async finalFunctionCallResult(){return await this.done(),$s(this,fs,"m",r1).call(this)}async totalUsage(){return await this.done(),$s(this,fs,"m",o1).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const t=this._chatCompletions[this._chatCompletions.length-1];t&&this._emit("finalChatCompletion",t);const e=$s(this,fs,"m",C_).call(this);e&&this._emit("finalMessage",e);const n=$s(this,fs,"m",s1).call(this);n&&this._emit("finalContent",n);const s=$s(this,fs,"m",a1).call(this);s&&this._emit("finalFunctionCall",s);const r=$s(this,fs,"m",r1).call(this);r!=null&&this._emit("finalFunctionCallResult",r),this._chatCompletions.some(u=>u.usage)&&this._emit("totalUsage",$s(this,fs,"m",o1).call(this))}async _createChatCompletion(t,e,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),$s(this,fs,"m",vN).call(this,e);const r=await t.chat.completions.create({...e,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(tx(r,e))}async _runChatCompletion(t,e,n){for(const s of e.messages)this._addMessage(s,!1);return await this._createChatCompletion(t,e,n)}async _runFunctions(t,e,n){var _;const s="function",{function_call:r="auto",stream:u,...h}=e,f=typeof r!="string"&&(r==null?void 0:r.name),{maxChatCompletions:p=RD}=n||{},m={};for(const S of e.functions)m[S.name||S.function.name]=S;const b=e.functions.map(S=>({name:S.name||S.function.name,parameters:S.parameters,description:S.description}));for(const S of e.messages)this._addMessage(S,!1);for(let S=0;S<p;++S){const C=(_=(await this._createChatCompletion(t,{...h,function_call:r,functions:b,messages:[...this.messages]},n)).choices[0])==null?void 0:_.message;if(!C)throw new le("missing message in ChatCompletion response");if(!C.function_call)return;const{name:M,arguments:k}=C.function_call,I=m[M];if(I){if(f&&f!==M){const j=`Invalid function_call: ${JSON.stringify(M)}. ${JSON.stringify(f)} requested. Please try again`;this._addMessage({role:s,name:M,content:j});continue}}else{const j=`Invalid function_call: ${JSON.stringify(M)}. Available options are: ${b.map(H=>JSON.stringify(H.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:M,content:j});continue}let P;try{P=TD(I)?await I.parse(k):k}catch(j){this._addMessage({role:s,name:M,content:j instanceof Error?j.message:String(j)});continue}const F=await I.function(P,this),z=$s(this,fs,"m",l1).call(this,F);if(this._addMessage({role:s,name:M,content:z}),f)return}}async _runTools(t,e,n){var S,R,C;const s="tool",{tool_choice:r="auto",stream:u,...h}=e,f=typeof r!="string"&&((S=r==null?void 0:r.function)==null?void 0:S.name),{maxChatCompletions:p=RD}=n||{},m=e.tools.map(M=>{if(Bv(M)){if(!M.$callback)throw new le("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:M.$callback,name:M.function.name,description:M.function.description||"",parameters:M.function.parameters,parse:M.$parseRaw,strict:!0}}}return M}),b={};for(const M of m)M.type==="function"&&(b[M.function.name||M.function.function.name]=M.function);const _="tools"in e?m.map(M=>M.type==="function"?{type:"function",function:{name:M.function.name||M.function.function.name,parameters:M.function.parameters,description:M.function.description,strict:M.function.strict}}:M):void 0;for(const M of e.messages)this._addMessage(M,!1);for(let M=0;M<p;++M){const I=(R=(await this._createChatCompletion(t,{...h,tool_choice:r,tools:_,messages:[...this.messages]},n)).choices[0])==null?void 0:R.message;if(!I)throw new le("missing message in ChatCompletion response");if(!((C=I.tool_calls)!=null&&C.length))return;for(const P of I.tool_calls){if(P.type!=="function")continue;const F=P.id,{name:z,arguments:j}=P.function,H=b[z];if(H){if(f&&f!==z){const gt=`Invalid tool_call: ${JSON.stringify(z)}. ${JSON.stringify(f)} requested. Please try again`;this._addMessage({role:s,tool_call_id:F,content:gt});continue}}else{const gt=`Invalid tool_call: ${JSON.stringify(z)}. Available options are: ${Object.keys(b).map(Pt=>JSON.stringify(Pt)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:F,content:gt});continue}let dt;try{dt=TD(H)?await H.parse(j):j}catch(gt){const Pt=gt instanceof Error?gt.message:String(gt);this._addMessage({role:s,tool_call_id:F,content:Pt});continue}const ct=await H.function(dt,this),yt=$s(this,fs,"m",l1).call(this,ct);if(this._addMessage({role:s,tool_call_id:F,content:yt}),f)return}}}}fs=new WeakSet,s1=function(){return $s(this,fs,"m",C_).call(this).content??null},C_=function(){let t=this.messages.length;for(;t-- >0;){const e=this.messages[t];if(gp(e)){const{function_call:n,...s}=e,r={...s,content:e.content??null,refusal:e.refusal??null};return n&&(r.function_call=n),r}}throw new le("stream ended without producing a ChatCompletionMessage with role=assistant")},a1=function(){var t,e;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(gp(s)&&(s!=null&&s.function_call))return s.function_call;if(gp(s)&&((t=s==null?void 0:s.tool_calls)!=null&&t.length))return(e=s.tool_calls.at(-1))==null?void 0:e.function}},r1=function(){for(let t=this.messages.length-1;t>=0;t--){const e=this.messages[t];if(gN(e)&&e.content!=null||yN(e)&&e.content!=null&&typeof e.content=="string"&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(r=>r.type==="function"&&r.id===e.tool_call_id))}))return e.content}},o1=function(){const t={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:e}of this._chatCompletions)e&&(t.completion_tokens+=e.completion_tokens,t.prompt_tokens+=e.prompt_tokens,t.total_tokens+=e.total_tokens);return t},vN=function(t){if(t.n!=null&&t.n>1)throw new le("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},l1=function(t){return typeof t=="string"?t:t===void 0?"undefined":JSON.stringify(t)};class Ly extends wN{static runFunctions(t,e,n){const s=new Ly,r={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(t,e,r)),s}static runTools(t,e,n){const s=new Ly,r={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(t,e,r)),s}_addMessage(t,e=!0){super._addMessage(t,e),gp(t)&&t.content&&this._emit("content",t.content)}}const _N=1,AN=2,SN=4,EN=8,CN=16,xN=32,TN=64,RN=128,ON=256,DN=RN|ON,MN=CN|xN|DN|TN,NN=_N|AN|MN,kN=SN|EN,QF=NN|kN,Li={STR:_N,NUM:AN,ARR:SN,OBJ:EN,NULL:CN,BOOL:xN,NAN:TN,INFINITY:RN,MINUS_INFINITY:ON,INF:DN,SPECIAL:MN,ATOM:NN,COLLECTION:kN,ALL:QF};class JF extends Error{}class ZF extends Error{}function t3(l,t=Li.ALL){if(typeof l!="string")throw new TypeError(`expecting str, got ${typeof l}`);if(!l.trim())throw new Error(`${l} is empty`);return e3(l.trim(),t)}const e3=(l,t)=>{const e=l.length;let n=0;const s=_=>{throw new JF(`${_} at position ${n}`)},r=_=>{throw new ZF(`${_} at position ${n}`)},u=()=>(b(),n>=e&&s("Unexpected end of input"),l[n]==='"'?h():l[n]==="{"?f():l[n]==="["?p():l.substring(n,n+4)==="null"||Li.NULL&t&&e-n<4&&"null".startsWith(l.substring(n))?(n+=4,null):l.substring(n,n+4)==="true"||Li.BOOL&t&&e-n<4&&"true".startsWith(l.substring(n))?(n+=4,!0):l.substring(n,n+5)==="false"||Li.BOOL&t&&e-n<5&&"false".startsWith(l.substring(n))?(n+=5,!1):l.substring(n,n+8)==="Infinity"||Li.INFINITY&t&&e-n<8&&"Infinity".startsWith(l.substring(n))?(n+=8,1/0):l.substring(n,n+9)==="-Infinity"||Li.MINUS_INFINITY&t&&1<e-n&&e-n<9&&"-Infinity".startsWith(l.substring(n))?(n+=9,-1/0):l.substring(n,n+3)==="NaN"||Li.NAN&t&&e-n<3&&"NaN".startsWith(l.substring(n))?(n+=3,NaN):m()),h=()=>{const _=n;let S=!1;for(n++;n<e&&(l[n]!=='"'||S&&l[n-1]==="\\");)S=l[n]==="\\"?!S:!1,n++;if(l.charAt(n)=='"')try{return JSON.parse(l.substring(_,++n-Number(S)))}catch(R){r(String(R))}else if(Li.STR&t)try{return JSON.parse(l.substring(_,n-Number(S))+'"')}catch{return JSON.parse(l.substring(_,l.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},f=()=>{n++,b();const _={};try{for(;l[n]!=="}";){if(b(),n>=e&&Li.OBJ&t)return _;const S=h();b(),n++;try{const R=u();Object.defineProperty(_,S,{value:R,writable:!0,enumerable:!0,configurable:!0})}catch(R){if(Li.OBJ&t)return _;throw R}b(),l[n]===","&&n++}}catch{if(Li.OBJ&t)return _;s("Expected '}' at end of object")}return n++,_},p=()=>{n++;const _=[];try{for(;l[n]!=="]";)_.push(u()),b(),l[n]===","&&n++}catch{if(Li.ARR&t)return _;s("Expected ']' at end of array")}return n++,_},m=()=>{if(n===0){l==="-"&&Li.NUM&t&&s("Not sure what '-' is");try{return JSON.parse(l)}catch(S){if(Li.NUM&t)try{return l[l.length-1]==="."?JSON.parse(l.substring(0,l.lastIndexOf("."))):JSON.parse(l.substring(0,l.lastIndexOf("e")))}catch{}r(String(S))}}const _=n;for(l[n]==="-"&&n++;l[n]&&!",]}".includes(l[n]);)n++;n==e&&!(Li.NUM&t)&&s("Unterminated number literal");try{return JSON.parse(l.substring(_,n))}catch{l.substring(_,n)==="-"&&Li.NUM&t&&s("Not sure what '-' is");try{return JSON.parse(l.substring(_,l.lastIndexOf("e")))}catch(R){r(String(R))}}},b=()=>{for(;n<e&&` 
\r	`.includes(l[n]);)n++};return u()},OD=l=>t3(l,Li.ALL^Li.NUM);var Gf=function(l,t,e,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?l!==t||!s:!t.has(l))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(l,e):s?s.value=e:t.set(l,e),e},an=function(l,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?l!==t||!n:!t.has(l))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(l):n?n.value:t.get(l)},vi,dl,qf,$c,LE,pw,IE,BE,FE,mw,UE,DD;class Iy extends wN{constructor(t){super(),vi.add(this),dl.set(this,void 0),qf.set(this,void 0),$c.set(this,void 0),Gf(this,dl,t,"f"),Gf(this,qf,[],"f")}get currentChatCompletionSnapshot(){return an(this,$c,"f")}static fromReadableStream(t){const e=new Iy(null);return e._run(()=>e._fromReadableStream(t)),e}static createChatCompletion(t,e,n){const s=new Iy(e);return s._run(()=>s._runChatCompletion(t,{...e,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(t,e,n){var u;super._createChatCompletion;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),an(this,vi,"m",LE).call(this);const r=await t.chat.completions.create({...e,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const h of r)an(this,vi,"m",IE).call(this,h);if((u=r.controller.signal)!=null&&u.aborted)throw new ur;return this._addChatCompletion(an(this,vi,"m",mw).call(this))}async _fromReadableStream(t,e){var u;const n=e==null?void 0:e.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),an(this,vi,"m",LE).call(this),this._connected();const s=ko.fromReadableStream(t,this.controller);let r;for await(const h of s)r&&r!==h.id&&this._addChatCompletion(an(this,vi,"m",mw).call(this)),an(this,vi,"m",IE).call(this,h),r=h.id;if((u=s.controller.signal)!=null&&u.aborted)throw new ur;return this._addChatCompletion(an(this,vi,"m",mw).call(this))}[(dl=new WeakMap,qf=new WeakMap,$c=new WeakMap,vi=new WeakSet,LE=function(){this.ended||Gf(this,$c,void 0,"f")},pw=function(e){let n=an(this,qf,"f")[e.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},an(this,qf,"f")[e.index]=n,n)},IE=function(e){var s,r,u,h,f,p,m,b,_,S,R,C,M,k,I;if(this.ended)return;const n=an(this,vi,"m",DD).call(this,e);this._emit("chunk",e,n);for(const P of e.choices){const F=n.choices[P.index];P.delta.content!=null&&((s=F.message)==null?void 0:s.role)==="assistant"&&((r=F.message)!=null&&r.content)&&(this._emit("content",P.delta.content,F.message.content),this._emit("content.delta",{delta:P.delta.content,snapshot:F.message.content,parsed:F.message.parsed})),P.delta.refusal!=null&&((u=F.message)==null?void 0:u.role)==="assistant"&&((h=F.message)!=null&&h.refusal)&&this._emit("refusal.delta",{delta:P.delta.refusal,snapshot:F.message.refusal}),((f=P.logprobs)==null?void 0:f.content)!=null&&((p=F.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(m=P.logprobs)==null?void 0:m.content,snapshot:((b=F.logprobs)==null?void 0:b.content)??[]}),((_=P.logprobs)==null?void 0:_.refusal)!=null&&((S=F.message)==null?void 0:S.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(R=P.logprobs)==null?void 0:R.refusal,snapshot:((C=F.logprobs)==null?void 0:C.refusal)??[]});const z=an(this,vi,"m",pw).call(this,F);F.finish_reason&&(an(this,vi,"m",FE).call(this,F),z.current_tool_call_index!=null&&an(this,vi,"m",BE).call(this,F,z.current_tool_call_index));for(const j of P.delta.tool_calls??[])z.current_tool_call_index!==j.index&&(an(this,vi,"m",FE).call(this,F),z.current_tool_call_index!=null&&an(this,vi,"m",BE).call(this,F,z.current_tool_call_index)),z.current_tool_call_index=j.index;for(const j of P.delta.tool_calls??[]){const H=(M=F.message.tool_calls)==null?void 0:M[j.index];H!=null&&H.type&&((H==null?void 0:H.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(k=H.function)==null?void 0:k.name,index:j.index,arguments:H.function.arguments,parsed_arguments:H.function.parsed_arguments,arguments_delta:((I=j.function)==null?void 0:I.arguments)??""}):(H==null||H.type,void 0))}}},BE=function(e,n){var u,h,f;if(an(this,vi,"m",pw).call(this,e).done_tool_calls.has(n))return;const r=(u=e.message.tool_calls)==null?void 0:u[n];if(!r)throw new Error("no tool call snapshot");if(!r.type)throw new Error("tool call snapshot missing `type`");if(r.type==="function"){const p=(f=(h=an(this,dl,"f"))==null?void 0:h.tools)==null?void 0:f.find(m=>m.type==="function"&&m.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:n,arguments:r.function.arguments,parsed_arguments:Bv(p)?p.$parseRaw(r.function.arguments):p!=null&&p.function.strict?JSON.parse(r.function.arguments):null})}else r.type},FE=function(e){var s,r;const n=an(this,vi,"m",pw).call(this,e);if(e.message.content&&!n.content_done){n.content_done=!0;const u=an(this,vi,"m",UE).call(this);this._emit("content.done",{content:e.message.content,parsed:u?u.$parseRaw(e.message.content):null})}e.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),(s=e.logprobs)!=null&&s.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),(r=e.logprobs)!=null&&r.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},mw=function(){if(this.ended)throw new le("stream has ended, this shouldn't happen");const e=an(this,$c,"f");if(!e)throw new le("request ended without sending any chunks");return Gf(this,$c,void 0,"f"),Gf(this,qf,[],"f"),n3(e,an(this,dl,"f"))},UE=function(){var n;const e=(n=an(this,dl,"f"))==null?void 0:n.response_format;return ZC(e)?e:null},DD=function(e){var n,s,r,u;let h=an(this,$c,"f");const{choices:f,...p}=e;h?Object.assign(h,p):h=Gf(this,$c,{...p,choices:[]},"f");for(const{delta:m,finish_reason:b,index:_,logprobs:S=null,...R}of e.choices){let C=h.choices[_];if(C||(C=h.choices[_]={finish_reason:b,index:_,message:{},logprobs:S,...R}),S)if(!C.logprobs)C.logprobs=Object.assign({},S);else{const{content:j,refusal:H,...dt}=S;Object.assign(C.logprobs,dt),j&&((n=C.logprobs).content??(n.content=[]),C.logprobs.content.push(...j)),H&&((s=C.logprobs).refusal??(s.refusal=[]),C.logprobs.refusal.push(...H))}if(b&&(C.finish_reason=b,an(this,dl,"f")&&bN(an(this,dl,"f")))){if(b==="length")throw new ZM;if(b==="content_filter")throw new tN}if(Object.assign(C,R),!m)continue;const{content:M,refusal:k,function_call:I,role:P,tool_calls:F,...z}=m;if(Object.assign(C.message,z),k&&(C.message.refusal=(C.message.refusal||"")+k),P&&(C.message.role=P),I&&(C.message.function_call?(I.name&&(C.message.function_call.name=I.name),I.arguments&&((r=C.message.function_call).arguments??(r.arguments=""),C.message.function_call.arguments+=I.arguments)):C.message.function_call=I),M&&(C.message.content=(C.message.content||"")+M,!C.message.refusal&&an(this,vi,"m",UE).call(this)&&(C.message.parsed=OD(C.message.content))),F){C.message.tool_calls||(C.message.tool_calls=[]);for(const{index:j,id:H,type:dt,function:ct,...yt}of F){const gt=(u=C.message.tool_calls)[j]??(u[j]={});Object.assign(gt,yt),H&&(gt.id=H),dt&&(gt.type=dt),ct&&(gt.function??(gt.function={name:ct.name??"",arguments:""})),ct!=null&&ct.name&&(gt.function.name=ct.name),ct!=null&&ct.arguments&&(gt.function.arguments+=ct.arguments,KF(an(this,dl,"f"),gt)&&(gt.function.parsed_arguments=OD(gt.function.arguments)))}}}return h},Symbol.asyncIterator)](){const t=[],e=[];let n=!1;return this.on("chunk",s=>{const r=e.shift();r?r.resolve(s):t.push(s)}),this.on("end",()=>{n=!0;for(const s of e)s.resolve(void 0);e.length=0}),this.on("abort",s=>{n=!0;for(const r of e)r.reject(s);e.length=0}),this.on("error",s=>{n=!0;for(const r of e)r.reject(s);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((r,u)=>e.push({resolve:r,reject:u})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ko(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function n3(l,t){const{id:e,choices:n,created:s,model:r,system_fingerprint:u,...h}=l,f={...h,id:e,choices:n.map(({message:p,finish_reason:m,index:b,logprobs:_,...S})=>{if(!m)throw new le(`missing finish_reason for choice ${b}`);const{content:R=null,function_call:C,tool_calls:M,...k}=p,I=p.role;if(!I)throw new le(`missing role for choice ${b}`);if(C){const{arguments:P,name:F}=C;if(P==null)throw new le(`missing function_call.arguments for choice ${b}`);if(!F)throw new le(`missing function_call.name for choice ${b}`);return{...S,message:{content:R,function_call:{arguments:P,name:F},role:I,refusal:p.refusal??null},finish_reason:m,index:b,logprobs:_}}return M?{...S,index:b,finish_reason:m,logprobs:_,message:{...k,role:I,content:R,refusal:p.refusal??null,tool_calls:M.map((P,F)=>{const{function:z,type:j,id:H,...dt}=P,{arguments:ct,name:yt,...gt}=z||{};if(H==null)throw new le(`missing choices[${b}].tool_calls[${F}].id
${gw(l)}`);if(j==null)throw new le(`missing choices[${b}].tool_calls[${F}].type
${gw(l)}`);if(yt==null)throw new le(`missing choices[${b}].tool_calls[${F}].function.name
${gw(l)}`);if(ct==null)throw new le(`missing choices[${b}].tool_calls[${F}].function.arguments
${gw(l)}`);return{...dt,id:H,type:j,function:{...gt,name:yt,arguments:ct}}})}}:{...S,message:{...k,content:R,role:I,refusal:p.refusal??null},finish_reason:m,index:b,logprobs:_}}),created:s,model:r,object:"chat.completion",...u?{system_fingerprint:u}:{}};return qF(f,t)}function gw(l){return JSON.stringify(l)}class yp extends Iy{static fromReadableStream(t){const e=new yp(null);return e._run(()=>e._fromReadableStream(t)),e}static runFunctions(t,e,n){const s=new yp(null),r={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(t,e,r)),s}static runTools(t,e,n){const s=new yp(e),r={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(t,e,r)),s}}let PN=class extends ue{parse(t,e){return WF(t.tools),this._client.chat.completions.create(t,{...e,headers:{...e==null?void 0:e.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>tx(n,t))}runFunctions(t,e){return t.stream?yp.runFunctions(this._client,t,e):Ly.runFunctions(this._client,t,e)}runTools(t,e){return t.stream?yp.runTools(this._client,t,e):Ly.runTools(this._client,t,e)}stream(t,e){return Iy.createChatCompletion(this._client,t,e)}};class c1 extends ue{constructor(){super(...arguments),this.completions=new PN(this._client)}}(function(l){l.Completions=PN})(c1||(c1={}));class LN extends ue{create(t,e){return this._client.post("/realtime/sessions",{body:t,...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers}})}}class IN extends ue{create(t,e){return this._client.post("/realtime/transcription_sessions",{body:t,...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers}})}}class gA extends ue{constructor(){super(...arguments),this.sessions=new LN(this._client),this.transcriptionSessions=new IN(this._client)}}gA.Sessions=LN;gA.TranscriptionSessions=IN;class ex extends ue{create(t,e,n){return this._client.post(`/threads/${t}/messages`,{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(t,e,n){return this._client.get(`/threads/${t}/messages/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(t,e,n,s){return this._client.post(`/threads/${t}/messages/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(t,e={},n){return jn(e)?this.list(t,{},e):this._client.getAPIList(`/threads/${t}/messages`,nx,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(t,e,n){return this._client.delete(`/threads/${t}/messages/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class nx extends Ri{}ex.MessagesPage=nx;class ix extends ue{retrieve(t,e,n,s={},r){return jn(s)?this.retrieve(t,e,n,{},s):this._client.get(`/threads/${t}/runs/${e}/steps/${n}`,{query:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(t,e,n={},s){return jn(n)?this.list(t,e,{},n):this._client.getAPIList(`/threads/${t}/runs/${e}/steps`,sx,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class sx extends Ri{}ix.RunStepsPage=sx;let Fv=class extends ue{constructor(){super(...arguments),this.steps=new ix(this._client)}create(t,e,n){const{include:s,...r}=e;return this._client.post(`/threads/${t}/runs`,{query:{include:s},body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:e.stream??!1})}retrieve(t,e,n){return this._client.get(`/threads/${t}/runs/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(t,e,n,s){return this._client.post(`/threads/${t}/runs/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(t,e={},n){return jn(e)?this.list(t,{},e):this._client.getAPIList(`/threads/${t}/runs`,ax,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(t,e,n){return this._client.post(`/threads/${t}/runs/${e}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(t,e,n){const s=await this.create(t,e,n);return await this.poll(t,s.id,n)}createAndStream(t,e,n){return Fr.createAssistantStream(t,this._client.beta.threads.runs,e,n)}async poll(t,e,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:r,response:u}=await this.retrieve(t,e,{...n,headers:{...n==null?void 0:n.headers,...s}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let h=5e3;if(n!=null&&n.pollIntervalMs)h=n.pollIntervalMs;else{const f=u.headers.get("openai-poll-after-ms");if(f){const p=parseInt(f);isNaN(p)||(h=p)}}await Lv(h);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(t,e,n){return Fr.createAssistantStream(t,this._client.beta.threads.runs,e,n)}submitToolOutputs(t,e,n,s){return this._client.post(`/threads/${t}/runs/${e}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(t,e,n,s){const r=await this.submitToolOutputs(t,e,n,s);return await this.poll(t,r.id,s)}submitToolOutputsStream(t,e,n,s){return Fr.createToolAssistantStream(t,e,this._client.beta.threads.runs,n,s)}};class ax extends Ri{}Fv.RunsPage=ax;Fv.Steps=ix;Fv.RunStepsPage=sx;class qm extends ue{constructor(){super(...arguments),this.runs=new Fv(this._client),this.messages=new ex(this._client)}create(t={},e){return jn(t)?this.create({},t):this._client.post("/threads",{body:t,...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers}})}retrieve(t,e){return this._client.get(`/threads/${t}`,{...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers}})}update(t,e,n){return this._client.post(`/threads/${t}`,{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(t,e){return this._client.delete(`/threads/${t}`,{...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers}})}createAndRun(t,e){return this._client.post("/threads/runs",{body:t,...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers},stream:t.stream??!1})}async createAndRunPoll(t,e){const n=await this.createAndRun(t,e);return await this.runs.poll(n.thread_id,n.id,e)}createAndRunStream(t,e){return Fr.createThreadAssistantStream(t,this._client.beta.threads,e)}}qm.Runs=Fv;qm.RunsPage=ax;qm.Messages=ex;qm.MessagesPage=nx;class Xm extends ue{constructor(){super(...arguments),this.realtime=new gA(this._client),this.chat=new c1(this._client),this.assistants=new QC(this._client),this.threads=new qm(this._client)}}Xm.Realtime=gA;Xm.Assistants=QC;Xm.AssistantsPage=JC;Xm.Threads=qm;class BN extends ue{create(t,e){return this._client.post("/completions",{body:t,...e,stream:t.stream??!1})}}class FN extends ue{retrieve(t,e,n){return this._client.get(`/containers/${t}/files/${e}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}}let yA=class extends ue{constructor(){super(...arguments),this.content=new FN(this._client)}create(t,e,n){return this._client.post(`/containers/${t}/files`,qd({body:e,...n}))}retrieve(t,e,n){return this._client.get(`/containers/${t}/files/${e}`,n)}list(t,e={},n){return jn(e)?this.list(t,{},e):this._client.getAPIList(`/containers/${t}/files`,rx,{query:e,...n})}del(t,e,n){return this._client.delete(`/containers/${t}/files/${e}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}};class rx extends Ri{}yA.FileListResponsesPage=rx;yA.Content=FN;class Uv extends ue{constructor(){super(...arguments),this.files=new yA(this._client)}create(t,e){return this._client.post("/containers",{body:t,...e})}retrieve(t,e){return this._client.get(`/containers/${t}`,e)}list(t={},e){return jn(t)?this.list({},t):this._client.getAPIList("/containers",ox,{query:t,...e})}del(t,e){return this._client.delete(`/containers/${t}`,{...e,headers:{Accept:"*/*",...e==null?void 0:e.headers}})}}class ox extends Ri{}Uv.ContainerListResponsesPage=ox;Uv.Files=yA;Uv.FileListResponsesPage=rx;class UN extends ue{create(t,e){const n=!!t.encoding_format;let s=n?t.encoding_format:"base64";n&&Fu("Request","User defined encoding_format:",t.encoding_format);const r=this._client.post("/embeddings",{body:{...t,encoding_format:s},...e});return n?r:(Fu("response","Decoding base64 embeddings to float32 array"),r._thenUnwrap(u=>(u&&u.data&&u.data.forEach(h=>{const f=h.embedding;h.embedding=VF(f)}),u)))}}class lx extends ue{retrieve(t,e,n,s){return this._client.get(`/evals/${t}/runs/${e}/output_items/${n}`,s)}list(t,e,n={},s){return jn(n)?this.list(t,e,{},n):this._client.getAPIList(`/evals/${t}/runs/${e}/output_items`,cx,{query:n,...s})}}class cx extends Ri{}lx.OutputItemListResponsesPage=cx;class zv extends ue{constructor(){super(...arguments),this.outputItems=new lx(this._client)}create(t,e,n){return this._client.post(`/evals/${t}/runs`,{body:e,...n})}retrieve(t,e,n){return this._client.get(`/evals/${t}/runs/${e}`,n)}list(t,e={},n){return jn(e)?this.list(t,{},e):this._client.getAPIList(`/evals/${t}/runs`,ux,{query:e,...n})}del(t,e,n){return this._client.delete(`/evals/${t}/runs/${e}`,n)}cancel(t,e,n){return this._client.post(`/evals/${t}/runs/${e}`,n)}}class ux extends Ri{}zv.RunListResponsesPage=ux;zv.OutputItems=lx;zv.OutputItemListResponsesPage=cx;class jv extends ue{constructor(){super(...arguments),this.runs=new zv(this._client)}create(t,e){return this._client.post("/evals",{body:t,...e})}retrieve(t,e){return this._client.get(`/evals/${t}`,e)}update(t,e,n){return this._client.post(`/evals/${t}`,{body:e,...n})}list(t={},e){return jn(t)?this.list({},t):this._client.getAPIList("/evals",hx,{query:t,...e})}del(t,e){return this._client.delete(`/evals/${t}`,e)}}class hx extends Ri{}jv.EvalListResponsesPage=hx;jv.Runs=zv;jv.RunListResponsesPage=ux;let dx=class extends ue{create(t,e){return this._client.post("/files",qd({body:t,...e}))}retrieve(t,e){return this._client.get(`/files/${t}`,e)}list(t={},e){return jn(t)?this.list({},t):this._client.getAPIList("/files",fx,{query:t,...e})}del(t,e){return this._client.delete(`/files/${t}`,e)}content(t,e){return this._client.get(`/files/${t}/content`,{...e,headers:{Accept:"application/binary",...e==null?void 0:e.headers},__binaryResponse:!0})}retrieveContent(t,e){return this._client.get(`/files/${t}/content`,e)}async waitForProcessing(t,{pollInterval:e=5e3,maxWait:n=1800*1e3}={}){const s=new Set(["processed","error","deleted"]),r=Date.now();let u=await this.retrieve(t);for(;!u.status||!s.has(u.status);)if(await Lv(e),u=await this.retrieve(t),Date.now()-r>n)throw new XC({message:`Giving up on waiting for file ${t} to finish processing after ${n} milliseconds.`});return u}};class fx extends Ri{}dx.FileObjectsPage=fx;class zN extends ue{}let jN=class extends ue{run(t,e){return this._client.post("/fine_tuning/alpha/graders/run",{body:t,...e})}validate(t,e){return this._client.post("/fine_tuning/alpha/graders/validate",{body:t,...e})}};class px extends ue{constructor(){super(...arguments),this.graders=new jN(this._client)}}px.Graders=jN;class mx extends ue{create(t,e,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${t}/permissions`,gx,{body:e,method:"post",...n})}retrieve(t,e={},n){return jn(e)?this.retrieve(t,{},e):this._client.get(`/fine_tuning/checkpoints/${t}/permissions`,{query:e,...n})}del(t,e,n){return this._client.delete(`/fine_tuning/checkpoints/${t}/permissions/${e}`,n)}}class gx extends dA{}mx.PermissionCreateResponsesPage=gx;let bA=class extends ue{constructor(){super(...arguments),this.permissions=new mx(this._client)}};bA.Permissions=mx;bA.PermissionCreateResponsesPage=gx;class yx extends ue{list(t,e={},n){return jn(e)?this.list(t,{},e):this._client.getAPIList(`/fine_tuning/jobs/${t}/checkpoints`,bx,{query:e,...n})}}class bx extends Ri{}yx.FineTuningJobCheckpointsPage=bx;class Ym extends ue{constructor(){super(...arguments),this.checkpoints=new yx(this._client)}create(t,e){return this._client.post("/fine_tuning/jobs",{body:t,...e})}retrieve(t,e){return this._client.get(`/fine_tuning/jobs/${t}`,e)}list(t={},e){return jn(t)?this.list({},t):this._client.getAPIList("/fine_tuning/jobs",vx,{query:t,...e})}cancel(t,e){return this._client.post(`/fine_tuning/jobs/${t}/cancel`,e)}listEvents(t,e={},n){return jn(e)?this.listEvents(t,{},e):this._client.getAPIList(`/fine_tuning/jobs/${t}/events`,wx,{query:e,...n})}pause(t,e){return this._client.post(`/fine_tuning/jobs/${t}/pause`,e)}resume(t,e){return this._client.post(`/fine_tuning/jobs/${t}/resume`,e)}}class vx extends Ri{}class wx extends Ri{}Ym.FineTuningJobsPage=vx;Ym.FineTuningJobEventsPage=wx;Ym.Checkpoints=yx;Ym.FineTuningJobCheckpointsPage=bx;class Hu extends ue{constructor(){super(...arguments),this.methods=new zN(this._client),this.jobs=new Ym(this._client),this.checkpoints=new bA(this._client),this.alpha=new px(this._client)}}Hu.Methods=zN;Hu.Jobs=Ym;Hu.FineTuningJobsPage=vx;Hu.FineTuningJobEventsPage=wx;Hu.Checkpoints=bA;Hu.Alpha=px;class HN extends ue{}class _x extends ue{constructor(){super(...arguments),this.graderModels=new HN(this._client)}}_x.GraderModels=HN;class $N extends ue{createVariation(t,e){return this._client.post("/images/variations",qd({body:t,...e}))}edit(t,e){return this._client.post("/images/edits",qd({body:t,...e}))}generate(t,e){return this._client.post("/images/generations",{body:t,...e})}}class Ax extends ue{retrieve(t,e){return this._client.get(`/models/${t}`,e)}list(t){return this._client.getAPIList("/models",Sx,t)}del(t,e){return this._client.delete(`/models/${t}`,e)}}class Sx extends dA{}Ax.ModelsPage=Sx;class VN extends ue{create(t,e){return this._client.post("/moderations",{body:t,...e})}}function i3(l,t){return!t||!a3(t)?{...l,output_parsed:null,output:l.output.map(e=>e.type==="function_call"?{...e,parsed_arguments:null}:e.type==="message"?{...e,content:e.content.map(n=>({...n,parsed:null}))}:e)}:GN(l,t)}function GN(l,t){const e=l.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:l3(t,s)};if(s.type==="message"){const r=s.content.map(u=>u.type==="output_text"?{...u,parsed:s3(t,u.text)}:u);return{...s,content:r}}return s}),n=Object.assign({},l,{output:e});return Object.getOwnPropertyDescriptor(l,"output_text")||qN(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const s of n.output)if(s.type==="message"){for(const r of s.content)if(r.type==="output_text"&&r.parsed!==null)return r.parsed}return null}}),n}function s3(l,t){var e,n,s,r;return((n=(e=l.text)==null?void 0:e.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((s=l.text)==null?void 0:s.format)?((r=l.text)==null?void 0:r.format).$parseRaw(t):JSON.parse(t)}function a3(l){var t;return!!ZC((t=l.text)==null?void 0:t.format)}function r3(l){return(l==null?void 0:l.$brand)==="auto-parseable-tool"}function o3(l,t){return l.find(e=>e.type==="function"&&e.name===t)}function l3(l,t){const e=o3(l.tools??[],t.name);return{...t,...t,parsed_arguments:r3(e)?e.$parseRaw(t.arguments):e!=null&&e.strict?JSON.parse(t.arguments):null}}function qN(l){const t=[];for(const e of l.output)if(e.type==="message")for(const n of e.content)n.type==="output_text"&&t.push(n.text);l.output_text=t.join("")}class XN extends ue{list(t,e={},n){return jn(e)?this.list(t,{},e):this._client.getAPIList(`/responses/${t}/input_items`,u3,{query:e,...n})}}var Xf=function(l,t,e,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?l!==t||!s:!t.has(l))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(l,e):s?s.value=e:t.set(l,e),e},Vc=function(l,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?l!==t||!n:!t.has(l))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(l):n?n.value:t.get(l)},Yf,yw,Gc,bw,MD,ND,kD,PD;class Ex extends WC{constructor(t){super(),Yf.add(this),yw.set(this,void 0),Gc.set(this,void 0),bw.set(this,void 0),Xf(this,yw,t,"f")}static createResponse(t,e,n){const s=new Ex(e);return s._run(()=>s._createOrRetrieveResponse(t,e,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(t,e,n){var h;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Vc(this,Yf,"m",MD).call(this);let r,u=null;"response_id"in e?(r=await t.responses.retrieve(e.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),u=e.starting_after??null):r=await t.responses.create({...e,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const f of r)Vc(this,Yf,"m",ND).call(this,f,u);if((h=r.controller.signal)!=null&&h.aborted)throw new ur;return Vc(this,Yf,"m",kD).call(this)}[(yw=new WeakMap,Gc=new WeakMap,bw=new WeakMap,Yf=new WeakSet,MD=function(){this.ended||Xf(this,Gc,void 0,"f")},ND=function(e,n){if(this.ended)return;const s=(u,h)=>{(n==null||h.sequence_number>n)&&this._emit(u,h)},r=Vc(this,Yf,"m",PD).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{const u=r.output[e.output_index];if(!u)throw new le(`missing output at index ${e.output_index}`);if(u.type==="message"){const h=u.content[e.content_index];if(!h)throw new le(`missing content at index ${e.content_index}`);if(h.type!=="output_text")throw new le(`expected content to be 'output_text', got ${h.type}`);s("response.output_text.delta",{...e,snapshot:h.text})}break}case"response.function_call_arguments.delta":{const u=r.output[e.output_index];if(!u)throw new le(`missing output at index ${e.output_index}`);u.type==="function_call"&&s("response.function_call_arguments.delta",{...e,snapshot:u.arguments});break}default:s(e.type,e);break}},kD=function(){if(this.ended)throw new le("stream has ended, this shouldn't happen");const e=Vc(this,Gc,"f");if(!e)throw new le("request ended without sending any events");Xf(this,Gc,void 0,"f");const n=c3(e,Vc(this,yw,"f"));return Xf(this,bw,n,"f"),n},PD=function(e){let n=Vc(this,Gc,"f");if(!n){if(e.type!=="response.created")throw new le(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return n=Xf(this,Gc,e.response,"f"),n}switch(e.type){case"response.output_item.added":{n.output.push(e.item);break}case"response.content_part.added":{const s=n.output[e.output_index];if(!s)throw new le(`missing output at index ${e.output_index}`);s.type==="message"&&s.content.push(e.part);break}case"response.output_text.delta":{const s=n.output[e.output_index];if(!s)throw new le(`missing output at index ${e.output_index}`);if(s.type==="message"){const r=s.content[e.content_index];if(!r)throw new le(`missing content at index ${e.content_index}`);if(r.type!=="output_text")throw new le(`expected content to be 'output_text', got ${r.type}`);r.text+=e.delta}break}case"response.function_call_arguments.delta":{const s=n.output[e.output_index];if(!s)throw new le(`missing output at index ${e.output_index}`);s.type==="function_call"&&(s.arguments+=e.delta);break}case"response.completed":{Xf(this,Gc,e.response,"f");break}}return n},Symbol.asyncIterator)](){const t=[],e=[];let n=!1;return this.on("event",s=>{const r=e.shift();r?r.resolve(s):t.push(s)}),this.on("end",()=>{n=!0;for(const s of e)s.resolve(void 0);e.length=0}),this.on("abort",s=>{n=!0;for(const r of e)r.reject(s);e.length=0}),this.on("error",s=>{n=!0;for(const r of e)r.reject(s);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((r,u)=>e.push({resolve:r,reject:u})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const t=Vc(this,bw,"f");if(!t)throw new le("stream ended without producing a ChatCompletion");return t}}function c3(l,t){return i3(l,t)}class Cx extends ue{constructor(){super(...arguments),this.inputItems=new XN(this._client)}create(t,e){return this._client.post("/responses",{body:t,...e,stream:t.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&qN(n),n))}retrieve(t,e={},n){return this._client.get(`/responses/${t}`,{query:e,...n,stream:(e==null?void 0:e.stream)??!1})}del(t,e){return this._client.delete(`/responses/${t}`,{...e,headers:{Accept:"*/*",...e==null?void 0:e.headers}})}parse(t,e){return this._client.responses.create(t,e)._thenUnwrap(n=>GN(n,t))}stream(t,e){return Ex.createResponse(this._client,t,e)}cancel(t,e){return this._client.post(`/responses/${t}/cancel`,{...e,headers:{Accept:"*/*",...e==null?void 0:e.headers}})}}class u3 extends Ri{}Cx.InputItems=XN;class YN extends ue{create(t,e,n){return this._client.post(`/uploads/${t}/parts`,qd({body:e,...n}))}}class xx extends ue{constructor(){super(...arguments),this.parts=new YN(this._client)}create(t,e){return this._client.post("/uploads",{body:t,...e})}cancel(t,e){return this._client.post(`/uploads/${t}/cancel`,e)}complete(t,e,n){return this._client.post(`/uploads/${t}/complete`,{body:e,...n})}}xx.Parts=YN;const h3=async l=>{const t=await Promise.allSettled(l),e=t.filter(s=>s.status==="rejected");if(e.length){for(const s of e)console.error(s.reason);throw new Error(`${e.length} promise(s) failed - see the above errors`)}const n=[];for(const s of t)s.status==="fulfilled"&&n.push(s.value);return n};class vA extends ue{create(t,e,n){return this._client.post(`/vector_stores/${t}/files`,{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(t,e,n){return this._client.get(`/vector_stores/${t}/files/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(t,e,n,s){return this._client.post(`/vector_stores/${t}/files/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(t,e={},n){return jn(e)?this.list(t,{},e):this._client.getAPIList(`/vector_stores/${t}/files`,wA,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(t,e,n){return this._client.delete(`/vector_stores/${t}/files/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(t,e,n){const s=await this.create(t,e,n);return await this.poll(t,s.id,n)}async poll(t,e,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const r=await this.retrieve(t,e,{...n,headers:s}).withResponse(),u=r.data;switch(u.status){case"in_progress":let h=5e3;if(n!=null&&n.pollIntervalMs)h=n.pollIntervalMs;else{const f=r.response.headers.get("openai-poll-after-ms");if(f){const p=parseInt(f);isNaN(p)||(h=p)}}await Lv(h);break;case"failed":case"completed":return u}}}async upload(t,e,n){const s=await this._client.files.create({file:e,purpose:"assistants"},n);return this.create(t,{file_id:s.id},n)}async uploadAndPoll(t,e,n){const s=await this.upload(t,e,n);return await this.poll(t,s.id,n)}content(t,e,n){return this._client.getAPIList(`/vector_stores/${t}/files/${e}/content`,Tx,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class wA extends Ri{}class Tx extends dA{}vA.VectorStoreFilesPage=wA;vA.FileContentResponsesPage=Tx;class KN extends ue{create(t,e,n){return this._client.post(`/vector_stores/${t}/file_batches`,{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(t,e,n){return this._client.get(`/vector_stores/${t}/file_batches/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(t,e,n){return this._client.post(`/vector_stores/${t}/file_batches/${e}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(t,e,n){const s=await this.create(t,e);return await this.poll(t,s.id,n)}listFiles(t,e,n={},s){return jn(n)?this.listFiles(t,e,{},n):this._client.getAPIList(`/vector_stores/${t}/file_batches/${e}/files`,wA,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(t,e,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:r,response:u}=await this.retrieve(t,e,{...n,headers:s}).withResponse();switch(r.status){case"in_progress":let h=5e3;if(n!=null&&n.pollIntervalMs)h=n.pollIntervalMs;else{const f=u.headers.get("openai-poll-after-ms");if(f){const p=parseInt(f);isNaN(p)||(h=p)}}await Lv(h);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(t,{files:e,fileIds:n=[]},s){if(e==null||e.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const r=(s==null?void 0:s.maxConcurrency)??5,u=Math.min(r,e.length),h=this._client,f=e.values(),p=[...n];async function m(_){for(let S of _){const R=await h.files.create({file:S,purpose:"assistants"},s);p.push(R.id)}}const b=Array(u).fill(f).map(m);return await h3(b),await this.createAndPoll(t,{file_ids:p})}}class $u extends ue{constructor(){super(...arguments),this.files=new vA(this._client),this.fileBatches=new KN(this._client)}create(t,e){return this._client.post("/vector_stores",{body:t,...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers}})}retrieve(t,e){return this._client.get(`/vector_stores/${t}`,{...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers}})}update(t,e,n){return this._client.post(`/vector_stores/${t}`,{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(t={},e){return jn(t)?this.list({},t):this._client.getAPIList("/vector_stores",Rx,{query:t,...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers}})}del(t,e){return this._client.delete(`/vector_stores/${t}`,{...e,headers:{"OpenAI-Beta":"assistants=v2",...e==null?void 0:e.headers}})}search(t,e,n){return this._client.getAPIList(`/vector_stores/${t}/search`,Ox,{body:e,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Rx extends Ri{}class Ox extends dA{}$u.VectorStoresPage=Rx;$u.VectorStoreSearchResponsesPage=Ox;$u.Files=vA;$u.VectorStoreFilesPage=wA;$u.FileContentResponsesPage=Tx;$u.FileBatches=KN;var WN;class ye extends NF{constructor({baseURL:t=dw("OPENAI_BASE_URL"),apiKey:e=dw("OPENAI_API_KEY"),organization:n=dw("OPENAI_ORG_ID")??null,project:s=dw("OPENAI_PROJECT_ID")??null,...r}={}){if(e===void 0)throw new le("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const u={apiKey:e,organization:n,project:s,...r,baseURL:t||"https://api.openai.com/v1"};if(!u.dangerouslyAllowBrowser&&HF())throw new le(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:u.baseURL,timeout:u.timeout??6e5,httpAgent:u.httpAgent,maxRetries:u.maxRetries,fetch:u.fetch}),this.completions=new BN(this),this.chat=new mA(this),this.embeddings=new UN(this),this.files=new dx(this),this.images=new $N(this),this.audio=new Iv(this),this.moderations=new VN(this),this.models=new Ax(this),this.fineTuning=new Hu(this),this.graders=new _x(this),this.vectorStores=new $u(this),this.beta=new Xm(this),this.batches=new YC(this),this.uploads=new xx(this),this.responses=new Cx(this),this.evals=new jv(this),this.containers=new Uv(this),this._options=u,this.apiKey=e,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(t){return{...super.defaultHeaders(t),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(t){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(t){return pF(t,{arrayFormat:"brackets"})}}WN=ye;ye.OpenAI=WN;ye.DEFAULT_TIMEOUT=6e5;ye.OpenAIError=le;ye.APIError=rs;ye.APIConnectionError=lA;ye.APIConnectionTimeoutError=XC;ye.APIUserAbortError=ur;ye.NotFoundError=YM;ye.ConflictError=KM;ye.RateLimitError=QM;ye.BadRequestError=GM;ye.AuthenticationError=qM;ye.InternalServerError=JM;ye.PermissionDeniedError=XM;ye.UnprocessableEntityError=WM;ye.toFile=sN;ye.fileFromPath=HM;ye.Completions=BN;ye.Chat=mA;ye.ChatCompletionsPage=pA;ye.Embeddings=UN;ye.Files=dx;ye.FileObjectsPage=fx;ye.Images=$N;ye.Audio=Iv;ye.Moderations=VN;ye.Models=Ax;ye.ModelsPage=Sx;ye.FineTuning=Hu;ye.Graders=_x;ye.VectorStores=$u;ye.VectorStoresPage=Rx;ye.VectorStoreSearchResponsesPage=Ox;ye.Beta=Xm;ye.Batches=YC;ye.BatchesPage=KC;ye.Uploads=xx;ye.Responses=Cx;ye.Evals=jv;ye.EvalListResponsesPage=hx;ye.Containers=Uv;ye.ContainerListResponsesPage=ox;let vw=null;const u1=async()=>vw||(vw=new ye({apiKey:"proxy-mode",baseURL:"/api/ai/proxy-openai-adapter",dangerouslyAllowBrowser:!0,fetch:async(l,t)=>{const e=`Bearer ${localStorage.getItem("auth_token")}`;let n={};t!=null&&t.body&&(n=JSON.parse(t.body));const r=await(await fetch("/api/ai/chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:e},body:JSON.stringify({messages:n.messages,model:n.model})})).json();return new Response(JSON.stringify({id:"chatcmpl-proxy",object:"chat.completion",created:Date.now(),model:n.model,choices:[{index:0,message:r,finish_reason:"stop"}],usage:{prompt_tokens:0,completion_tokens:0,total_tokens:0}}),{status:200,headers:{"Content-Type":"application/json"}})}}),vw),d3=()=>!0,QN={AUDITOR:"gpt-4o",CHAT:"gpt-4o-mini",STRATEGIST:"gpt-4o",VISION:"gpt-4o"},JN={async getAll(){const l=localStorage.getItem("auth_token"),t=await fetch(`${de}/admin/agents`,{headers:{Authorization:`Bearer ${l}`}});if(!t.ok)throw new Error("Falha ao carregar agentes");return t.json()},async update(l,t){const e=localStorage.getItem("auth_token"),n=await fetch(`${de}/admin/agents/${l}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(t)});if(!n.ok){const s=await n.json();throw new Error(s.error||"Falha ao atualizar agente")}},async getPrompt(l){const t=localStorage.getItem("auth_token"),e=await fetch(`${de}/agents/prompt/${l}`,{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Falha ao carregar prompt do agente");return e.json()}},Hs={NIF:{PATTERN:/^\d{10}$/},IVA:{STANDARD_RATE:.14,REDUCED_RATE:.05,EXEMPT_CATEGORIES:["SAUDE","EDUCACAO","EXPORTACAO"]},WITHHOLDING:{SERVICES_RATE:.065,RENTAL_RATE:.15,CATEGORIES:["SERVICOS_PROFISSIONAIS","ALUGUEL","CONSULTORIA"]},DATE:{MAX_PAST_YEARS:5},AMOUNTS:{MAX_VARIANCE:1}},ZN=`Voc  o **Auditor Fiscal Forense KwikDocs**, certificado em legislao tributria angolana (AGT, CIVA, Imposto Industrial).

**MISSO PRIMRIA:**
Proteger a empresa de riscos fiscais atravs de auditoria rigorosa, identificando irregularidades com preciso cirrgica e fornecendo solues acionveis.

**PROTOCOLO DE AUDITORIA FORENSE (Chain-of-Thought):**

### 1 VALIDAO ESTRUTURAL
-  Tipo de documento vlido? (Fatura, Recibo, FR, Nota Crdito/Dbito)
-  Campos obrigatrios presentes? (NIF, Data, Totais, Itens)
-  Qualidade dos dados extrados (OCR confivel?)

### 2 VALIDAO DE NIF (CRTICO)
**Regras Angola:**
- Exatamente 10 dgitos numricos
- Primeiro dgito: 5 (pessoa jurdica) ou 2-4 (pessoa fsica)
- Obrigatrio em: Faturas, FR, Notas Fiscais
- Opcional em: Recibos simples < 50.000 AOA

**Verificaes:**
\`\`\`
NIF Emitente: OBRIGATRIO sempre
NIF Comprador: OBRIGATRIO se valor > 50.000 AOA
    \`\`\`

### 3 ANLISE MATEMTICA RIGOROSA
**Frmulas:**
\`\`\`
Base Tributvel = Soma(item.preo * item.qtd) - Descontos
IVA Calculado = Base Tributvel  Taxa IVA
Total Final = Base Tributvel + IVA
    \`\`\`

**Tolerncias:**
- Variao  1 AOA  APROVADO (arredondamento)
- Variao > 1 AOA  REJEITADO (erro de clculo)

**Validaes Cruzadas:**
- Se IVA = 0  Verificar se categoria  isenta
- Se Base + IVA  Total  REJEITAR
- Se itens no batem com total  REVISAR

### 4 COMPLIANCE FISCAL ANGOLA

**IVA (Cdigo do IVA - CIVA):**
- Taxa padro: 14%
- Taxa reduzida: 5% (alimentao bsica, medicamentos)
- Isentos: Sade, Educao, Exportao

**Reteno na Fonte (Art. 63 Cdigo do IR):**
- Servios Profissionais: 6,5%
- Aluguis: 15%
- Threshold: Todas as transaes (sem mnimo)
- Categorias obrigatrias: Consultoria, Honorrios, Rent

**Prazos (AGT):**
- Entrega mensal: At dia 15 do ms seguinte
- Pagamento IVA: At dia 10 do ms seguinte

### 5 ANLISE DE RISCO (Score 0-100)

**Matriz de Pontuao:**
\`\`\`
100 pontos  SEM PROBLEMAS
90 - 99  Pequenas inconsistncias(aprovar com observao)
70 - 89  Problemas mdios(revisar)
50 - 69  Problemas graves(pendente)
0 - 49  Erros crticos(rejeitar)
    \`\`\`

**Fatores de Risco (-pontos):**
- NIF ausente/invlido: -40 pontos
- Erro de clculo > 1% do total: -30 pontos
- Data invlida/futura: -20 pontos
- Reteno ausente quando obrigatria: -25 pontos
- Campos crticos vazios: -15 pontos cada
- OCR de baixa qualidade: -10 pontos

### 6 CLASSIFICAO INTELIGENTE

**Categorias Fiscais Angola:**
- COMBUSTIVEL, ALIMENTACAO, TRANSPORTE
- SERVICOS_PROFISSIONAIS (reteno obrigatria)
- ALUGUEL (reteno 15%)
- MATERIAL_ESCRITORIO, MANUTENCAO
- TELECOMUNICACOES, UTILITIES

**Regras de Categorizao:**
- Fornecedor conhecido  usar histrico
- Palavras-chave nos itens  match semntico
- Valor tpico da categoria

### 7 DECISO FINAL

**APROVADO:**
- Risk Score  90
- Nenhum problema CRTICO
- Compliance 100%

**REVISAR:**
- Risk Score 70-89
- Problemas MDIOS detectados
- Necessita confirmao humana

**PENDENTE:**
- Risk Score 50-69
- Problemas GRAVES
- Dados insuficientes

**REJEITADO:**
- Risk Score < 50
- Problemas CRTICOS
- No conformidade legal

**FORMATO DE SADA (JSON):**
Retorne APENAS JSON vlido seguindo esta estrutura:
{
  "status": "APROVADO|REJEITADO|PENDENTE|REVISAR",
  "risk_score": <0-100>,
  "confidence_level": <0-100>,
  "issues": [
    {
      "severity": "CRITICO|ALTO|MEDIO|BAIXO",
      "type": "NIF_INVALIDO|CALCULO_ERRADO|...",
      "field": "campo_afetado",
      "description": "Descrio tcnica do problema",
      "legal_reference": "Art. X do CIVA",
      "financial_impact": 12345.67,
      "action_required": "Ao especfica a tomar",
      "deadline": "2026-02-15"
    }
  ],
  "tax_analysis": {
    "iva_correct": true,
    "iva_calculated": 14000,
    "iva_expected": 14000,
    "iva_variance": 0,
    "base_correct": true,
    "base_taxable": 100000,
    "withholding_needed": false,
    "withholding_rate": 0,
    "withholding_amount": 0,
    "tax_regime": "GERAL",
    "deductible": true
  },
  "category_suggestion": "COMBUSTIVEL",
  "justification": "Documento aprovado. Todos os clculos corretos e NIF vlido.",
  "recommendations": [
    "Arquivar cpia fsica por 10 anos",
    "Incluir no clculo de IVA dedutvel"
  ]
}`;class f3{constructor(){this.auditHistory=new Map,this.VERSION="2.0.0"}validateDocumentStructure(t){const e=["merchantName","totalAmount","date"],n=e.filter(u=>!t[u]||t[u]===""),s=e.filter(u=>t[u]).length,r=Math.round(s/e.length*100);return{is_valid_format:n.length===0,is_complete:n.length===0,missing_fields:n,data_quality_score:r}}validateNIF(t,e){if(!t)return{severity:"CRITICO",type:"NIF_INVALIDO",field:"issuer_data.nif",description:`NIF do ${e} ausente. Obrigatrio para deduo fiscal.`,legal_reference:"Art. 36 CIVA",financial_impact:0,action_required:"Solicitar fatura corrigida com NIF vlido",deadline:this.calculateDeadline(30)};const n=t.replace(/\D/g,"");if(!Hs.NIF.PATTERN.test(n))return{severity:"CRITICO",type:"NIF_INVALIDO",field:"issuer_data.nif",description:`NIF "${t}" invlido. Deve ter exatamente 10 dgitos.`,legal_reference:"Art. 36 CIVA",financial_impact:0,action_required:"Verificar NIF com fornecedor e solicitar correo",deadline:this.calculateDeadline(15)};const s=n[0];return["2","3","4","5"].includes(s)?null:{severity:"ALTO",type:"NIF_INVALIDO",field:"issuer_data.nif",description:`NIF "${n}" com formato atpico. Primeiro dgito deve ser 2-5.`,legal_reference:"Padro AGT",action_required:"Validar NIF no portal da AGT",deadline:this.calculateDeadline(7)}}validateTaxCalculations(t){var S;const e=[],n=t.totalAmount||0,s=t.iva||0,r=this.determineIVARate(t.category);let u,h;s>0?(u=n/(1+r),h=n-u):(u=n,h=0);const f=Math.abs(s-h);let p=f<=Hs.AMOUNTS.MAX_VARIANCE;!p&&s>0&&e.push({severity:"ALTO",type:"CALCULO_ERRADO",field:"iva",description:`IVA declarado (${this.formatCurrency(s)}) difere do esperado (${this.formatCurrency(h)}). Variao: ${this.formatCurrency(f)}.`,legal_reference:"Art. 18 CIVA",financial_impact:f,action_required:"Solicitar nota de correo ao fornecedor",deadline:this.calculateDeadline(15)}),Hs.IVA.EXEMPT_CATEGORIES.includes(((S=t.category)==null?void 0:S.toUpperCase())||"")&&s>0&&e.push({severity:"MEDIO",type:"CALCULO_ERRADO",field:"category",description:`Categoria "${t.category}" isenta de IVA, mas documento declara ${this.formatCurrency(s)}.`,legal_reference:"Art. 9 CIVA",action_required:"Verificar classificao fiscal correta",deadline:this.calculateDeadline(20)});const b=this.calculateWithholding(t),_={iva_correct:p,iva_calculated:s,iva_expected:Math.round(h*100)/100,iva_variance:Math.round(f*100)/100,base_correct:Math.abs(u-(n-s))<=Hs.AMOUNTS.MAX_VARIANCE,base_taxable:Math.round(u*100)/100,withholding_needed:b.needed,withholding_rate:b.rate,withholding_amount:b.amount,tax_regime:this.determineTaxRegime(t),deductible:this.isDeductible(t)};return b.needed&&!b.applied&&e.push({severity:"CRITICO",type:"RETENCAO_AUSENTE",field:"withholding",description:`Reteno na fonte obrigatria no aplicada. Taxa: ${b.rate*100}%. Valor: ${this.formatCurrency(b.amount)}.`,legal_reference:"Art. 63 Cdigo do IR",financial_impact:b.amount,action_required:"Aplicar reteno e emitir comprovante",deadline:this.calculateDeadline(5)}),{tax_analysis:_,issues:e}}determineIVARate(t){const e=["ALIMENTACAO","SAUDE_BASICA"];return t?Hs.IVA.EXEMPT_CATEGORIES.includes(t.toUpperCase())?0:e.some(n=>t.toUpperCase().includes(n))?Hs.IVA.REDUCED_RATE:Hs.IVA.STANDARD_RATE:Hs.IVA.STANDARD_RATE}calculateWithholding(t){var f;const e=((f=t.category)==null?void 0:f.toUpperCase())||"",n=t.totalAmount||0;let s=0,r=!1;Hs.WITHHOLDING.CATEGORIES.some(p=>e.includes(p))&&(r=!0,e.includes("ALUGUEL")||e.includes("RENT")?s=Hs.WITHHOLDING.RENTAL_RATE:s=Hs.WITHHOLDING.SERVICES_RATE);const u=r?Math.round(n*s*100)/100:0,h=t.withholding_applied||!1;return{needed:r,rate:s,amount:u,applied:h}}determineTaxRegime(t){var n;const e=t.totalAmount||0;return Hs.IVA.EXEMPT_CATEGORIES.includes(((n=t.category)==null?void 0:n.toUpperCase())||"")?"ISENTO":e<5e4?"SIMPLIFICADO":"GERAL"}isDeductible(t){var n,s;return!(!((n=t.issuer_data)!=null&&n.nif)||["COMBUSTIVEL_PESSOAL","ENTRETENIMENTO","MULTAS"].includes(((s=t.category)==null?void 0:s.toUpperCase())||""))}validateDate(t){if(!t)return{severity:"ALTO",type:"DATA_INVALIDA",field:"date",description:"Data do documento ausente.",action_required:"Solicitar documento com data vlida",deadline:this.calculateDeadline(7)};const e=new Date(t),s=(new Date().getTime()-e.getTime())/(1e3*60*60*24);return s<-5?{severity:"ALTO",type:"DATA_INVALIDA",field:"date",description:`Data do documento no futuro: ${this.formatDate(t)}.`,action_required:"Verificar data com fornecedor",deadline:this.calculateDeadline(3)}:s>Hs.DATE.MAX_PAST_YEARS*365?{severity:"MEDIO",type:"DATA_INVALIDA",field:"date",description:`Documento com mais de ${Hs.DATE.MAX_PAST_YEARS} anos: ${this.formatDate(t)}.`,action_required:"Verificar se documento ainda  vlido fiscalmente",deadline:this.calculateDeadline(10)}:null}calculateRiskScore(t,e){let n=100;return n-=(100-t.data_quality_score)*.3,e.forEach(s=>{switch(s.severity){case"CRITICO":n-=40;break;case"ALTO":n-=25;break;case"MEDIO":n-=15;break;case"BAIXO":n-=5;break}}),Math.max(0,Math.min(100,Math.round(n)))}determineStatus(t,e){return e.some(s=>s.severity==="CRITICO")||t<50?"REJEITADO":t>=90?"APROVADO":t>=70?"REVISAR":"PENDENTE"}generateRecommendations(t,e){const n=[];return n.push("Arquivar cpia digital e fsica por 10 anos (Art. 123 CGT)"),t.length===0?(n.push("Documento conforme - incluir no clculo de IVA dedutvel mensal"),n.push("Registrar no livro de compras at dia 15 do ms seguinte")):(t.filter(r=>r.severity==="CRITICO").length>0&&(n.push(" NO processar pagamento at correo dos problemas crticos"),n.push("Contactar fornecedor imediatamente para emisso de documento correto")),t.some(r=>r.type==="NIF_INVALIDO")&&n.push("IVA no dedutvel sem NIF vlido - impacto fiscal direto"),t.some(r=>r.type==="RETENCAO_AUSENTE")&&n.push("Aplicar reteno antes do pagamento e emitir comprovante (Mod. 19 AGT)")),n}async auditDocument(t,e){var r;const n=Date.now(),s=this.generateAuditId();try{const u=this.validateDocumentStructure(t);if(!u.is_complete)return this.generateIncompleteDocumentResult(u,s,n);const h=[],f=this.validateNIF((r=t.issuer_data)==null?void 0:r.nif,"emitente");f&&h.push(f);const p=this.validateDate(t.date);p&&h.push(p);const{tax_analysis:m,issues:b}=this.validateTaxCalculations(t);h.push(...b);const _=this.calculateRiskScore(u,h),S=this.determineStatus(_,h);let R=null;(S==="REVISAR"||S==="PENDENTE")&&(R=await this.getLLMEnhancement(t,h,e));const C={status:S,risk_score:_,confidence_level:u.data_quality_score,issues:R!=null&&R.additional_issues?[...h,...R.additional_issues]:h,tax_analysis:m,category_suggestion:(R==null?void 0:R.suggested_category)||t.category||"GERAL",justification:(R==null?void 0:R.justification)||this.generateJustification(S,h),recommendations:this.generateRecommendations(h,t),audit_metadata:{audit_id:s,timestamp:new Date().toISOString(),auditor_version:this.VERSION,processing_time_ms:Date.now()-n,ocr_quality:this.assessOCRQuality(t),manual_review_required:S==="REVISAR"||S==="PENDENTE",previous_audits_count:this.getAuditHistoryCount(t.merchantName)}};return this.addToHistory(t.merchantName||"UNKNOWN",C),C}catch(u){return console.error("[AUDITOR] Erro crtico:",u),this.generateErrorResult(u,s,n)}}async getLLMEnhancement(t,e,n){try{const s=await u1(),r=await JN.getPrompt("auditor"),u=n||r.prompt_text||ZN,h=r.model_override||QN.AUDITOR,f=`
DOCUMENTO ANALISADO:
${JSON.stringify(t,null,2)}

ISSUES J IDENTIFICADOS:
${JSON.stringify(e,null,2)}

TAREFA: Fornea anlise adicional focando em:
1. Categorizao fiscal correta
2. Issues no detectados automaticamente
3. Justificativa tcnica detalhada

Retorne JSON:
{
  "suggested_category": "...",
  "additional_issues": [...]
}
\`\`\`;
`,m=(await s.chat.completions.create({model:h,messages:[{role:"system",content:u},{role:"user",content:f}],response_format:{type:"json_object"},temperature:r.temperature??.1})).choices[0].message.content;return m?JSON.parse(m):null}catch(s){return console.error("[AUDITOR] Falha no enriquecimento LLM:",s),null}}generateAuditId(){return`AUD-${Date.now()}-${Math.random().toString(36).substr(2,9).toUpperCase()}`}calculateDeadline(t){const e=new Date;return e.setDate(e.getDate()+t),e.toISOString().split("T")[0]}formatCurrency(t){return new Intl.NumberFormat("pt-AO",{style:"currency",currency:"AOA"}).format(t)}formatDate(t){return new Date(t).toLocaleDateString("pt-PT")}assessOCRQuality(t){const e=Object.keys(t).length,s=Object.values(t).filter(r=>r!==null&&r!=="").length/e;return s>.8?"ALTA":s>.5?"MEDIA":"BAIXA"}getAuditHistoryCount(t){var e;return t&&((e=this.auditHistory.get(t))==null?void 0:e.length)||0}generateJustification(t,e){if(t==="APROVADO")return"Documento aprovado automaticamente. Nenhuma inconsistncia crtica detectada.";const n=e.filter(r=>r.severity==="CRITICO").length,s=e.filter(r=>r.severity==="ALTO").length;return`Documento ${t}. Detectados ${n} erros crticos e ${s} erros de alta severidade.`}generateIncompleteDocumentResult(t,e,n){return{status:"REJEITADO",risk_score:0,confidence_level:0,issues:[{severity:"CRITICO",type:"FORMATO_INVALIDO",field:"general",description:"Documento incompleto ou ilegvel.",action_required:"Reenviar documento com melhor qualidade."}],tax_analysis:{iva_correct:!1,base_correct:!1,withholding_needed:!1,deductible:!1},category_suggestion:"INDEFINIDO",justification:"Falha na validao estrutural.",recommendations:["Reenviar imagem"],audit_metadata:{audit_id:e,timestamp:new Date().toISOString(),auditor_version:this.VERSION,processing_time_ms:Date.now()-n,ocr_quality:"BAIXA",manual_review_required:!0,previous_audits_count:0}}}generateErrorResult(t,e,n){return{status:"PENDENTE",risk_score:0,confidence_level:0,issues:[{severity:"ALTO",type:"OUTRO",field:"system",description:`Erro interno: ${t.message}`,action_required:"Contactar suporte."}],tax_analysis:{iva_correct:!1,base_correct:!1,withholding_needed:!1,deductible:!1},category_suggestion:"ERRO",justification:"Erro no processamento.",recommendations:[],audit_metadata:{audit_id:e,timestamp:new Date().toISOString(),auditor_version:this.VERSION,processing_time_ms:Date.now()-n,manual_review_required:!0}}}addToHistory(t,e){const n=this.auditHistory.get(t)||[];n.push(e),n.length>10&&n.shift(),this.auditHistory.set(t,n)}}const p3=new f3,Ds=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),h1=[.001,0,0,.001,0,0],zE=1.35,Na={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Xc={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},By="pdfjs_internal_editor_",ve={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Fe={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},m3={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},d1={TRIANGLES:1,LATTICE:2},wi={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Uw={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},hi={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Zf={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},_A={ERRORS:0,WARNINGS:1,INFOS:5},Fy={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},ty={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},g3={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let AA=_A.WARNINGS;function y3(l){Number.isInteger(l)&&(AA=l)}function b3(){return AA}function SA(l){AA>=_A.INFOS&&console.info(`Info: ${l}`)}function me(l){AA>=_A.WARNINGS&&console.warn(`Warning: ${l}`)}function yn(l){throw new Error(l)}function Ue(l,t){l||yn(t)}function v3(l){switch(l==null?void 0:l.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function t2(l,t=null,e=null){if(!l)return null;if(e&&typeof l=="string"){if(e.addDefaultProtocol&&l.startsWith("www.")){const s=l.match(/\./g);(s==null?void 0:s.length)>=2&&(l=`http://${l}`)}if(e.tryConvertEncoding)try{l=E3(l)}catch{}}const n=t?URL.parse(l,t):URL.parse(l);return v3(n)?n:null}function e2(l,t,e=!1){const n=URL.parse(l);return n?(n.hash=t,n.href):e&&t2(l,"http://example.com")?l.split("#",1)[0]+`${t?`#${t}`:""}`:""}function ge(l,t,e,n=!1){return Object.defineProperty(l,t,{value:e,enumerable:!n,configurable:!0,writable:!1}),e}const Qd=(function(){function t(e,n){this.message=e,this.name=n}return t.prototype=new Error,t.constructor=t,t})();class LD extends Qd{constructor(t,e){super(t,"PasswordException"),this.code=e}}class jE extends Qd{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class f1 extends Qd{constructor(t){super(t,"InvalidPDFException")}}class x_ extends Qd{constructor(t,e,n){super(t,"ResponseException"),this.status=e,this.missing=n}}class w3 extends Qd{constructor(t){super(t,"FormatError")}}class Uu extends Qd{constructor(t){super(t,"AbortException")}}function n2(l){(typeof l!="object"||(l==null?void 0:l.length)===void 0)&&yn("Invalid argument for bytesToString");const t=l.length,e=8192;if(t<e)return String.fromCharCode.apply(null,l);const n=[];for(let s=0;s<t;s+=e){const r=Math.min(s+e,t),u=l.subarray(s,r);n.push(String.fromCharCode.apply(null,u))}return n.join("")}function Hv(l){typeof l!="string"&&yn("Invalid argument for stringToBytes");const t=l.length,e=new Uint8Array(t);for(let n=0;n<t;++n)e[n]=l.charCodeAt(n)&255;return e}function _3(l){return String.fromCharCode(l>>24&255,l>>16&255,l>>8&255,l&255)}function A3(){const l=new Uint8Array(4);return l[0]=1,new Uint32Array(l.buffer,0,1)[0]===1}function S3(){try{return new Function(""),!0}catch{return!1}}class Ti{static get isLittleEndian(){return ge(this,"isLittleEndian",A3())}static get isEvalSupported(){return ge(this,"isEvalSupported",S3())}static get isOffscreenCanvasSupported(){return ge(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return ge(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return ge(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return ge(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return ge(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){var t,e;return ge(this,"isCSSRoundSupported",(e=(t=globalThis.CSS)==null?void 0:t.supports)==null?void 0:e.call(t,"width: round(1.5px, 1px)"))}}const HE=Array.from(Array(256).keys(),l=>l.toString(16).padStart(2,"0"));var ec,zw,p1;class jt{static makeHexColor(t,e,n){return`#${HE[t]}${HE[e]}${HE[n]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let n;t[0]?(t[0]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[3],e[3]*=t[3]):(n=e[0],e[0]=e[1],e[1]=n,n=e[2],e[2]=e[3],e[3]=n,t[1]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,n=0){const s=t[n],r=t[n+1];t[n]=s*e[0]+r*e[2]+e[4],t[n+1]=s*e[1]+r*e[3]+e[5]}static applyTransformToBezier(t,e,n=0){const s=e[0],r=e[1],u=e[2],h=e[3],f=e[4],p=e[5];for(let m=0;m<6;m+=2){const b=t[n+m],_=t[n+m+1];t[n+m]=b*s+_*u+f,t[n+m+1]=b*r+_*h+p}}static applyInverseTransform(t,e){const n=t[0],s=t[1],r=e[0]*e[3]-e[1]*e[2];t[0]=(n*e[3]-s*e[2]+e[2]*e[5]-e[4]*e[3])/r,t[1]=(-n*e[1]+s*e[0]+e[4]*e[1]-e[5]*e[0])/r}static axialAlignedBoundingBox(t,e,n){const s=e[0],r=e[1],u=e[2],h=e[3],f=e[4],p=e[5],m=t[0],b=t[1],_=t[2],S=t[3];let R=s*m+f,C=R,M=s*_+f,k=M,I=h*b+p,P=I,F=h*S+p,z=F;if(r!==0||u!==0){const j=r*m,H=r*_,dt=u*b,ct=u*S;R+=dt,k+=dt,M+=ct,C+=ct,I+=j,z+=j,F+=H,P+=H}n[0]=Math.min(n[0],R,M,C,k),n[1]=Math.min(n[1],I,F,P,z),n[2]=Math.max(n[2],R,M,C,k),n[3]=Math.max(n[3],I,F,P,z)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const n=t[0],s=t[1],r=t[2],u=t[3],h=n**2+s**2,f=n*r+s*u,p=r**2+u**2,m=(h+p)/2,b=Math.sqrt(m**2-(h*p-f**2));e[0]=Math.sqrt(m+b||1),e[1]=Math.sqrt(m-b||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const n=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),s=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(n>s)return null;const r=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),u=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return r>u?null:[n,r,s,u]}static pointBoundingBox(t,e,n){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}static rectBoundingBox(t,e,n,s,r){r[0]=Math.min(r[0],t,n),r[1]=Math.min(r[1],e,s),r[2]=Math.max(r[2],t,n),r[3]=Math.max(r[3],e,s)}static bezierBoundingBox(t,e,n,s,r,u,h,f,p){p[0]=Math.min(p[0],t,h),p[1]=Math.min(p[1],e,f),p[2]=Math.max(p[2],t,h),p[3]=Math.max(p[3],e,f),N(this,ec,p1).call(this,t,n,r,h,e,s,u,f,3*(-t+3*(n-r)+h),6*(t-2*n+r),3*(n-t),p),N(this,ec,p1).call(this,t,n,r,h,e,s,u,f,3*(-e+3*(s-u)+f),6*(e-2*s+u),3*(s-e),p)}}ec=new WeakSet,zw=function(t,e,n,s,r,u,h,f,p,m){if(p<=0||p>=1)return;const b=1-p,_=p*p,S=_*p,R=b*(b*(b*t+3*p*e)+3*_*n)+S*s,C=b*(b*(b*r+3*p*u)+3*_*h)+S*f;m[0]=Math.min(m[0],R),m[1]=Math.min(m[1],C),m[2]=Math.max(m[2],R),m[3]=Math.max(m[3],C)},p1=function(t,e,n,s,r,u,h,f,p,m,b,_){if(Math.abs(p)<1e-12){Math.abs(m)>=1e-12&&N(this,ec,zw).call(this,t,e,n,s,r,u,h,f,-b/m,_);return}const S=m**2-4*b*p;if(S<0)return;const R=Math.sqrt(S),C=2*p;N(this,ec,zw).call(this,t,e,n,s,r,u,h,f,(-m+R)/C,_),N(this,ec,zw).call(this,t,e,n,s,r,u,h,f,(-m-R)/C,_)},O(jt,ec);function E3(l){return decodeURIComponent(escape(l))}let $E=null,ID=null;function C3(l){return $E||($E=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,ID=new Map([["","t"]])),l.replaceAll($E,(t,e,n)=>e?e.normalize("NFKC"):ID.get(n))}function i2(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const l=new Uint8Array(32);return crypto.getRandomValues(l),n2(l)}const lp="pdfjs_internal_id_";function x3(l,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[n,s,...r]=e;if(!l(n)&&!Number.isInteger(n)||!t(s))return!1;const u=r.length;let h=!0;switch(s.name){case"XYZ":if(u<2||u>3)return!1;break;case"Fit":case"FitB":return u===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(u>1)return!1;break;case"FitR":if(u!==4)return!1;h=!1;break;default:return!1}for(const f of r)if(!(typeof f=="number"||h&&f===null))return!1;return!0}function Ms(l,t,e){return Math.min(Math.max(l,t),e)}function s2(l){return Uint8Array.prototype.toBase64?l.toBase64():btoa(n2(l))}function T3(l){return Uint8Array.fromBase64?Uint8Array.fromBase64(l):Hv(atob(l))}typeof Promise.try!="function"&&(Promise.try=function(l,...t){return new Promise(e=>{e(l(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(l){return l.reduce((t,e)=>t+e,0)});class Uy{static textContent(t){const e=[],n={items:e,styles:Object.create(null)};function s(r){var f;if(!r)return;let u=null;const h=r.name;if(h==="#text")u=r.value;else if(Uy.shouldBuildText(h))(f=r==null?void 0:r.attributes)!=null&&f.textContent?u=r.attributes.textContent:r.value&&(u=r.value);else return;if(u!==null&&e.push({str:u}),!!r.children)for(const p of r.children)s(p)}return s(t),n}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}class a2{static setupStorage(t,e,n,s,r){const u=s.getValue(e,{value:null});switch(n.name){case"textarea":if(u.value!==null&&(t.textContent=u.value),r==="print")break;t.addEventListener("input",h=>{s.setValue(e,{value:h.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(u.value===n.attributes.xfaOn?t.setAttribute("checked",!0):u.value===n.attributes.xfaOff&&t.removeAttribute("checked"),r==="print")break;t.addEventListener("change",h=>{s.setValue(e,{value:h.target.checked?h.target.getAttribute("xfaOn"):h.target.getAttribute("xfaOff")})})}else{if(u.value!==null&&t.setAttribute("value",u.value),r==="print")break;t.addEventListener("input",h=>{s.setValue(e,{value:h.target.value})})}break;case"select":if(u.value!==null){t.setAttribute("value",u.value);for(const h of n.children)h.attributes.value===u.value?h.attributes.selected=!0:h.attributes.hasOwnProperty("selected")&&delete h.attributes.selected}t.addEventListener("input",h=>{const f=h.target.options,p=f.selectedIndex===-1?"":f[f.selectedIndex].value;s.setValue(e,{value:p})});break}}static setAttributes({html:t,element:e,storage:n=null,intent:s,linkService:r}){const{attributes:u}=e,h=t instanceof HTMLAnchorElement;u.type==="radio"&&(u.name=`${u.name}-${s}`);for(const[f,p]of Object.entries(u))if(p!=null)switch(f){case"class":p.length&&t.setAttribute(f,p.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",p);break;case"style":Object.assign(t.style,p);break;case"textContent":t.textContent=p;break;default:(!h||f!=="href"&&f!=="newWindow")&&t.setAttribute(f,p)}h&&r.addLinkAttributes(t,u.href,u.newWindow),n&&u.dataId&&this.setupStorage(t,u.dataId,e,n)}static render(t){var b,_;const e=t.annotationStorage,n=t.linkService,s=t.xfaHtml,r=t.intent||"display",u=document.createElement(s.name);s.attributes&&this.setAttributes({html:u,element:s,intent:r,linkService:n});const h=r!=="richText",f=t.div;if(f.append(u),t.viewport){const S=`matrix(${t.viewport.transform.join(",")})`;f.style.transform=S}h&&f.setAttribute("class","xfaLayer xfaFont");const p=[];if(s.children.length===0){if(s.value){const S=document.createTextNode(s.value);u.append(S),h&&Uy.shouldBuildText(s.name)&&p.push(S)}return{textDivs:p}}const m=[[s,-1,u]];for(;m.length>0;){const[S,R,C]=m.at(-1);if(R+1===S.children.length){m.pop();continue}const M=S.children[++m.at(-1)[1]];if(M===null)continue;const{name:k}=M;if(k==="#text"){const P=document.createTextNode(M.value);p.push(P),C.append(P);continue}const I=(b=M==null?void 0:M.attributes)!=null&&b.xmlns?document.createElementNS(M.attributes.xmlns,k):document.createElement(k);if(C.append(I),M.attributes&&this.setAttributes({html:I,element:M,storage:e,intent:r,linkService:n}),((_=M.children)==null?void 0:_.length)>0)m.push([M,-1,I]);else if(M.value){const P=document.createTextNode(M.value);h&&Uy.shouldBuildText(k)&&p.push(P),I.append(P)}}for(const S of f.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))S.setAttribute("readOnly",!0);return{textDivs:p}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const pl="http://www.w3.org/2000/svg",Th=class Th{};Ct(Th,"CSS",96),Ct(Th,"PDF",72),Ct(Th,"PDF_TO_CSS_UNITS",Th.CSS/Th.PDF);let zu=Th;async function $v(l,t="text"){if(hy(l,document.baseURI)){const e=await fetch(l);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,n)=>{const s=new XMLHttpRequest;s.open("GET",l,!0),s.responseType=t,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(s.response);return}e(s.responseText);return}n(new Error(s.statusText))}},s.send(null)})}class Vv{constructor({viewBox:t,userUnit:e,scale:n,rotation:s,offsetX:r=0,offsetY:u=0,dontFlip:h=!1}){this.viewBox=t,this.userUnit=e,this.scale=n,this.rotation=s,this.offsetX=r,this.offsetY=u,n*=e;const f=(t[2]+t[0])/2,p=(t[3]+t[1])/2;let m,b,_,S;switch(s%=360,s<0&&(s+=360),s){case 180:m=-1,b=0,_=0,S=1;break;case 90:m=0,b=1,_=1,S=0;break;case 270:m=0,b=-1,_=-1,S=0;break;case 0:m=1,b=0,_=0,S=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}h&&(_=-_,S=-S);let R,C,M,k;m===0?(R=Math.abs(p-t[1])*n+r,C=Math.abs(f-t[0])*n+u,M=(t[3]-t[1])*n,k=(t[2]-t[0])*n):(R=Math.abs(f-t[0])*n+r,C=Math.abs(p-t[1])*n+u,M=(t[2]-t[0])*n,k=(t[3]-t[1])*n),this.transform=[m*n,b*n,_*n,S*n,R-m*n*f-_*n*p,C-b*n*f-S*n*p],this.width=M,this.height=k}get rawDims(){const t=this.viewBox;return ge(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:n=this.offsetX,offsetY:s=this.offsetY,dontFlip:r=!1}={}){return new Vv({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:s,dontFlip:r})}convertToViewportPoint(t,e){const n=[t,e];return jt.applyTransform(n,this.transform),n}convertToViewportRectangle(t){const e=[t[0],t[1]];jt.applyTransform(e,this.transform);const n=[t[2],t[3]];return jt.applyTransform(n,this.transform),[e[0],e[1],n[0],n[1]]}convertToPdfPoint(t,e){const n=[t,e];return jt.applyInverseTransform(n,this.transform),n}}class Dx extends Qd{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function EA(l){const t=l.length;let e=0;for(;e<t&&l[e].trim()==="";)e++;return l.substring(e,e+5).toLowerCase()==="data:"}function Mx(l){return typeof l=="string"&&/\.pdf$/i.test(l)}function R3(l){return[l]=l.split(/[#?]/,1),l.substring(l.lastIndexOf("/")+1)}function O3(l,t="document.pdf"){if(typeof l!="string")return t;if(EA(l))return me('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const n=(h=>{try{return new URL(h)}catch{try{return new URL(decodeURIComponent(h))}catch{try{return new URL(h,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(h),"https://foo.bar")}catch{return null}}}}})(l);if(!n)return t;const s=h=>{try{let f=decodeURIComponent(h);return f.includes("/")?(f=f.split("/").at(-1),f.test(/^\.pdf$/i)?f:h):f}catch{return h}},r=/\.pdf$/i,u=n.pathname.split("/").at(-1);if(r.test(u))return s(u);if(n.searchParams.size>0){const h=Array.from(n.searchParams.values()).reverse();for(const p of h)if(r.test(p))return s(p);const f=Array.from(n.searchParams.keys()).reverse();for(const p of f)if(r.test(p))return s(p)}if(n.hash){const f=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(f)return s(f[0])}return t}class BD{constructor(){Ct(this,"started",Object.create(null));Ct(this,"times",[])}time(t){t in this.started&&me(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||me(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:n}of this.times)e=Math.max(n.length,e);for(const{name:n,start:s,end:r}of this.times)t.push(`${n.padEnd(e)} ${r-s}ms
`);return t.join("")}}function hy(l,t){const e=t?URL.parse(l,t):URL.parse(l);return(e==null?void 0:e.protocol)==="http:"||(e==null?void 0:e.protocol)==="https:"}function dr(l){l.preventDefault()}function Kn(l){l.preventDefault(),l.stopPropagation()}function D3(l){console.log("Deprecated API usage: "+l)}var Hy;class T_{static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;c(this,Hy)||E(this,Hy,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const e=c(this,Hy).exec(t);if(!e)return null;const n=parseInt(e[1],10);let s=parseInt(e[2],10);s=s>=1&&s<=12?s-1:0;let r=parseInt(e[3],10);r=r>=1&&r<=31?r:1;let u=parseInt(e[4],10);u=u>=0&&u<=23?u:0;let h=parseInt(e[5],10);h=h>=0&&h<=59?h:0;let f=parseInt(e[6],10);f=f>=0&&f<=59?f:0;const p=e[7]||"Z";let m=parseInt(e[8],10);m=m>=0&&m<=23?m:0;let b=parseInt(e[9],10)||0;return b=b>=0&&b<=59?b:0,p==="-"?(u+=m,h+=b):p==="+"&&(u-=m,h-=b),new Date(Date.UTC(n,s,r,u,h,f))}}Hy=new WeakMap,O(T_,Hy);function M3(l,{scale:t=1,rotation:e=0}){const{width:n,height:s}=l.attributes.style,r=[0,0,parseInt(n),parseInt(s)];return new Vv({viewBox:r,userUnit:1,scale:t,rotation:e})}function Gv(l){if(l.startsWith("#")){const t=parseInt(l.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return l.startsWith("rgb(")?l.slice(4,-1).split(",").map(t=>parseInt(t)):l.startsWith("rgba(")?l.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(me(`Not a valid color format: "${l}"`),[0,0,0])}function N3(l){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of l.keys()){t.style.color=e;const n=window.getComputedStyle(t).color;l.set(e,Gv(n))}t.remove()}function Un(l){const{a:t,b:e,c:n,d:s,e:r,f:u}=l.getTransform();return[t,e,n,s,r,u]}function so(l){const{a:t,b:e,c:n,d:s,e:r,f:u}=l.getTransform().invertSelf();return[t,e,n,s,r,u]}function Xd(l,t,e=!1,n=!0){if(t instanceof Vv){const{pageWidth:s,pageHeight:r}=t.rawDims,{style:u}=l,h=Ti.isCSSRoundSupported,f=`var(--total-scale-factor) * ${s}px`,p=`var(--total-scale-factor) * ${r}px`,m=h?`round(down, ${f}, var(--scale-round-x))`:`calc(${f})`,b=h?`round(down, ${p}, var(--scale-round-y))`:`calc(${p})`;!e||t.rotation%180===0?(u.width=m,u.height=b):(u.width=b,u.height=m)}n&&l.setAttribute("data-main-rotation",t.rotation)}class Po{constructor(){const{pixelRatio:t}=Po;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,n,s,r=-1){let u=1/0,h=1/0,f=1/0;n=Po.capPixels(n,r),n>0&&(u=Math.sqrt(n/(t*e))),s!==-1&&(h=s/t,f=s/e);const p=Math.min(u,h,f);return this.sx>p||this.sy>p?(this.sx=p,this.sy=p,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,n):n}return t}}const m1=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class k3{static get isDarkMode(){var t;return ge(this,"isDarkMode",!!((t=window==null?void 0:window.matchMedia)!=null&&t.call(window,"(prefers-color-scheme: dark)").matches))}}class P3{static get commentForegroundColor(){const t=document.createElement("span");t.classList.add("comment","sidebar");const{style:e}=t;e.width=e.height="0",e.display="none",e.color="var(--comment-fg-color)",document.body.append(t);const{color:n}=window.getComputedStyle(t);return t.remove(),ge(this,"commentForegroundColor",Gv(n))}}function L3(l,t,e,n){n=Math.min(Math.max(n??1,0),1);const s=255*(1-n);return l=Math.round(l*n+s),t=Math.round(t*n+s),e=Math.round(e*n+s),[l,t,e]}function FD(l,t){const e=l[0]/255,n=l[1]/255,s=l[2]/255,r=Math.max(e,n,s),u=Math.min(e,n,s),h=(r+u)/2;if(r===u)t[0]=t[1]=0;else{const f=r-u;switch(t[1]=h<.5?f/(r+u):f/(2-r-u),r){case e:t[0]=((n-s)/f+(n<s?6:0))*60;break;case n:t[0]=((s-e)/f+2)*60;break;case s:t[0]=((e-n)/f+4)*60;break}}t[2]=h}function g1(l,t){const e=l[0],n=l[1],s=l[2],r=(1-Math.abs(2*s-1))*n,u=r*(1-Math.abs(e/60%2-1)),h=s-r/2;switch(Math.floor(e/60)){case 0:t[0]=r+h,t[1]=u+h,t[2]=h;break;case 1:t[0]=u+h,t[1]=r+h,t[2]=h;break;case 2:t[0]=h,t[1]=r+h,t[2]=u+h;break;case 3:t[0]=h,t[1]=u+h,t[2]=r+h;break;case 4:t[0]=u+h,t[1]=h,t[2]=r+h;break;case 5:case 6:t[0]=r+h,t[1]=h,t[2]=u+h;break}}function UD(l){return l<=.03928?l/12.92:((l+.055)/1.055)**2.4}function zD(l,t,e){g1(l,e),e.map(UD);const n=.2126*e[0]+.7152*e[1]+.0722*e[2];g1(t,e),e.map(UD);const s=.2126*e[0]+.7152*e[1]+.0722*e[2];return n>s?(n+.05)/(s+.05):(s+.05)/(n+.05)}const jD=new Map;function I3(l,t){const e=l[0]+l[1]*256+l[2]*65536+t[0]*16777216+t[1]*4294967296+t[2]*1099511627776;let n=jD.get(e);if(n)return n;const s=new Float32Array(9),r=s.subarray(0,3),u=s.subarray(3,6);FD(l,u);const h=s.subarray(6,9);FD(t,h);const f=h[2]<.5,p=f?12:4.5;if(u[2]=f?Math.sqrt(u[2]):1-Math.sqrt(1-u[2]),zD(u,h,r)<p){let m,b;f?(m=u[2],b=1):(m=0,b=u[2]);const _=.005;for(;b-m>_;){const S=u[2]=(m+b)/2;f===zD(u,h,r)<p?m=S:b=S}u[2]=f?b:m}return g1(u,r),n=jt.makeHexColor(Math.round(r[0]*255),Math.round(r[1]*255),Math.round(r[2]*255)),jD.set(e,n),n}function r2({html:l,dir:t,className:e},n){const s=document.createDocumentFragment();if(typeof l=="string"){const r=document.createElement("p");r.dir=t||"auto";const u=l.split(/(?:\r\n?|\n)/);for(let h=0,f=u.length;h<f;++h){const p=u[h];r.append(document.createTextNode(p)),h<f-1&&r.append(document.createElement("br"))}s.append(r)}else a2.render({xfaHtml:l,div:s,intent:"richText"});s.firstElementChild.classList.add("richText",e),n.append(s)}function o2(l){const t=new Path2D;if(!l)return t;for(let e=0,n=l.length;e<n;)switch(l[e++]){case ty.moveTo:t.moveTo(l[e++],l[e++]);break;case ty.lineTo:t.lineTo(l[e++],l[e++]);break;case ty.curveTo:t.bezierCurveTo(l[e++],l[e++],l[e++],l[e++],l[e++],l[e++]);break;case ty.quadraticCurveTo:t.quadraticCurveTo(l[e++],l[e++],l[e++],l[e++]);break;case ty.closePath:t.closePath();break;default:me(`Unrecognized drawing path operator: ${l[e-1]}`);break}return t}var Yc,Kc,Qa,Ja,$y,Wc,vp,wp,Vy,z_,l2,as,c2,u2,tp,dy;const yl=class yl{constructor(t){O(this,as);O(this,Yc,null);O(this,Kc,null);O(this,Qa);O(this,Ja,null);O(this,$y,null);O(this,Wc,null);O(this,vp,null);O(this,wp,null);E(this,Qa,t),c(yl,Vy)||E(yl,Vy,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const t=E(this,Yc,document.createElement("div"));t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=c(this,Qa)._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",dr,{signal:e}),t.addEventListener("pointerdown",N(yl,z_,l2),{signal:e}));const n=E(this,Ja,document.createElement("div"));n.className="buttons",t.append(n);const s=c(this,Qa).toolbarPosition;if(s){const{style:r}=t,u=c(this,Qa)._uiManager.direction==="ltr"?1-s[0]:s[0];r.insetInlineEnd=`${100*u}%`,r.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return c(this,Yc)}hide(){var t;c(this,Yc).classList.add("hidden"),(t=c(this,Kc))==null||t.hideDropdown()}show(){var t,e;c(this,Yc).classList.remove("hidden"),(t=c(this,$y))==null||t.shown(),(e=c(this,Wc))==null||e.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=c(this,Qa),n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",c(yl,Vy)[t]),N(this,as,tp).call(this,n)&&n.addEventListener("click",s=>{e.delete()},{signal:e._signal}),c(this,Ja).append(n)}async addAltText(t){const e=await t.render();N(this,as,tp).call(this,e),c(this,Ja).append(e,c(this,as,dy)),E(this,$y,t)}addComment(t,e=null){if(c(this,Wc))return;const n=t.renderForToolbar();if(!n)return;N(this,as,tp).call(this,n);const s=E(this,vp,c(this,as,dy));e?(c(this,Ja).insertBefore(n,e),c(this,Ja).insertBefore(s,e)):c(this,Ja).append(n,s),E(this,Wc,t),t.toolbar=this}addColorPicker(t){if(c(this,Kc))return;E(this,Kc,t);const e=t.renderButton();N(this,as,tp).call(this,e),c(this,Ja).append(e,c(this,as,dy))}async addEditSignatureButton(t){const e=E(this,wp,await t.renderEditButton(c(this,Qa)));N(this,as,tp).call(this,e),c(this,Ja).append(e,c(this,as,dy))}removeButton(t){var e,n;switch(t){case"comment":(e=c(this,Wc))==null||e.removeToolbarCommentButton(),E(this,Wc,null),(n=c(this,vp))==null||n.remove(),E(this,vp,null);break}}async addButton(t,e){switch(t){case"colorPicker":e&&this.addColorPicker(e);break;case"altText":e&&await this.addAltText(e);break;case"editSignature":e&&await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":e&&this.addComment(e);break}}async addButtonBefore(t,e,n){if(!e&&t==="comment")return;const s=c(this,Ja).querySelector(n);s&&t==="comment"&&this.addComment(e,s)}updateEditSignatureButton(t){c(this,wp)&&(c(this,wp).title=t)}remove(){var t;c(this,Yc).remove(),(t=c(this,Kc))==null||t.destroy(),E(this,Kc,null)}};Yc=new WeakMap,Kc=new WeakMap,Qa=new WeakMap,Ja=new WeakMap,$y=new WeakMap,Wc=new WeakMap,vp=new WeakMap,wp=new WeakMap,Vy=new WeakMap,z_=new WeakSet,l2=function(t){t.stopPropagation()},as=new WeakSet,c2=function(t){c(this,Qa)._focusEventsAllowed=!1,Kn(t)},u2=function(t){c(this,Qa)._focusEventsAllowed=!0,Kn(t)},tp=function(t){const e=c(this,Qa)._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",N(this,as,c2).bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",N(this,as,u2).bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",dr,{signal:e}),!0)},dy=function(){const t=document.createElement("div");return t.className="divider",t},O(yl,z_),O(yl,Vy,null);let y1=yl;var Gy,Mh,vl,ac,h2,d2,b1;class B3{constructor(t){O(this,ac);O(this,Gy,null);O(this,Mh,null);O(this,vl);E(this,vl,t)}show(t,e,n){const[s,r]=N(this,ac,d2).call(this,e,n),{style:u}=c(this,Mh)||E(this,Mh,N(this,ac,h2).call(this));t.append(c(this,Mh)),u.insetInlineEnd=`${100*s}%`,u.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){c(this,Mh).remove()}}Gy=new WeakMap,Mh=new WeakMap,vl=new WeakMap,ac=new WeakSet,h2=function(){const t=E(this,Mh,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar");const e=c(this,vl)._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",dr,{signal:e});const n=E(this,Gy,document.createElement("div"));return n.className="buttons",t.append(n),c(this,vl).hasCommentManager()&&N(this,ac,b1).call(this,"commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{c(this,vl).commentSelection("floating_button")}),N(this,ac,b1).call(this,"highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{c(this,vl).highlightSelection("floating_button")}),t},d2=function(t,e){let n=0,s=0;for(const r of t){const u=r.y+r.height;if(u<n)continue;const h=r.x+(e?r.width:0);if(u>n){s=h,n=u;continue}e?h>s&&(s=h):h<s&&(s=h)}return[e?1-s:s,n]},b1=function(t,e,n,s){const r=document.createElement("button");r.classList.add("basic",t),r.tabIndex=0,r.setAttribute("data-l10n-id",e);const u=document.createElement("span");r.append(u),u.className="visuallyHidden",u.setAttribute("data-l10n-id",n);const h=c(this,vl)._signal;h instanceof AbortSignal&&!h.aborted&&(r.addEventListener("contextmenu",dr,{signal:h}),r.addEventListener("click",s,{signal:h})),c(this,Gy).append(r)};function f2(l,t,e){for(const n of e)t.addEventListener(n,l[n].bind(l))}var Nh,kh,_p,Ph;const rn=class rn{static initializeAndAddPointerId(t){(c(rn,kh)||E(rn,kh,new Set)).add(t)}static setPointer(t,e){c(rn,Nh)||E(rn,Nh,e),c(rn,Ph)??E(rn,Ph,t)}static setTimeStamp(t){E(rn,_p,t)}static isSamePointerId(t){return c(rn,Nh)===t}static isSamePointerIdOrRemove(t){var e;return c(rn,Nh)===t?!0:((e=c(rn,kh))==null||e.delete(t),!1)}static isSamePointerType(t){return c(rn,Ph)===t}static isInitializedAndDifferentPointerType(t){return c(rn,Ph)!==null&&!rn.isSamePointerType(t)}static isSameTimeStamp(t){return c(rn,_p)===t}static isUsingMultiplePointers(){var t;return((t=c(rn,kh))==null?void 0:t.size)>=1}static clearPointerType(){E(rn,Ph,null)}static clearPointerIds(){E(rn,Nh,NaN),E(rn,kh,null)}static clearTimeStamp(){E(rn,_p,NaN)}};Nh=new WeakMap,kh=new WeakMap,_p=new WeakMap,Ph=new WeakMap,O(rn,Nh,NaN),O(rn,kh,null),O(rn,_p,NaN),O(rn,Ph,null);let ps=rn;var j_;class F3{constructor(){O(this,j_,0)}get id(){return`${By}${bi(this,j_)._++}`}}j_=new WeakMap;var Ap,qy,ms,Sp,jw;const Ux=class Ux{constructor(){O(this,Sp);O(this,Ap,i2());O(this,qy,0);O(this,ms,null)}static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=t;const r=s.decode().then(()=>(n.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return ge(this,"_isSVGFittingCanvas",r)}async getFromFile(t){const{lastModified:e,name:n,size:s,type:r}=t;return N(this,Sp,jw).call(this,`${e}_${n}_${s}_${r}`,t)}async getFromUrl(t){return N(this,Sp,jw).call(this,t,t)}async getFromBlob(t,e){const n=await e;return N(this,Sp,jw).call(this,t,n)}async getFromId(t){c(this,ms)||E(this,ms,new Map);const e=c(this,ms).get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:n}=e;return delete e.blobPromise,this.getFromBlob(e.id,n)}return this.getFromUrl(e.url)}getFromCanvas(t,e){c(this,ms)||E(this,ms,new Map);let n=c(this,ms).get(t);if(n!=null&&n.bitmap)return n.refCounter+=1,n;const s=new OffscreenCanvas(e.width,e.height);return s.getContext("2d").drawImage(e,0,0),n={bitmap:s.transferToImageBitmap(),id:`image_${c(this,Ap)}_${bi(this,qy)._++}`,refCounter:1,isSvg:!1},c(this,ms).set(t,n),c(this,ms).set(n.id,n),n}getSvgUrl(t){const e=c(this,ms).get(t);return e!=null&&e.isSvg?e.svgUrl:null}deleteId(t){var s;c(this,ms)||E(this,ms,new Map);const e=c(this,ms).get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:n}=e;if(!e.url&&!e.file){const r=new OffscreenCanvas(n.width,n.height);r.getContext("bitmaprenderer").transferFromImageBitmap(n),e.blobPromise=r.convertToBlob()}(s=n.close)==null||s.call(n),e.bitmap=null}isValidId(t){return t.startsWith(`image_${c(this,Ap)}_`)}};Ap=new WeakMap,qy=new WeakMap,ms=new WeakMap,Sp=new WeakSet,jw=async function(t,e){c(this,ms)||E(this,ms,new Map);let n=c(this,ms).get(t);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${c(this,Ap)}_${bi(this,qy)._++}`,refCounter:0,isSvg:!1});let s;if(typeof e=="string"?(n.url=e,s=await $v(e,"blob")):e instanceof File?s=n.file=e:e instanceof Blob&&(s=e),s.type==="image/svg+xml"){const r=Ux._isSVGFittingCanvas,u=new FileReader,h=new Image,f=new Promise((p,m)=>{h.onload=()=>{n.bitmap=h,n.isSvg=!0,p()},u.onload=async()=>{const b=n.svgUrl=u.result;h.src=await r?`${b}#svgView(preserveAspectRatio(none))`:b},h.onerror=u.onerror=m});u.readAsDataURL(s),await f}else n.bitmap=await createImageBitmap(s);n.refCounter=1}catch(s){me(s),n=null}return c(this,ms).set(t,n),n&&c(this,ms).set(n.id,n),n};let v1=Ux;var ei,Qc,Xy,Fn;class U3{constructor(t=128){O(this,ei,[]);O(this,Qc,!1);O(this,Xy);O(this,Fn,-1);E(this,Xy,t)}add({cmd:t,undo:e,post:n,mustExec:s,type:r=NaN,overwriteIfSameType:u=!1,keepUndo:h=!1}){if(s&&t(),c(this,Qc))return;const f={cmd:t,undo:e,post:n,type:r};if(c(this,Fn)===-1){c(this,ei).length>0&&(c(this,ei).length=0),E(this,Fn,0),c(this,ei).push(f);return}if(u&&c(this,ei)[c(this,Fn)].type===r){h&&(f.undo=c(this,ei)[c(this,Fn)].undo),c(this,ei)[c(this,Fn)]=f;return}const p=c(this,Fn)+1;p===c(this,Xy)?c(this,ei).splice(0,1):(E(this,Fn,p),p<c(this,ei).length&&c(this,ei).splice(p)),c(this,ei).push(f)}undo(){if(c(this,Fn)===-1)return;E(this,Qc,!0);const{undo:t,post:e}=c(this,ei)[c(this,Fn)];t(),e==null||e(),E(this,Qc,!1),E(this,Fn,c(this,Fn)-1)}redo(){if(c(this,Fn)<c(this,ei).length-1){E(this,Fn,c(this,Fn)+1),E(this,Qc,!0);const{cmd:t,post:e}=c(this,ei)[c(this,Fn)];t(),e==null||e(),E(this,Qc,!1)}}hasSomethingToUndo(){return c(this,Fn)!==-1}hasSomethingToRedo(){return c(this,Fn)<c(this,ei).length-1}cleanType(t){if(c(this,Fn)!==-1){for(let e=c(this,Fn);e>=0;e--)if(c(this,ei)[e].type!==t){c(this,ei).splice(e+1,c(this,Fn)-e),E(this,Fn,e);return}c(this,ei).length=0,E(this,Fn,-1)}}destroy(){E(this,ei,null)}}ei=new WeakMap,Qc=new WeakMap,Xy=new WeakMap,Fn=new WeakMap;var H_,p2;class qv{constructor(t){O(this,H_);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=Ti.platform;for(const[n,s,r={}]of t)for(const u of n){const h=u.startsWith("mac+");e&&h?(this.callbacks.set(u.slice(4),{callback:s,options:r}),this.allKeys.add(u.split("+").at(-1))):!e&&!h&&(this.callbacks.set(u,{callback:s,options:r}),this.allKeys.add(u.split("+").at(-1)))}}exec(t,e){if(!this.allKeys.has(e.key))return;const n=this.callbacks.get(N(this,H_,p2).call(this,e));if(!n)return;const{callback:s,options:{bubbles:r=!1,args:u=[],checker:h=null}}=n;h&&!h(t,e)||(s.bind(t,...u,e)(),r||Kn(e))}}H_=new WeakSet,p2=function(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e};const $_=class $_{get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return N3(t),ge(this,"_colors",t)}convert(t){const e=Gv(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[n,s]of this._colors)if(s.every((r,u)=>r===e[u]))return $_._colorsMapping.get(n);return e}getHexCode(t){const e=this._colors.get(t);return e?jt.makeHexColor(...e):t}};Ct($_,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let w1=$_;var Ep,fa,Cp,Vn,Si,xp,Za,Tp,tr,gs,Jc,Zc,Rp,tu,co,er,Lh,Yy,Ky,Op,Wy,uo,eu,Dp,nu,ho,V_,iu,Mp,Qy,su,Ih,Np,au,Jy,di,Je,wl,ru,ou,Zy,kp,tb,lu,fo,_l,eb,nb,nr,Bt,Hw,_1,m2,g2,fy,y2,b2,v2,A1,w2,_2,A2,S2,Cs,ml,E2,C2,S1,x2,py,E1;const up=class up{constructor(t,e,n,s,r,u,h,f,p,m,b,_,S,R,C,M){O(this,Bt);O(this,Ep,new AbortController);O(this,fa,null);O(this,Cp,null);O(this,Vn,new Map);O(this,Si,new Map);O(this,xp,null);O(this,Za,null);O(this,Tp,null);O(this,tr,new U3);O(this,gs,null);O(this,Jc,null);O(this,Zc,null);O(this,Rp,0);O(this,tu,new Set);O(this,co,null);O(this,er,null);O(this,Lh,new Set);Ct(this,"_editorUndoBar",null);O(this,Yy,!1);O(this,Ky,!1);O(this,Op,!1);O(this,Wy,null);O(this,uo,null);O(this,eu,null);O(this,Dp,null);O(this,nu,!1);O(this,ho,null);O(this,V_,new F3);O(this,iu,!1);O(this,Mp,!1);O(this,Qy,!1);O(this,su,null);O(this,Ih,null);O(this,Np,null);O(this,au,null);O(this,Jy,null);O(this,di,ve.NONE);O(this,Je,new Set);O(this,wl,null);O(this,ru,null);O(this,ou,null);O(this,Zy,null);O(this,kp,null);O(this,tb,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});O(this,lu,[0,0]);O(this,fo,null);O(this,_l,null);O(this,eb,null);O(this,nb,null);O(this,nr,null);const k=this._signal=c(this,Ep).signal;E(this,_l,t),E(this,eb,e),E(this,nb,n),E(this,xp,s),E(this,gs,r),E(this,ru,u),E(this,kp,f),this._eventBus=h,h._on("editingaction",this.onEditingAction.bind(this),{signal:k}),h._on("pagechanging",this.onPageChanging.bind(this),{signal:k}),h._on("scalechanging",this.onScaleChanging.bind(this),{signal:k}),h._on("rotationchanging",this.onRotationChanging.bind(this),{signal:k}),h._on("setpreference",this.onSetPreference.bind(this),{signal:k}),h._on("switchannotationeditorparams",I=>this.updateParams(I.type,I.value),{signal:k}),window.addEventListener("pointerdown",()=>{E(this,Mp,!0)},{capture:!0,signal:k}),window.addEventListener("pointerup",()=>{E(this,Mp,!1)},{capture:!0,signal:k}),N(this,Bt,y2).call(this),N(this,Bt,S2).call(this),N(this,Bt,A1).call(this),E(this,Za,f.annotationStorage),E(this,Wy,f.filterFactory),E(this,ou,p),E(this,Dp,m||null),E(this,Yy,b),E(this,Ky,_),E(this,Op,S),E(this,Jy,R||null),this.viewParameters={realScale:zu.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=C||null,this._supportsPinchToZoom=M!==!1,r==null||r.setSidebarUiManager(this)}static get _keyboardManager(){const t=up.prototype,e=u=>c(u,_l).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&u.hasSomethingToControl(),n=(u,{target:h})=>{if(h instanceof HTMLInputElement){const{type:f}=h;return f!=="text"&&f!=="number"}return!0},s=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return ge(this,"_keyboardManager",new qv([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],t.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:n}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(u,{target:h})=>!(h instanceof HTMLButtonElement)&&c(u,_l).contains(h)&&!u.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(u,{target:h})=>!(h instanceof HTMLButtonElement)&&c(u,_l).contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-r,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[r,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-r],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,r],checker:e}]]))}destroy(){var t,e,n,s,r,u,h,f,p;(t=c(this,nr))==null||t.resolve(),E(this,nr,null),(e=c(this,Ep))==null||e.abort(),E(this,Ep,null),this._signal=null;for(const m of c(this,Si).values())m.destroy();c(this,Si).clear(),c(this,Vn).clear(),c(this,Lh).clear(),(n=c(this,au))==null||n.clear(),E(this,fa,null),c(this,Je).clear(),c(this,tr).destroy(),(s=c(this,xp))==null||s.destroy(),(r=c(this,gs))==null||r.destroy(),(u=c(this,ru))==null||u.destroy(),(h=c(this,ho))==null||h.hide(),E(this,ho,null),(f=c(this,Np))==null||f.destroy(),E(this,Np,null),E(this,Cp,null),c(this,uo)&&(clearTimeout(c(this,uo)),E(this,uo,null)),c(this,fo)&&(clearTimeout(c(this,fo)),E(this,fo,null)),(p=this._editorUndoBar)==null||p.destroy(),E(this,kp,null)}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return c(this,Jy)}get useNewAltTextFlow(){return c(this,Ky)}get useNewAltTextWhenAddingImage(){return c(this,Op)}get hcmFilter(){return ge(this,"hcmFilter",c(this,ou)?c(this,Wy).addHCMFilter(c(this,ou).foreground,c(this,ou).background):"none")}get direction(){return ge(this,"direction",getComputedStyle(c(this,_l)).direction)}get _highlightColors(){return ge(this,"_highlightColors",c(this,Dp)?new Map(c(this,Dp).split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return ge(this,"highlightColors",null);const e=new Map,n=!!c(this,ou);for(const[s,r]of t){const u=s.endsWith("_HCM");if(n&&u){e.set(s.replace("_HCM",""),r);continue}!n&&!u&&e.set(s,r)}return ge(this,"highlightColors",e)}get highlightColorNames(){return ge(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),E(this,Zc,t)}setMainHighlightColorPicker(t){E(this,Np,t)}editAltText(t,e=!1){var n;(n=c(this,xp))==null||n.editAltText(this,t,e)}hasCommentManager(){return!!c(this,gs)}editComment(t,e,n,s){var r;(r=c(this,gs))==null||r.showDialog(this,t,e,n,s)}selectComment(t,e){const n=c(this,Si).get(t),s=n==null?void 0:n.getEditorByUID(e);s==null||s.toggleComment(!0,!0)}updateComment(t){var e;(e=c(this,gs))==null||e.updateComment(t.getData())}updatePopupColor(t){var e;(e=c(this,gs))==null||e.updatePopupColor(t)}removeComment(t){var e;(e=c(this,gs))==null||e.removeComments([t.uid])}toggleComment(t,e,n=void 0){var s;(s=c(this,gs))==null||s.toggleCommentPopup(t,e,n)}makeCommentColor(t,e){var n;return t&&((n=c(this,gs))==null?void 0:n.makeCommentColor(t,e))||null}getCommentDialogElement(){var t;return((t=c(this,gs))==null?void 0:t.dialogElement)||null}async waitForEditorsRendered(t){if(c(this,Si).has(t-1))return;const{resolve:e,promise:n}=Promise.withResolvers(),s=r=>{r.pageNumber===t&&(this._eventBus._off("editorsrendered",s),e())};this._eventBus.on("editorsrendered",s),await n}getSignature(t){var e;(e=c(this,ru))==null||e.getSignature({uiManager:this,editor:t})}get signatureManager(){return c(this,ru)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":E(this,Op,e);break}}onPageChanging({pageNumber:t}){E(this,Rp,t-1)}focusMainContainer(){c(this,_l).focus()}findParent(t,e){for(const n of c(this,Si).values()){const{x:s,y:r,width:u,height:h}=n.div.getBoundingClientRect();if(t>=s&&t<=s+u&&e>=r&&e<=r+h)return n}return null}disableUserSelect(t=!1){c(this,eb).classList.toggle("noUserSelect",t)}addShouldRescale(t){c(this,Lh).add(t)}removeShouldRescale(t){c(this,Lh).delete(t)}onScaleChanging({scale:t}){var e;this.commitOrRemove(),this.viewParameters.realScale=t*zu.PDF_TO_CSS_UNITS;for(const n of c(this,Lh))n.onScaleChanging();(e=c(this,Zc))==null||e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}highlightSelection(t="",e=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:s,anchorOffset:r,focusNode:u,focusOffset:h}=n,f=n.toString(),m=N(this,Bt,Hw).call(this,n).closest(".textLayer"),b=this.getSelectionBoxes(m);if(!b)return;n.empty();const _=N(this,Bt,_1).call(this,m),S=c(this,di)===ve.NONE,R=()=>{const C=_==null?void 0:_.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:b,anchorNode:s,anchorOffset:r,focusNode:u,focusOffset:h,text:f});S&&this.showAllEditors("highlight",!0,!0),e&&(C==null||C.editComment())};if(S){this.switchToMode(ve.HIGHLIGHT,R);return}R()}commentSelection(t=""){this.highlightSelection(t,!0)}getAndRemoveDataFromAnnotationStorage(t){if(!c(this,Za))return null;const e=`${By}${t}`,n=c(this,Za).getRawValue(e);return n&&c(this,Za).remove(e),n}addToAnnotationStorage(t){!t.isEmpty()&&c(this,Za)&&!c(this,Za).has(t.id)&&c(this,Za).setValue(t.id,t)}a11yAlert(t,e=null){const n=c(this,nb);n&&(n.setAttribute("data-l10n-id",t),e?n.setAttribute("data-l10n-args",JSON.stringify(e)):n.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,c(this,nu)&&(E(this,nu,!1),N(this,Bt,fy).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of c(this,Je))if(e.div.contains(t)){E(this,Ih,[e,t]),e._focusEventsAllowed=!1;break}}focus(){if(!c(this,Ih))return;const[t,e]=c(this,Ih);E(this,Ih,null),e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}addEditListeners(){N(this,Bt,A1).call(this),this.setEditingState(!0)}removeEditListeners(){N(this,Bt,w2).call(this),this.setEditingState(!1)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const n of c(this,er))if(n.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const n of c(this,er))if(n.isHandlingMimeForPasting(e.type)){n.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){var n;if(t.preventDefault(),(n=c(this,fa))==null||n.commitOrRemove(),!this.hasSelection)return;const e=[];for(const s of c(this,Je)){const r=s.serialize(!0);r&&e.push(r)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const r of e.items)for(const u of c(this,er))if(u.isHandlingMimeForPasting(r.type)){u.paste(r,this.currentLayer);return}let n=e.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(r){me(`paste: "${r.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const s=this.currentLayer;try{const r=[];for(const f of n){const p=await s.deserialize(f);if(!p)return;r.push(p)}const u=()=>{for(const f of r)N(this,Bt,S1).call(this,f);N(this,Bt,E1).call(this,r)},h=()=>{for(const f of r)f.remove()};this.addCommands({cmd:u,undo:h,mustExec:!0})}catch(r){me(`paste: "${r.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),c(this,di)!==ve.NONE&&!this.isEditorHandlingKeyboard&&up._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,c(this,nu)&&(E(this,nu,!1),N(this,Bt,fy).call(this,"main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}setEditingState(t){t?(N(this,Bt,b2).call(this),N(this,Bt,_2).call(this),N(this,Bt,Cs).call(this,{isEditing:c(this,di)!==ve.NONE,isEmpty:N(this,Bt,py).call(this),hasSomethingToUndo:c(this,tr).hasSomethingToUndo(),hasSomethingToRedo:c(this,tr).hasSomethingToRedo(),hasSelectedEditor:!1})):(N(this,Bt,v2).call(this),N(this,Bt,A2).call(this),N(this,Bt,Cs).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!c(this,er)){E(this,er,t);for(const e of c(this,er))N(this,Bt,ml).call(this,e.defaultPropertiesToUpdate)}}getId(){return c(this,V_).id}get currentLayer(){return c(this,Si).get(c(this,Rp))}getLayer(t){return c(this,Si).get(t)}get currentPageIndex(){return c(this,Rp)}addLayer(t){c(this,Si).set(t.pageIndex,t),c(this,iu)?t.enable():t.disable()}removeLayer(t){c(this,Si).delete(t.pageIndex)}async updateMode(t,e=null,n=!1,s=!1,r=!1,u=!1){var h,f,p,m,b,_;if(c(this,di)!==t&&!(c(this,nr)&&(await c(this,nr).promise,!c(this,nr)))){if(E(this,nr,Promise.withResolvers()),(h=c(this,Zc))==null||h.commitOrRemove(),c(this,di)===ve.POPUP&&((f=c(this,gs))==null||f.hideSidebar()),(p=c(this,gs))==null||p.destroyPopup(),E(this,di,t),t===ve.NONE){this.setEditingState(!1),N(this,Bt,C2).call(this);for(const S of c(this,Vn).values())S.hideStandaloneCommentButton();(m=this._editorUndoBar)==null||m.hide(),this.toggleComment(null),c(this,nr).resolve();return}for(const S of c(this,Vn).values())S.addStandaloneCommentButton();t===ve.SIGNATURE&&await((b=c(this,ru))==null?void 0:b.loadSignatures()),n&&ps.clearPointerType(),this.setEditingState(!0),await N(this,Bt,E2).call(this),this.unselectAll();for(const S of c(this,Si).values())S.updateMode(t);if(t===ve.POPUP){c(this,Cp)||E(this,Cp,await c(this,kp).getAnnotationsByType(new Set(c(this,er).map(C=>C._editorType))));const S=new Set,R=[];for(const C of c(this,Vn).values()){const{annotationElementId:M,hasComment:k,deleted:I}=C;M&&S.add(M),k&&!I&&R.push(C.getData())}for(const C of c(this,Cp)){const{id:M,popupRef:k,contentsObj:I}=C;k&&(I!=null&&I.str)&&!S.has(M)&&!c(this,tu).has(M)&&R.push(C)}(_=c(this,gs))==null||_.showSidebar(R)}if(!e){s&&this.addNewEditorFromKeyboard(),c(this,nr).resolve();return}for(const S of c(this,Vn).values())S.uid===e?(this.setSelected(S),u?S.editComment():r?S.enterInEditMode():S.focus()):S.unselect();c(this,nr).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==c(this,di)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(c(this,er)){switch(t){case Fe.CREATE:this.currentLayer.addNewEditor(e);return;case Fe.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(c(this,Zy)||E(this,Zy,new Map)).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const n of c(this,Je))n.updateParams(t,e);else for(const n of c(this,er))n.updateDefaultParams(t,e)}}showAllEditors(t,e,n=!1){var r;for(const u of c(this,Vn).values())u.editorType===t&&u.show(e);(((r=c(this,Zy))==null?void 0:r.get(Fe.HIGHLIGHT_SHOW_ALL))??!0)!==e&&N(this,Bt,ml).call(this,[[Fe.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(c(this,Qy)!==t){E(this,Qy,t);for(const e of c(this,Si).values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}*getEditors(t){for(const e of c(this,Vn).values())e.pageIndex===t&&(yield e)}getEditor(t){return c(this,Vn).get(t)}addEditor(t){c(this,Vn).set(t.id,t)}removeEditor(t){var e,n;t.div.contains(document.activeElement)&&(c(this,uo)&&clearTimeout(c(this,uo)),E(this,uo,setTimeout(()=>{this.focusMainContainer(),E(this,uo,null)},0))),c(this,Vn).delete(t.id),t.annotationElementId&&((e=c(this,au))==null||e.delete(t.annotationElementId)),this.unselect(t),(!t.annotationElementId||!c(this,tu).has(t.annotationElementId))&&((n=c(this,Za))==null||n.remove(t.id))}addDeletedAnnotationElement(t){c(this,tu).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return c(this,tu).has(t)}removeDeletedAnnotationElement(t){c(this,tu).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}setActiveEditor(t){c(this,fa)!==t&&(E(this,fa,t),t&&N(this,Bt,ml).call(this,t.propertiesToUpdate))}updateUI(t){c(this,Bt,x2)===t&&N(this,Bt,ml).call(this,t.propertiesToUpdate)}updateUIForDefaultProperties(t){N(this,Bt,ml).call(this,t.defaultPropertiesToUpdate)}toggleSelected(t){if(c(this,Je).has(t)){c(this,Je).delete(t),t.unselect(),N(this,Bt,Cs).call(this,{hasSelectedEditor:this.hasSelection});return}c(this,Je).add(t),t.select(),N(this,Bt,ml).call(this,t.propertiesToUpdate),N(this,Bt,Cs).call(this,{hasSelectedEditor:!0})}setSelected(t){var e;this.updateToolbar({mode:t.mode,editId:t.uid}),(e=c(this,Zc))==null||e.commitOrRemove();for(const n of c(this,Je))n!==t&&n.unselect();c(this,Je).clear(),c(this,Je).add(t),t.select(),N(this,Bt,ml).call(this,t.propertiesToUpdate),N(this,Bt,Cs).call(this,{hasSelectedEditor:!0})}isSelected(t){return c(this,Je).has(t)}get firstSelectedEditor(){return c(this,Je).values().next().value}unselect(t){t.unselect(),c(this,Je).delete(t),N(this,Bt,Cs).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return c(this,Je).size!==0}get isEnterHandled(){return c(this,Je).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var t;c(this,tr).undo(),N(this,Bt,Cs).call(this,{hasSomethingToUndo:c(this,tr).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:N(this,Bt,py).call(this)}),(t=this._editorUndoBar)==null||t.hide()}redo(){c(this,tr).redo(),N(this,Bt,Cs).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:c(this,tr).hasSomethingToRedo(),isEmpty:N(this,Bt,py).call(this)})}addCommands(t){c(this,tr).add(t),N(this,Bt,Cs).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:N(this,Bt,py).call(this)})}cleanUndoStack(t){c(this,tr).cleanType(t)}delete(){var r;this.commitOrRemove();const t=(r=this.currentLayer)==null?void 0:r.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...c(this,Je)],n=()=>{var u;(u=this._editorUndoBar)==null||u.show(s,e.length===1?e[0].editorType:e.length);for(const h of e)h.remove()},s=()=>{for(const u of e)N(this,Bt,S1).call(this,u)};this.addCommands({cmd:n,undo:s,mustExec:!0})}commitOrRemove(){var t;(t=c(this,fa))==null||t.commitOrRemove()}hasSomethingToControl(){return c(this,fa)||this.hasSelection}selectAll(){for(const t of c(this,Je))t.commit();N(this,Bt,E1).call(this,c(this,Vn).values())}unselectAll(){var t;if(!(c(this,fa)&&(c(this,fa).commitOrRemove(),c(this,di)!==ve.NONE))&&!((t=c(this,Zc))!=null&&t.commitOrRemove())&&this.hasSelection){for(const e of c(this,Je))e.unselect();c(this,Je).clear(),N(this,Bt,Cs).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(t,e,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;c(this,lu)[0]+=t,c(this,lu)[1]+=e;const[s,r]=c(this,lu),u=[...c(this,Je)],h=1e3;c(this,fo)&&clearTimeout(c(this,fo)),E(this,fo,setTimeout(()=>{E(this,fo,null),c(this,lu)[0]=c(this,lu)[1]=0,this.addCommands({cmd:()=>{for(const f of u)c(this,Vn).has(f.id)&&(f.translateInPage(s,r),f.translationDone())},undo:()=>{for(const f of u)c(this,Vn).has(f.id)&&(f.translateInPage(-s,-r),f.translationDone())},mustExec:!1})},h));for(const f of u)f.translateInPage(t,e),f.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),E(this,co,new Map);for(const t of c(this,Je))c(this,co).set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!c(this,co))return!1;this.disableUserSelect(!1);const t=c(this,co);E(this,co,null);let e=!1;for(const[{x:s,y:r,pageIndex:u},h]of t)h.newX=s,h.newY=r,h.newPageIndex=u,e||(e=s!==h.savedX||r!==h.savedY||u!==h.savedPageIndex);if(!e)return!1;const n=(s,r,u,h)=>{if(c(this,Vn).has(s.id)){const f=c(this,Si).get(h);f?s._setParentAndPosition(f,r,u):(s.pageIndex=h,s.x=r,s.y=u)}};return this.addCommands({cmd:()=>{for(const[s,{newX:r,newY:u,newPageIndex:h}]of t)n(s,r,u,h)},undo:()=>{for(const[s,{savedX:r,savedY:u,savedPageIndex:h}]of t)n(s,r,u,h)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(c(this,co))for(const n of c(this,co).keys())n.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){var t;return((t=this.getActive())==null?void 0:t.shouldGetKeyboardEvents())||c(this,Je).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return c(this,fa)===t}getActive(){return c(this,fa)}getMode(){return c(this,di)}isEditingMode(){return c(this,di)!==ve.NONE}get imageManager(){return ge(this,"imageManager",new v1)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let p=0,m=e.rangeCount;p<m;p++)if(!t.contains(e.getRangeAt(p).commonAncestorContainer))return null;const{x:n,y:s,width:r,height:u}=t.getBoundingClientRect();let h;switch(t.getAttribute("data-main-rotation")){case"90":h=(p,m,b,_)=>({x:(m-s)/u,y:1-(p+b-n)/r,width:_/u,height:b/r});break;case"180":h=(p,m,b,_)=>({x:1-(p+b-n)/r,y:1-(m+_-s)/u,width:b/r,height:_/u});break;case"270":h=(p,m,b,_)=>({x:1-(m+_-s)/u,y:(p-n)/r,width:_/u,height:b/r});break;default:h=(p,m,b,_)=>({x:(p-n)/r,y:(m-s)/u,width:b/r,height:_/u});break}const f=[];for(let p=0,m=e.rangeCount;p<m;p++){const b=e.getRangeAt(p);if(!b.collapsed)for(const{x:_,y:S,width:R,height:C}of b.getClientRects())R===0||C===0||f.push(h(_,S,R,C))}return f.length===0?null:f}addChangedExistingAnnotation({annotationElementId:t,id:e}){(c(this,Tp)||E(this,Tp,new Map)).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){var e;(e=c(this,Tp))==null||e.delete(t)}renderAnnotationElement(t){var s;const e=(s=c(this,Tp))==null?void 0:s.get(t.data.id);if(!e)return;const n=c(this,Za).getRawValue(e);n&&(c(this,di)===ve.NONE&&!n.hasBeenModified||n.renderAnnotationElement(t))}setMissingCanvas(t,e,n){var r;const s=(r=c(this,au))==null?void 0:r.get(t);s&&(s.setCanvas(e,n),c(this,au).delete(t))}addMissingCanvas(t,e){(c(this,au)||E(this,au,new Map)).set(t,e)}};Ep=new WeakMap,fa=new WeakMap,Cp=new WeakMap,Vn=new WeakMap,Si=new WeakMap,xp=new WeakMap,Za=new WeakMap,Tp=new WeakMap,tr=new WeakMap,gs=new WeakMap,Jc=new WeakMap,Zc=new WeakMap,Rp=new WeakMap,tu=new WeakMap,co=new WeakMap,er=new WeakMap,Lh=new WeakMap,Yy=new WeakMap,Ky=new WeakMap,Op=new WeakMap,Wy=new WeakMap,uo=new WeakMap,eu=new WeakMap,Dp=new WeakMap,nu=new WeakMap,ho=new WeakMap,V_=new WeakMap,iu=new WeakMap,Mp=new WeakMap,Qy=new WeakMap,su=new WeakMap,Ih=new WeakMap,Np=new WeakMap,au=new WeakMap,Jy=new WeakMap,di=new WeakMap,Je=new WeakMap,wl=new WeakMap,ru=new WeakMap,ou=new WeakMap,Zy=new WeakMap,kp=new WeakMap,tb=new WeakMap,lu=new WeakMap,fo=new WeakMap,_l=new WeakMap,eb=new WeakMap,nb=new WeakMap,nr=new WeakMap,Bt=new WeakSet,Hw=function({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t},_1=function(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const n of c(this,Si).values())if(n.hasTextLayer(t))return n;return null},m2=function(){const t=document.getSelection();if(!t||t.isCollapsed)return;const n=N(this,Bt,Hw).call(this,t).closest(".textLayer"),s=this.getSelectionBoxes(n);s&&(c(this,ho)||E(this,ho,new B3(this)),c(this,ho).show(n,s,this.direction==="ltr"))},g2=function(){var r,u,h;const t=document.getSelection();if(!t||t.isCollapsed){c(this,wl)&&((r=c(this,ho))==null||r.hide(),E(this,wl,null),N(this,Bt,Cs).call(this,{hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===c(this,wl))return;const s=N(this,Bt,Hw).call(this,t).closest(".textLayer");if(!s){c(this,wl)&&((u=c(this,ho))==null||u.hide(),E(this,wl,null),N(this,Bt,Cs).call(this,{hasSelectedText:!1}));return}if((h=c(this,ho))==null||h.hide(),E(this,wl,e),N(this,Bt,Cs).call(this,{hasSelectedText:!0}),!(c(this,di)!==ve.HIGHLIGHT&&c(this,di)!==ve.NONE)&&(c(this,di)===ve.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),E(this,nu,this.isShiftKeyDown),!this.isShiftKeyDown)){const f=c(this,di)===ve.HIGHLIGHT?N(this,Bt,_1).call(this,s):null;if(f==null||f.toggleDrawing(),c(this,Mp)){const p=new AbortController,m=this.combinedSignal(p),b=_=>{_.type==="pointerup"&&_.button!==0||(p.abort(),f==null||f.toggleDrawing(!0),_.type==="pointerup"&&N(this,Bt,fy).call(this,"main_toolbar"))};window.addEventListener("pointerup",b,{signal:m}),window.addEventListener("blur",b,{signal:m})}else f==null||f.toggleDrawing(!0),N(this,Bt,fy).call(this,"main_toolbar")}},fy=function(t=""){c(this,di)===ve.HIGHLIGHT?this.highlightSelection(t):c(this,Yy)&&N(this,Bt,m2).call(this)},y2=function(){document.addEventListener("selectionchange",N(this,Bt,g2).bind(this),{signal:this._signal})},b2=function(){if(c(this,eu))return;E(this,eu,new AbortController);const t=this.combinedSignal(c(this,eu));window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})},v2=function(){var t;(t=c(this,eu))==null||t.abort(),E(this,eu,null)},A1=function(){if(c(this,su))return;E(this,su,new AbortController);const t=this.combinedSignal(c(this,su));window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})},w2=function(){var t;(t=c(this,su))==null||t.abort(),E(this,su,null)},_2=function(){if(c(this,Jc))return;E(this,Jc,new AbortController);const t=this.combinedSignal(c(this,Jc));document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})},A2=function(){var t;(t=c(this,Jc))==null||t.abort(),E(this,Jc,null)},S2=function(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})},Cs=function(t){Object.entries(t).some(([n,s])=>c(this,tb)[n]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(c(this,tb),t)}),c(this,di)===ve.HIGHLIGHT&&t.hasSelectedEditor===!1&&N(this,Bt,ml).call(this,[[Fe.HIGHLIGHT_FREE,!0]]))},ml=function(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})},E2=async function(){if(!c(this,iu)){E(this,iu,!0);const t=[];for(const e of c(this,Si).values())t.push(e.enable());await Promise.all(t);for(const e of c(this,Vn).values())e.enable()}},C2=function(){if(this.unselectAll(),c(this,iu)){E(this,iu,!1);for(const t of c(this,Si).values())t.disable();for(const t of c(this,Vn).values())t.disable()}},S1=function(t){const e=c(this,Si).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))},x2=function(){let t=null;for(t of c(this,Je));return t},py=function(){if(c(this,Vn).size===0)return!0;if(c(this,Vn).size===1)for(const t of c(this,Vn).values())return t.isEmpty();return!1},E1=function(t){for(const e of c(this,Je))e.unselect();c(this,Je).clear();for(const e of t)e.isEmpty()||(c(this,Je).add(e),e.select());N(this,Bt,Cs).call(this,{hasSelectedEditor:this.hasSelection})},Ct(up,"TRANSLATE_SMALL",1),Ct(up,"TRANSLATE_BIG",10);let Yd=up;var Ii,po,xr,Pp,mo,pa,Lp,go,qs,Al,Bh,yo,cu,Ur,my,$w;const xs=class xs{constructor(t){O(this,Ur);O(this,Ii,null);O(this,po,!1);O(this,xr,null);O(this,Pp,null);O(this,mo,null);O(this,pa,null);O(this,Lp,!1);O(this,go,null);O(this,qs,null);O(this,Al,null);O(this,Bh,null);O(this,yo,!1);E(this,qs,t),E(this,yo,t._uiManager.useNewAltTextFlow),c(xs,cu)||E(xs,cu,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(t){xs._l10n??(xs._l10n=t)}async render(){const t=E(this,xr,document.createElement("button"));t.className="altText",t.tabIndex="0";const e=E(this,Pp,document.createElement("span"));t.append(e),c(this,yo)?(t.classList.add("new"),t.setAttribute("data-l10n-id",c(xs,cu).missing),e.setAttribute("data-l10n-id",c(xs,cu)["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=c(this,qs)._uiManager._signal;t.addEventListener("contextmenu",dr,{signal:n}),t.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});const s=r=>{r.preventDefault(),c(this,qs)._uiManager.editAltText(c(this,qs)),c(this,yo)&&c(this,qs)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:c(this,Ur,my)}})};return t.addEventListener("click",s,{capture:!0,signal:n}),t.addEventListener("keydown",r=>{r.target===t&&r.key==="Enter"&&(E(this,Lp,!0),s(r))},{signal:n}),await N(this,Ur,$w).call(this),t}finish(){c(this,xr)&&(c(this,xr).focus({focusVisible:c(this,Lp)}),E(this,Lp,!1))}isEmpty(){return c(this,yo)?c(this,Ii)===null:!c(this,Ii)&&!c(this,po)}hasData(){return c(this,yo)?c(this,Ii)!==null||!!c(this,Al):this.isEmpty()}get guessedText(){return c(this,Al)}async setGuessedText(t){c(this,Ii)===null&&(E(this,Al,t),E(this,Bh,await xs._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t})),N(this,Ur,$w).call(this))}toggleAltTextBadge(t=!1){var e;if(!c(this,yo)||c(this,Ii)){(e=c(this,go))==null||e.remove(),E(this,go,null);return}if(!c(this,go)){const n=E(this,go,document.createElement("div"));n.className="noAltTextBadge",c(this,qs).div.append(n)}c(this,go).classList.toggle("hidden",!t)}serialize(t){let e=c(this,Ii);return!t&&c(this,Al)===e&&(e=c(this,Bh)),{altText:e,decorative:c(this,po),guessedText:c(this,Al),textWithDisclaimer:c(this,Bh)}}get data(){return{altText:c(this,Ii),decorative:c(this,po)}}set data({altText:t,decorative:e,guessedText:n,textWithDisclaimer:s,cancel:r=!1}){n&&(E(this,Al,n),E(this,Bh,s)),!(c(this,Ii)===t&&c(this,po)===e)&&(r||(E(this,Ii,t),E(this,po,e)),N(this,Ur,$w).call(this))}toggle(t=!1){c(this,xr)&&(!t&&c(this,pa)&&(clearTimeout(c(this,pa)),E(this,pa,null)),c(this,xr).disabled=!t)}shown(){c(this,qs)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:c(this,Ur,my)}})}destroy(){var t,e;(t=c(this,xr))==null||t.remove(),E(this,xr,null),E(this,Pp,null),E(this,mo,null),(e=c(this,go))==null||e.remove(),E(this,go,null)}};Ii=new WeakMap,po=new WeakMap,xr=new WeakMap,Pp=new WeakMap,mo=new WeakMap,pa=new WeakMap,Lp=new WeakMap,go=new WeakMap,qs=new WeakMap,Al=new WeakMap,Bh=new WeakMap,yo=new WeakMap,cu=new WeakMap,Ur=new WeakSet,my=function(){return c(this,Ii)&&"added"||c(this,Ii)===null&&this.guessedText&&"review"||"missing"},$w=async function(){var s,r,u;const t=c(this,xr);if(!t)return;if(c(this,yo)){if(t.classList.toggle("done",!!c(this,Ii)),t.setAttribute("data-l10n-id",c(xs,cu)[c(this,Ur,my)]),(s=c(this,Pp))==null||s.setAttribute("data-l10n-id",c(xs,cu)[`${c(this,Ur,my)}-label`]),!c(this,Ii)){(r=c(this,mo))==null||r.remove();return}}else{if(!c(this,Ii)&&!c(this,po)){t.classList.remove("done"),(u=c(this,mo))==null||u.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=c(this,mo);if(!e){E(this,mo,e=document.createElement("span")),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${c(this,qs).id}`;const h=100,f=c(this,qs)._uiManager._signal;f.addEventListener("abort",()=>{clearTimeout(c(this,pa)),E(this,pa,null)},{once:!0}),t.addEventListener("mouseenter",()=>{E(this,pa,setTimeout(()=>{E(this,pa,null),c(this,mo).classList.add("show"),c(this,qs)._reportTelemetry({action:"alt_text_tooltip"})},h))},{signal:f}),t.addEventListener("mouseleave",()=>{var p;c(this,pa)&&(clearTimeout(c(this,pa)),E(this,pa,null)),(p=c(this,mo))==null||p.classList.remove("show")},{signal:f})}c(this,po)?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=c(this,Ii)),e.parentNode||t.append(e);const n=c(this,qs).getElementForAltText();n==null||n.setAttribute("aria-describedby",e.id)},O(xs,cu,null),Ct(xs,"_l10n",null);let R_=xs;var Qi,ir,Fh,_n,ib,Uh,Tr,zh,jh,Hh,sb,C1;class ww{constructor(t){O(this,sb);O(this,Qi,null);O(this,ir,null);O(this,Fh,!1);O(this,_n,null);O(this,ib,null);O(this,Uh,null);O(this,Tr,null);O(this,zh,null);O(this,jh,!1);O(this,Hh,null);E(this,_n,t)}renderForToolbar(){const t=E(this,ir,document.createElement("button"));return t.className="comment",N(this,sb,C1).call(this,t,!1)}renderForStandalone(){const t=E(this,Qi,document.createElement("button"));t.className="annotationCommentButton";const e=c(this,_n).commentButtonPosition;if(e){const{style:n}=t;n.insetInlineEnd=`calc(${100*(c(this,_n)._uiManager.direction==="ltr"?1-e[0]:e[0])}% - var(--comment-button-dim))`,n.top=`calc(${100*e[1]}% - var(--comment-button-dim))`;const s=c(this,_n).commentButtonColor;s&&(n.backgroundColor=s)}return N(this,sb,C1).call(this,t,!0)}focusButton(){setTimeout(()=>{var t;(t=c(this,Qi)??c(this,ir))==null||t.focus()},0)}onUpdatedColor(){if(!c(this,Qi))return;const t=c(this,_n).commentButtonColor;t&&(c(this,Qi).style.backgroundColor=t),c(this,_n)._uiManager.updatePopupColor(c(this,_n))}get commentButtonWidth(){var t;return(((t=c(this,Qi))==null?void 0:t.getBoundingClientRect().width)??0)/c(this,_n).parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(c(this,Hh))return c(this,Hh);if(!c(this,Qi))return null;const{x:t,y:e,height:n}=c(this,Qi).getBoundingClientRect(),{x:s,y:r,width:u,height:h}=c(this,_n).parent.boundingClientRect;return[(t-s)/u,(e+n-r)/h]}set commentPopupPositionInLayer(t){E(this,Hh,t)}hasDefaultPopupPosition(){return c(this,Hh)===null}removeStandaloneCommentButton(){var t;(t=c(this,Qi))==null||t.remove(),E(this,Qi,null)}removeToolbarCommentButton(){var t;(t=c(this,ir))==null||t.remove(),E(this,ir,null)}setCommentButtonStates({selected:t,hasPopup:e}){c(this,Qi)&&(c(this,Qi).classList.toggle("selected",t),c(this,Qi).ariaExpanded=e)}edit(t){const e=this.commentPopupPositionInLayer;let n,s;if(e)[n,s]=e;else{[n,s]=c(this,_n).commentButtonPosition;const{width:m,height:b,x:_,y:S}=c(this,_n);n=_+n*m,s=S+s*b}const r=c(this,_n).parent.boundingClientRect,{x:u,y:h,width:f,height:p}=r;c(this,_n)._uiManager.editComment(c(this,_n),u+n*f,h+s*p,{...t,parentDimensions:r})}finish(){c(this,ir)&&(c(this,ir).focus({focusVisible:c(this,Fh)}),E(this,Fh,!1))}isDeleted(){return c(this,jh)||c(this,Tr)===""}isEmpty(){return c(this,Tr)===null}hasBeenEdited(){return this.isDeleted()||c(this,Tr)!==c(this,ib)}serialize(){return this.data}get data(){return{text:c(this,Tr),richText:c(this,Uh),date:c(this,zh),deleted:this.isDeleted()}}set data(t){if(t!==c(this,Tr)&&E(this,Uh,null),t===null){E(this,Tr,""),E(this,jh,!0);return}E(this,Tr,t),E(this,zh,new Date),E(this,jh,!1)}setInitialText(t,e=null){E(this,ib,t),this.data=t,E(this,zh,null),E(this,Uh,e)}shown(){}destroy(){var t,e;(t=c(this,ir))==null||t.remove(),E(this,ir,null),(e=c(this,Qi))==null||e.remove(),E(this,Qi,null),E(this,Tr,""),E(this,Uh,null),E(this,zh,null),E(this,_n,null),E(this,Fh,!1),E(this,jh,!1)}}Qi=new WeakMap,ir=new WeakMap,Fh=new WeakMap,_n=new WeakMap,ib=new WeakMap,Uh=new WeakMap,Tr=new WeakMap,zh=new WeakMap,jh=new WeakMap,Hh=new WeakMap,sb=new WeakSet,C1=function(t,e){if(!c(this,_n)._uiManager.hasCommentManager())return null;t.tabIndex="0",t.ariaHasPopup="dialog",e?(t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(t.ariaControlsElements=[c(this,_n)._uiManager.getCommentDialogElement()],t.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const n=c(this,_n)._uiManager._signal;if(!(n instanceof AbortSignal)||n.aborted)return t;t.addEventListener("contextmenu",dr,{signal:n}),e&&(t.addEventListener("focusin",r=>{c(this,_n)._focusEventsAllowed=!1,Kn(r)},{capture:!0,signal:n}),t.addEventListener("focusout",r=>{c(this,_n)._focusEventsAllowed=!0,Kn(r)},{capture:!0,signal:n})),t.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});const s=r=>{r.preventDefault(),t===c(this,ir)?this.edit():c(this,_n).toggleComment(!0)};return t.addEventListener("click",s,{capture:!0,signal:n}),t.addEventListener("keydown",r=>{r.target===t&&r.key==="Enter"&&(E(this,Fh,!0),s(r))},{signal:n}),t.addEventListener("pointerenter",()=>{c(this,_n).toggleComment(!1,!0)},{signal:n}),t.addEventListener("pointerleave",()=>{c(this,_n).toggleComment(!1,!1)},{signal:n}),t};var Ip,$h,ab,rb,ob,lb,cb,Sl,Vh,El,Gh,Cl,ju,T2,R2,O2;const zx=class zx{constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:n=null,onPinchStart:s=null,onPinching:r=null,onPinchEnd:u=null,signal:h}){O(this,ju);O(this,Ip);O(this,$h,!1);O(this,ab,null);O(this,rb);O(this,ob);O(this,lb);O(this,cb);O(this,Sl,null);O(this,Vh);O(this,El,null);O(this,Gh);O(this,Cl,null);E(this,Ip,t),E(this,ab,n),E(this,rb,e),E(this,ob,s),E(this,lb,r),E(this,cb,u),E(this,Gh,new AbortController),E(this,Vh,AbortSignal.any([h,c(this,Gh).signal])),t.addEventListener("touchstart",N(this,ju,T2).bind(this),{passive:!1,signal:c(this,Vh)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Po.pixelRatio}destroy(){var t,e;(t=c(this,Gh))==null||t.abort(),E(this,Gh,null),(e=c(this,Sl))==null||e.abort(),E(this,Sl,null)}};Ip=new WeakMap,$h=new WeakMap,ab=new WeakMap,rb=new WeakMap,ob=new WeakMap,lb=new WeakMap,cb=new WeakMap,Sl=new WeakMap,Vh=new WeakMap,El=new WeakMap,Gh=new WeakMap,Cl=new WeakMap,ju=new WeakSet,T2=function(t){var s,r,u;if((s=c(this,rb))!=null&&s.call(this))return;if(t.touches.length===1){if(c(this,Sl))return;const h=E(this,Sl,new AbortController),f=AbortSignal.any([c(this,Vh),h.signal]),p=c(this,Ip),m={capture:!0,signal:f,passive:!1},b=_=>{var S;_.pointerType==="touch"&&((S=c(this,Sl))==null||S.abort(),E(this,Sl,null))};p.addEventListener("pointerdown",_=>{_.pointerType==="touch"&&(Kn(_),b(_))},m),p.addEventListener("pointerup",b,m),p.addEventListener("pointercancel",b,m);return}if(!c(this,Cl)){E(this,Cl,new AbortController);const h=AbortSignal.any([c(this,Vh),c(this,Cl).signal]),f=c(this,Ip),p={signal:h,capture:!1,passive:!1};f.addEventListener("touchmove",N(this,ju,R2).bind(this),p);const m=N(this,ju,O2).bind(this);f.addEventListener("touchend",m,p),f.addEventListener("touchcancel",m,p),p.capture=!0,f.addEventListener("pointerdown",Kn,p),f.addEventListener("pointermove",Kn,p),f.addEventListener("pointercancel",Kn,p),f.addEventListener("pointerup",Kn,p),(r=c(this,ob))==null||r.call(this)}if(Kn(t),t.touches.length!==2||(u=c(this,ab))!=null&&u.call(this)){E(this,El,null);return}let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]),E(this,El,{touch0X:e.screenX,touch0Y:e.screenY,touch1X:n.screenX,touch1Y:n.screenY})},R2=function(t){var F;if(!c(this,El)||t.touches.length!==2)return;Kn(t);let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]);const{screenX:s,screenY:r}=e,{screenX:u,screenY:h}=n,f=c(this,El),{touch0X:p,touch0Y:m,touch1X:b,touch1Y:_}=f,S=b-p,R=_-m,C=u-s,M=h-r,k=Math.hypot(C,M)||1,I=Math.hypot(S,R)||1;if(!c(this,$h)&&Math.abs(I-k)<=zx.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(f.touch0X=s,f.touch0Y=r,f.touch1X=u,f.touch1Y=h,!c(this,$h)){E(this,$h,!0);return}const P=[(s+u)/2,(r+h)/2];(F=c(this,lb))==null||F.call(this,P,I,k)},O2=function(t){var e;t.touches.length>=2||(c(this,Cl)&&(c(this,Cl).abort(),E(this,Cl,null),(e=c(this,cb))==null||e.call(this)),c(this,El)&&(Kn(t),E(this,El,null),E(this,$h,!1)))};let O_=zx;var qh,Rr,Pn,pn,xl,Bp,uu,ub,Ji,Xh,Tl,sr,hu,hb,Yh,ma,db,Kh,Rl,bo,Fp,Up,ar,Wh,fb,G_,re,x1,pb,T1,Vw,D2,M2,R1,Gw,O1,N2,k2,P2,D1,L2,M1,I2,B2,F2,N1,gy;const be=class be{constructor(t){O(this,re);O(this,qh,null);O(this,Rr,null);O(this,Pn,null);O(this,pn,null);O(this,xl,null);O(this,Bp,!1);O(this,uu,null);O(this,ub,"");O(this,Ji,null);O(this,Xh,null);O(this,Tl,null);O(this,sr,null);O(this,hu,null);O(this,hb,"");O(this,Yh,!1);O(this,ma,null);O(this,db,!1);O(this,Kh,!1);O(this,Rl,!1);O(this,bo,null);O(this,Fp,0);O(this,Up,0);O(this,ar,null);O(this,Wh,null);Ct(this,"isSelected",!1);Ct(this,"_isCopy",!1);Ct(this,"_editToolbar",null);Ct(this,"_initialOptions",Object.create(null));Ct(this,"_initialData",null);Ct(this,"_isVisible",!0);Ct(this,"_uiManager",null);Ct(this,"_focusEventsAllowed",!0);O(this,fb,!1);O(this,G_,be._zIndex++);this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null,this.creationDate=t.creationDate||new Date,this.modificationDate=t.modificationDate||null,this.canAddComment=!0;const{rotation:e,rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:u}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,s],this.pageTranslation=[r,u];const[h,f]=this.parentDimensions;this.x=t.x/h,this.y=t.y/f,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const t=be.prototype._resizeWithKeyboard,e=Yd.TRANSLATE_SMALL,n=Yd.TRANSLATE_BIG;return ge(this,"_resizerKeyboardManager",new qv([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,n]}],[["Escape","mac+Escape"],be.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return ge(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new z3({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(be._l10n??(be._l10n=t),be._l10nResizer||(be._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),be._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);be._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){yn("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return c(this,fb)}set _isDraggable(t){var e;E(this,fb,t),(e=this.div)==null||e.classList.toggle("draggable",t)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=c(this,G_)}setParent(t){var e;t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):(N(this,re,gy).call(this),(e=c(this,sr))==null||e.remove(),E(this,sr,null)),this.parent=t}focusin(t){this._focusEventsAllowed&&(c(this,Yh)?E(this,Yh,!1):this.parent.setSelected(this))}focusout(t){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const e=t.relatedTarget;e!=null&&e.closest(`#${this.id}`)||(t.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,n,s){const[r,u]=this.parentDimensions;[n,s]=this.screenToPageTranslation(n,s),this.x=(t+n)/r,this.y=(e+s)/u,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[n,s]=this.parentDimensions;this.setAt(t*n,e*s,this.width*n,this.height*s),this._onTranslated()}translate(t,e){N(this,re,x1).call(this,this.parentDimensions,t,e)}translateInPage(t,e){c(this,ma)||E(this,ma,[this.x,this.y,this.width,this.height]),N(this,re,x1).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){c(this,ma)||E(this,ma,[this.x,this.y,this.width,this.height]);const{div:n,parentDimensions:[s,r]}=this;if(this.x+=t/s,this.y+=e/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:b,y:_}=this.div.getBoundingClientRect();this.parent.findNewParent(this,b,_)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:u,y:h}=this;const[f,p]=this.getBaseTranslation();u+=f,h+=p;const{style:m}=n;m.left=`${(100*u).toFixed(2)}%`,m.top=`${(100*h).toFixed(2)}%`,this._onTranslating(u,h),n.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!c(this,ma)&&(c(this,ma)[0]!==this.x||c(this,ma)[1]!==this.y)}get _hasBeenResized(){return!!c(this,ma)&&(c(this,ma)[2]!==this.width||c(this,ma)[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:n}=be,s=n/t,r=n/e;switch(this.rotation){case 90:return[-s,r];case 180:return[s,r];case 270:return[s,-r];default:return[-s,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[n,s]}=this;let{x:r,y:u,width:h,height:f}=this;if(h*=n,f*=s,r*=n,u*=s,this._mustFixPosition)switch(t){case 0:r=Ms(r,0,n-h),u=Ms(u,0,s-f);break;case 90:r=Ms(r,0,n-f),u=Ms(u,h,s);break;case 180:r=Ms(r,h,n),u=Ms(u,f,s);break;case 270:r=Ms(r,f,n),u=Ms(u,0,s-h);break}this.x=r/=n,this.y=u/=s;const[p,m]=this.getBaseTranslation();r+=p,u+=m,e.left=`${(100*r).toFixed(2)}%`,e.top=`${(100*u).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(t,e){var n;return N(n=be,pb,T1).call(n,t,e,this.parentRotation)}pageTranslationToScreen(t,e){var n;return N(n=be,pb,T1).call(n,t,e,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,n]}=this;return[e*t,n*t]}setDims(){const{div:{style:t},width:e,height:n}=this;t.width=`${(100*e).toFixed(2)}%`,t.height=`${(100*n).toFixed(2)}%`}getInitialTranslation(){return[0,0]}_onResized(){}static _round(t){return Math.round(t*1e4)/1e4}_onResizing(){}altTextFinish(){var t;(t=c(this,Pn))==null||t.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||c(this,Kh))return this._editToolbar;this._editToolbar=new y1(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,n]of t)await this._editToolbar.addButton(e,n);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){var t;(t=this._editToolbar)==null||t.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){var t;(t=this._editToolbar)==null||t.removeButton("comment")}removeEditToolbar(){var t,e;(t=this._editToolbar)==null||t.remove(),this._editToolbar=null,(e=c(this,Pn))==null||e.destroy()}addContainer(t){var n;const e=(n=this._editToolbar)==null?void 0:n.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return c(this,Pn)||(R_.initialize(be._l10n),E(this,Pn,new R_(this)),c(this,qh)&&(c(this,Pn).data=c(this,qh),E(this,qh,null))),c(this,Pn)}get altTextData(){var t;return(t=c(this,Pn))==null?void 0:t.data}set altTextData(t){c(this,Pn)&&(c(this,Pn).data=t)}get guessedAltText(){var t;return(t=c(this,Pn))==null?void 0:t.guessedText}async setGuessedAltText(t){var e;await((e=c(this,Pn))==null?void 0:e.setGuessedText(t))}serializeAltText(t){var e;return(e=c(this,Pn))==null?void 0:e.serialize(t)}hasAltText(){return!!c(this,Pn)&&!c(this,Pn).isEmpty()}hasAltTextData(){var t;return((t=c(this,Pn))==null?void 0:t.hasData())??!1}focusCommentButton(){var t;(t=c(this,pn))==null||t.focusButton()}addCommentButton(){return this.canAddComment?c(this,pn)||E(this,pn,new ww(this)):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(c(this,xl)){this._uiManager.isEditingMode()&&c(this,xl).classList.remove("hidden");return}this.hasComment&&(E(this,xl,c(this,pn).renderForStandalone()),this.div.append(c(this,xl)))}}removeStandaloneCommentButton(){c(this,pn).removeStandaloneCommentButton(),E(this,xl,null)}hideStandaloneCommentButton(){var t;(t=c(this,xl))==null||t.classList.add("hidden")}get comment(){const{data:{richText:t,text:e,date:n,deleted:s}}=c(this,pn);return{text:e,richText:t,date:n,deleted:s,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(t){c(this,pn)||E(this,pn,new ww(this)),c(this,pn).data=t,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:t,popupRef:e,richText:n}){if(!e||(c(this,pn)||E(this,pn,new ww(this)),c(this,pn).setInitialText(t,n),!this.annotationElementId))return;const s=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);s&&this.updateFromAnnotationLayer(s)}get hasEditedComment(){var t;return(t=c(this,pn))==null?void 0:t.hasBeenEdited()}get hasDeletedComment(){var t;return(t=c(this,pn))==null?void 0:t.isDeleted()}get hasComment(){return!!c(this,pn)&&!c(this,pn).isEmpty()&&!c(this,pn).isDeleted()}async editComment(t){c(this,pn)||E(this,pn,new ww(this)),c(this,pn).edit(t)}toggleComment(t,e=void 0){this.hasComment&&this._uiManager.toggleComment(this,t,e)}setSelectedCommentButton(t){c(this,pn).setSelectedButton(t)}addComment(t){if(this.hasEditedComment){const[,,,s]=t.rect,[r]=this.pageDimensions,[u]=this.pageTranslation,h=u+r+1,f=s-100,p=h+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[h,f,p,s]}}}updateFromAnnotationLayer({popup:{contents:t,deleted:e}}){c(this,pn).data=e?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){var u;const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=c(this,Bp)?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),N(this,re,M1).call(this);const[e,n]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*n/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/n).toFixed(2)}%`);const[s,r]=this.getInitialTranslation();return this.translate(s,r),f2(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(c(this,Wh)||E(this,Wh,new O_({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:N(this,re,N2).bind(this),onPinching:N(this,re,k2).bind(this),onPinchEnd:N(this,re,P2).bind(this),signal:this._uiManager._signal}))),this.addStandaloneCommentButton(),(u=this._uiManager._editorUndoBar)==null||u.hide(),t}pointerdown(t){const{isMac:e}=Ti.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(E(this,Yh,!0),this._isDraggable){N(this,re,L2).call(this,t);return}N(this,re,D1).call(this,t)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){c(this,bo)&&clearTimeout(c(this,bo)),E(this,bo,setTimeout(()=>{var t;E(this,bo,null),(t=this.parent)==null||t.moveEditorInDOM(this)},0))}_setParentAndPosition(t,e,n){t.changeParent(this),this.x=e,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,n=this.rotation){const s=this.parentScale,[r,u]=this.pageDimensions,[h,f]=this.pageTranslation,p=t/s,m=e/s,b=this.x*r,_=this.y*u,S=this.width*r,R=this.height*u;switch(n){case 0:return[b+p+h,u-_-m-R+f,b+p+S+h,u-_-m+f];case 90:return[b+m+h,u-_+p+f,b+m+R+h,u-_+p+S+f];case 180:return[b-p-S+h,u-_+m+f,b-p+h,u-_+m+R+f];case 270:return[b-m-R+h,u-_-p-S+f,b-m+h,u-_-p+f];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[n,s,r,u]=t,h=r-n,f=u-s;switch(this.rotation){case 0:return[n,e-u,h,f];case 90:return[n,e-s,f,h];case 180:return[r,e-s,h,f];case 270:return[r,e-u,f,h];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&be._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){var t;(t=c(this,pn))==null||t.onUpdatedColor()}getData(){const{comment:{text:t,color:e,date:n,opacity:s,deleted:r,richText:u},uid:h,pageIndex:f,creationDate:p,modificationDate:m}=this;return{id:h,pageIndex:f,rect:this.getPDFRect(),richText:u,contentsObj:{str:t},creationDate:p,modificationDate:n||m,popupRef:!r,color:e,opacity:s}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),E(this,Kh,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),E(this,Kh,!1),!0):!1}isInEditMode(){return c(this,Kh)}shouldGetKeyboardEvents(){return c(this,Rl)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:n,right:s}=this.getClientDimensions(),{innerHeight:r,innerWidth:u}=window;return e<u&&s>0&&t<r&&n>0}rebuild(){N(this,re,M1).call(this)}rotate(t){}resize(){}serializeDeleted(){var t;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((t=this._initialData)==null?void 0:t.popupRef)||""}}serialize(t=!1,e=null){var n;return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:((n=this._initialData)==null?void 0:n.popupRef)||""}}static async deserialize(t,e,n){const s=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:n,annotationElementId:t.annotationElementId,creationDate:t.creationDate,modificationDate:t.modificationDate});s.rotation=t.rotation,E(s,qh,t.accessibilityData),s._isCopy=t.isCopy||!1;const[r,u]=s.pageDimensions,[h,f,p,m]=s.getRectInCurrentCoords(t.rect,u);return s.x=h/r,s.y=f/u,s.width=p/r,s.height=m/u,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var t,e,n;if((t=c(this,hu))==null||t.abort(),E(this,hu,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),c(this,bo)&&(clearTimeout(c(this,bo)),E(this,bo,null)),N(this,re,gy).call(this),this.removeEditToolbar(),c(this,ar)){for(const s of c(this,ar).values())clearTimeout(s);E(this,ar,null)}this.parent=null,(e=c(this,Wh))==null||e.destroy(),E(this,Wh,null),(n=c(this,sr))==null||n.remove(),E(this,sr,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(N(this,re,D2).call(this),c(this,Ji).classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[t,e]}=this,[n,s,r,u]=this.getPDFRect();return[be._round(n+(r-n)*t),be._round(s+(u-s)*(1-e))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return c(this,pn).commentPopupPositionInLayer}set commentPopupPosition(t){c(this,pn).commentPopupPositionInLayer=t}hasDefaultPopupPosition(){return c(this,pn).hasDefaultPopupPosition()}get commentButtonWidth(){return c(this,pn).commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(t){var e;(e=c(this,pn))==null||e.setCommentButtonStates(t)}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),E(this,Tl,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const e=c(this,Ji).children;if(!c(this,Rr)){E(this,Rr,Array.from(e));const u=N(this,re,I2).bind(this),h=N(this,re,B2).bind(this),f=this._uiManager._signal;for(const p of c(this,Rr)){const m=p.getAttribute("data-resizer-name");p.setAttribute("role","spinbutton"),p.addEventListener("keydown",u,{signal:f}),p.addEventListener("blur",h,{signal:f}),p.addEventListener("focus",N(this,re,F2).bind(this,m),{signal:f}),p.setAttribute("data-l10n-id",be._l10nResizer[m])}}const n=c(this,Rr)[0];let s=0;for(const u of e){if(u===n)break;s++}const r=(360-this.rotation+this.parentRotation)%360/90*(c(this,Rr).length/4);if(r!==s){if(r<s)for(let h=0;h<s-r;h++)c(this,Ji).append(c(this,Ji).firstElementChild);else if(r>s)for(let h=0;h<r-s;h++)c(this,Ji).firstElementChild.before(c(this,Ji).lastElementChild);let u=0;for(const h of e){const p=c(this,Rr)[u++].getAttribute("data-resizer-name");h.setAttribute("data-l10n-id",be._l10nResizer[p])}}N(this,re,N1).call(this,0),E(this,Rl,!0),c(this,Ji).firstElementChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}_resizeWithKeyboard(t,e){c(this,Rl)&&N(this,re,O1).call(this,c(this,hb),{deltaX:t,deltaY:e,fromKeyboard:!0})}_stopResizingWithKeyboard(){N(this,re,gy).call(this),this.div.focus()}select(){var t,e,n;if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),(t=this.div)==null||t.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var s,r;(s=this.div)!=null&&s.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(e=this._editToolbar)==null||e.show(),(n=c(this,Pn))==null||n.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>{var t;return(t=this.div)==null?void 0:t.focus({preventScroll:!0})},0)}unselect(){var t,e,n,s,r;this.isSelected&&(this.isSelected=!1,(t=c(this,Ji))==null||t.classList.add("hidden"),(e=this.div)==null||e.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(s=this._editToolbar)==null||s.hide(),(r=c(this,Pn))==null||r.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){t.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return c(this,db)}set isEditing(t){E(this,db,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){c(this,ar)||E(this,ar,new Map);const{action:n}=t;let s=c(this,ar).get(n);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(t),c(this,ar).delete(n),c(this,ar).size===0&&E(this,ar,null)},be._telemetryTimeout),c(this,ar).set(n,s);return}t.type||(t.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),E(this,Bp,!1)}disable(){this.div&&(this.div.tabIndex=-1),E(this,Bp,!0)}updateFakeAnnotationElement(t){if(!c(this,sr)&&!this.deleted){E(this,sr,t.addFakeAnnotation(this));return}if(this.deleted){c(this,sr).remove(),E(this,sr,null);return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&c(this,sr).updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const n=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),n.before(e)}return e}resetAnnotationElement(t){const{firstElementChild:e}=t.container;(e==null?void 0:e.nodeName)==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}};qh=new WeakMap,Rr=new WeakMap,Pn=new WeakMap,pn=new WeakMap,xl=new WeakMap,Bp=new WeakMap,uu=new WeakMap,ub=new WeakMap,Ji=new WeakMap,Xh=new WeakMap,Tl=new WeakMap,sr=new WeakMap,hu=new WeakMap,hb=new WeakMap,Yh=new WeakMap,ma=new WeakMap,db=new WeakMap,Kh=new WeakMap,Rl=new WeakMap,bo=new WeakMap,Fp=new WeakMap,Up=new WeakMap,ar=new WeakMap,Wh=new WeakMap,fb=new WeakMap,G_=new WeakMap,re=new WeakSet,x1=function([t,e],n,s){[n,s]=this.screenToPageTranslation(n,s),this.x+=n/t,this.y+=s/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},pb=new WeakSet,T1=function(t,e,n){switch(n){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}},Vw=function(t){switch(t){case 90:{const[e,n]=this.pageDimensions;return[0,-e/n,n/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,n]=this.pageDimensions;return[0,e/n,-n/e,0]}default:return[1,0,0,1]}},D2=function(){if(c(this,Ji))return;E(this,Ji,document.createElement("div")),c(this,Ji).classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const n of t){const s=document.createElement("div");c(this,Ji).append(s),s.classList.add("resizer",n),s.setAttribute("data-resizer-name",n),s.addEventListener("pointerdown",N(this,re,M2).bind(this,n),{signal:e}),s.addEventListener("contextmenu",dr,{signal:e}),s.tabIndex=-1}this.div.prepend(c(this,Ji))},M2=function(t,e){var m;e.preventDefault();const{isMac:n}=Ti.platform;if(e.button!==0||e.ctrlKey&&n)return;(m=c(this,Pn))==null||m.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,E(this,Xh,[e.screenX,e.screenY]);const r=new AbortController,u=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",N(this,re,O1).bind(this,t),{passive:!0,capture:!0,signal:u}),window.addEventListener("touchmove",Kn,{passive:!1,signal:u}),window.addEventListener("contextmenu",dr,{signal:u}),E(this,Tl,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const h=this.parent.div.style.cursor,f=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const p=()=>{var b;r.abort(),this.parent.togglePointerEvents(!0),(b=c(this,Pn))==null||b.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=h,this.div.style.cursor=f,N(this,re,Gw).call(this)};window.addEventListener("pointerup",p,{signal:u}),window.addEventListener("blur",p,{signal:u})},R1=function(t,e,n,s){this.width=n,this.height=s,this.x=t,this.y=e,this.setDims(),this.fixAndSetPosition(),this._onResized()},Gw=function(){if(!c(this,Tl))return;const{savedX:t,savedY:e,savedWidth:n,savedHeight:s}=c(this,Tl);E(this,Tl,null);const r=this.x,u=this.y,h=this.width,f=this.height;r===t&&u===e&&h===n&&f===s||this.addCommands({cmd:N(this,re,R1).bind(this,r,u,h,f),undo:N(this,re,R1).bind(this,t,e,n,s),mustExec:!0})},O1=function(t,e){const[n,s]=this.parentDimensions,r=this.x,u=this.y,h=this.width,f=this.height,p=be.MIN_SIZE/n,m=be.MIN_SIZE/s,b=N(this,re,Vw).call(this,this.rotation),_=(J,pt)=>[b[0]*J+b[2]*pt,b[1]*J+b[3]*pt],S=N(this,re,Vw).call(this,360-this.rotation),R=(J,pt)=>[S[0]*J+S[2]*pt,S[1]*J+S[3]*pt];let C,M,k=!1,I=!1;switch(t){case"topLeft":k=!0,C=(J,pt)=>[0,0],M=(J,pt)=>[J,pt];break;case"topMiddle":C=(J,pt)=>[J/2,0],M=(J,pt)=>[J/2,pt];break;case"topRight":k=!0,C=(J,pt)=>[J,0],M=(J,pt)=>[0,pt];break;case"middleRight":I=!0,C=(J,pt)=>[J,pt/2],M=(J,pt)=>[0,pt/2];break;case"bottomRight":k=!0,C=(J,pt)=>[J,pt],M=(J,pt)=>[0,0];break;case"bottomMiddle":C=(J,pt)=>[J/2,pt],M=(J,pt)=>[J/2,0];break;case"bottomLeft":k=!0,C=(J,pt)=>[0,pt],M=(J,pt)=>[J,0];break;case"middleLeft":I=!0,C=(J,pt)=>[0,pt/2],M=(J,pt)=>[J,pt/2];break}const P=C(h,f),F=M(h,f);let z=_(...F);const j=be._round(r+z[0]),H=be._round(u+z[1]);let dt=1,ct=1,yt,gt;if(e.fromKeyboard)({deltaX:yt,deltaY:gt}=e);else{const{screenX:J,screenY:pt}=e,[Et,Wt]=c(this,Xh);[yt,gt]=this.screenToPageTranslation(J-Et,pt-Wt),c(this,Xh)[0]=J,c(this,Xh)[1]=pt}if([yt,gt]=R(yt/n,gt/s),k){const J=Math.hypot(h,f);dt=ct=Math.max(Math.min(Math.hypot(F[0]-P[0]-yt,F[1]-P[1]-gt)/J,1/h,1/f),p/h,m/f)}else I?dt=Ms(Math.abs(F[0]-P[0]-yt),p,1)/h:ct=Ms(Math.abs(F[1]-P[1]-gt),m,1)/f;const Pt=be._round(h*dt),Xt=be._round(f*ct);z=_(...M(Pt,Xt));const Vt=j-z[0],Yt=H-z[1];c(this,ma)||E(this,ma,[this.x,this.y,this.width,this.height]),this.width=Pt,this.height=Xt,this.x=Vt,this.y=Yt,this.setDims(),this.fixAndSetPosition(),this._onResizing()},N2=function(){var t;E(this,Tl,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(t=c(this,Pn))==null||t.toggle(!1),this.parent.togglePointerEvents(!1)},k2=function(t,e,n){let r=.7*(n/e)+1-.7;if(r===1)return;const u=N(this,re,Vw).call(this,this.rotation),h=(j,H)=>[u[0]*j+u[2]*H,u[1]*j+u[3]*H],[f,p]=this.parentDimensions,m=this.x,b=this.y,_=this.width,S=this.height,R=be.MIN_SIZE/f,C=be.MIN_SIZE/p;r=Math.max(Math.min(r,1/_,1/S),R/_,C/S);const M=be._round(_*r),k=be._round(S*r);if(M===_&&k===S)return;c(this,ma)||E(this,ma,[m,b,_,S]);const I=h(_/2,S/2),P=be._round(m+I[0]),F=be._round(b+I[1]),z=h(M/2,k/2);this.x=P-z[0],this.y=F-z[1],this.width=M,this.height=k,this.setDims(),this.fixAndSetPosition(),this._onResizing()},P2=function(){var t;(t=c(this,Pn))==null||t.toggle(!0),this.parent.togglePointerEvents(!0),N(this,re,Gw).call(this)},D1=function(t){const{isMac:e}=Ti.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)},L2=function(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let n=!1;const s=new AbortController,r=this._uiManager.combinedSignal(s),u={capture:!0,passive:!1,signal:r},h=p=>{s.abort(),E(this,uu,null),E(this,Yh,!1),this._uiManager.endDragSession()||N(this,re,D1).call(this,p),n&&this._onStopDragging()};e&&(E(this,Fp,t.clientX),E(this,Up,t.clientY),E(this,uu,t.pointerId),E(this,ub,t.pointerType),window.addEventListener("pointermove",p=>{n||(n=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:m,clientY:b,pointerId:_}=p;if(_!==c(this,uu)){Kn(p);return}const[S,R]=this.screenToPageTranslation(m-c(this,Fp),b-c(this,Up));E(this,Fp,m),E(this,Up,b),this._uiManager.dragSelectedEditors(S,R)},u),window.addEventListener("touchmove",Kn,u),window.addEventListener("pointerdown",p=>{p.pointerType===c(this,ub)&&(c(this,Wh)||p.isPrimary)&&h(p),Kn(p)},u));const f=p=>{if(!c(this,uu)||c(this,uu)===p.pointerId){h(p);return}Kn(p)};window.addEventListener("pointerup",f,{signal:r}),window.addEventListener("blur",f,{signal:r})},M1=function(){if(c(this,hu)||!this.div)return;E(this,hu,new AbortController);const t=this._uiManager.combinedSignal(c(this,hu));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})},I2=function(t){be._resizerKeyboardManager.exec(this,t)},B2=function(t){var e;c(this,Rl)&&((e=t.relatedTarget)==null?void 0:e.parentNode)!==c(this,Ji)&&N(this,re,gy).call(this)},F2=function(t){E(this,hb,c(this,Rl)?t:"")},N1=function(t){if(c(this,Rr))for(const e of c(this,Rr))e.tabIndex=t},gy=function(){E(this,Rl,!1),N(this,re,N1).call(this,-1),N(this,re,Gw).call(this)},O(be,pb),Ct(be,"_l10n",null),Ct(be,"_l10nResizer",null),Ct(be,"_borderLineWidth",-1),Ct(be,"_colorManager",new w1),Ct(be,"_zIndex",1),Ct(be,"_telemetryTimeout",1e3);let An=be;class z3 extends An{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const HD=3285377520,Ka=4294901760,ao=65535;class U2{constructor(t){this.h1=t?t&4294967295:HD,this.h2=t?t&4294967295:HD}update(t){let e,n;if(typeof t=="string"){e=new Uint8Array(t.length*2),n=0;for(let C=0,M=t.length;C<M;C++){const k=t.charCodeAt(C);k<=255?e[n++]=k:(e[n++]=k>>>8,e[n++]=k&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),n=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=n>>2,r=n-s*4,u=new Uint32Array(e.buffer,0,s);let h=0,f=0,p=this.h1,m=this.h2;const b=3432918353,_=461845907,S=b&ao,R=_&ao;for(let C=0;C<s;C++)C&1?(h=u[C],h=h*b&Ka|h*S&ao,h=h<<15|h>>>17,h=h*_&Ka|h*R&ao,p^=h,p=p<<13|p>>>19,p=p*5+3864292196):(f=u[C],f=f*b&Ka|f*S&ao,f=f<<15|f>>>17,f=f*_&Ka|f*R&ao,m^=f,m=m<<13|m>>>19,m=m*5+3864292196);switch(h=0,r){case 3:h^=e[s*4+2]<<16;case 2:h^=e[s*4+1]<<8;case 1:h^=e[s*4],h=h*b&Ka|h*S&ao,h=h<<15|h>>>17,h=h*_&Ka|h*R&ao,s&1?p^=h:m^=h}this.h1=p,this.h2=m}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Ka|t*36045&ao,e=e*4283543511&Ka|((e<<16|t>>>16)*2950163797&Ka)>>>16,t^=e>>>1,t=t*444984403&Ka|t*60499&ao,e=e*3301882366&Ka|((e<<16|t>>>16)*3120437893&Ka)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const k1=Object.freeze({map:null,hash:"",transfer:void 0});var Qh,Jh,Ol,Zi,q_,z2;class Nx{constructor(){O(this,q_);O(this,Qh,!1);O(this,Jh,null);O(this,Ol,null);O(this,Zi,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const n=c(this,Zi).get(t);return n===void 0?e:Object.assign(e,n)}getRawValue(t){return c(this,Zi).get(t)}remove(t){const e=c(this,Zi).get(t);if(e!==void 0&&(e instanceof An&&c(this,Ol).delete(e.annotationElementId),c(this,Zi).delete(t),c(this,Zi).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const n of c(this,Zi).values())if(n instanceof An)return;this.onAnnotationEditor(null)}}setValue(t,e){const n=c(this,Zi).get(t);let s=!1;if(n!==void 0)for(const[r,u]of Object.entries(e))n[r]!==u&&(s=!0,n[r]=u);else s=!0,c(this,Zi).set(t,e);s&&N(this,q_,z2).call(this),e instanceof An&&((c(this,Ol)||E(this,Ol,new Map)).set(e.annotationElementId,e),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type))}has(t){return c(this,Zi).has(t)}get size(){return c(this,Zi).size}resetModified(){c(this,Qh)&&(E(this,Qh,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new j2(this)}get serializable(){if(c(this,Zi).size===0)return k1;const t=new Map,e=new U2,n=[],s=Object.create(null);let r=!1;for(const[u,h]of c(this,Zi)){const f=h instanceof An?h.serialize(!1,s):h;f&&(t.set(u,f),e.update(`${u}:${JSON.stringify(f)}`),r||(r=!!f.bitmap))}if(r)for(const u of t.values())u.bitmap&&n.push(u.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:n}:k1}get editorStats(){let t=null;const e=new Map;let n=0,s=0;for(const r of c(this,Zi).values()){if(!(r instanceof An)){r.popup&&(r.popup.deleted?s+=1:n+=1);continue}r.isCommentDeleted?s+=1:r.hasEditedComment&&(n+=1);const u=r.telemetryFinalData;if(!u)continue;const{type:h}=u;e.has(h)||e.set(h,Object.getPrototypeOf(r).constructor),t||(t=Object.create(null));const f=t[h]||(t[h]=new Map);for(const[p,m]of Object.entries(u)){if(p==="type")continue;let b=f.get(p);b||(b=new Map,f.set(p,b));const _=b.get(m)??0;b.set(m,_+1)}}if((s>0||n>0)&&(t||(t=Object.create(null)),t.comments={deleted:s,edited:n}),!t)return null;for(const[r,u]of e)t[r]=u.computeTelemetryFinalData(t[r]);return t}resetModifiedIds(){E(this,Jh,null)}updateEditor(t,e){var s;const n=(s=c(this,Ol))==null?void 0:s.get(t);return n?(n.updateFromAnnotationLayer(e),!0):!1}getEditor(t){var e;return((e=c(this,Ol))==null?void 0:e.get(t))||null}get modifiedIds(){if(c(this,Jh))return c(this,Jh);const t=[];if(c(this,Ol))for(const e of c(this,Ol).values())e.serialize()&&t.push(e.annotationElementId);return E(this,Jh,{ids:new Set(t),hash:t.join(",")})}[Symbol.iterator](){return c(this,Zi).entries()}}Qh=new WeakMap,Jh=new WeakMap,Ol=new WeakMap,Zi=new WeakMap,q_=new WeakSet,z2=function(){c(this,Qh)||(E(this,Qh,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var mb;class j2 extends Nx{constructor(e){super();O(this,mb);const{map:n,hash:s,transfer:r}=e.serializable,u=structuredClone(n,r?{transfer:r}:null);E(this,mb,{map:u,hash:s,transfer:r})}get print(){yn("Should not call PrintAnnotationStorage.print")}get serializable(){return c(this,mb)}get modifiedIds(){return ge(this,"modifiedIds",{ids:new Set,hash:""})}}mb=new WeakMap;var zp;class j3{constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){O(this,zp,new Set);this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),c(this,zp).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:n}){if(!(!t||c(this,zp).has(t.loadedName))){if(Ue(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:r,style:u}=t,h=new FontFace(s,r,u);this.addNativeFontFace(h);try{await h.load(),c(this,zp).add(s),n==null||n(t)}catch{me(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(h)}return}yn("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const n=t.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(s){throw me(`Failed to load font '${n.family}': '${s}'.`),t.disableFontFace=!0,s}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const s=this._queueLoadingCallback(n);this._prepareFontLoadEvent(t,s)})}}get isFontLoadingAPISupported(){var e;const t=!!((e=this._document)!=null&&e.fonts);return ge(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return ge(this,"isSyncFontLoadingSupported",Ds||Ti.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(Ue(!s.done,"completeRequest() cannot be called twice."),s.done=!0;n.length>0&&n[0].done;){const r=n.shift();setTimeout(r.callback,0)}}const{loadingRequests:n}=this,s={done:!1,complete:e,callback:t};return n.push(s),s}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return ge(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function n(F,z){return F.charCodeAt(z)<<24|F.charCodeAt(z+1)<<16|F.charCodeAt(z+2)<<8|F.charCodeAt(z+3)&255}function s(F,z,j,H){const dt=F.substring(0,z),ct=F.substring(z+j);return dt+H+ct}let r,u;const h=this._document.createElement("canvas");h.width=1,h.height=1;const f=h.getContext("2d");let p=0;function m(F,z){if(++p>30){me("Load test font never loaded."),z();return}if(f.font="30px "+F,f.fillText(".",0,20),f.getImageData(0,0,1,1).data[3]>0){z();return}setTimeout(m.bind(null,F,z))}const b=`lt${Date.now()}${this.loadTestFontId++}`;let _=this._loadTestFont;_=s(_,976,b.length,b);const R=16,C=1482184792;let M=n(_,R);for(r=0,u=b.length-3;r<u;r+=4)M=M-C+n(b,r)|0;r<b.length&&(M=M-C+n(b+"XXX",r)|0),_=s(_,R,4,_3(M));const k=`url(data:font/opentype;base64,${btoa(_)});`,I=`@font-face {font-family:"${b}";src:${k}}`;this.insertRule(I);const P=this._document.createElement("div");P.style.visibility="hidden",P.style.width=P.style.height="10px",P.style.position="absolute",P.style.top=P.style.left="0px";for(const F of[t.loadedName,b]){const z=this._document.createElement("span");z.textContent="Hi",z.style.fontFamily=F,P.append(z)}this._document.body.append(P),m(b,()=>{P.remove(),e.complete()})}}zp=new WeakMap;var on;class H3{constructor(t,e=null,n,s){O(this,on);this.compiledGlyphs=Object.create(null),E(this,on,t),this._inspectFont=e,n&&Object.assign(this,n),s&&(this.charProcOperatorList=s)}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(e=this._inspectFont)==null||e.call(this,this),t}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${s2(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}return(n=this._inspectFont)==null||n.call(this,this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const n=this.loadedName+"_path_"+e;let s;try{s=t.get(n)}catch(u){me(`getPathGenerator - ignoring character: "${u}".`)}const r=o2(s==null?void 0:s.path);return this.fontExtraProperties||t.delete(n),this.compiledGlyphs[e]=r}get black(){return c(this,on).black}get bold(){return c(this,on).bold}get disableFontFace(){return c(this,on).disableFontFace??!1}set disableFontFace(t){ge(this,"disableFontFace",!!t)}get fontExtraProperties(){return c(this,on).fontExtraProperties??!1}get isInvalidPDFjsFont(){return c(this,on).isInvalidPDFjsFont}get isType3Font(){return c(this,on).isType3Font}get italic(){return c(this,on).italic}get missingFile(){return c(this,on).missingFile}get remeasure(){return c(this,on).remeasure}get vertical(){return c(this,on).vertical}get ascent(){return c(this,on).ascent}get defaultWidth(){return c(this,on).defaultWidth}get descent(){return c(this,on).descent}get bbox(){return c(this,on).bbox}set bbox(t){ge(this,"bbox",t)}get fontMatrix(){return c(this,on).fontMatrix}get fallbackName(){return c(this,on).fallbackName}get loadedName(){return c(this,on).loadedName}get mimetype(){return c(this,on).mimetype}get name(){return c(this,on).name}get data(){return c(this,on).data}clearData(){c(this,on).clearData()}get cssFontInfo(){return c(this,on).cssFontInfo}get systemFontInfo(){return c(this,on).systemFontInfo}get defaultVMetrics(){return c(this,on).defaultVMetrics}}on=new WeakMap;var jp,Hp,gb,$p,qw;const hp=class hp{constructor(t){O(this,$p);O(this,jp);O(this,Hp);O(this,gb);E(this,jp,t),E(this,Hp,new DataView(c(this,jp))),E(this,gb,new TextDecoder)}static write(t){const e=new TextEncoder,n={};let s=0;for(const p of hp.strings){const m=e.encode(t[p]);n[p]=m,s+=4+m.length}const r=new ArrayBuffer(s),u=new Uint8Array(r),h=new DataView(r);let f=0;for(const p of hp.strings){const m=n[p],b=m.length;h.setUint32(f,b),u.set(m,f+4),f+=4+b}return Ue(f===r.byteLength,"CssFontInfo.write: Buffer overflow"),r}get fontFamily(){return N(this,$p,qw).call(this,0)}get fontWeight(){return N(this,$p,qw).call(this,1)}get italicAngle(){return N(this,$p,qw).call(this,2)}};jp=new WeakMap,Hp=new WeakMap,gb=new WeakMap,$p=new WeakSet,qw=function(t){Ue(t<hp.strings.length,"Invalid string index");let e=0;for(let s=0;s<t;s++)e+=c(this,Hp).getUint32(e)+4;const n=c(this,Hp).getUint32(e);return c(this,gb).decode(new Uint8Array(c(this,jp),e+4,n))},Ct(hp,"strings",["fontFamily","fontWeight","italicAngle"]);let D_=hp;var du,vo,Zh,td,yy;const dp=class dp{constructor(t){O(this,td);O(this,du);O(this,vo);O(this,Zh);E(this,du,t),E(this,vo,new DataView(c(this,du))),E(this,Zh,new TextDecoder)}static write(t){const e=new TextEncoder,n={};let s=0;for(const _ of dp.strings){const S=e.encode(t[_]);n[_]=S,s+=4+S.length}s+=4;let r,u,h=1+s;t.style&&(r=e.encode(t.style.style),u=e.encode(t.style.weight),h+=4+r.length+4+u.length);const f=new ArrayBuffer(h),p=new Uint8Array(f),m=new DataView(f);let b=0;m.setUint8(b++,t.guessFallback?1:0),m.setUint32(b,0),b+=4,s=0;for(const _ of dp.strings){const S=n[_],R=S.length;s+=4+R,m.setUint32(b,R),p.set(S,b+4),b+=4+R}return m.setUint32(b-s-4,s),t.style&&(m.setUint32(b,r.length),p.set(r,b+4),b+=4+r.length,m.setUint32(b,u.length),p.set(u,b+4),b+=4+u.length),Ue(b<=f.byteLength,"SubstitionInfo.write: Buffer overflow"),f.transferToFixedLength(b)}get guessFallback(){return c(this,vo).getUint8(0)!==0}get css(){return N(this,td,yy).call(this,0)}get loadedName(){return N(this,td,yy).call(this,1)}get baseFontName(){return N(this,td,yy).call(this,2)}get src(){return N(this,td,yy).call(this,3)}get style(){let t=1;t+=4+c(this,vo).getUint32(t);const e=c(this,vo).getUint32(t),n=c(this,Zh).decode(new Uint8Array(c(this,du),t+4,e));t+=4+e;const s=c(this,vo).getUint32(t),r=c(this,Zh).decode(new Uint8Array(c(this,du),t+4,s));return{style:n,weight:r}}};du=new WeakMap,vo=new WeakMap,Zh=new WeakMap,td=new WeakSet,yy=function(t){Ue(t<dp.strings.length,"Invalid string index");let e=5;for(let s=0;s<t;s++)e+=c(this,vo).getUint32(e)+4;const n=c(this,vo).getUint32(e);return c(this,Zh).decode(new Uint8Array(c(this,du),e+4,n))},Ct(dp,"strings",["css","loadedName","baseFontName","src"]);let M_=dp;var Vp,Gp,qp,Xp,ga,wo,yb,ln,Yn,Ar,Xw,by;const Se=class Se{constructor({data:t,extra:e}){O(this,Yn);O(this,wo);O(this,yb);O(this,ln);E(this,wo,t),E(this,yb,new TextDecoder),E(this,ln,new DataView(c(this,wo))),e&&Object.assign(this,e)}get black(){return N(this,Yn,Ar).call(this,0)}get bold(){return N(this,Yn,Ar).call(this,1)}get disableFontFace(){return N(this,Yn,Ar).call(this,2)}get fontExtraProperties(){return N(this,Yn,Ar).call(this,3)}get isInvalidPDFjsFont(){return N(this,Yn,Ar).call(this,4)}get isType3Font(){return N(this,Yn,Ar).call(this,5)}get italic(){return N(this,Yn,Ar).call(this,6)}get missingFile(){return N(this,Yn,Ar).call(this,7)}get remeasure(){return N(this,Yn,Ar).call(this,8)}get vertical(){return N(this,Yn,Ar).call(this,9)}get ascent(){return N(this,Yn,Xw).call(this,0)}get defaultWidth(){return N(this,Yn,Xw).call(this,1)}get descent(){return N(this,Yn,Xw).call(this,2)}get bbox(){let t=c(Se,Gp);if(c(this,ln).getUint8(t)===0)return;t+=1;const n=[];for(let s=0;s<4;s++)n.push(c(this,ln).getInt16(t,!0)),t+=2;return n}get fontMatrix(){let t=c(Se,qp);if(c(this,ln).getUint8(t)===0)return;t+=1;const n=[];for(let s=0;s<6;s++)n.push(c(this,ln).getFloat64(t,!0)),t+=8;return n}get defaultVMetrics(){let t=c(Se,Xp);if(c(this,ln).getUint8(t)===0)return;t+=1;const n=[];for(let s=0;s<3;s++)n.push(c(this,ln).getInt16(t,!0)),t+=2;return n}get fallbackName(){return N(this,Yn,by).call(this,0)}get loadedName(){return N(this,Yn,by).call(this,1)}get mimetype(){return N(this,Yn,by).call(this,2)}get name(){return N(this,Yn,by).call(this,3)}get data(){let t=c(Se,ga);const e=c(this,ln).getUint32(t);t+=4+e;const n=c(this,ln).getUint32(t);t+=4+n;const s=c(this,ln).getUint32(t);t+=4+s;const r=c(this,ln).getUint32(t);if(r!==0)return new Uint8Array(c(this,wo),t+4,r)}clearData(){let t=c(Se,ga);const e=c(this,ln).getUint32(t);t+=4+e;const n=c(this,ln).getUint32(t);t+=4+n;const s=c(this,ln).getUint32(t);t+=4+s;const r=c(this,ln).getUint32(t);new Uint8Array(c(this,wo),t+4,r).fill(0),c(this,ln).setUint32(t,0)}get cssFontInfo(){let t=c(Se,ga);const e=c(this,ln).getUint32(t);t+=4+e;const n=c(this,ln).getUint32(t);t+=4+n;const s=c(this,ln).getUint32(t);if(s===0)return null;const r=new Uint8Array(s);return r.set(new Uint8Array(c(this,wo),t+4,s)),new D_(r.buffer)}get systemFontInfo(){let t=c(Se,ga);const e=c(this,ln).getUint32(t);t+=4+e;const n=c(this,ln).getUint32(t);if(n===0)return null;const s=new Uint8Array(n);return s.set(new Uint8Array(c(this,wo),t+4,n)),new M_(s.buffer)}static write(t){const e=t.systemFontInfo?M_.write(t.systemFontInfo):null,n=t.cssFontInfo?D_.write(t.cssFontInfo):null,s=new TextEncoder,r={};let u=0;for(const C of Se.strings)r[C]=s.encode(t[C]),u+=4+r[C].length;const h=c(Se,ga)+4+u+4+(e?e.byteLength:0)+4+(n?n.byteLength:0)+4+(t.data?t.data.length:0),f=new ArrayBuffer(h),p=new Uint8Array(f),m=new DataView(f);let b=0;const _=Se.bools.length;let S=0,R=0;for(let C=0;C<_;C++){const M=t[Se.bools[C]];S|=(M===void 0?0:M?2:1)<<R,R+=2,(R===8||C===_-1)&&(m.setUint8(b++,S),S=0,R=0)}Ue(b===c(Se,Vp),"FontInfo.write: Boolean properties offset mismatch");for(const C of Se.numbers)m.setFloat64(b,t[C]),b+=8;if(Ue(b===c(Se,Gp),"FontInfo.write: Number properties offset mismatch"),t.bbox){m.setUint8(b++,4);for(const C of t.bbox)m.setInt16(b,C,!0),b+=2}else m.setUint8(b++,0),b+=8;if(Ue(b===c(Se,qp),"FontInfo.write: BBox properties offset mismatch"),t.fontMatrix){m.setUint8(b++,6);for(const C of t.fontMatrix)m.setFloat64(b,C,!0),b+=8}else m.setUint8(b++,0),b+=48;if(Ue(b===c(Se,Xp),"FontInfo.write: FontMatrix properties offset mismatch"),t.defaultVMetrics){m.setUint8(b++,1);for(const C of t.defaultVMetrics)m.setInt16(b,C,!0),b+=2}else m.setUint8(b++,0),b+=6;Ue(b===c(Se,ga),"FontInfo.write: DefaultVMetrics properties offset mismatch"),m.setUint32(c(Se,ga),0),b+=4;for(const C of Se.strings){const M=r[C],k=M.length;m.setUint32(b,k),p.set(M,b+4),b+=4+k}if(m.setUint32(c(Se,ga),b-c(Se,ga)-4),!e)m.setUint32(b,0),b+=4;else{const C=e.byteLength;m.setUint32(b,C),Ue(b+4+C<=f.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),p.set(new Uint8Array(e),b+4),b+=4+C}if(!n)m.setUint32(b,0),b+=4;else{const C=n.byteLength;m.setUint32(b,C),Ue(b+4+C<=f.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),p.set(new Uint8Array(n),b+4),b+=4+C}return t.data===void 0?(m.setUint32(b,0),b+=4):(m.setUint32(b,t.data.length),p.set(t.data,b+4),b+=4+t.data.length),Ue(b<=f.byteLength,"FontInfo.write: Buffer overflow"),f.transferToFixedLength(b)}};Vp=new WeakMap,Gp=new WeakMap,qp=new WeakMap,Xp=new WeakMap,ga=new WeakMap,wo=new WeakMap,yb=new WeakMap,ln=new WeakMap,Yn=new WeakSet,Ar=function(t){Ue(t<Se.bools.length,"Invalid boolean index");const e=Math.floor(t/4),n=t*2%8,s=c(this,ln).getUint8(e)>>n&3;return s===0?void 0:s===2},Xw=function(t){return Ue(t<Se.numbers.length,"Invalid number index"),c(this,ln).getFloat64(c(Se,Vp)+t*8)},by=function(t){Ue(t<Se.strings.length,"Invalid string index");let e=c(Se,ga)+4;for(let r=0;r<t;r++)e+=c(this,ln).getUint32(e)+4;const n=c(this,ln).getUint32(e),s=new Uint8Array(n);return s.set(new Uint8Array(c(this,wo),e+4,n)),c(this,yb).decode(s)},Ct(Se,"bools",["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"]),Ct(Se,"numbers",["ascent","defaultWidth","descent"]),Ct(Se,"strings",["fallbackName","loadedName","mimetype","name"]),O(Se,Vp,Math.ceil(Se.bools.length*2/8)),O(Se,Gp,c(Se,Vp)+Se.numbers.length*8),O(Se,qp,c(Se,Gp)+1+8),O(Se,Xp,c(Se,qp)+1+48),O(Se,ga,c(Se,Xp)+1+6);let P1=Se;var bb,vb,wb,_b,Ab,Sb,Eb,Cb;const wn=class wn{constructor(t){this.buffer=t,this.view=new DataView(t),this.data=new Uint8Array(t)}static write(t){let e,n=null,s=[],r=[],u=[],h=[],f=null,p=null;switch(t[0]){case"RadialAxial":e=t[1]==="axial"?1:2,n=t[2],u=t[3],e===1?s.push(...t[4],...t[5]):s.push(t[4][0],t[4][1],t[6],t[5][0],t[5][1],t[7]);break;case"Mesh":e=3,f=t[1],s=t[2],r=t[3],h=t[4]||[],n=t[6],p=t[7];break;default:throw new Error(`Unsupported pattern type: ${t[0]}`)}const m=Math.floor(s.length/2),b=Math.floor(r.length/3),_=u.length,S=h.length;let R=0;for(const z of h)R+=1,R=Math.ceil(R/4)*4,R+=4+z.coords.length*4,R+=4+z.colors.length*4,z.verticesPerRow!==void 0&&(R+=4);const C=20+m*8+b*3+_*8+(n?16:0)+(p?3:0)+R,M=new ArrayBuffer(C),k=new DataView(M),I=new Uint8Array(M);k.setUint8(c(wn,bb),e),k.setUint8(c(wn,vb),n?1:0),k.setUint8(c(wn,wb),p?1:0),k.setUint8(c(wn,_b),f),k.setUint32(c(wn,Ab),m,!0),k.setUint32(c(wn,Sb),b,!0),k.setUint32(c(wn,Eb),_,!0),k.setUint32(c(wn,Cb),S,!0);let P=20;new Float32Array(M,P,m*2).set(s),P+=m*8,I.set(r,P),P+=b*3;for(const[z,j]of u)k.setFloat32(P,z,!0),P+=4,k.setUint32(P,parseInt(j.slice(1),16),!0),P+=4;if(n)for(const z of n)k.setFloat32(P,z,!0),P+=4;p&&(I.set(p,P),P+=3);for(let z=0;z<h.length;z++){const j=h[z];k.setUint8(P,j.type),P+=1,P=Math.ceil(P/4)*4,k.setUint32(P,j.coords.length,!0),P+=4,new Int32Array(M,P,j.coords.length).set(j.coords),P+=j.coords.length*4,k.setUint32(P,j.colors.length,!0),P+=4,new Int32Array(M,P,j.colors.length).set(j.colors),P+=j.colors.length*4,j.verticesPerRow!==void 0&&(k.setUint32(P,j.verticesPerRow,!0),P+=4)}return M}getIR(){const t=this.view,e=this.data[c(wn,bb)],n=!!this.data[c(wn,vb)],s=!!this.data[c(wn,wb)],r=t.getUint32(c(wn,Ab),!0),u=t.getUint32(c(wn,Sb),!0),h=t.getUint32(c(wn,Eb),!0),f=t.getUint32(c(wn,Cb),!0);let p=20;const m=new Float32Array(this.buffer,p,r*2);p+=r*8;const b=new Uint8Array(this.buffer,p,u*3);p+=u*3;const _=[];for(let M=0;M<h;++M){const k=t.getFloat32(p,!0);p+=4;const I=t.getUint32(p,!0);p+=4,_.push([k,`#${I.toString(16).padStart(6,"0")}`])}let S=null;if(n){S=[];for(let M=0;M<4;++M)S.push(t.getFloat32(p,!0)),p+=4}let R=null;s&&(R=new Uint8Array(this.buffer,p,3),p+=3);const C=[];for(let M=0;M<f;++M){const k=t.getUint8(p);p+=1,p=Math.ceil(p/4)*4;const I=t.getUint32(p,!0);p+=4;const P=new Int32Array(this.buffer,p,I);p+=I*4;const F=t.getUint32(p,!0);p+=4;const z=new Int32Array(this.buffer,p,F);p+=F*4;const j={type:k,coords:P,colors:z};k===d1.LATTICE&&(j.verticesPerRow=t.getUint32(p,!0),p+=4),C.push(j)}if(e===1)return["RadialAxial","axial",S,_,Array.from(m.slice(0,2)),Array.from(m.slice(2,4)),null,null];if(e===2)return["RadialAxial","radial",S,_,[m[0],m[1]],[m[3],m[4]],m[2],m[5]];if(e===3){const M=this.data[c(wn,_b)];let k=null;if(m.length>0){let I=m[0],P=m[0],F=m[1],z=m[1];for(let j=0;j<m.length;j+=2){const H=m[j],dt=m[j+1];I=I>H?H:I,F=F>dt?dt:F,P=P<H?H:P,z=z<dt?dt:z}k=[I,F,P,z]}return["Mesh",M,m,b,C,k,S,R]}throw new Error(`Unsupported pattern kind: ${e}`)}};bb=new WeakMap,vb=new WeakMap,wb=new WeakMap,_b=new WeakMap,Ab=new WeakMap,Sb=new WeakMap,Eb=new WeakMap,Cb=new WeakMap,O(wn,bb,0),O(wn,vb,1),O(wn,wb,2),O(wn,_b,3),O(wn,Ab,4),O(wn,Sb,8),O(wn,Eb,12),O(wn,Cb,16);let L1=wn;var Yp;class $3{constructor(t){O(this,Yp);E(this,Yp,t)}static write(t){let e,n;return Ti.isFloat16ArraySupported?(n=new ArrayBuffer(t.length*2),e=new Float16Array(n)):(n=new ArrayBuffer(t.length*4),e=new Float32Array(n)),e.set(t),n}get path(){return Ti.isFloat16ArraySupported?new Float16Array(c(this,Yp)):new Float32Array(c(this,Yp))}}Yp=new WeakMap;function V3(l){if(l instanceof URL)return l.href;if(typeof l=="string"){if(Ds)return l;const t=URL.parse(l,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function G3(l){if(Ds&&typeof Buffer<"u"&&l instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(l instanceof Uint8Array&&l.byteLength===l.buffer.byteLength)return l;if(typeof l=="string")return Hv(l);if(l instanceof ArrayBuffer||ArrayBuffer.isView(l)||typeof l=="object"&&!isNaN(l==null?void 0:l.length))return new Uint8Array(l);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function _w(l){if(typeof l!="string")return null;if(l.endsWith("/"))return l;throw new Error(`Invalid factory url: "${l}" must include trailing slash.`)}const I1=l=>typeof l=="object"&&Number.isInteger(l==null?void 0:l.num)&&l.num>=0&&Number.isInteger(l==null?void 0:l.gen)&&l.gen>=0,q3=l=>typeof l=="object"&&typeof(l==null?void 0:l.name)=="string",X3=x3.bind(null,I1,q3);var Dl,X_;class Y3{constructor(){O(this,Dl,new Map);O(this,X_,Promise.resolve())}postMessage(t,e){const n={data:structuredClone(t,e?{transfer:e}:null)};c(this,X_).then(()=>{for(const[s]of c(this,Dl))s.call(this,n)})}addEventListener(t,e,n=null){let s=null;if((n==null?void 0:n.signal)instanceof AbortSignal){const{signal:r}=n;if(r.aborted){me("LoopbackPort - cannot use an `aborted` signal.");return}const u=()=>this.removeEventListener(t,e);s=()=>r.removeEventListener("abort",u),r.addEventListener("abort",u)}c(this,Dl).set(e,s)}removeEventListener(t,e){const n=c(this,Dl).get(e);n==null||n(),c(this,Dl).delete(e)}terminate(){for(const[,t]of c(this,Dl))t==null||t();c(this,Dl).clear()}}Dl=new WeakMap,X_=new WeakMap;const Aw={DATA:1,ERROR:2},ui={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function $D(){}function Vs(l){if(l instanceof Uu||l instanceof f1||l instanceof LD||l instanceof x_||l instanceof jE)return l;switch(l instanceof Error||typeof l=="object"&&l!==null||yn('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),l.name){case"AbortException":return new Uu(l.message);case"InvalidPDFException":return new f1(l.message);case"PasswordException":return new LD(l.message,l.code);case"ResponseException":return new x_(l.message,l.status,l.missing);case"UnknownErrorException":return new jE(l.message,l.details)}return new jE(l.message,l.toString())}var Kp,hr,H2,$2,V2,Yw;class vy{constructor(t,e,n){O(this,hr);O(this,Kp,new AbortController);this.sourceName=t,this.targetName=e,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",N(this,hr,H2).bind(this),{signal:c(this,Kp).signal})}on(t,e){const n=this.actionHandler;if(n[t])throw new Error(`There is already an actionName called "${t}"`);n[t]=e}send(t,e,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},n)}sendWithPromise(t,e,n){const s=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[s]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:s,data:e},n)}catch(u){r.reject(u)}return r.promise}sendWithStream(t,e,n,s){const r=this.streamId++,u=this.sourceName,h=this.targetName,f=this.comObj;return new ReadableStream({start:p=>{const m=Promise.withResolvers();return this.streamControllers[r]={controller:p,startCall:m,pullCall:null,cancelCall:null,isClosed:!1},f.postMessage({sourceName:u,targetName:h,action:t,streamId:r,data:e,desiredSize:p.desiredSize},s),m.promise},pull:p=>{const m=Promise.withResolvers();return this.streamControllers[r].pullCall=m,f.postMessage({sourceName:u,targetName:h,stream:ui.PULL,streamId:r,desiredSize:p.desiredSize}),m.promise},cancel:p=>{Ue(p instanceof Error,"cancel must have a valid reason");const m=Promise.withResolvers();return this.streamControllers[r].cancelCall=m,this.streamControllers[r].isClosed=!0,f.postMessage({sourceName:u,targetName:h,stream:ui.CANCEL,streamId:r,reason:Vs(p)}),m.promise}},n)}destroy(){var t;(t=c(this,Kp))==null||t.abort(),E(this,Kp,null)}}Kp=new WeakMap,hr=new WeakSet,H2=function({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){N(this,hr,V2).call(this,t);return}if(t.callback){const n=t.callbackId,s=this.callbackCapabilities[n];if(!s)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],t.callback===Aw.DATA)s.resolve(t.data);else if(t.callback===Aw.ERROR)s.reject(Vs(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const n=this.sourceName,s=t.sourceName,r=this.comObj;Promise.try(e,t.data).then(function(u){r.postMessage({sourceName:n,targetName:s,callback:Aw.DATA,callbackId:t.callbackId,data:u})},function(u){r.postMessage({sourceName:n,targetName:s,callback:Aw.ERROR,callbackId:t.callbackId,reason:Vs(u)})});return}if(t.streamId){N(this,hr,$2).call(this,t);return}e(t.data)},$2=function(t){const e=t.streamId,n=this.sourceName,s=t.sourceName,r=this.comObj,u=this,h=this.actionHandler[t.action],f={enqueue(p,m=1,b){if(this.isCancelled)return;const _=this.desiredSize;this.desiredSize-=m,_>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:n,targetName:s,stream:ui.ENQUEUE,streamId:e,chunk:p},b)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:ui.CLOSE,streamId:e}),delete u.streamSinks[e])},error(p){Ue(p instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:ui.ERROR,streamId:e,reason:Vs(p)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};f.sinkCapability.resolve(),f.ready=f.sinkCapability.promise,this.streamSinks[e]=f,Promise.try(h,t.data,f).then(function(){r.postMessage({sourceName:n,targetName:s,stream:ui.START_COMPLETE,streamId:e,success:!0})},function(p){r.postMessage({sourceName:n,targetName:s,stream:ui.START_COMPLETE,streamId:e,reason:Vs(p)})})},V2=function(t){const e=t.streamId,n=this.sourceName,s=t.sourceName,r=this.comObj,u=this.streamControllers[e],h=this.streamSinks[e];switch(t.stream){case ui.START_COMPLETE:t.success?u.startCall.resolve():u.startCall.reject(Vs(t.reason));break;case ui.PULL_COMPLETE:t.success?u.pullCall.resolve():u.pullCall.reject(Vs(t.reason));break;case ui.PULL:if(!h){r.postMessage({sourceName:n,targetName:s,stream:ui.PULL_COMPLETE,streamId:e,success:!0});break}h.desiredSize<=0&&t.desiredSize>0&&h.sinkCapability.resolve(),h.desiredSize=t.desiredSize,Promise.try(h.onPull||$D).then(function(){r.postMessage({sourceName:n,targetName:s,stream:ui.PULL_COMPLETE,streamId:e,success:!0})},function(p){r.postMessage({sourceName:n,targetName:s,stream:ui.PULL_COMPLETE,streamId:e,reason:Vs(p)})});break;case ui.ENQUEUE:if(Ue(u,"enqueue should have stream controller"),u.isClosed)break;u.controller.enqueue(t.chunk);break;case ui.CLOSE:if(Ue(u,"close should have stream controller"),u.isClosed)break;u.isClosed=!0,u.controller.close(),N(this,hr,Yw).call(this,u,e);break;case ui.ERROR:Ue(u,"error should have stream controller"),u.controller.error(Vs(t.reason)),N(this,hr,Yw).call(this,u,e);break;case ui.CANCEL_COMPLETE:t.success?u.cancelCall.resolve():u.cancelCall.reject(Vs(t.reason)),N(this,hr,Yw).call(this,u,e);break;case ui.CANCEL:if(!h)break;const f=Vs(t.reason);Promise.try(h.onCancel||$D,f).then(function(){r.postMessage({sourceName:n,targetName:s,stream:ui.CANCEL_COMPLETE,streamId:e,success:!0})},function(p){r.postMessage({sourceName:n,targetName:s,stream:ui.CANCEL_COMPLETE,streamId:e,reason:Vs(p)})}),h.sinkCapability.reject(f),h.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}},Yw=async function(t,e){var n,s,r;await Promise.allSettled([(n=t.startCall)==null?void 0:n.promise,(s=t.pullCall)==null?void 0:s.promise,(r=t.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[e]};var xb;class G2{constructor({enableHWA:t=!1}){O(this,xb,!1);E(this,xb,t)}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(t,e);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!c(this,xb)})}}reset(t,e,n){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||n<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=n}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){yn("Abstract method `_createCanvas` called.")}}xb=new WeakMap;class K3 extends G2{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const n=this._document.createElement("canvas");return n.width=t,n.height=e,n}}class q2{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){yn("Abstract method `_fetch` called.")}}class VD extends q2{async _fetch(t){const e=await $v(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Hv(e)}}class X2{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,n,s,r){return"none"}destroy(t=!1){}}var ed,Wp,Ml,Nl,ys,nd,id,$t,ds,wy,ep,Kw,np,Y2,B1,ip,_y,Ay,F1,Sy;class W3 extends X2{constructor({docId:e,ownerDocument:n=globalThis.document}){super();O(this,$t);O(this,ed);O(this,Wp);O(this,Ml);O(this,Nl);O(this,ys);O(this,nd);O(this,id,0);E(this,Nl,e),E(this,ys,n)}addFilter(e){if(!e)return"none";let n=c(this,$t,ds).get(e);if(n)return n;const[s,r,u]=N(this,$t,Kw).call(this,e),h=e.length===1?s:`${s}${r}${u}`;if(n=c(this,$t,ds).get(h),n)return c(this,$t,ds).set(e,n),n;const f=`g_${c(this,Nl)}_transfer_map_${bi(this,id)._++}`,p=N(this,$t,np).call(this,f);c(this,$t,ds).set(e,p),c(this,$t,ds).set(h,p);const m=N(this,$t,ip).call(this,f);return N(this,$t,Ay).call(this,s,r,u,m),p}addHCMFilter(e,n){var R;const s=`${e}-${n}`,r="base";let u=c(this,$t,wy).get(r);if((u==null?void 0:u.key)===s||(u?((R=u.filter)==null||R.remove(),u.key=s,u.url="none",u.filter=null):(u={key:s,url:"none",filter:null},c(this,$t,wy).set(r,u)),!e||!n))return u.url;const h=N(this,$t,Sy).call(this,e);e=jt.makeHexColor(...h);const f=N(this,$t,Sy).call(this,n);if(n=jt.makeHexColor(...f),c(this,$t,ep).style.color="",e==="#000000"&&n==="#ffffff"||e===n)return u.url;const p=new Array(256);for(let C=0;C<=255;C++){const M=C/255;p[C]=M<=.03928?M/12.92:((M+.055)/1.055)**2.4}const m=p.join(","),b=`g_${c(this,Nl)}_hcm_filter`,_=u.filter=N(this,$t,ip).call(this,b);N(this,$t,Ay).call(this,m,m,m,_),N(this,$t,B1).call(this,_);const S=(C,M)=>{const k=h[C]/255,I=f[C]/255,P=new Array(M+1);for(let F=0;F<=M;F++)P[F]=k+F/M*(I-k);return P.join(",")};return N(this,$t,Ay).call(this,S(0,5),S(1,5),S(2,5),_),u.url=N(this,$t,np).call(this,b),u.url}addAlphaFilter(e){let n=c(this,$t,ds).get(e);if(n)return n;const[s]=N(this,$t,Kw).call(this,[e]),r=`alpha_${s}`;if(n=c(this,$t,ds).get(r),n)return c(this,$t,ds).set(e,n),n;const u=`g_${c(this,Nl)}_alpha_map_${bi(this,id)._++}`,h=N(this,$t,np).call(this,u);c(this,$t,ds).set(e,h),c(this,$t,ds).set(r,h);const f=N(this,$t,ip).call(this,u);return N(this,$t,F1).call(this,s,f),h}addLuminosityFilter(e){let n=c(this,$t,ds).get(e||"luminosity");if(n)return n;let s,r;if(e?([s]=N(this,$t,Kw).call(this,[e]),r=`luminosity_${s}`):r="luminosity",n=c(this,$t,ds).get(r),n)return c(this,$t,ds).set(e,n),n;const u=`g_${c(this,Nl)}_luminosity_map_${bi(this,id)._++}`,h=N(this,$t,np).call(this,u);c(this,$t,ds).set(e,h),c(this,$t,ds).set(r,h);const f=N(this,$t,ip).call(this,u);return N(this,$t,Y2).call(this,f),e&&N(this,$t,F1).call(this,s,f),h}addHighlightHCMFilter(e,n,s,r,u){var I;const h=`${n}-${s}-${r}-${u}`;let f=c(this,$t,wy).get(e);if((f==null?void 0:f.key)===h||(f?((I=f.filter)==null||I.remove(),f.key=h,f.url="none",f.filter=null):(f={key:h,url:"none",filter:null},c(this,$t,wy).set(e,f)),!n||!s))return f.url;const[p,m]=[n,s].map(N(this,$t,Sy).bind(this));let b=Math.round(.2126*p[0]+.7152*p[1]+.0722*p[2]),_=Math.round(.2126*m[0]+.7152*m[1]+.0722*m[2]),[S,R]=[r,u].map(N(this,$t,Sy).bind(this));_<b&&([b,_,S,R]=[_,b,R,S]),c(this,$t,ep).style.color="";const C=(P,F,z)=>{const j=new Array(256),H=(_-b)/z,dt=P/255,ct=(F-P)/(255*z);let yt=0;for(let gt=0;gt<=z;gt++){const Pt=Math.round(b+gt*H),Xt=dt+gt*ct;for(let Vt=yt;Vt<=Pt;Vt++)j[Vt]=Xt;yt=Pt+1}for(let gt=yt;gt<256;gt++)j[gt]=j[yt-1];return j.join(",")},M=`g_${c(this,Nl)}_hcm_${e}_filter`,k=f.filter=N(this,$t,ip).call(this,M);return N(this,$t,B1).call(this,k),N(this,$t,Ay).call(this,C(S[0],R[0],5),C(S[1],R[1],5),C(S[2],R[2],5),k),f.url=N(this,$t,np).call(this,M),f.url}destroy(e=!1){var n,s,r,u;e&&((n=c(this,nd))!=null&&n.size)||((s=c(this,Ml))==null||s.parentNode.parentNode.remove(),E(this,Ml,null),(r=c(this,Wp))==null||r.clear(),E(this,Wp,null),(u=c(this,nd))==null||u.clear(),E(this,nd,null),E(this,id,0))}}ed=new WeakMap,Wp=new WeakMap,Ml=new WeakMap,Nl=new WeakMap,ys=new WeakMap,nd=new WeakMap,id=new WeakMap,$t=new WeakSet,ds=function(){return c(this,Wp)||E(this,Wp,new Map)},wy=function(){return c(this,nd)||E(this,nd,new Map)},ep=function(){if(!c(this,Ml)){const e=c(this,ys).createElement("div"),{style:n}=e;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;const s=c(this,ys).createElementNS(pl,"svg");s.setAttribute("width",0),s.setAttribute("height",0),E(this,Ml,c(this,ys).createElementNS(pl,"defs")),e.append(s),s.append(c(this,Ml)),c(this,ys).body.append(e)}return c(this,Ml)},Kw=function(e){if(e.length===1){const p=e[0],m=new Array(256);for(let _=0;_<256;_++)m[_]=p[_]/255;const b=m.join(",");return[b,b,b]}const[n,s,r]=e,u=new Array(256),h=new Array(256),f=new Array(256);for(let p=0;p<256;p++)u[p]=n[p]/255,h[p]=s[p]/255,f[p]=r[p]/255;return[u.join(","),h.join(","),f.join(",")]},np=function(e){if(c(this,ed)===void 0){E(this,ed,"");const n=c(this,ys).URL;n!==c(this,ys).baseURI&&(EA(n)?me('#createUrl: ignore "data:"-URL for performance reasons.'):E(this,ed,e2(n,"")))}return`url(${c(this,ed)}#${e})`},Y2=function(e){const n=c(this,ys).createElementNS(pl,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(n)},B1=function(e){const n=c(this,ys).createElementNS(pl,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(n)},ip=function(e){const n=c(this,ys).createElementNS(pl,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",e),c(this,$t,ep).append(n),n},_y=function(e,n,s){const r=c(this,ys).createElementNS(pl,n);r.setAttribute("type","discrete"),r.setAttribute("tableValues",s),e.append(r)},Ay=function(e,n,s,r){const u=c(this,ys).createElementNS(pl,"feComponentTransfer");r.append(u),N(this,$t,_y).call(this,u,"feFuncR",e),N(this,$t,_y).call(this,u,"feFuncG",n),N(this,$t,_y).call(this,u,"feFuncB",s)},F1=function(e,n){const s=c(this,ys).createElementNS(pl,"feComponentTransfer");n.append(s),N(this,$t,_y).call(this,s,"feFuncA",e)},Sy=function(e){return c(this,$t,ep).style.color=e,Gv(getComputedStyle(c(this,$t,ep)).getPropertyValue("color"))};class K2{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){yn("Abstract method `_fetch` called.")}}class GD extends K2{async _fetch(t){const e=await $v(t,"arraybuffer");return new Uint8Array(e)}}class W2{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){yn("Abstract method `_fetch` called.")}}class qD extends W2{async _fetch(t){const e=await $v(t,"arraybuffer");return new Uint8Array(e)}}Ds&&me("Please use the `legacy` build in Node.js environments.");async function kx(l){const e=await process.getBuiltinModule("fs").promises.readFile(l);return new Uint8Array(e)}class Q3 extends X2{}class J3 extends G2{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class Z3 extends q2{async _fetch(t){return kx(t)}}class tU extends K2{async _fetch(t){return kx(t)}}class eU extends W2{async _fetch(t){return kx(t)}}const Kf="__forcedDependency",{floor:XD,ceil:YD}=Math;function Sw(l,t,e,n,s,r){l[t*4+0]=Math.min(l[t*4+0],e),l[t*4+1]=Math.min(l[t*4+1],n),l[t*4+2]=Math.max(l[t*4+2],s),l[t*4+3]=Math.max(l[t*4+3],r)}const U1=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];var Qp,fu;class nU{constructor(t,e){O(this,Qp);O(this,fu);E(this,Qp,t),E(this,fu,e)}get length(){return c(this,Qp).length}isEmpty(t){return c(this,Qp)[t]===U1}minX(t){return c(this,fu)[t*4+0]/256}minY(t){return c(this,fu)[t*4+1]/256}maxX(t){return(c(this,fu)[t*4+2]+1)/256}maxY(t){return(c(this,fu)[t*4+3]+1)/256}}Qp=new WeakMap,fu=new WeakMap;const Ew=(l,t)=>{if(!l)return;let e=l.get(t);return e||(e={dependencies:new Set,isRenderingOperation:!1},l.set(t,e)),e};var Xs,Ys,sd,Or,ad,kl,Ze,cn,Pl,Ks,Tb,Jp,rd,od,Ll,bs,_o,Rb,z1;class iU{constructor(t,e,n=!1){O(this,Rb);O(this,Xs,{__proto__:null});O(this,Ys,{__proto__:null,transform:[],moveText:[],sameLineText:[],[Kf]:[]});O(this,sd,new Map);O(this,Or,[]);O(this,ad,[]);O(this,kl,[[1,0,0,1,0,0]]);O(this,Ze,[-1/0,-1/0,1/0,1/0]);O(this,cn,new Float64Array([1/0,1/0,-1/0,-1/0]));O(this,Pl,-1);O(this,Ks,new Set);O(this,Tb,new Map);O(this,Jp,new Map);O(this,rd);O(this,od);O(this,Ll);O(this,bs);O(this,_o);E(this,rd,t.width),E(this,od,t.height),N(this,Rb,z1).call(this,e),n&&E(this,_o,new Map)}growOperationsCount(t){t>=c(this,bs).length&&N(this,Rb,z1).call(this,t,c(this,bs))}save(t){return E(this,Xs,{__proto__:c(this,Xs)}),E(this,Ys,{__proto__:c(this,Ys),transform:{__proto__:c(this,Ys).transform},moveText:{__proto__:c(this,Ys).moveText},sameLineText:{__proto__:c(this,Ys).sameLineText},[Kf]:{__proto__:c(this,Ys)[Kf]}}),E(this,Ze,{__proto__:c(this,Ze)}),c(this,Or).push(t),this}restore(t){var s;const e=Object.getPrototypeOf(c(this,Xs));if(e===null)return this;E(this,Xs,e),E(this,Ys,Object.getPrototypeOf(c(this,Ys))),E(this,Ze,Object.getPrototypeOf(c(this,Ze)));const n=c(this,Or).pop();return n!==void 0&&((s=Ew(c(this,_o),t))==null||s.dependencies.add(n),c(this,bs)[t]=c(this,bs)[n]),this}recordOpenMarker(t){return c(this,Or).push(t),this}getOpenMarker(){return c(this,Or).length===0?null:c(this,Or).at(-1)}recordCloseMarker(t){var n;const e=c(this,Or).pop();return e!==void 0&&((n=Ew(c(this,_o),t))==null||n.dependencies.add(e),c(this,bs)[t]=c(this,bs)[e]),this}beginMarkedContent(t){return c(this,ad).push(t),this}endMarkedContent(t){var n;const e=c(this,ad).pop();return e!==void 0&&((n=Ew(c(this,_o),t))==null||n.dependencies.add(e),c(this,bs)[t]=c(this,bs)[e]),this}pushBaseTransform(t){return c(this,kl).push(jt.multiplyByDOMMatrix(c(this,kl).at(-1),t.getTransform())),this}popBaseTransform(){return c(this,kl).length>1&&c(this,kl).pop(),this}recordSimpleData(t,e){return c(this,Xs)[t]=e,this}recordIncrementalData(t,e){return c(this,Ys)[t].push(e),this}resetIncrementalData(t,e){return c(this,Ys)[t].length=0,this}recordNamedData(t,e){return c(this,sd).set(t,e),this}recordSimpleDataFromNamed(t,e,n){c(this,Xs)[t]=c(this,sd).get(e)??n}recordFutureForcedDependency(t,e){return this.recordIncrementalData(Kf,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in c(this,Xs)&&this.recordFutureForcedDependency(e,c(this,Xs)[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of c(this,Ks))this.recordFutureForcedDependency(Kf,t);return this}resetBBox(t){return c(this,Pl)!==t&&(E(this,Pl,t),c(this,cn)[0]=1/0,c(this,cn)[1]=1/0,c(this,cn)[2]=-1/0,c(this,cn)[3]=-1/0),this}recordClipBox(t,e,n,s,r,u){const h=jt.multiplyByDOMMatrix(c(this,kl).at(-1),e.getTransform()),f=[1/0,1/0,-1/0,-1/0];jt.axialAlignedBoundingBox([n,r,s,u],h,f);const p=jt.intersect(c(this,Ze),f);return p?(c(this,Ze)[0]=p[0],c(this,Ze)[1]=p[1],c(this,Ze)[2]=p[2],c(this,Ze)[3]=p[3]):(c(this,Ze)[0]=c(this,Ze)[1]=1/0,c(this,Ze)[2]=c(this,Ze)[3]=-1/0),this}recordBBox(t,e,n,s,r,u){const h=c(this,Ze);if(h[0]===1/0)return this;const f=jt.multiplyByDOMMatrix(c(this,kl).at(-1),e.getTransform());if(h[0]===-1/0)return jt.axialAlignedBoundingBox([n,r,s,u],f,c(this,cn)),this;const p=[1/0,1/0,-1/0,-1/0];return jt.axialAlignedBoundingBox([n,r,s,u],f,p),c(this,cn)[0]=Math.min(c(this,cn)[0],Math.max(p[0],h[0])),c(this,cn)[1]=Math.min(c(this,cn)[1],Math.max(p[1],h[1])),c(this,cn)[2]=Math.max(c(this,cn)[2],Math.min(p[2],h[2])),c(this,cn)[3]=Math.max(c(this,cn)[3],Math.min(p[3],h[3])),this}recordCharacterBBox(t,e,n,s=1,r=0,u=0,h){const f=n.bbox;let p,m;if(f&&(p=f[2]!==f[0]&&f[3]!==f[1]&&c(this,Jp).get(n),p!==!1&&(m=[0,0,0,0],jt.axialAlignedBoundingBox(f,n.fontMatrix,m),(s!==1||r!==0||u!==0)&&jt.scaleMinMax([s,0,0,-s,r,u],m),p)))return this.recordBBox(t,e,m[0],m[2],m[1],m[3]);if(!h)return this.recordFullPageBBox(t);const b=h();return f&&m&&p===void 0&&(p=m[0]<=r-b.actualBoundingBoxLeft&&m[2]>=r+b.actualBoundingBoxRight&&m[1]<=u-b.actualBoundingBoxAscent&&m[3]>=u+b.actualBoundingBoxDescent,c(this,Jp).set(n,p),p)?this.recordBBox(t,e,m[0],m[2],m[1],m[3]):this.recordBBox(t,e,r-b.actualBoundingBoxLeft,r+b.actualBoundingBoxRight,u-b.actualBoundingBoxAscent,u+b.actualBoundingBoxDescent)}recordFullPageBBox(t){return c(this,cn)[0]=Math.max(0,c(this,Ze)[0]),c(this,cn)[1]=Math.max(0,c(this,Ze)[1]),c(this,cn)[2]=Math.min(c(this,rd),c(this,Ze)[2]),c(this,cn)[3]=Math.min(c(this,od),c(this,Ze)[3]),this}getSimpleIndex(t){return c(this,Xs)[t]}recordDependencies(t,e){const n=c(this,Ks),s=c(this,Xs),r=c(this,Ys);for(const u of e)u in c(this,Xs)?n.add(s[u]):u in r&&r[u].forEach(n.add,n);return this}recordNamedDependency(t,e){return c(this,sd).has(e)&&c(this,Ks).add(c(this,sd).get(e)),this}recordOperation(t,e=!1){if(this.recordDependencies(t,[Kf]),c(this,_o)){const n=Ew(c(this,_o),t),{dependencies:s}=n;c(this,Ks).forEach(s.add,s),c(this,Or).forEach(s.add,s),c(this,ad).forEach(s.add,s),s.delete(t),n.isRenderingOperation=!0}if(c(this,Pl)===t){const n=XD(c(this,cn)[0]*256/c(this,rd)),s=XD(c(this,cn)[1]*256/c(this,od)),r=YD(c(this,cn)[2]*256/c(this,rd)),u=YD(c(this,cn)[3]*256/c(this,od));Sw(c(this,Ll),t,n,s,r,u);for(const h of c(this,Ks))h!==t&&Sw(c(this,Ll),h,n,s,r,u);for(const h of c(this,Or))h!==t&&Sw(c(this,Ll),h,n,s,r,u);for(const h of c(this,ad))h!==t&&Sw(c(this,Ll),h,n,s,r,u);e||(c(this,Ks).clear(),E(this,Pl,-1))}return this}recordShowTextOperation(t,e=!1){const n=Array.from(c(this,Ks));this.recordOperation(t,e),this.recordIncrementalData("sameLineText",t);for(const s of n)this.recordIncrementalData("sameLineText",s);return this}bboxToClipBoxDropOperation(t,e=!1){return c(this,Pl)===t&&(E(this,Pl,-1),c(this,Ze)[0]=Math.max(c(this,Ze)[0],c(this,cn)[0]),c(this,Ze)[1]=Math.max(c(this,Ze)[1],c(this,cn)[1]),c(this,Ze)[2]=Math.min(c(this,Ze)[2],c(this,cn)[2]),c(this,Ze)[3]=Math.min(c(this,Ze)[3],c(this,cn)[3]),e||c(this,Ks).clear()),this}_takePendingDependencies(){const t=c(this,Ks);return E(this,Ks,new Set),t}_extractOperation(t){const e=c(this,Tb).get(t);return c(this,Tb).delete(t),e}_pushPendingDependencies(t){for(const e of t)c(this,Ks).add(e)}take(){return c(this,Jp).clear(),new nU(c(this,bs),c(this,Ll))}takeDebugMetadata(){return c(this,_o)}}Xs=new WeakMap,Ys=new WeakMap,sd=new WeakMap,Or=new WeakMap,ad=new WeakMap,kl=new WeakMap,Ze=new WeakMap,cn=new WeakMap,Pl=new WeakMap,Ks=new WeakMap,Tb=new WeakMap,Jp=new WeakMap,rd=new WeakMap,od=new WeakMap,Ll=new WeakMap,bs=new WeakMap,_o=new WeakMap,Rb=new WeakSet,z1=function(t,e){const n=new ArrayBuffer(t*4);E(this,Ll,new Uint8ClampedArray(n)),E(this,bs,new Uint32Array(n)),e&&e.length>0?(c(this,bs).set(e),c(this,bs).fill(U1,e.length)):c(this,bs).fill(U1)};var mn,Gn,Dr,Zp,tm;const jx=class jx{constructor(t,e,n){O(this,mn);O(this,Gn);O(this,Dr);O(this,Zp,0);O(this,tm,0);if(t instanceof jx&&c(t,Dr)===!!n)return t;E(this,mn,t),E(this,Gn,e),E(this,Dr,!!n)}growOperationsCount(){throw new Error("Unreachable")}save(t){return bi(this,tm)._++,c(this,mn).save(c(this,Gn)),this}restore(t){return c(this,tm)>0&&(c(this,mn).restore(c(this,Gn)),bi(this,tm)._--),this}recordOpenMarker(t){return bi(this,Zp)._++,this}getOpenMarker(){return c(this,Zp)>0?c(this,Gn):c(this,mn).getOpenMarker()}recordCloseMarker(t){return bi(this,Zp)._--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return c(this,mn).pushBaseTransform(t),this}popBaseTransform(){return c(this,mn).popBaseTransform(),this}recordSimpleData(t,e){return c(this,mn).recordSimpleData(t,c(this,Gn)),this}recordIncrementalData(t,e){return c(this,mn).recordIncrementalData(t,c(this,Gn)),this}resetIncrementalData(t,e){return c(this,mn).resetIncrementalData(t,c(this,Gn)),this}recordNamedData(t,e){return this}recordSimpleDataFromNamed(t,e,n){return c(this,mn).recordSimpleDataFromNamed(t,e,c(this,Gn)),this}recordFutureForcedDependency(t,e){return c(this,mn).recordFutureForcedDependency(t,c(this,Gn)),this}inheritSimpleDataAsFutureForcedDependencies(t){return c(this,mn).inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return c(this,mn).inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return c(this,Dr)||c(this,mn).resetBBox(c(this,Gn)),this}recordClipBox(t,e,n,s,r,u){return c(this,Dr)||c(this,mn).recordClipBox(c(this,Gn),e,n,s,r,u),this}recordBBox(t,e,n,s,r,u){return c(this,Dr)||c(this,mn).recordBBox(c(this,Gn),e,n,s,r,u),this}recordCharacterBBox(t,e,n,s,r,u,h){return c(this,Dr)||c(this,mn).recordCharacterBBox(c(this,Gn),e,n,s,r,u,h),this}recordFullPageBBox(t){return c(this,Dr)||c(this,mn).recordFullPageBBox(c(this,Gn)),this}getSimpleIndex(t){return c(this,mn).getSimpleIndex(t)}recordDependencies(t,e){return c(this,mn).recordDependencies(c(this,Gn),e),this}recordNamedDependency(t,e){return c(this,mn).recordNamedDependency(c(this,Gn),e),this}recordOperation(t){return c(this,mn).recordOperation(c(this,Gn),!0),this}recordShowTextOperation(t){return c(this,mn).recordShowTextOperation(c(this,Gn),!0),this}bboxToClipBoxDropOperation(t){return c(this,Dr)||c(this,mn).bboxToClipBoxDropOperation(c(this,Gn),!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}};mn=new WeakMap,Gn=new WeakMap,Dr=new WeakMap,Zp=new WeakMap,tm=new WeakMap;let N_=jx;const Wa={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},is={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function j1(l,t){if(!t)return;const e=t[2]-t[0],n=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],e,n),l.clip(s)}class Px{isModifyingCurrentTransform(){return!1}getPattern(){yn("Abstract method `getPattern` called.")}}class sU extends Px{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}isOriginBased(){return this._p0[0]===0&&this._p0[1]===0&&(!this.isRadial()||this._p1[0]===0&&this._p1[1]===0)}isRadial(){return this._type==="radial"}_createGradient(t,e=null){let n,s=this._p0,r=this._p1;if(e&&(s=s.slice(),r=r.slice(),jt.applyTransform(s,e),jt.applyTransform(r,e)),this._type==="axial")n=t.createLinearGradient(s[0],s[1],r[0],r[1]);else if(this._type==="radial"){let u=this._r0,h=this._r1;if(e){const f=new Float32Array(2);jt.singularValueDecompose2dScale(e,f),u*=f[0],h*=f[0]}n=t.createRadialGradient(s[0],s[1],u,r[0],r[1],h)}for(const u of this._colorStops)n.addColorStop(u[0],u[1]);return n}getPattern(t,e,n,s){let r;if(s===is.STROKE||s===is.FILL){if(this.isOriginBased()){let _=jt.transform(n,e.baseTransform);this.matrix&&(_=jt.transform(_,this.matrix));const S=.001,R=Math.hypot(_[0],_[1]),C=Math.hypot(_[2],_[3]),M=(_[0]*_[2]+_[1]*_[3])/(R*C);if(Math.abs(M)<S)if(this.isRadial()){if(Math.abs(R-C)<S)return this._createGradient(t,_)}else return this._createGradient(t,_)}const u=e.current.getClippedPathBoundingBox(s,Un(t))||[0,0,0,0],h=Math.ceil(u[2]-u[0])||1,f=Math.ceil(u[3]-u[1])||1,p=e.cachedCanvases.getCanvas("pattern",h,f),m=p.context;m.clearRect(0,0,m.canvas.width,m.canvas.height),m.beginPath(),m.rect(0,0,m.canvas.width,m.canvas.height),m.translate(-u[0],-u[1]),n=jt.transform(n,[1,0,0,1,u[0],u[1]]),m.transform(...e.baseTransform),this.matrix&&m.transform(...this.matrix),j1(m,this._bbox),m.fillStyle=this._createGradient(m),m.fill(),r=t.createPattern(p.canvas,"no-repeat");const b=new DOMMatrix(n);r.setTransform(b)}else j1(t,this._bbox),r=this._createGradient(t);return r}}function VE(l,t,e,n,s,r,u,h){const f=t.coords,p=t.colors,m=l.data,b=l.width*4;let _;f[e+1]>f[n+1]&&(_=e,e=n,n=_,_=r,r=u,u=_),f[n+1]>f[s+1]&&(_=n,n=s,s=_,_=u,u=h,h=_),f[e+1]>f[n+1]&&(_=e,e=n,n=_,_=r,r=u,u=_);const S=(f[e]+t.offsetX)*t.scaleX,R=(f[e+1]+t.offsetY)*t.scaleY,C=(f[n]+t.offsetX)*t.scaleX,M=(f[n+1]+t.offsetY)*t.scaleY,k=(f[s]+t.offsetX)*t.scaleX,I=(f[s+1]+t.offsetY)*t.scaleY;if(R>=I)return;const P=p[r],F=p[r+1],z=p[r+2],j=p[u],H=p[u+1],dt=p[u+2],ct=p[h],yt=p[h+1],gt=p[h+2],Pt=Math.round(R),Xt=Math.round(I);let Vt,Yt,J,pt,Et,Wt,Zt,G;for(let ft=Pt;ft<=Xt;ft++){if(ft<M){const Ft=ft<R?0:(R-ft)/(R-M);Vt=S-(S-C)*Ft,Yt=P-(P-j)*Ft,J=F-(F-H)*Ft,pt=z-(z-dt)*Ft}else{let Ft;ft>I?Ft=1:M===I?Ft=0:Ft=(M-ft)/(M-I),Vt=C-(C-k)*Ft,Yt=j-(j-ct)*Ft,J=H-(H-yt)*Ft,pt=dt-(dt-gt)*Ft}let _t;ft<R?_t=0:ft>I?_t=1:_t=(R-ft)/(R-I),Et=S-(S-k)*_t,Wt=P-(P-ct)*_t,Zt=F-(F-yt)*_t,G=z-(z-gt)*_t;const Mt=Math.round(Math.min(Vt,Et)),It=Math.round(Math.max(Vt,Et));let Gt=b*ft+Mt*4;for(let Ft=Mt;Ft<=It;Ft++)_t=(Vt-Ft)/(Vt-Et),_t<0?_t=0:_t>1&&(_t=1),m[Gt++]=Yt-(Yt-Wt)*_t|0,m[Gt++]=J-(J-Zt)*_t|0,m[Gt++]=pt-(pt-G)*_t|0,m[Gt++]=255}}function aU(l,t,e){const n=t.coords,s=t.colors;let r,u;switch(t.type){case d1.LATTICE:const h=t.verticesPerRow,f=Math.floor(n.length/h)-1,p=h-1;for(r=0;r<f;r++){let m=r*h;for(let b=0;b<p;b++,m++)VE(l,e,n[m],n[m+1],n[m+h],s[m],s[m+1],s[m+h]),VE(l,e,n[m+h+1],n[m+1],n[m+h],s[m+h+1],s[m+1],s[m+h])}break;case d1.TRIANGLES:for(r=0,u=n.length;r<u;r+=3)VE(l,e,n[r],n[r+1],n[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}class rU extends Px{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,n){const h=Math.floor(this._bounds[0]),f=Math.floor(this._bounds[1]),p=Math.ceil(this._bounds[2])-h,m=Math.ceil(this._bounds[3])-f,b=Math.min(Math.ceil(Math.abs(p*t[0]*1.1)),3e3),_=Math.min(Math.ceil(Math.abs(m*t[1]*1.1)),3e3),S=p/b,R=m/_,C={coords:this._coords,colors:this._colors,offsetX:-h,offsetY:-f,scaleX:1/S,scaleY:1/R},M=b+4,k=_+4,I=n.getCanvas("mesh",M,k),P=I.context,F=P.createImageData(b,_);if(e){const j=F.data;for(let H=0,dt=j.length;H<dt;H+=4)j[H]=e[0],j[H+1]=e[1],j[H+2]=e[2],j[H+3]=255}for(const j of this._figures)aU(F,j,C);return P.putImageData(F,2,2),{canvas:I.canvas,offsetX:h-2*S,offsetY:f-2*R,scaleX:S,scaleY:R}}isModifyingCurrentTransform(){return!0}getPattern(t,e,n,s){j1(t,this._bbox);const r=new Float32Array(2);if(s===is.SHADING)jt.singularValueDecompose2dScale(Un(t),r);else if(this.matrix){jt.singularValueDecompose2dScale(this.matrix,r);const[h,f]=r;jt.singularValueDecompose2dScale(e.baseTransform,r),r[0]*=h,r[1]*=f}else jt.singularValueDecompose2dScale(e.baseTransform,r);const u=this._createMeshCanvas(r,s===is.SHADING?null:this._background,e.cachedCanvases);return s!==is.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(u.offsetX,u.offsetY),t.scale(u.scaleX,u.scaleY),t.createPattern(u.canvas,"no-repeat")}}class oU extends Px{getPattern(){return"hotpink"}}function lU(l){switch(l[0]){case"RadialAxial":return new sU(l);case"Mesh":return new rU(l);case"Dummy":return new oU}throw new Error(`Unknown IR type: ${l[0]}`)}const KD={COLORED:1,UNCOLORED:2},Y_=class Y_{constructor(t,e,n,s){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=n,this.baseTransform=s}createPatternCanvas(t,e){var Wt,Zt;const{bbox:n,operatorList:s,paintType:r,tilingType:u,color:h,canvasGraphicsFactory:f}=this;let{xstep:p,ystep:m}=this;p=Math.abs(p),m=Math.abs(m),SA("TilingType: "+u);const b=n[0],_=n[1],S=n[2],R=n[3],C=S-b,M=R-_,k=new Float32Array(2);jt.singularValueDecompose2dScale(this.matrix,k);const[I,P]=k;jt.singularValueDecompose2dScale(this.baseTransform,k);const F=I*k[0],z=P*k[1];let j=C,H=M,dt=!1,ct=!1;const yt=Math.ceil(p*F),gt=Math.ceil(m*z),Pt=Math.ceil(C*F),Xt=Math.ceil(M*z);yt>=Pt?j=p:dt=!0,gt>=Xt?H=m:ct=!0;const Vt=this.getSizeAndScale(j,this.ctx.canvas.width,F),Yt=this.getSizeAndScale(H,this.ctx.canvas.height,z),J=t.cachedCanvases.getCanvas("pattern",Vt.size,Yt.size),pt=J.context,Et=f.createCanvasGraphics(pt,e);if(Et.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(Et,r,h),pt.translate(-Vt.scale*b,-Yt.scale*_),Et.transform(0,Vt.scale,0,0,Yt.scale,0,0),pt.save(),(Wt=Et.dependencyTracker)==null||Wt.save(),this.clipBbox(Et,b,_,S,R),Et.baseTransform=Un(Et.ctx),Et.executeOperatorList(s),Et.endDrawing(),(Zt=Et.dependencyTracker)==null||Zt.restore(),pt.restore(),dt||ct){const G=J.canvas;dt&&(j=p),ct&&(H=m);const ft=this.getSizeAndScale(j,this.ctx.canvas.width,F),_t=this.getSizeAndScale(H,this.ctx.canvas.height,z),Mt=ft.size,It=_t.size,Gt=t.cachedCanvases.getCanvas("pattern-workaround",Mt,It),Ft=Gt.context,Ke=dt?Math.floor(C/p):0,Dt=ct?Math.floor(M/m):0;for(let pi=0;pi<=Ke;pi++)for(let bn=0;bn<=Dt;bn++)Ft.drawImage(G,Mt*pi,It*bn,Mt,It,0,0,Mt,It);return{canvas:Gt.canvas,scaleX:ft.scale,scaleY:_t.scale,offsetX:b,offsetY:_}}return{canvas:J.canvas,scaleX:Vt.scale,scaleY:Yt.scale,offsetX:b,offsetY:_}}getSizeAndScale(t,e,n){const s=Math.max(Y_.MAX_PATTERN_SIZE,e);let r=Math.ceil(t*n);return r>=s?r=s:n=r/t,{scale:n,size:r}}clipBbox(t,e,n,s,r){const u=s-e,h=r-n;t.ctx.rect(e,n,u,h),jt.axialAlignedBoundingBox([e,n,s,r],Un(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,n){const s=t.ctx,r=t.current;switch(e){case KD.COLORED:const{fillStyle:u,strokeStyle:h}=this.ctx;s.fillStyle=r.fillColor=u,s.strokeStyle=r.strokeColor=h;break;case KD.UNCOLORED:s.fillStyle=s.strokeStyle=n,r.fillColor=r.strokeColor=n;break;default:throw new w3(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,n,s,r){let u=n;s!==is.SHADING&&(u=jt.transform(u,e.baseTransform),this.matrix&&(u=jt.transform(u,this.matrix)));const h=this.createPatternCanvas(e,r);let f=new DOMMatrix(u);f=f.translate(h.offsetX,h.offsetY),f=f.scale(1/h.scaleX,1/h.scaleY);const p=t.createPattern(h.canvas,"repeat");return p.setTransform(f),p}};Ct(Y_,"MAX_PATTERN_SIZE",3e3);let H1=Y_;function cU({src:l,srcPos:t=0,dest:e,width:n,height:s,nonBlackColor:r=4294967295,inverseDecode:u=!1}){const h=Ti.isLittleEndian?4278190080:255,[f,p]=u?[r,h]:[h,r],m=n>>3,b=n&7,_=l.length;e=new Uint32Array(e.buffer);let S=0;for(let R=0;R<s;R++){for(const M=t+m;t<M;t++){const k=t<_?l[t]:255;e[S++]=k&128?p:f,e[S++]=k&64?p:f,e[S++]=k&32?p:f,e[S++]=k&16?p:f,e[S++]=k&8?p:f,e[S++]=k&4?p:f,e[S++]=k&2?p:f,e[S++]=k&1?p:f}if(b===0)continue;const C=t<_?l[t++]:255;for(let M=0;M<b;M++)e[S++]=C&1<<7-M?p:f}return{srcPos:t,destPos:S}}const WD=16,QD=100,uU=15,JD=10,Js=16,GE=new DOMMatrix,ka=new Float32Array(2),cp=new Float32Array([1/0,1/0,-1/0,-1/0]);function hU(l,t){if(l._removeMirroring)throw new Error("Context is already forwarding operations.");l.__originalSave=l.save,l.__originalRestore=l.restore,l.__originalRotate=l.rotate,l.__originalScale=l.scale,l.__originalTranslate=l.translate,l.__originalTransform=l.transform,l.__originalSetTransform=l.setTransform,l.__originalResetTransform=l.resetTransform,l.__originalClip=l.clip,l.__originalMoveTo=l.moveTo,l.__originalLineTo=l.lineTo,l.__originalBezierCurveTo=l.bezierCurveTo,l.__originalRect=l.rect,l.__originalClosePath=l.closePath,l.__originalBeginPath=l.beginPath,l._removeMirroring=()=>{l.save=l.__originalSave,l.restore=l.__originalRestore,l.rotate=l.__originalRotate,l.scale=l.__originalScale,l.translate=l.__originalTranslate,l.transform=l.__originalTransform,l.setTransform=l.__originalSetTransform,l.resetTransform=l.__originalResetTransform,l.clip=l.__originalClip,l.moveTo=l.__originalMoveTo,l.lineTo=l.__originalLineTo,l.bezierCurveTo=l.__originalBezierCurveTo,l.rect=l.__originalRect,l.closePath=l.__originalClosePath,l.beginPath=l.__originalBeginPath,delete l._removeMirroring},l.save=function(){t.save(),this.__originalSave()},l.restore=function(){t.restore(),this.__originalRestore()},l.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},l.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},l.transform=function(e,n,s,r,u,h){t.transform(e,n,s,r,u,h),this.__originalTransform(e,n,s,r,u,h)},l.setTransform=function(e,n,s,r,u,h){t.setTransform(e,n,s,r,u,h),this.__originalSetTransform(e,n,s,r,u,h)},l.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},l.rotate=function(e){t.rotate(e),this.__originalRotate(e)},l.clip=function(e){t.clip(e),this.__originalClip(e)},l.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},l.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},l.bezierCurveTo=function(e,n,s,r,u,h){t.bezierCurveTo(e,n,s,r,u,h),this.__originalBezierCurveTo(e,n,s,r,u,h)},l.rect=function(e,n,s,r){t.rect(e,n,s,r),this.__originalRect(e,n,s,r)},l.closePath=function(){t.closePath(),this.__originalClosePath()},l.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class dU{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,n){let s;return this.cache[t]!==void 0?(s=this.cache[t],this.canvasFactory.reset(s,e,n)):(s=this.canvasFactory.create(e,n),this.cache[t]=s),s}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Cw(l,t,e,n,s,r,u,h,f,p){const[m,b,_,S,R,C]=Un(l);if(b===0&&_===0){const I=u*m+R,P=Math.round(I),F=h*S+C,z=Math.round(F),j=(u+f)*m+R,H=Math.abs(Math.round(j)-P)||1,dt=(h+p)*S+C,ct=Math.abs(Math.round(dt)-z)||1;return l.setTransform(Math.sign(m),0,0,Math.sign(S),P,z),l.drawImage(t,e,n,s,r,0,0,H,ct),l.setTransform(m,b,_,S,R,C),[H,ct]}if(m===0&&S===0){const I=h*_+R,P=Math.round(I),F=u*b+C,z=Math.round(F),j=(h+p)*_+R,H=Math.abs(Math.round(j)-P)||1,dt=(u+f)*b+C,ct=Math.abs(Math.round(dt)-z)||1;return l.setTransform(0,Math.sign(b),Math.sign(_),0,P,z),l.drawImage(t,e,n,s,r,0,0,ct,H),l.setTransform(m,b,_,S,R,C),[ct,H]}l.drawImage(t,e,n,s,r,u,h,f,p);const M=Math.hypot(m,b),k=Math.hypot(_,S);return[M*f,k*p]}class ZD{constructor(t,e,n){Ct(this,"alphaIsShape",!1);Ct(this,"fontSize",0);Ct(this,"fontSizeScale",1);Ct(this,"textMatrix",null);Ct(this,"textMatrixScale",1);Ct(this,"fontMatrix",h1);Ct(this,"leading",0);Ct(this,"x",0);Ct(this,"y",0);Ct(this,"lineX",0);Ct(this,"lineY",0);Ct(this,"charSpacing",0);Ct(this,"wordSpacing",0);Ct(this,"textHScale",1);Ct(this,"textRenderingMode",wi.FILL);Ct(this,"textRise",0);Ct(this,"fillColor","#000000");Ct(this,"strokeColor","#000000");Ct(this,"patternFill",!1);Ct(this,"patternStroke",!1);Ct(this,"fillAlpha",1);Ct(this,"strokeAlpha",1);Ct(this,"lineWidth",1);Ct(this,"activeSMask",null);Ct(this,"transferMaps","none");n==null||n(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=cp.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=is.FILL,e=null){const n=this.minMax.slice();if(t===is.STROKE){e||yn("Stroke bounding box must include transform."),jt.singularValueDecompose2dScale(e,ka);const s=ka[0]*this.lineWidth/2,r=ka[1]*this.lineWidth/2;n[0]-=s,n[1]-=r,n[2]+=s,n[3]+=r}return n}updateClipFromPath(){const t=jt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(cp,0)}getClippedPathBoundingBox(t=is.FILL,e=null){return jt.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function tM(l,t){if(t instanceof ImageData){l.putImageData(t,0,0);return}const e=t.height,n=t.width,s=e%Js,r=(e-s)/Js,u=s===0?r:r+1,h=l.createImageData(n,Js);let f=0,p;const m=t.data,b=h.data;let _,S,R,C;if(t.kind===Uw.GRAYSCALE_1BPP){const M=m.byteLength,k=new Uint32Array(b.buffer,0,b.byteLength>>2),I=k.length,P=n+7>>3,F=4294967295,z=Ti.isLittleEndian?4278190080:255;for(_=0;_<u;_++){for(R=_<r?Js:s,p=0,S=0;S<R;S++){const j=M-f;let H=0;const dt=j>P?n:j*8-7,ct=dt&-8;let yt=0,gt=0;for(;H<ct;H+=8)gt=m[f++],k[p++]=gt&128?F:z,k[p++]=gt&64?F:z,k[p++]=gt&32?F:z,k[p++]=gt&16?F:z,k[p++]=gt&8?F:z,k[p++]=gt&4?F:z,k[p++]=gt&2?F:z,k[p++]=gt&1?F:z;for(;H<dt;H++)yt===0&&(gt=m[f++],yt=128),k[p++]=gt&yt?F:z,yt>>=1}for(;p<I;)k[p++]=0;l.putImageData(h,0,_*Js)}}else if(t.kind===Uw.RGBA_32BPP){for(S=0,C=n*Js*4,_=0;_<r;_++)b.set(m.subarray(f,f+C)),f+=C,l.putImageData(h,0,S),S+=Js;_<u&&(C=n*s*4,b.set(m.subarray(f,f+C)),l.putImageData(h,0,S))}else if(t.kind===Uw.RGB_24BPP)for(R=Js,C=n*R,_=0;_<u;_++){for(_>=r&&(R=s,C=n*R),p=0,S=C;S--;)b[p++]=m[f++],b[p++]=m[f++],b[p++]=m[f++],b[p++]=255;l.putImageData(h,0,_*Js)}else throw new Error(`bad image kind: ${t.kind}`)}function eM(l,t){if(t.bitmap){l.drawImage(t.bitmap,0,0);return}const e=t.height,n=t.width,s=e%Js,r=(e-s)/Js,u=s===0?r:r+1,h=l.createImageData(n,Js);let f=0;const p=t.data,m=h.data;for(let b=0;b<u;b++){const _=b<r?Js:s;({srcPos:f}=cU({src:p,srcPos:f,dest:m,width:n,height:_,nonBlackColor:0})),l.putImageData(h,0,b*Js)}}function ey(l,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of e)l[n]!==void 0&&(t[n]=l[n]);l.setLineDash!==void 0&&(t.setLineDash(l.getLineDash()),t.lineDashOffset=l.lineDashOffset)}function xw(l){l.strokeStyle=l.fillStyle="#000000",l.fillRule="nonzero",l.globalAlpha=1,l.lineWidth=1,l.lineCap="butt",l.lineJoin="miter",l.miterLimit=10,l.globalCompositeOperation="source-over",l.font="10px sans-serif",l.setLineDash!==void 0&&(l.setLineDash([]),l.lineDashOffset=0);const{filter:t}=l;t!=="none"&&t!==""&&(l.filter="none")}function nM(l,t){if(t)return!0;jt.singularValueDecompose2dScale(l,ka);const e=Math.fround(Po.pixelRatio*zu.PDF_TO_CSS_UNITS);return ka[0]<=e&&ka[1]<=e}const fU=["butt","round","square"],pU=["miter","round","bevel"],mU={},iM={};var jr,$1,V1,G1;const Hx=class Hx{constructor(t,e,n,s,r,{optionalContentConfig:u,markedContentStack:h=null},f,p,m){O(this,jr);this.ctx=t,this.current=new ZD(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=n,this.canvasFactory=s,this.filterFactory=r,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=h||[],this.optionalContentConfig=u,this.cachedCanvases=new dU(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=f,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=p,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=m??null}getObject(t,e,n=null){var s;return typeof e=="string"?((s=this.dependencyTracker)==null||s.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):n}beginDrawing({transform:t,viewport:e,transparency:n=!1,background:s=null}){const r=this.ctx.canvas.width,u=this.ctx.canvas.height,h=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,r,u),this.ctx.fillStyle=h,n){const f=this.cachedCanvases.getCanvas("transparent",r,u);this.compositeCtx=this.ctx,this.transparentCanvas=f.canvas,this.ctx=f.context,this.ctx.save(),this.ctx.transform(...Un(this.compositeCtx))}this.ctx.save(),xw(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Un(this.ctx)}executeOperatorList(t,e,n,s,r){var k;const u=t.argsArray,h=t.fnArray;let f=e||0;const p=u.length;if(p===f)return f;const m=p-f>JD&&typeof n=="function",b=m?Date.now()+uU:0;let _=0;const S=this.commonObjs,R=this.objs;let C,M;for(;;){if(s!==void 0&&f===s.nextBreakPoint)return s.breakIt(f,n),f;if(!r||r(f))if(C=h[f],M=u[f]??null,C!==Fy.dependency)M===null?this[C](f):this[C](f,...M);else for(const I of M){(k=this.dependencyTracker)==null||k.recordNamedData(I,f);const P=I.startsWith("g_")?S:R;if(!P.has(I))return P.get(I,n),f}if(f++,f===p)return f;if(m&&++_>JD){if(Date.now()>b)return n(),f;_=0}}}endDrawing(){N(this,jr,$1).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),N(this,jr,V1).call(this)}_scaleImage(t,e){const n=t.width??t.displayWidth,s=t.height??t.displayHeight;let r=Math.max(Math.hypot(e[0],e[1]),1),u=Math.max(Math.hypot(e[2],e[3]),1),h=n,f=s,p="prescale1",m,b;for(;r>2&&h>1||u>2&&f>1;){let _=h,S=f;r>2&&h>1&&(_=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h/2),r/=h/_),u>2&&f>1&&(S=f>=16384?Math.floor(f/2)-1||1:Math.ceil(f)/2,u/=f/S),m=this.cachedCanvases.getCanvas(p,_,S),b=m.context,b.clearRect(0,0,_,S),b.drawImage(t,0,0,h,f,0,0,_,S),t=m.canvas,h=_,f=S,p=p==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:h,paintHeight:f}}_createMaskCanvas(t,e){var yt,gt;const n=this.ctx,{width:s,height:r}=e,u=this.current.fillColor,h=this.current.patternFill,f=Un(n);let p,m,b,_;if((e.bitmap||e.data)&&e.count>1){const Pt=e.bitmap||e.data.buffer;m=JSON.stringify(h?f:[f.slice(0,4),u]),p=this._cachedBitmapsMap.get(Pt),p||(p=new Map,this._cachedBitmapsMap.set(Pt,p));const Xt=p.get(m);if(Xt&&!h){const Vt=Math.round(Math.min(f[0],f[2])+f[4]),Yt=Math.round(Math.min(f[1],f[3])+f[5]);return(yt=this.dependencyTracker)==null||yt.recordDependencies(t,Wa.transformAndFill),{canvas:Xt,offsetX:Vt,offsetY:Yt}}b=Xt}b||(_=this.cachedCanvases.getCanvas("maskCanvas",s,r),eM(_.context,e));let S=jt.transform(f,[1/s,0,0,-1/r,0,0]);S=jt.transform(S,[1,0,0,1,0,-r]);const R=cp.slice();jt.axialAlignedBoundingBox([0,0,s,r],S,R);const[C,M,k,I]=R,P=Math.round(k-C)||1,F=Math.round(I-M)||1,z=this.cachedCanvases.getCanvas("fillCanvas",P,F),j=z.context,H=C,dt=M;j.translate(-H,-dt),j.transform(...S),b||(b=this._scaleImage(_.canvas,so(j)),b=b.img,p&&h&&p.set(m,b)),j.imageSmoothingEnabled=nM(Un(j),e.interpolate),Cw(j,b,0,0,b.width,b.height,0,0,s,r),j.globalCompositeOperation="source-in";const ct=jt.transform(so(j),[1,0,0,1,-H,-dt]);return j.fillStyle=h?u.getPattern(n,this,ct,is.FILL,t):u,j.fillRect(0,0,s,r),p&&!h&&(this.cachedCanvases.delete("fillCanvas"),p.set(m,z.canvas)),(gt=this.dependencyTracker)==null||gt.recordDependencies(t,Wa.transformAndFill),{canvas:z.canvas,offsetX:Math.round(H),offsetY:Math.round(dt)}}setLineWidth(t,e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineCap",t),this.ctx.lineCap=fU[e]}setLineJoin(t,e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineJoin",t),this.ctx.lineJoin=pU[e]}setMiterLimit(t,e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,n){var r;(r=this.dependencyTracker)==null||r.recordSimpleData("dash",t);const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=n)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){var n,s,r,u,h;for(const[f,p]of e)switch(f){case"LW":this.setLineWidth(t,p);break;case"LC":this.setLineCap(t,p);break;case"LJ":this.setLineJoin(t,p);break;case"ML":this.setMiterLimit(t,p);break;case"D":this.setDash(t,p[0],p[1]);break;case"RI":this.setRenderingIntent(t,p);break;case"FL":this.setFlatness(t,p);break;case"Font":this.setFont(t,p[0],p[1]);break;case"CA":(n=this.dependencyTracker)==null||n.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=p;break;case"ca":(s=this.dependencyTracker)==null||s.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=p;break;case"BM":(r=this.dependencyTracker)==null||r.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=p;break;case"SMask":(u=this.dependencyTracker)==null||u.recordSimpleData("SMask",t),this.current.activeSMask=p?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":(h=this.dependencyTracker)==null||h.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(p);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,n=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(s,e,n);this.suspendedCtx=this.ctx;const u=this.ctx=r.context;u.setTransform(this.suspendedCtx.getTransform()),ey(this.suspendedCtx,u),hU(u,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ey(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,n,s){const r=s[0],u=s[1],h=s[2]-r,f=s[3]-u;h===0||f===0||(this.genericComposeSMask(e.context,n,h,f,e.subtype,e.backdrop,e.transferMap,r,u,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(n.canvas,0,0),t.restore())}genericComposeSMask(t,e,n,s,r,u,h,f,p,m,b){let _=t.canvas,S=f-m,R=p-b;if(u)if(S<0||R<0||S+n>_.width||R+s>_.height){const M=this.cachedCanvases.getCanvas("maskExtension",n,s),k=M.context;k.drawImage(_,-S,-R),k.globalCompositeOperation="destination-atop",k.fillStyle=u,k.fillRect(0,0,n,s),k.globalCompositeOperation="source-over",_=M.canvas,S=R=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const M=new Path2D;M.rect(S,R,n,s),t.clip(M),t.globalCompositeOperation="destination-atop",t.fillStyle=u,t.fillRect(S,R,n,s),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),r==="Alpha"&&h?e.filter=this.filterFactory.addAlphaFilter(h):r==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(h));const C=new Path2D;C.rect(f,p,n,s),e.clip(C),e.globalCompositeOperation="destination-in",e.drawImage(_,S,R,n,s,f,p,n,s),e.restore()}save(t){var n;this.inSMaskMode&&ey(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),(n=this.dependencyTracker)==null||n.save(t)}restore(t){var e;if((e=this.dependencyTracker)==null||e.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&ey(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,n,s,r,u,h){var f;(f=this.dependencyTracker)==null||f.recordIncrementalData("transform",t),this.ctx.transform(e,n,s,r,u,h),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,n,s){let[r]=n;if(!s){r||(r=n[0]=new Path2D),this[e](t,r);return}if(this.dependencyTracker!==null){const u=e===Fy.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,s[0]-u,s[2]+u,s[1]-u,s[3]+u).recordDependencies(t,["transform"])}r instanceof Path2D||(r=n[0]=o2(r)),jt.axialAlignedBoundingBox(s,Un(this.ctx),this.current.minMax),this[e](t,r),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,n=!0){var u;const s=this.ctx,r=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&(r!=null&&r.getPattern)){const h=r.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=r.getPattern(s,this,so(s),is.STROKE,t),h){const f=new Path2D;f.addPath(e,s.getTransform().invertSelf().multiplySelf(h)),e=f}this.rescaleAndStroke(e,!1),s.restore()}else this.rescaleAndStroke(e,!0);(u=this.dependencyTracker)==null||u.recordDependencies(t,Wa.stroke),n&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(is.STROKE,Un(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,n=!0){var p,m,b;const s=this.ctx,r=this.current.fillColor,u=this.current.patternFill;let h=!1;if(u){const _=r.isModifyingCurrentTransform()?s.getTransform():null;if((p=this.dependencyTracker)==null||p.save(t),s.save(),s.fillStyle=r.getPattern(s,this,so(s),is.FILL,t),_){const S=new Path2D;S.addPath(e,s.getTransform().invertSelf().multiplySelf(_)),e=S}h=!0}const f=this.current.getClippedPathBoundingBox();this.contentVisible&&f!==null&&(this.pendingEOFill?(s.fill(e,"evenodd"),this.pendingEOFill=!1):s.fill(e)),(m=this.dependencyTracker)==null||m.recordDependencies(t,Wa.fill),h&&(s.restore(),(b=this.dependencyTracker)==null||b.restore(t)),n&&this.consumePath(t,e,f)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){var n;this.ctx.fill(e),(n=this.dependencyTracker)==null||n.recordDependencies(t,Wa.rawFillPath).recordOperation(t)}clip(t){var e;(e=this.dependencyTracker)==null||e.recordFutureForcedDependency("clipMode",t),this.pendingClip=mU}eoClip(t){var e;(e=this.dependencyTracker)==null||e.recordFutureForcedDependency("clipMode",t),this.pendingClip=iM}beginText(t){var e;this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,(e=this.dependencyTracker)==null||e.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:s}=this;e!==void 0&&s.recordFutureForcedDependency("textClip",s.getOpenMarker()).recordFutureForcedDependency("textClip",t),s.recordCloseMarker(t)}if(e!==void 0){const s=new Path2D,r=n.getTransform().invertSelf();for(const{transform:u,x:h,y:f,fontSize:p,path:m}of e)m&&s.addPath(m,new DOMMatrix(u).preMultiplySelf(r).translate(h,f).scale(p,-p));n.clip(s)}delete this.pendingTextPaths}setCharSpacing(t,e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,n){var b,_;(b=this.dependencyTracker)==null||b.recordSimpleData("font",t).recordSimpleDataFromNamed("fontObj",e,t);const s=this.commonObjs.get(e),r=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=s.fontMatrix||h1,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&me("Invalid font matrix for font "+e),n<0?(n=-n,r.fontDirection=-1):r.fontDirection=1,this.current.font=s,this.current.fontSize=n,s.isType3Font)return;const u=s.loadedName||"sans-serif",h=((_=s.systemFontInfo)==null?void 0:_.css)||`"${u}", ${s.fallbackName}`;let f="normal";s.black?f="900":s.bold&&(f="bold");const p=s.italic?"italic":"normal";let m=n;n<WD?m=WD:n>QD&&(m=QD),this.current.fontSizeScale=n/m,this.ctx.font=`${p} ${f} ${m}px ${h}`}setTextRenderingMode(t,e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,n){var s;(s=this.dependencyTracker)==null||s.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=n}setLeadingMoveText(t,e,n){this.setLeading(t,-n),this.moveText(t,e,n)}setTextMatrix(t,e){var s;(s=this.dependencyTracker)==null||s.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",t);const{current:n}=this;n.textMatrix=e,n.textMatrixScale=Math.hypot(e[0],e[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(t){var e;this.moveText(t,0,this.current.leading),(e=this.dependencyTracker)==null||e.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}paintChar(t,e,n,s,r,u){var k,I,P,F;const h=this.ctx,f=this.current,p=f.font,m=f.textRenderingMode,b=f.fontSize/f.fontSizeScale,_=m&wi.FILL_STROKE_MASK,S=!!(m&wi.ADD_TO_PATH_FLAG),R=f.patternFill&&!p.missingFile,C=f.patternStroke&&!p.missingFile;let M;if((p.disableFontFace||S||R||C)&&!p.missingFile&&(M=p.getPathGenerator(this.commonObjs,e)),M&&(p.disableFontFace||R||C)){h.save(),h.translate(n,s),h.scale(b,-b),(k=this.dependencyTracker)==null||k.recordCharacterBBox(t,h,p);let z;if(_===wi.FILL||_===wi.FILL_STROKE)if(r){z=h.getTransform(),h.setTransform(...r);const j=N(this,jr,G1).call(this,M,z,r);h.fill(j)}else h.fill(M);if(_===wi.STROKE||_===wi.FILL_STROKE)if(u){z||(z=h.getTransform()),h.setTransform(...u);const{a:j,b:H,c:dt,d:ct}=z,yt=jt.inverseTransform(u),gt=jt.transform([j,H,dt,ct,0,0],yt);jt.singularValueDecompose2dScale(gt,ka),h.lineWidth*=Math.max(ka[0],ka[1])/b,h.stroke(N(this,jr,G1).call(this,M,z,u))}else h.lineWidth/=b,h.stroke(M);h.restore()}else(_===wi.FILL||_===wi.FILL_STROKE)&&(h.fillText(e,n,s),(I=this.dependencyTracker)==null||I.recordCharacterBBox(t,h,p,b,n,s,()=>h.measureText(e))),(_===wi.STROKE||_===wi.FILL_STROKE)&&(this.dependencyTracker&&((P=this.dependencyTracker)==null||P.recordCharacterBBox(t,h,p,b,n,s,()=>h.measureText(e)).recordDependencies(t,Wa.stroke)),h.strokeText(e,n,s));S&&((this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Un(h),x:n,y:s,fontSize:b,path:M}),(F=this.dependencyTracker)==null||F.recordCharacterBBox(t,h,p,b,n,s))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let n=!1;for(let s=3;s<e.length;s+=4)if(e[s]>0&&e[s]<255){n=!0;break}return ge(this,"isFontSubpixelAAEnabled",n)}showText(t,e){var gt,Pt,Xt,Vt;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,Wa.showText).resetBBox(t),this.current.textRenderingMode&wi.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,s=n.font;if(s.isType3Font){this.showType3Text(t,e),(gt=this.dependencyTracker)==null||gt.recordShowTextOperation(t);return}const r=n.fontSize;if(r===0){(Pt=this.dependencyTracker)==null||Pt.recordOperation(t);return}const u=this.ctx,h=n.fontSizeScale,f=n.charSpacing,p=n.wordSpacing,m=n.fontDirection,b=n.textHScale*m,_=e.length,S=s.vertical,R=S?1:-1,C=s.defaultVMetrics,M=r*n.fontMatrix[0],k=n.textRenderingMode===wi.FILL&&!s.disableFontFace&&!n.patternFill;u.save(),n.textMatrix&&u.transform(...n.textMatrix),u.translate(n.x,n.y+n.textRise),m>0?u.scale(b,-1):u.scale(b,1);let I,P;const F=n.textRenderingMode&wi.FILL_STROKE_MASK,z=F===wi.FILL||F===wi.FILL_STROKE,j=F===wi.STROKE||F===wi.FILL_STROKE;if(z&&n.patternFill){u.save();const Yt=n.fillColor.getPattern(u,this,so(u),is.FILL,t);I=Un(u),u.restore(),u.fillStyle=Yt}if(j&&n.patternStroke){u.save();const Yt=n.strokeColor.getPattern(u,this,so(u),is.STROKE,t);P=Un(u),u.restore(),u.strokeStyle=Yt}let H=n.lineWidth;const dt=n.textMatrixScale;if(dt===0||H===0?j&&(H=this.getSinglePixelWidth()):H/=dt,h!==1&&(u.scale(h,h),H/=h),u.lineWidth=H,s.isInvalidPDFjsFont){const Yt=[];let J=0;for(const Et of e)Yt.push(Et.unicode),J+=Et.width;const pt=Yt.join("");if(u.fillText(pt,0,0),this.dependencyTracker!==null){const Et=u.measureText(pt);this.dependencyTracker.recordBBox(t,this.ctx,-Et.actualBoundingBoxLeft,Et.actualBoundingBoxRight,-Et.actualBoundingBoxAscent,Et.actualBoundingBoxDescent).recordShowTextOperation(t)}n.x+=J*M*b,u.restore(),this.compose();return}let ct=0,yt;for(yt=0;yt<_;++yt){const Yt=e[yt];if(typeof Yt=="number"){ct+=R*Yt*r/1e3;continue}let J=!1;const pt=(Yt.isSpace?p:0)+f,Et=Yt.fontChar,Wt=Yt.accent;let Zt,G,ft=Yt.width;if(S){const It=Yt.vmetric||C,Gt=-(Yt.vmetric?It[1]:ft*.5)*M,Ft=It[2]*M;ft=It?-It[0]:ft,Zt=Gt/h,G=(ct+Ft)/h}else Zt=ct/h,G=0;let _t;if(s.remeasure&&ft>0){_t=u.measureText(Et);const It=_t.width*1e3/r*h;if(ft<It&&this.isFontSubpixelAAEnabled){const Gt=ft/It;J=!0,u.save(),u.scale(Gt,1),Zt/=Gt}else ft!==It&&(Zt+=(ft-It)/2e3*r/h)}if(this.contentVisible&&(Yt.isInFont||s.missingFile)){if(k&&!Wt)u.fillText(Et,Zt,G),(Xt=this.dependencyTracker)==null||Xt.recordCharacterBBox(t,u,_t?{bbox:null}:s,r/h,Zt,G,()=>_t??u.measureText(Et));else if(this.paintChar(t,Et,Zt,G,I,P),Wt){const It=Zt+r*Wt.offset.x/h,Gt=G-r*Wt.offset.y/h;this.paintChar(t,Wt.fontChar,It,Gt,I,P)}}const Mt=S?ft*M-pt*m:ft*M+pt*m;ct+=Mt,J&&u.restore()}S?n.y-=ct:n.x+=ct*b,u.restore(),this.compose(),(Vt=this.dependencyTracker)==null||Vt.recordShowTextOperation(t)}showType3Text(t,e){const n=this.ctx,s=this.current,r=s.font,u=s.fontSize,h=s.fontDirection,f=r.vertical?1:-1,p=s.charSpacing,m=s.wordSpacing,b=s.textHScale*h,_=s.fontMatrix||h1,S=e.length,R=s.textRenderingMode===wi.INVISIBLE;let C,M,k,I;if(R||u===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),s.textMatrix&&n.transform(...s.textMatrix),n.translate(s.x,s.y+s.textRise),n.scale(b,h);const P=this.dependencyTracker;for(this.dependencyTracker=P?new N_(P,t):null,C=0;C<S;++C){if(M=e[C],typeof M=="number"){I=f*M*u/1e3,this.ctx.translate(I,0),s.x+=I*b;continue}const F=(M.isSpace?m:0)+p,z=r.charProcOperatorList[M.operatorListId];z?this.contentVisible&&(this.save(),n.scale(u,u),n.transform(..._),this.executeOperatorList(z),this.restore()):me(`Type3 character "${M.operatorListId}" is not available.`);const j=[M.width,0];jt.applyTransform(j,_),k=j[0]*u+F,n.translate(k,0),s.x+=k*b}n.restore(),P&&(this.dependencyTracker=P)}setCharWidth(t,e,n){}setCharWidthAndBounds(t,e,n,s,r,u,h){var p;const f=new Path2D;f.rect(s,r,u-s,h-r),this.ctx.clip(f),(p=this.dependencyTracker)==null||p.recordBBox(t,this.ctx,s,u,r,h).recordClipBox(t,this.ctx,s,u,r,h),this.endPath(t)}getColorN_Pattern(t,e){let n;if(e[0]==="TilingPattern"){const s=this.baseTransform||Un(this.ctx),r={createCanvasGraphics:(u,h)=>new Hx(u,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new N_(this.dependencyTracker,h,!0):null)};n=new H1(e,this.ctx,r,s)}else n=this._getPattern(t,e[1],e[2]);return n}setStrokeColorN(t,...e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){var e;(e=this.dependencyTracker)==null||e.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){var e;(e=this.dependencyTracker)==null||e.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,n=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=lU(this.getObject(t,e)),this.cachedPatterns.set(e,s)),n&&(s.matrix=n),s}shadingFill(t,e){var u;if(!this.contentVisible)return;const n=this.ctx;this.save(t);const s=this._getPattern(t,e);n.fillStyle=s.getPattern(n,this,so(n),is.SHADING,t);const r=so(n);if(r){const{width:h,height:f}=n.canvas,p=cp.slice();jt.axialAlignedBoundingBox([0,0,h,f],r,p);const[m,b,_,S]=p;this.ctx.fillRect(m,b,_-m,S-b)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);(u=this.dependencyTracker)==null||u.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,Wa.transform).recordDependencies(t,Wa.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){yn("Should not call beginInlineImage")}beginImageData(){yn("Should not call beginImageData")}paintFormXObjectBegin(t,e,n){var s;if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=Un(this.ctx),n)){jt.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[r,u,h,f]=n,p=new Path2D;p.rect(r,u,h-r,f-u),this.ctx.clip(p),(s=this.dependencyTracker)==null||s.recordClipBox(t,this.ctx,r,h,u,f),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){var P;if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;e.isolated||SA("TODO: Support non-isolated groups."),e.knockout&&me("Knockout groups not supported.");const s=Un(n);if(e.matrix&&n.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=cp.slice();jt.axialAlignedBoundingBox(e.bbox,Un(n),r);const u=[0,0,n.canvas.width,n.canvas.height];r=jt.intersect(r,u)||[0,0,0,0];const h=Math.floor(r[0]),f=Math.floor(r[1]),p=Math.max(Math.ceil(r[2])-h,1),m=Math.max(Math.ceil(r[3])-f,1);this.current.startNewPathAndClipBox([0,0,p,m]);let b="groupAt"+this.groupLevel;e.smask&&(b+="_smask_"+this.smaskCounter++%2);const _=this.cachedCanvases.getCanvas(b,p,m),S=_.context;S.translate(-h,-f),S.transform(...s);let R=new Path2D;const[C,M,k,I]=e.bbox;if(R.rect(C,M,k-C,I-M),e.matrix){const F=new Path2D;F.addPath(R,new DOMMatrix(e.matrix)),R=F}S.clip(R),e.smask&&this.smaskStack.push({canvas:_.canvas,context:S,offsetX:h,offsetY:f,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(h,f),n.save()),ey(n,S),this.ctx=S,(P=this.dependencyTracker)==null||P.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(t,e){var r;if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,(r=this.dependencyTracker)==null||r.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const u=Un(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...u);const h=cp.slice();jt.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],u,h),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(h)}}beginAnnotation(t,e,n,s,r,u){if(N(this,jr,$1).call(this),xw(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const h=n[2]-n[0],f=n[3]-n[1];if(u&&this.annotationCanvasMap){s=s.slice(),s[4]-=n[0],s[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=h,n[3]=f,jt.singularValueDecompose2dScale(Un(this.ctx),ka);const{viewportScale:p}=this,m=Math.ceil(h*this.outputScaleX*p),b=Math.ceil(f*this.outputScaleY*p);this.annotationCanvas=this.canvasFactory.create(m,b);const{canvas:_,context:S}=this.annotationCanvas;this.annotationCanvasMap.set(e,_),this.annotationCanvas.savedCtx=this.ctx,this.ctx=S,this.ctx.save(),this.ctx.setTransform(ka[0],0,0,-ka[1],0,f*ka[1]),xw(this.ctx)}else{xw(this.ctx),this.endPath(t);const p=new Path2D;p.rect(n[0],n[1],h,f),this.ctx.clip(p)}}this.current=new ZD(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...s),this.transform(t,...r)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),N(this,jr,V1).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){var h;if(!this.contentVisible)return;const n=e.count;e=this.getObject(t,e.data,e),e.count=n;const s=this.ctx,r=this._createMaskCanvas(t,e),u=r.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(u,r.offsetX,r.offsetY),(h=this.dependencyTracker)==null||h.resetBBox(t).recordBBox(t,this.ctx,r.offsetX,r.offsetX+u.width,r.offsetY,r.offsetY+u.height).recordOperation(t),s.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,n,s=0,r=0,u,h){var b,_,S;if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const f=this.ctx;f.save();const p=Un(f);f.transform(n,s,r,u,0,0);const m=this._createMaskCanvas(t,e);f.setTransform(1,0,0,1,m.offsetX-p[4],m.offsetY-p[5]),(b=this.dependencyTracker)==null||b.resetBBox(t);for(let R=0,C=h.length;R<C;R+=2){const M=jt.transform(p,[n,s,r,u,h[R],h[R+1]]);f.drawImage(m.canvas,M[4],M[5]),(_=this.dependencyTracker)==null||_.recordBBox(t,this.ctx,M[4],M[4]+m.canvas.width,M[5],M[5]+m.canvas.height)}f.restore(),this.compose(),(S=this.dependencyTracker)==null||S.recordOperation(t)}paintImageMaskXObjectGroup(t,e){var u,h,f;if(!this.contentVisible)return;const n=this.ctx,s=this.current.fillColor,r=this.current.patternFill;(u=this.dependencyTracker)==null||u.resetBBox(t).recordDependencies(t,Wa.transformAndFill);for(const p of e){const{data:m,width:b,height:_,transform:S}=p,R=this.cachedCanvases.getCanvas("maskCanvas",b,_),C=R.context;C.save();const M=this.getObject(t,m,p);eM(C,M),C.globalCompositeOperation="source-in",C.fillStyle=r?s.getPattern(C,this,so(n),is.FILL,t):s,C.fillRect(0,0,b,_),C.restore(),n.save(),n.transform(...S),n.scale(1,-1),Cw(n,R.canvas,0,0,b,_,0,-1,1,1),(h=this.dependencyTracker)==null||h.recordBBox(t,n,0,b,0,_),n.restore()}this.compose(),(f=this.dependencyTracker)==null||f.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const n=this.getObject(t,e);if(!n){me("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,n)}paintImageXObjectRepeat(t,e,n,s,r){if(!this.contentVisible)return;const u=this.getObject(t,e);if(!u){me("Dependent image isn't ready yet");return}const h=u.width,f=u.height,p=[];for(let m=0,b=r.length;m<b;m+=2)p.push({transform:[n,0,0,s,r[m],r[m+1]],x:0,y:0,w:h,h:f});this.paintInlineImageXObjectGroup(t,u,p)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:n,height:s}=t,r=this.cachedCanvases.getCanvas("inlineImage",n,s),u=r.context;return u.filter=this.current.transferMaps,u.drawImage(e,0,0),u.filter="none",r.canvas}paintInlineImageXObject(t,e){var p;if(!this.contentVisible)return;const n=e.width,s=e.height,r=this.ctx;this.save(t);const{filter:u}=r;u!=="none"&&u!==""&&(r.filter="none"),r.scale(1/n,-1/s);let h;if(e.bitmap)h=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)h=e;else{const b=this.cachedCanvases.getCanvas("inlineImage",n,s).context;tM(b,e),h=this.applyTransferMapsToCanvas(b)}const f=this._scaleImage(h,so(r));r.imageSmoothingEnabled=nM(Un(r),e.interpolate),(p=this.dependencyTracker)==null||p.resetBBox(t).recordBBox(t,r,0,n,-s,0).recordDependencies(t,Wa.imageXObject).recordOperation(t),Cw(r,f.img,0,0,f.paintWidth,f.paintHeight,0,-s,n,s),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,n){var u,h,f;if(!this.contentVisible)return;const s=this.ctx;let r;if(e.bitmap)r=e.bitmap;else{const p=e.width,m=e.height,_=this.cachedCanvases.getCanvas("inlineImage",p,m).context;tM(_,e),r=this.applyTransferMapsToCanvas(_)}(u=this.dependencyTracker)==null||u.resetBBox(t);for(const p of n)s.save(),s.transform(...p.transform),s.scale(1,-1),Cw(s,r,p.x,p.y,p.w,p.h,0,-1,1,1),(h=this.dependencyTracker)==null||h.recordBBox(t,s,0,1,-1,0),s.restore();(f=this.dependencyTracker)==null||f.recordOperation(t),this.compose()}paintSolidColorImageMask(t){var e;this.contentVisible&&((e=this.dependencyTracker)==null||e.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,Wa.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,n){}beginMarkedContent(t,e){var n;(n=this.dependencyTracker)==null||n.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,n){var s;(s=this.dependencyTracker)==null||s.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){var e;(e=this.dependencyTracker)==null||e.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,n){var u,h;const s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const r=this.ctx;this.pendingClip?(s||(this.pendingClip===iM?r.clip(e,"evenodd"):r.clip(e)),this.pendingClip=null,(u=this.dependencyTracker)==null||u.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):(h=this.dependencyTracker)==null||h.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Un(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),n=Math.hypot(t[0],t[2]),s=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(n,s)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:n,c:s,d:r}=this.ctx.getTransform();let u,h;if(n===0&&s===0){const f=Math.abs(e),p=Math.abs(r);if(f===p)if(t===0)u=h=1/f;else{const m=f*t;u=h=m<1?1/m:1}else if(t===0)u=1/f,h=1/p;else{const m=f*t,b=p*t;u=m<1?1/m:1,h=b<1?1/b:1}}else{const f=Math.abs(e*r-n*s),p=Math.hypot(e,n),m=Math.hypot(s,r);if(t===0)u=m/f,h=p/f;else{const b=t*f;u=m>b?m/b:1,h=p>b?p/b:1}}this._cachedScaleForStroking[0]=u,this._cachedScaleForStroking[1]=h}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:n,current:{lineWidth:s}}=this,[r,u]=this.getScaleForStroking();if(r===u){n.lineWidth=(s||1)*r,n.stroke(t);return}const h=n.getLineDash();e&&n.save(),n.scale(r,u),GE.a=1/r,GE.d=1/u;const f=new Path2D;if(f.addPath(t,GE),h.length>0){const p=Math.max(r,u);n.setLineDash(h.map(m=>m/p)),n.lineDashOffset/=p}n.lineWidth=s||1,n.stroke(f),e&&n.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};jr=new WeakSet,$1=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},V1=function(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}},G1=function(t,e,n){const s=new Path2D;return s.addPath(t,new DOMMatrix(n).invertSelf().multiplySelf(e)),s};let bp=Hx;for(const l in Fy)bp.prototype[l]!==void 0&&(bp.prototype[Fy[l]]=bp.prototype[l]);var Ob,Db;class No{static get workerPort(){return c(this,Ob)}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");E(this,Ob,t)}static get workerSrc(){return c(this,Db)}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");E(this,Db,t)}}Ob=new WeakMap,Db=new WeakMap,O(No,Ob,null),O(No,Db,"");var em,Mb;class gU{constructor({parsedData:t,rawData:e}){O(this,em);O(this,Mb);E(this,em,t),E(this,Mb,e)}getRaw(){return c(this,Mb)}get(t){return c(this,em).get(t)??null}[Symbol.iterator](){return c(this,em).entries()}}em=new WeakMap,Mb=new WeakMap;const sp=Symbol("INTERNAL");var Nb,kb,Pb,nm;class yU{constructor(t,{name:e,intent:n,usage:s,rbGroups:r}){O(this,Nb,!1);O(this,kb,!1);O(this,Pb,!1);O(this,nm,!0);E(this,Nb,!!(t&Na.DISPLAY)),E(this,kb,!!(t&Na.PRINT)),this.name=e,this.intent=n,this.usage=s,this.rbGroups=r}get visible(){if(c(this,Pb))return c(this,nm);if(!c(this,nm))return!1;const{print:t,view:e}=this.usage;return c(this,Nb)?(e==null?void 0:e.viewState)!=="OFF":c(this,kb)?(t==null?void 0:t.printState)!=="OFF":!0}_setVisible(t,e,n=!1){t!==sp&&yn("Internal method `_setVisible` called."),E(this,Pb,n),E(this,nm,e)}}Nb=new WeakMap,kb=new WeakMap,Pb=new WeakMap,nm=new WeakMap;var pu,un,im,sm,Lb,q1;class bU{constructor(t,e=Na.DISPLAY){O(this,Lb);O(this,pu,null);O(this,un,new Map);O(this,im,null);O(this,sm,null);if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,E(this,sm,t.order);for(const n of t.groups)c(this,un).set(n.id,new yU(e,n));if(t.baseState==="OFF")for(const n of c(this,un).values())n._setVisible(sp,!1);for(const n of t.on)c(this,un).get(n)._setVisible(sp,!0);for(const n of t.off)c(this,un).get(n)._setVisible(sp,!1);E(this,im,this.getHash())}}isVisible(t){if(c(this,un).size===0)return!0;if(!t)return SA("Optional content group not defined."),!0;if(t.type==="OCG")return c(this,un).has(t.id)?c(this,un).get(t.id).visible:(me(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return N(this,Lb,q1).call(this,t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!c(this,un).has(e))return me(`Optional content group not found: ${e}`),!0;if(c(this,un).get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!c(this,un).has(e))return me(`Optional content group not found: ${e}`),!0;if(!c(this,un).get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!c(this,un).has(e))return me(`Optional content group not found: ${e}`),!0;if(!c(this,un).get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!c(this,un).has(e))return me(`Optional content group not found: ${e}`),!0;if(c(this,un).get(e).visible)return!1}return!0}return me(`Unknown optional content policy ${t.policy}.`),!0}return me(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,n=!0){var r;const s=c(this,un).get(t);if(!s){me(`Optional content group not found: ${t}`);return}if(n&&e&&s.rbGroups.length)for(const u of s.rbGroups)for(const h of u)h!==t&&((r=c(this,un).get(h))==null||r._setVisible(sp,!1,!0));s._setVisible(sp,!!e,!0),E(this,pu,null)}setOCGState({state:t,preserveRB:e}){let n;for(const s of t){switch(s){case"ON":case"OFF":case"Toggle":n=s;continue}const r=c(this,un).get(s);if(r)switch(n){case"ON":this.setVisibility(s,!0,e);break;case"OFF":this.setVisibility(s,!1,e);break;case"Toggle":this.setVisibility(s,!r.visible,e);break}}E(this,pu,null)}get hasInitialVisibility(){return c(this,im)===null||this.getHash()===c(this,im)}getOrder(){return c(this,un).size?c(this,sm)?c(this,sm).slice():[...c(this,un).keys()]:null}getGroup(t){return c(this,un).get(t)||null}getHash(){if(c(this,pu)!==null)return c(this,pu);const t=new U2;for(const[e,n]of c(this,un))t.update(`${e}:${n.visible}`);return E(this,pu,t.hexdigest())}[Symbol.iterator](){return c(this,un).entries()}}pu=new WeakMap,un=new WeakMap,im=new WeakMap,sm=new WeakMap,Lb=new WeakSet,q1=function(t){const e=t.length;if(e<2)return!0;const n=t[0];for(let s=1;s<e;s++){const r=t[s];let u;if(Array.isArray(r))u=N(this,Lb,q1).call(this,r);else if(c(this,un).has(r))u=c(this,un).get(r).visible;else return me(`Optional content group not found: ${r}`),!0;switch(n){case"And":if(!u)return!1;break;case"Or":if(u)return!0;break;case"Not":return!u;default:return!0}}return n==="And"};class vU{constructor(t,{disableRange:e=!1,disableStream:n=!1}){Ue(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:r,progressiveDone:u,contentDispositionFilename:h}=t;if(this._queuedChunks=[],this._progressiveDone=u,this._contentDispositionFilename=h,(r==null?void 0:r.length)>0){const f=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(f)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!n,this._isRangeSupported=!e,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((f,p)=>{this._onReceiveData({begin:f,chunk:p})}),t.addProgressListener((f,p)=>{this._onProgress({loaded:f,total:p})}),t.addProgressiveReadListener(f=>{this._onReceiveData({chunk:f})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const n=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const s=this._rangeReaders.some(function(r){return r._begin!==t?!1:(r._enqueue(n),!0)});Ue(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}_onProgress(t){var e,n,s,r;t.total===void 0?(n=(e=this._rangeReaders[0])==null?void 0:e.onProgress)==null||n.call(e,{loaded:t.loaded}):(r=(s=this._fullRequestReader)==null?void 0:s.onProgress)==null||r.call(s,{loaded:t.loaded,total:t.total})}_onProgressiveDone(){var t;(t=this._fullRequestReader)==null||t.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){Ue(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new wU(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new _U(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(n),n}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const n of this._rangeReaders.slice(0))n.cancel(t);this._pdfDataRangeTransport.abort()}}class wU{constructor(t,e,n=!1,s=null){this._stream=t,this._done=n||!1,this._filename=Mx(s)?s:null,this._queuedChunks=e||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class _U{constructor(t,e,n){this._stream=t,this._begin=e,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function AU(l){let t=!0,e=n("filename\\*","i").exec(l);if(e){e=e[1];let m=h(e);return m=unescape(m),m=f(m),m=p(m),r(m)}if(e=u(l),e){const m=p(e);return r(m)}if(e=n("filename","i").exec(l),e){e=e[1];let m=h(e);return m=p(m),r(m)}function n(m,b){return new RegExp("(?:^|;)\\s*"+m+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',b)}function s(m,b){if(m){if(!/^[\x00-\xFF]+$/.test(b))return b;try{const _=new TextDecoder(m,{fatal:!0}),S=Hv(b);b=_.decode(S),t=!1}catch{}}return b}function r(m){return t&&/[\x80-\xff]/.test(m)&&(m=s("utf-8",m),t&&(m=s("iso-8859-1",m))),m}function u(m){const b=[];let _;const S=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(_=S.exec(m))!==null;){let[,C,M,k]=_;if(C=parseInt(C,10),C in b){if(C===0)break;continue}b[C]=[M,k]}const R=[];for(let C=0;C<b.length&&C in b;++C){let[M,k]=b[C];k=h(k),M&&(k=unescape(k),C===0&&(k=f(k))),R.push(k)}return R.join("")}function h(m){if(m.startsWith('"')){const b=m.slice(1).split('\\"');for(let _=0;_<b.length;++_){const S=b[_].indexOf('"');S!==-1&&(b[_]=b[_].slice(0,S),b.length=_+1),b[_]=b[_].replaceAll(/\\(.)/g,"$1")}m=b.join('"')}return m}function f(m){const b=m.indexOf("'");if(b===-1)return m;const _=m.slice(0,b),R=m.slice(b+1).replace(/^[^']*'/,"");return s(_,R)}function p(m){return!m.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(m)?m:m.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(b,_,S,R){if(S==="q"||S==="Q")return R=R.replaceAll("_"," "),R=R.replaceAll(/=([0-9a-fA-F]{2})/g,function(C,M){return String.fromCharCode(parseInt(M,16))}),s(_,R);try{R=atob(R)}catch{}return s(_,R)})}return""}function Q2(l,t){const e=new Headers;if(!l||!t||typeof t!="object")return e;for(const n in t){const s=t[n];s!==void 0&&e.append(n,s)}return e}function CA(l){var t;return((t=URL.parse(l))==null?void 0:t.origin)??null}function J2({responseHeaders:l,isHttp:t,rangeChunkSize:e,disableRange:n}){const s={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(l.get("Content-Length"),10);return!Number.isInteger(r)||(s.suggestedLength=r,r<=2*e)||n||!t||l.get("Accept-Ranges")!=="bytes"||(l.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function Z2(l){const t=l.get("Content-Disposition");if(t){let e=AU(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Mx(e))return e}return null}function Xv(l,t){return new x_(`Unexpected server response (${l}) while retrieving PDF "${t}".`,l,l===404||l===0&&t.startsWith("file:"))}function tk(l){return l===200||l===206}function ek(l,t,e){return{method:"GET",headers:l,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function nk(l){return l instanceof Uint8Array?l.buffer:l instanceof ArrayBuffer?l:(me(`getArrayBuffer - unexpected data format: ${l}`),new Uint8Array(l).buffer)}class SU{constructor(t){Ct(this,"_responseOrigin",null);this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Q2(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return Ue(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new EU(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new CU(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const n of this._rangeRequestReaders.slice(0))n.cancel(t)}}class EU{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const n=new Headers(t.headers),s=e.url;fetch(s,ek(n,this._withCredentials,this._abortController)).then(r=>{if(t._responseOrigin=CA(r.url),!tk(r.status))throw Xv(r.status,s);this._reader=r.body.getReader(),this._headersCapability.resolve();const u=r.headers,{allowRangeRequests:h,suggestedLength:f}=J2({responseHeaders:u,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=h,this._contentLength=f||this._contentLength,this._filename=Z2(u),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Uu("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:nk(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}class CU{constructor(t,e,n){this._stream=t,this._reader=null,this._loaded=0;const s=t.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const r=new Headers(t.headers);r.append("Range",`bytes=${e}-${n-1}`);const u=s.url;fetch(u,ek(r,this._withCredentials,this._abortController)).then(h=>{const f=CA(h.url);if(f!==t._responseOrigin)throw new Error(`Expected range response-origin "${f}" to match "${t._responseOrigin}".`);if(!tk(h.status))throw Xv(h.status,u);this._readCapability.resolve(),this._reader=h.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:nk(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}const qE=200,XE=206;function xU(l){const t=l.response;return typeof t!="string"?t:Hv(t).buffer}class TU{constructor({url:t,httpHeaders:e,withCredentials:n}){Ct(this,"_responseOrigin",null);this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=Q2(this.isHttp,e),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,n=this.currXhrId++,s=this.pendingRequests[n]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[r,u]of this.headers)e.setRequestHeader(r,u);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),s.expectedStatus=XE):s.expectedStatus=qE,e.responseType="arraybuffer",Ue(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,n),e.onprogress=this.onProgress.bind(this,n),s.onHeadersReceived=t.onHeadersReceived,s.onDone=t.onDone,s.onError=t.onError,s.onProgress=t.onProgress,e.send(null),n}onProgress(t,e){var s;const n=this.pendingRequests[t];n&&((s=n.onProgress)==null||s.call(n,e))}onStateChange(t,e){const n=this.pendingRequests[t];if(!n)return;const s=n.xhr;if(s.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),s.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],s.status===0&&this.isHttp){n.onError(s.status);return}const r=s.status||qE;if(!(r===qE&&n.expectedStatus===XE)&&r!==n.expectedStatus){n.onError(s.status);return}const h=xU(s);if(r===XE){const f=s.getResponseHeader("Content-Range"),p=/bytes (\d+)-(\d+)\/(\d+)/.exec(f);p?n.onDone({begin:parseInt(p[1],10),chunk:h}):(me('Missing or invalid "Content-Range" header.'),n.onError(0))}else h?n.onDone({begin:0,chunk:h}):n.onError(s.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class RU{constructor(t){this._source=t,this._manager=new TU(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return Ue(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new OU(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const n=new DU(this._manager,t,e);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const n of this._rangeRequestReaders.slice(0))n.cancel(t)}}class OU{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=CA(e.responseURL);const n=e.getAllResponseHeaders(),s=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(h=>{const[f,...p]=h.split(": ");return[f,p.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:u}=J2({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=u||this._contentLength,this._filename=Z2(s),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Xv(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){var e;(e=this.onProgress)==null||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class DU{constructor(t,e,n){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var e;const t=CA((e=this._manager.getRequestXhr(this._requestId))==null?void 0:e.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var t;(t=this.onClosed)==null||t.call(this,this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??(this._storedError=Xv(t,this._url));for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){var e;this.isStreamingSupported||(e=this.onProgress)==null||e.call(this,{loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const MU=/^[a-z][a-z0-9\-+.]+:/i;function NU(l){if(MU.test(l))return new URL(l);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(l))}class kU{constructor(t){this.source=t,this.url=NU(t.url),Ue(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return Ue(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new PU(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new LU(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const n of this._rangeRequestReaders.slice(0))n.cancel(t)}}class PU{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=Xv(0,this._url.href)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Uu("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class LU{constructor(t,e,n){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=t.source;this._isStreamingSupported=!s.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:e,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const ny=Symbol("INITIAL_DATA");var ya,Ib,X1;class ik{constructor(){O(this,Ib);O(this,ya,Object.create(null))}get(t,e=null){if(e){const s=N(this,Ib,X1).call(this,t);return s.promise.then(()=>e(s.data)),null}const n=c(this,ya)[t];if(!n||n.data===ny)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return n.data}has(t){const e=c(this,ya)[t];return!!e&&e.data!==ny}delete(t){const e=c(this,ya)[t];return!e||e.data===ny?!1:(delete c(this,ya)[t],!0)}resolve(t,e=null){const n=N(this,Ib,X1).call(this,t);n.data=e,n.resolve()}clear(){var t;for(const e in c(this,ya)){const{data:n}=c(this,ya)[e];(t=n==null?void 0:n.bitmap)==null||t.close()}E(this,ya,Object.create(null))}*[Symbol.iterator](){for(const t in c(this,ya)){const{data:e}=c(this,ya)[t];e!==ny&&(yield[t,e])}}}ya=new WeakMap,Ib=new WeakSet,X1=function(t){var e;return(e=c(this,ya))[t]||(e[t]={...Promise.withResolvers(),data:ny})};const IU=1e5,sM=30;var uM,mu,ba,Bb,Fb,ld,Il,Ub,zb,cd,jb,am,gu,rm,Hb,om,ud,$b,Vb,lm,hd,Gb,cm,um,rc,sk,ak,Y1,La,Ww,K1,rk,ok;const Wi=class Wi{constructor({textContentSource:t,container:e,viewport:n}){O(this,rc);O(this,mu,Promise.withResolvers());O(this,ba,null);O(this,Bb,!1);O(this,Fb,!!((uM=globalThis.FontInspector)!=null&&uM.enabled));O(this,ld,null);O(this,Il,null);O(this,Ub,0);O(this,zb,0);O(this,cd,null);O(this,jb,null);O(this,am,0);O(this,gu,0);O(this,rm,Object.create(null));O(this,Hb,[]);O(this,om,null);O(this,ud,[]);O(this,$b,new WeakMap);O(this,Vb,null);var f;if(t instanceof ReadableStream)E(this,om,t);else if(typeof t=="object")E(this,om,new ReadableStream({start(p){p.enqueue(t),p.close()}}));else throw new Error('No "textContentSource" parameter specified.');E(this,ba,E(this,jb,e)),E(this,gu,n.scale*Po.pixelRatio),E(this,am,n.rotation),E(this,Il,{div:null,properties:null,ctx:null});const{pageWidth:s,pageHeight:r,pageX:u,pageY:h}=n.rawDims;E(this,Vb,[1,0,0,-1,-u,h+r]),E(this,zb,s),E(this,Ub,r),N(f=Wi,La,rk).call(f),e.style.setProperty("--min-font-size",c(Wi,cm)),Xd(e,n),c(this,mu).promise.finally(()=>{c(Wi,um).delete(this),E(this,Il,null),E(this,rm,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=Ti.platform;return ge(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{c(this,cd).read().then(({value:e,done:n})=>{if(n){c(this,mu).resolve();return}c(this,ld)??E(this,ld,e.lang),Object.assign(c(this,rm),e.styles),N(this,rc,sk).call(this,e.items),t()},c(this,mu).reject)};return E(this,cd,c(this,om).getReader()),c(Wi,um).add(this),t(),c(this,mu).promise}update({viewport:t,onBefore:e=null}){var r;const n=t.scale*Po.pixelRatio,s=t.rotation;if(s!==c(this,am)&&(e==null||e(),E(this,am,s),Xd(c(this,jb),{rotation:s})),n!==c(this,gu)){e==null||e(),E(this,gu,n);const u={div:null,properties:null,ctx:N(r=Wi,La,Ww).call(r,c(this,ld))};for(const h of c(this,ud))u.properties=c(this,$b).get(h),u.div=h,N(this,rc,Y1).call(this,u)}}cancel(){var e;const t=new Uu("TextLayer task cancelled.");(e=c(this,cd))==null||e.cancel(t).catch(()=>{}),E(this,cd,null),c(this,mu).reject(t)}get textDivs(){return c(this,ud)}get textContentItemsStr(){return c(this,Hb)}static cleanup(){if(!(c(this,um).size>0)){c(this,lm).clear();for(const{canvas:t}of c(this,hd).values())t.remove();c(this,hd).clear()}}};mu=new WeakMap,ba=new WeakMap,Bb=new WeakMap,Fb=new WeakMap,ld=new WeakMap,Il=new WeakMap,Ub=new WeakMap,zb=new WeakMap,cd=new WeakMap,jb=new WeakMap,am=new WeakMap,gu=new WeakMap,rm=new WeakMap,Hb=new WeakMap,om=new WeakMap,ud=new WeakMap,$b=new WeakMap,Vb=new WeakMap,lm=new WeakMap,hd=new WeakMap,Gb=new WeakMap,cm=new WeakMap,um=new WeakMap,rc=new WeakSet,sk=function(t){var s,r;if(c(this,Bb))return;(r=c(this,Il)).ctx??(r.ctx=N(s=Wi,La,Ww).call(s,c(this,ld)));const e=c(this,ud),n=c(this,Hb);for(const u of t){if(e.length>IU){me("Ignoring additional textDivs for performance reasons."),E(this,Bb,!0);return}if(u.str===void 0){if(u.type==="beginMarkedContentProps"||u.type==="beginMarkedContent"){const h=c(this,ba);E(this,ba,document.createElement("span")),c(this,ba).classList.add("markedContent"),u.id&&c(this,ba).setAttribute("id",`${u.id}`),h.append(c(this,ba))}else u.type==="endMarkedContent"&&E(this,ba,c(this,ba).parentNode);continue}n.push(u.str),N(this,rc,ak).call(this,u)}},ak=function(t){var R;const e=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};c(this,ud).push(e);const s=jt.transform(c(this,Vb),t.transform);let r=Math.atan2(s[1],s[0]);const u=c(this,rm)[t.fontName];u.vertical&&(r+=Math.PI/2);let h=c(this,Fb)&&u.fontSubstitution||u.fontFamily;h=Wi.fontFamilyMap.get(h)||h;const f=Math.hypot(s[2],s[3]),p=f*N(R=Wi,La,ok).call(R,h,u,c(this,ld));let m,b;r===0?(m=s[4],b=s[5]-p):(m=s[4]+p*Math.sin(r),b=s[5]-p*Math.cos(r));const _=e.style;_.left=`${(100*m/c(this,zb)).toFixed(2)}%`,_.top=`${(100*b/c(this,Ub)).toFixed(2)}%`,_.setProperty("--font-height",`${f.toFixed(2)}px`),_.fontFamily=h,n.fontSize=f,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,c(this,Fb)&&(e.dataset.fontName=u.fontSubstitutionLoadedName||t.fontName),r!==0&&(n.angle=r*(180/Math.PI));let S=!1;if(t.str.length>1)S=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const C=Math.abs(t.transform[0]),M=Math.abs(t.transform[3]);C!==M&&Math.max(C,M)/Math.min(C,M)>1.5&&(S=!0)}if(S&&(n.canvasWidth=u.vertical?t.height:t.width),c(this,$b).set(e,n),c(this,Il).div=e,c(this,Il).properties=n,N(this,rc,Y1).call(this,c(this,Il)),n.hasText&&c(this,ba).append(e),n.hasEOL){const C=document.createElement("br");C.setAttribute("role","presentation"),c(this,ba).append(C)}},Y1=function(t){var u;const{div:e,properties:n,ctx:s}=t,{style:r}=e;if(n.canvasWidth!==0&&n.hasText){const{fontFamily:h}=r,{canvasWidth:f,fontSize:p}=n;N(u=Wi,La,K1).call(u,s,p*c(this,gu),h);const{width:m}=s.measureText(e.textContent);m>0&&r.setProperty("--scale-x",f*c(this,gu)/m)}n.angle!==0&&r.setProperty("--rotate",`${n.angle}deg`)},La=new WeakSet,Ww=function(t=null){let e=c(this,hd).get(t||(t=""));if(!e){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=t,document.body.append(n),e=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),c(this,hd).set(t,e),c(this,Gb).set(e,{size:0,family:""})}return e},K1=function(t,e,n){const s=c(this,Gb).get(t);e===s.size&&n===s.family||(t.font=`${e}px ${n}`,s.size=e,s.family=n)},rk=function(){if(c(this,cm)!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),E(this,cm,t.getBoundingClientRect().height),t.remove()},ok=function(t,e,n){const s=c(this,lm).get(t);if(s)return s;const r=N(this,La,Ww).call(this,n);r.canvas.width=r.canvas.height=sM,N(this,La,K1).call(this,r,sM,t);const u=r.measureText(""),h=u.fontBoundingBoxAscent,f=Math.abs(u.fontBoundingBoxDescent);r.canvas.width=r.canvas.height=0;let p=.8;return h?p=h/(h+f):(Ti.platform.isFirefox&&me("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?p=e.ascent:e.descent&&(p=1+e.descent)),c(this,lm).set(t,p),p},O(Wi,La),O(Wi,lm,new Map),O(Wi,hd,new Map),O(Wi,Gb,new WeakMap),O(Wi,cm,null),O(Wi,um,new Set);let zy=Wi;const BU=100;function lk(l={}){typeof l=="string"||l instanceof URL?l={url:l}:(l instanceof ArrayBuffer||ArrayBuffer.isView(l))&&(l={data:l});const t=new W1,{docId:e}=t,n=l.url?V3(l.url):null,s=l.data?G3(l.data):null,r=l.httpHeaders||null,u=l.withCredentials===!0,h=l.password??null,f=l.range instanceof ck?l.range:null,p=Number.isInteger(l.rangeChunkSize)&&l.rangeChunkSize>0?l.rangeChunkSize:2**16;let m=l.worker instanceof jy?l.worker:null;const b=l.verbosity,_=typeof l.docBaseUrl=="string"&&!EA(l.docBaseUrl)?l.docBaseUrl:null,S=_w(l.cMapUrl),R=l.cMapPacked!==!1,C=l.CMapReaderFactory||(Ds?Z3:VD),M=_w(l.iccUrl),k=_w(l.standardFontDataUrl),I=l.StandardFontDataFactory||(Ds?tU:GD),P=_w(l.wasmUrl),F=l.WasmFactory||(Ds?eU:qD),z=l.stopAtErrors!==!0,j=Number.isInteger(l.maxImageSize)&&l.maxImageSize>-1?l.maxImageSize:-1,H=l.isEvalSupported!==!1,dt=typeof l.isOffscreenCanvasSupported=="boolean"?l.isOffscreenCanvasSupported:!Ds,ct=typeof l.isImageDecoderSupported=="boolean"?l.isImageDecoderSupported:!Ds&&(Ti.platform.isFirefox||!globalThis.chrome),yt=Number.isInteger(l.canvasMaxAreaInBytes)?l.canvasMaxAreaInBytes:-1,gt=typeof l.disableFontFace=="boolean"?l.disableFontFace:Ds,Pt=l.fontExtraProperties===!0,Xt=l.enableXfa===!0,Vt=l.ownerDocument||globalThis.document,Yt=l.disableRange===!0,J=l.disableStream===!0,pt=l.disableAutoFetch===!0,Et=l.pdfBug===!0,Wt=l.CanvasFactory||(Ds?J3:K3),Zt=l.FilterFactory||(Ds?Q3:W3),G=l.enableHWA===!0,ft=l.useWasm!==!1,_t=f?f.length:l.length??NaN,Mt=typeof l.useSystemFonts=="boolean"?l.useSystemFonts:!Ds&&!gt,It=typeof l.useWorkerFetch=="boolean"?l.useWorkerFetch:!!(C===VD&&I===GD&&F===qD&&S&&k&&P&&hy(S,document.baseURI)&&hy(k,document.baseURI)&&hy(P,document.baseURI)),Gt=null;y3(b);const Ft={canvasFactory:new Wt({ownerDocument:Vt,enableHWA:G}),filterFactory:new Zt({docId:e,ownerDocument:Vt}),cMapReaderFactory:It?null:new C({baseUrl:S,isCompressed:R}),standardFontDataFactory:It?null:new I({baseUrl:k}),wasmFactory:It?null:new F({baseUrl:P})};m||(m=jy.create({verbosity:b,port:No.workerPort}),t._worker=m);const Ke={docId:e,apiVersion:"5.4.530",data:s,password:h,disableAutoFetch:pt,rangeChunkSize:p,length:_t,docBaseUrl:_,enableXfa:Xt,evaluatorOptions:{maxImageSize:j,disableFontFace:gt,ignoreErrors:z,isEvalSupported:H,isOffscreenCanvasSupported:dt,isImageDecoderSupported:ct,canvasMaxAreaInBytes:yt,fontExtraProperties:Pt,useSystemFonts:Mt,useWasm:ft,useWorkerFetch:It,cMapUrl:S,iccUrl:M,standardFontDataUrl:k,wasmUrl:P}},Dt={ownerDocument:Vt,pdfBug:Et,styleElement:Gt,loadingParams:{disableAutoFetch:pt,enableXfa:Xt}};return m.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(m.destroyed)throw new Error("Worker was destroyed");const pi=m.messageHandler.sendWithPromise("GetDocRequest",Ke,s?[s.buffer]:null);let bn;if(f)bn=new vU(f,{disableRange:Yt,disableStream:J});else if(!s){if(!n)throw new Error("getDocument - no `url` parameter provided.");const Ee=hy(n)?SU:Ds?kU:RU;bn=new Ee({url:n,length:_t,httpHeaders:r,withCredentials:u,rangeChunkSize:p,disableRange:Yt,disableStream:J})}return pi.then(Ee=>{if(t.destroyed)throw new Error("Loading aborted");if(m.destroyed)throw new Error("Worker was destroyed");const os=new vy(e,Ee,m.port),ws=new zU(os,t,bn,Dt,Ft,G);t._transport=ws,os.send("Ready",null)})}).catch(t._capability.reject),t}var K_;const W_=class W_{constructor(){Ct(this,"_capability",Promise.withResolvers());Ct(this,"_transport",null);Ct(this,"_worker",null);Ct(this,"docId",`d${bi(W_,K_)._++}`);Ct(this,"destroyed",!1);Ct(this,"onPassword",null);Ct(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var t,e,n,s;this.destroyed=!0;try{(t=this._worker)!=null&&t.port&&(this._worker._pendingDestroy=!0),await((e=this._transport)==null?void 0:e.destroy())}catch(r){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,r}this._transport=null,(s=this._worker)==null||s.destroy(),this._worker=null}async getData(){return this._transport.getData()}};K_=new WeakMap,O(W_,K_,0);let W1=W_;var dd,qb,Xb,Yb,Kb;class ck{constructor(t,e,n=!1,s=null){O(this,dd,Promise.withResolvers());O(this,qb,[]);O(this,Xb,[]);O(this,Yb,[]);O(this,Kb,[]);this.length=t,this.initialData=e,this.progressiveDone=n,this.contentDispositionFilename=s}addRangeListener(t){c(this,Kb).push(t)}addProgressListener(t){c(this,Yb).push(t)}addProgressiveReadListener(t){c(this,Xb).push(t)}addProgressiveDoneListener(t){c(this,qb).push(t)}onDataRange(t,e){for(const n of c(this,Kb))n(t,e)}onDataProgress(t,e){c(this,dd).promise.then(()=>{for(const n of c(this,Yb))n(t,e)})}onDataProgressiveRead(t){c(this,dd).promise.then(()=>{for(const e of c(this,Xb))e(t)})}onDataProgressiveDone(){c(this,dd).promise.then(()=>{for(const t of c(this,qb))t()})}transportReady(){c(this,dd).resolve()}requestDataRange(t,e){yn("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}dd=new WeakMap,qb=new WeakMap,Xb=new WeakMap,Yb=new WeakMap,Kb=new WeakMap;class FU{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return ge(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(t){return this._transport.extractPages(t)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var Bl,fd,Ey;class UU{constructor(t,e,n,s=!1){O(this,fd);O(this,Bl,!1);this._pageIndex=t,this._pageInfo=e,this._transport=n,this._stats=s?new BD:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new ik,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:n=0,offsetY:s=0,dontFlip:r=!1}={}){return new Vv({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:s,dontFlip:r})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return ge(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var t;return((t=this._transport._htmlForXfa)==null?void 0:t.children[this._pageIndex])||null}render({canvasContext:t,canvas:e=t.canvas,viewport:n,intent:s="display",annotationMode:r=Xc.ENABLE,transform:u=null,background:h=null,optionalContentConfigPromise:f=null,annotationCanvasMap:p=null,pageColors:m=null,printAnnotationStorage:b=null,isEditing:_=!1,recordOperations:S=!1,operationsFilter:R=null}){var ct,yt,gt;(ct=this._stats)==null||ct.time("Overall");const C=this._transport.getRenderingIntent(s,r,b,_),{renderingIntent:M,cacheKey:k}=C;E(this,Bl,!1),f||(f=this._transport.getOptionalContentConfig(M));let I=this._intentStates.get(k);I||(I=Object.create(null),this._intentStates.set(k,I)),I.streamReaderCancelTimeout&&(clearTimeout(I.streamReaderCancelTimeout),I.streamReaderCancelTimeout=null);const P=!!(M&Na.PRINT);I.displayReadyCapability||(I.displayReadyCapability=Promise.withResolvers(),I.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(yt=this._stats)==null||yt.time("Page Request"),this._pumpOperatorList(C));const F=!!(this._pdfBug&&((gt=globalThis.StepperManager)!=null&&gt.enabled)),z=!this.recordedBBoxes&&(S||F),j=Pt=>{var Xt,Vt;if(I.renderTasks.delete(H),z){const Yt=(Xt=H.gfx)==null?void 0:Xt.dependencyTracker.take();Yt&&(H.stepper&&H.stepper.setOperatorBBoxes(Yt,H.gfx.dependencyTracker.takeDebugMetadata()),S&&(this.recordedBBoxes=Yt))}P&&E(this,Bl,!0),N(this,fd,Ey).call(this),Pt?(H.capability.reject(Pt),this._abortOperatorList({intentState:I,reason:Pt instanceof Error?Pt:new Error(Pt)})):H.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(Vt=globalThis.Stats)!=null&&Vt.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},H=new Q1({callback:j,params:{canvas:e,canvasContext:t,dependencyTracker:z?new iU(e,I.operatorList.length,F):null,viewport:n,transform:u,background:h},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:p,operatorList:I.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!P,pdfBug:this._pdfBug,pageColors:m,enableHWA:this._transport.enableHWA,operationsFilter:R});(I.renderTasks||(I.renderTasks=new Set)).add(H);const dt=H.task;return Promise.all([I.displayReadyCapability.promise,f]).then(([Pt,Xt])=>{var Vt;if(this.destroyed){j();return}if((Vt=this._stats)==null||Vt.time("Rendering"),!(Xt.renderingIntent&M))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");H.initializeGraphics({transparency:Pt,optionalContentConfig:Xt}),H.operatorListChanged()}).catch(j),dt}getOperatorList({intent:t="display",annotationMode:e=Xc.ENABLE,printAnnotationStorage:n=null,isEditing:s=!1}={}){var p;function r(){h.operatorList.lastChunk&&(h.opListReadCapability.resolve(h.operatorList),h.renderTasks.delete(f))}const u=this._transport.getRenderingIntent(t,e,n,s,!0);let h=this._intentStates.get(u.cacheKey);h||(h=Object.create(null),this._intentStates.set(u.cacheKey,h));let f;return h.opListReadCapability||(f=Object.create(null),f.operatorListChanged=r,h.opListReadCapability=Promise.withResolvers(),(h.renderTasks||(h.renderTasks=new Set)).add(f),h.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(p=this._stats)==null||p.time("Page Request"),this._pumpOperatorList(u)),h.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>Uy.textContent(n));const e=this.streamTextContent(t);return new Promise(function(n,s){function r(){u.read().then(function({value:f,done:p}){if(p){n(h);return}h.lang??(h.lang=f.lang),Object.assign(h.styles,f.styles),h.items.push(...f.items),r()},s)}const u=e.getReader(),h={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const n of e.renderTasks)t.push(n.completed),n.cancel();return this.objs.clear(),E(this,Bl,!1),Promise.all(t)}cleanup(t=!1){E(this,Bl,!0);const e=N(this,fd,Ey).call(this);return t&&e&&this._stats&&(this._stats=new BD),e}_startRenderPage(t,e){var s,r;const n=this._intentStates.get(e);n&&((s=this._stats)==null||s.timeEnd("Page Request"),(r=n.displayReadyCapability)==null||r.resolve(t))}_renderPageChunk(t,e){for(let n=0,s=t.length;n<s;n++)e.operatorList.fnArray.push(t.fnArray[n]),e.operatorList.argsArray.push(t.argsArray[n]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const n of e.renderTasks)n.operatorListChanged();t.lastChunk&&N(this,fd,Ey).call(this)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:n,modifiedIds:s}){const{map:r,transfer:u}=n,f=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:r,modifiedIds:s},u).getReader(),p=this._intentStates.get(e);p.streamReader=f;const m=()=>{f.read().then(({value:b,done:_})=>{if(_){p.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(b,p),m())},b=>{if(p.streamReader=null,!this._transport.destroyed){if(p.operatorList){p.operatorList.lastChunk=!0;for(const _ of p.renderTasks)_.operatorListChanged();N(this,fd,Ey).call(this)}if(p.displayReadyCapability)p.displayReadyCapability.reject(b);else if(p.opListReadCapability)p.opListReadCapability.reject(b);else throw b}})};m()}_abortOperatorList({intentState:t,reason:e,force:n=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!n){if(t.renderTasks.size>0)return;if(e instanceof Dx){let s=BU;e.extraDelay>0&&e.extraDelay<1e3&&(s+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},s);return}}if(t.streamReader.cancel(new Uu(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[s,r]of this._intentStates)if(r===t){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}Bl=new WeakMap,fd=new WeakSet,Ey=function(){if(!c(this,Bl)||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),E(this,Bl,!1),!0};var yu,Mr,Fl,pd,Q_,md,gd,Ns,Qw,uk,hk,Cy,hm,Jw;const kn=class kn{constructor({name:t=null,port:e=null,verbosity:n=b3()}={}){O(this,Ns);O(this,yu,Promise.withResolvers());O(this,Mr,null);O(this,Fl,null);O(this,pd,null);if(this.name=t,this.destroyed=!1,this.verbosity=n,e){if(c(kn,gd).has(e))throw new Error("Cannot use more than one PDFWorker per port.");c(kn,gd).set(e,this),N(this,Ns,uk).call(this,e)}else N(this,Ns,hk).call(this)}get promise(){return c(this,yu).promise}get port(){return c(this,Fl)}get messageHandler(){return c(this,Mr)}destroy(){var t,e;this.destroyed=!0,(t=c(this,pd))==null||t.terminate(),E(this,pd,null),c(kn,gd).delete(c(this,Fl)),E(this,Fl,null),(e=c(this,Mr))==null||e.destroy(),E(this,Mr,null)}static create(t){const e=c(this,gd).get(t==null?void 0:t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new kn(t)}static get workerSrc(){if(No.workerSrc)return No.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return ge(this,"_setupFakeWorkerGlobal",(async()=>c(this,hm,Jw)?c(this,hm,Jw):(await import(this.workerSrc)).WorkerMessageHandler)())}};yu=new WeakMap,Mr=new WeakMap,Fl=new WeakMap,pd=new WeakMap,Q_=new WeakMap,md=new WeakMap,gd=new WeakMap,Ns=new WeakSet,Qw=function(){c(this,yu).resolve(),c(this,Mr).send("configure",{verbosity:this.verbosity})},uk=function(t){E(this,Fl,t),E(this,Mr,new vy("main","worker",t)),c(this,Mr).on("ready",()=>{}),N(this,Ns,Qw).call(this)},hk=function(){if(c(kn,md)||c(kn,hm,Jw)){N(this,Ns,Cy).call(this);return}let{workerSrc:t}=kn;try{kn._isSameOrigin(window.location,t)||(t=kn._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),n=new vy("main","worker",e),s=()=>{r.abort(),n.destroy(),e.terminate(),this.destroyed?c(this,yu).reject(new Error("Worker was destroyed")):N(this,Ns,Cy).call(this)},r=new AbortController;e.addEventListener("error",()=>{c(this,pd)||s()},{signal:r.signal}),n.on("test",h=>{if(r.abort(),this.destroyed||!h){s();return}E(this,Mr,n),E(this,Fl,e),E(this,pd,e),N(this,Ns,Qw).call(this)}),n.on("ready",h=>{if(r.abort(),this.destroyed){s();return}try{u()}catch{N(this,Ns,Cy).call(this)}});const u=()=>{const h=new Uint8Array;n.send("test",h,[h.buffer])};u();return}catch{SA("The worker has been disabled.")}N(this,Ns,Cy).call(this)},Cy=function(){c(kn,md)||(me("Setting up fake worker."),E(kn,md,!0)),kn._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){c(this,yu).reject(new Error("Worker was destroyed"));return}const e=new Y3;E(this,Fl,e);const n=`fake${bi(kn,Q_)._++}`,s=new vy(n+"_worker",n,e);t.setup(s,e),E(this,Mr,new vy(n,n+"_worker",e)),N(this,Ns,Qw).call(this)}).catch(t=>{c(this,yu).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},hm=new WeakSet,Jw=function(){var t;try{return((t=globalThis.pdfjsWorker)==null?void 0:t.WorkerMessageHandler)||null}catch{return null}},O(kn,hm),O(kn,Q_,0),O(kn,md,!1),O(kn,gd,new WeakMap),Ds&&(E(kn,md,!0),No.workerSrc||(No.workerSrc="./pdf.worker.mjs")),kn._isSameOrigin=(t,e)=>{const n=URL.parse(t);if(!(n!=null&&n.origin)||n.origin==="null")return!1;const s=new URL(e,n);return n.origin===s.origin},kn._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},kn.fromPort=t=>{if(D3("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(t!=null&&t.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return kn.create(t)};let jy=kn;var Ul,Ao,dm,fm,zl,yd,xy;class zU{constructor(t,e,n,s,r,u){O(this,yd);O(this,Ul,new Map);O(this,Ao,new Map);O(this,dm,new Map);O(this,fm,new Map);O(this,zl,null);this.messageHandler=t,this.loadingTask=e,this.commonObjs=new ik,this.fontLoader=new j3({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.wasmFactory=r.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=u,this.setupMessageHandler()}get annotationStorage(){return ge(this,"annotationStorage",new Nx)}getRenderingIntent(t,e=Xc.ENABLE,n=null,s=!1,r=!1){let u=Na.DISPLAY,h=k1;switch(t){case"any":u=Na.ANY;break;case"display":break;case"print":u=Na.PRINT;break;default:me(`getRenderingIntent - invalid intent: ${t}`)}const f=u&Na.PRINT&&n instanceof j2?n:this.annotationStorage;switch(e){case Xc.DISABLE:u+=Na.ANNOTATIONS_DISABLE;break;case Xc.ENABLE:break;case Xc.ENABLE_FORMS:u+=Na.ANNOTATIONS_FORMS;break;case Xc.ENABLE_STORAGE:u+=Na.ANNOTATIONS_STORAGE,h=f.serializable;break;default:me(`getRenderingIntent - invalid annotationMode: ${e}`)}s&&(u+=Na.IS_EDITING),r&&(u+=Na.OPLIST);const{ids:p,hash:m}=f.modifiedIds,b=[u,h.hash,m];return{renderingIntent:u,cacheKey:b.join("_"),annotationStorageSerializable:h,modifiedIds:p}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=c(this,zl))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of c(this,Ao).values())t.push(s._destroy());c(this,Ao).clear(),c(this,dm).clear(),c(this,fm).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{var s,r;this.commonObjs.clear(),this.fontLoader.clear(),c(this,Ul).clear(),this.filterFactory.destroy(),zy.cleanup(),(s=this._networkStream)==null||s.cancelAllRequests(new Uu("Worker was terminated.")),(r=this.messageHandler)==null||r.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(n,s)=>{Ue(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},s.onPull=()=>{this._fullReader.read().then(function({value:r,done:u}){if(u){s.close();return}Ue(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{this._fullReader.cancel(r),s.ready.catch(u=>{if(!this.destroyed)throw u})}}),t.on("ReaderHeadersReady",async n=>{var h;await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:r,contentLength:u}=this._fullReader;return(!s||!r)&&(this._lastProgress&&((h=e.onProgress)==null||h.call(e,this._lastProgress)),this._fullReader.onProgress=f=>{var p;(p=e.onProgress)==null||p.call(e,{loaded:f.loaded,total:f.total})}),{isStreamingSupported:s,isRangeSupported:r,contentLength:u}}),t.on("GetRangeReader",(n,s)=>{Ue(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(n.begin,n.end);if(!r){s.close();return}s.onPull=()=>{r.read().then(function({value:u,done:h}){if(h){s.close();return}Ue(u instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(u),1,[u])}).catch(u=>{s.error(u)})},s.onCancel=u=>{r.cancel(u),s.ready.catch(h=>{if(!this.destroyed)throw h})}}),t.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,e._capability.resolve(new FU(n,this))}),t.on("DocException",n=>{e._capability.reject(Vs(n))}),t.on("PasswordRequest",n=>{E(this,zl,Promise.withResolvers());try{if(!e.onPassword)throw Vs(n);const s=r=>{r instanceof Error?c(this,zl).reject(r):c(this,zl).resolve({password:r})};e.onPassword(s,n.code)}catch(s){c(this,zl).reject(s)}return c(this,zl).promise}),t.on("DataLoaded",n=>{var s;(s=e.onProgress)==null||s.call(e,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),t.on("StartRenderPage",n=>{if(this.destroyed)return;c(this,Ao).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),t.on("commonobj",([n,s,r])=>{var u;if(this.destroyed||this.commonObjs.has(n))return null;switch(s){case"Font":if("error"in r){const _=r.error;me(`Error during font loading: ${_}`),this.commonObjs.resolve(n,_);break}const h=new P1(r),f=this._params.pdfBug&&((u=globalThis.FontInspector)!=null&&u.enabled)?(_,S)=>globalThis.FontInspector.fontAdded(_,S):null,p=new H3(h,f,r.extra,r.charProcOperatorList);this.fontLoader.bind(p).catch(()=>t.sendWithPromise("FontFallback",{id:n})).finally(()=>{!p.fontExtraProperties&&p.data&&p.clearData(),this.commonObjs.resolve(n,p)});break;case"CopyLocalImage":const{imageRef:m}=r;Ue(m,"The imageRef must be defined.");for(const _ of c(this,Ao).values())for(const[,S]of _.objs)if((S==null?void 0:S.ref)===m)return S.dataLen?(this.commonObjs.resolve(n,structuredClone(S)),S.dataLen):null;break;case"FontPath":this.commonObjs.resolve(n,new $3(r));break;case"Image":this.commonObjs.resolve(n,r);break;case"Pattern":const b=new L1(r);this.commonObjs.resolve(n,b.getIR());break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),t.on("obj",([n,s,r,u])=>{var f;if(this.destroyed)return;const h=c(this,Ao).get(s);if(!h.objs.has(n)){if(h._intentStates.size===0){(f=u==null?void 0:u.bitmap)==null||f.close();return}switch(r){case"Image":case"Pattern":h.objs.resolve(n,u);break;default:throw new Error(`Got unknown object type ${r}`)}}}),t.on("DocProgress",n=>{var s;this.destroyed||(s=e.onProgress)==null||s.call(e,{loaded:n.loaded,total:n.total})}),t.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const s=this[n.type];if(!s)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return s.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n;this.annotationStorage.size<=0&&me("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:((n=this._fullReader)==null?void 0:n.filename)??null},e).finally(()=>{this.annotationStorage.resetModified()})}extractPages(t){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:t})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,n=c(this,dm).get(e);if(n)return n;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&c(this,fm).set(r.refStr,t);const u=new UU(e,r,this,this._params.pdfBug);return c(this,Ao).set(e,u),u});return c(this,dm).set(e,s),s}getPageIndex(t){return I1(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return N(this,yd,xy).call(this,"GetFieldObjects")}hasJSActions(){return N(this,yd,xy).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return N(this,yd,xy).call(this,"GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return N(this,yd,xy).call(this,"GetOptionalContentConfig").then(e=>new bU(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=c(this,Ul).get(t);if(e)return e;const n=this.messageHandler.sendWithPromise(t,null).then(s=>{var r,u;return{info:s[0],metadata:s[1]?new gU(s[1]):null,contentDispositionFilename:((r=this._fullReader)==null?void 0:r.filename)??null,contentLength:((u=this._fullReader)==null?void 0:u.contentLength)??null,hasStructTree:s[2]}});return c(this,Ul).set(t,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of c(this,Ao).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),c(this,Ul).clear(),this.filterFactory.destroy(!0),zy.cleanup()}}cachedPageNumber(t){if(!I1(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return c(this,fm).get(e)??null}}Ul=new WeakMap,Ao=new WeakMap,dm=new WeakMap,fm=new WeakMap,zl=new WeakMap,yd=new WeakSet,xy=function(t,e=null){const n=c(this,Ul).get(t);if(n)return n;const s=this.messageHandler.sendWithPromise(t,e);return c(this,Ul).set(t,s),s};var bu;class jU{constructor(t){O(this,bu,null);Ct(this,"onContinue",null);Ct(this,"onError",null);E(this,bu,t)}get promise(){return c(this,bu).capability.promise}cancel(t=0){c(this,bu).cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=c(this,bu).operatorList;if(!t)return!1;const{annotationCanvasMap:e}=c(this,bu);return t.form||t.canvas&&(e==null?void 0:e.size)>0}}bu=new WeakMap;var vu,bd;const Rh=class Rh{constructor({callback:t,params:e,objs:n,commonObjs:s,annotationCanvasMap:r,operatorList:u,pageIndex:h,canvasFactory:f,filterFactory:p,useRequestAnimationFrame:m=!1,pdfBug:b=!1,pageColors:_=null,enableHWA:S=!1,operationsFilter:R=null}){O(this,vu,null);this.callback=t,this.params=e,this.objs=n,this.commonObjs=s,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=u,this._pageIndex=h,this.canvasFactory=f,this.filterFactory=p,this._pdfBug=b,this.pageColors=_,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=m===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new jU(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=S,this._dependencyTracker=e.dependencyTracker,this._operationsFilter=R}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){var f,p;if(this.cancelled)return;if(this._canvas){if(c(Rh,bd).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");c(Rh,bd).add(this._canvas)}this._pdfBug&&((f=globalThis.StepperManager)!=null&&f.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:s,background:r,dependencyTracker:u}=this.params,h=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new bp(h,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,u),this.gfx.beginDrawing({transform:s,viewport:n,transparency:t,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(p=this.graphicsReadyCallback)==null||p.call(this)}cancel(t=null,e=0){var n,s,r;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),c(this,vu)&&(window.cancelAnimationFrame(c(this,vu)),E(this,vu,null)),c(Rh,bd).delete(this._canvas),t||(t=new Dx(`Rendering cancelled, page ${this._pageIndex+1}`,e)),this.callback(t),(r=(s=this.task).onError)==null||r.call(s,t)}operatorListChanged(){var t,e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(t=this.gfx.dependencyTracker)==null||t.growOperationsCount(this.operatorList.fnArray.length),(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?E(this,vu,window.requestAnimationFrame(()=>{E(this,vu,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),c(Rh,bd).delete(this._canvas),this.callback())))}};vu=new WeakMap,bd=new WeakMap,O(Rh,bd,new WeakSet);let Q1=Rh;const HU="5.4.530",$U="50cc4adac";var va,vd,pm,Ei,Wb,mm,jl,Qb,wu,Nr,Jb,hn,J1,Z1,tC,Sh,dk,qc;const Gs=class Gs{constructor({editor:t=null,uiManager:e=null}){O(this,hn);O(this,va,null);O(this,vd,null);O(this,pm);O(this,Ei,null);O(this,Wb,!1);O(this,mm,!1);O(this,jl,null);O(this,Qb);O(this,wu,null);O(this,Nr,null);var n,s;t?(E(this,mm,!1),E(this,jl,t)):E(this,mm,!0),E(this,Nr,(t==null?void 0:t._uiManager)||e),E(this,Qb,c(this,Nr)._eventBus),E(this,pm,((n=t==null?void 0:t.color)==null?void 0:n.toUpperCase())||((s=c(this,Nr))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),c(Gs,Jb)||E(Gs,Jb,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return ge(this,"_keyboardManager",new qv([[["Escape","mac+Escape"],Gs.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Gs.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Gs.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Gs.prototype._moveToPrevious],[["Home","mac+Home"],Gs.prototype._moveToBeginning],[["End","mac+End"],Gs.prototype._moveToEnd]]))}renderButton(){const t=E(this,va,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",c(this,jl)&&(t.ariaControls=`${c(this,jl).id}_colorpicker_dropdown`);const e=c(this,Nr)._signal;t.addEventListener("click",N(this,hn,Sh).bind(this),{signal:e}),t.addEventListener("keydown",N(this,hn,tC).bind(this),{signal:e});const n=E(this,vd,document.createElement("span"));return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=c(this,pm),t.append(n),t}renderMainDropdown(){const t=E(this,Ei,N(this,hn,J1).call(this));return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}_colorSelectFromKeyboard(t){if(t.target===c(this,va)){N(this,hn,Sh).call(this,t);return}const e=t.target.getAttribute("data-color");e&&N(this,hn,Z1).call(this,e,t)}_moveToNext(t){var e,n;if(!c(this,hn,qc)){N(this,hn,Sh).call(this,t);return}if(t.target===c(this,va)){(e=c(this,Ei).firstElementChild)==null||e.focus();return}(n=t.target.nextSibling)==null||n.focus()}_moveToPrevious(t){var e,n;if(t.target===((e=c(this,Ei))==null?void 0:e.firstElementChild)||t.target===c(this,va)){c(this,hn,qc)&&this._hideDropdownFromKeyboard();return}c(this,hn,qc)||N(this,hn,Sh).call(this,t),(n=t.target.previousSibling)==null||n.focus()}_moveToBeginning(t){var e;if(!c(this,hn,qc)){N(this,hn,Sh).call(this,t);return}(e=c(this,Ei).firstElementChild)==null||e.focus()}_moveToEnd(t){var e;if(!c(this,hn,qc)){N(this,hn,Sh).call(this,t);return}(e=c(this,Ei).lastElementChild)==null||e.focus()}hideDropdown(){var t,e;(t=c(this,Ei))==null||t.classList.add("hidden"),c(this,va).ariaExpanded="false",(e=c(this,wu))==null||e.abort(),E(this,wu,null)}_hideDropdownFromKeyboard(){var t;if(!c(this,mm)){if(!c(this,hn,qc)){(t=c(this,jl))==null||t.unselect();return}this.hideDropdown(),c(this,va).focus({preventScroll:!0,focusVisible:c(this,Wb)})}}updateColor(t){if(c(this,vd)&&(c(this,vd).style.backgroundColor=t),!c(this,Ei))return;const e=c(this,Nr).highlightColors.values();for(const n of c(this,Ei).children)n.ariaSelected=e.next().value===t.toUpperCase()}destroy(){var t,e;(t=c(this,va))==null||t.remove(),E(this,va,null),E(this,vd,null),(e=c(this,Ei))==null||e.remove(),E(this,Ei,null)}};va=new WeakMap,vd=new WeakMap,pm=new WeakMap,Ei=new WeakMap,Wb=new WeakMap,mm=new WeakMap,jl=new WeakMap,Qb=new WeakMap,wu=new WeakMap,Nr=new WeakMap,Jb=new WeakMap,hn=new WeakSet,J1=function(){const t=document.createElement("div"),e=c(this,Nr)._signal;t.addEventListener("contextmenu",dr,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),c(this,jl)&&(t.id=`${c(this,jl).id}_colorpicker_dropdown`);for(const[n,s]of c(this,Nr).highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",s),r.title=n,r.setAttribute("data-l10n-id",c(Gs,Jb)[n]);const u=document.createElement("span");r.append(u),u.className="swatch",u.style.backgroundColor=s,r.ariaSelected=s===c(this,pm),r.addEventListener("click",N(this,hn,Z1).bind(this,s),{signal:e}),t.append(r)}return t.addEventListener("keydown",N(this,hn,tC).bind(this),{signal:e}),t},Z1=function(t,e){e.stopPropagation(),c(this,Qb).dispatch("switchannotationeditorparams",{source:this,type:Fe.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)},tC=function(t){Gs._keyboardManager.exec(this,t)},Sh=function(t){if(c(this,hn,qc)){this.hideDropdown();return}if(E(this,Wb,t.detail===0),c(this,wu)||(E(this,wu,new AbortController),window.addEventListener("pointerdown",N(this,hn,dk).bind(this),{signal:c(this,Nr).combinedSignal(c(this,wu))})),c(this,va).ariaExpanded="true",c(this,Ei)){c(this,Ei).classList.remove("hidden");return}const e=E(this,Ei,N(this,hn,J1).call(this));c(this,va).append(e)},dk=function(t){var e;(e=c(this,Ei))!=null&&e.contains(t.target)||this.hideDropdown()},qc=function(){return c(this,Ei)&&!c(this,Ei).classList.contains("hidden")},O(Gs,Jb,null);let k_=Gs;var So,Zb,gm,tv;const Oh=class Oh{constructor(t){O(this,So,null);O(this,Zb,null);O(this,gm,null);E(this,Zb,t),E(this,gm,t._uiManager),c(Oh,tv)||E(Oh,tv,Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"}))}renderButton(){if(c(this,So))return c(this,So);const{editorType:t,colorType:e,color:n}=c(this,Zb),s=E(this,So,document.createElement("input"));return s.type="color",s.value=n||"#000000",s.className="basicColorPicker",s.tabIndex=0,s.setAttribute("data-l10n-id",c(Oh,tv)[t]),s.addEventListener("input",()=>{c(this,gm).updateParams(e,s.value)},{signal:c(this,gm)._signal}),s}update(t){c(this,So)&&(c(this,So).value=t)}destroy(){var t;(t=c(this,So))==null||t.remove(),E(this,So,null)}hideDropdown(){}};So=new WeakMap,Zb=new WeakMap,gm=new WeakMap,tv=new WeakMap,O(Oh,tv,null);let P_=Oh;function aM(l){return Math.floor(Math.max(0,Math.min(1,l))*255).toString(16).padStart(2,"0")}function iy(l){return Math.max(0,Math.min(255,255*l))}class rM{static CMYK_G([t,e,n,s]){return["G",1-Math.min(1,.3*t+.59*n+.11*e+s)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=iy(t),[t,t,t]}static G_HTML([t]){const e=aM(t);return`#${e}${e}${e}`}static RGB_G([t,e,n]){return["G",.3*t+.59*e+.11*n]}static RGB_rgb(t){return t.map(iy)}static RGB_HTML(t){return`#${t.map(aM).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,n,s]){return["RGB",1-Math.min(1,t+s),1-Math.min(1,n+s),1-Math.min(1,e+s)]}static CMYK_rgb([t,e,n,s]){return[iy(1-Math.min(1,t+s)),iy(1-Math.min(1,n+s)),iy(1-Math.min(1,e+s))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,n]){const s=1-t,r=1-e,u=1-n,h=Math.min(s,r,u);return["CMYK",s,r,u,h]}}class VU{create(t,e,n=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),n||(s.setAttribute("width",`${t}px`),s.setAttribute("height",`${e}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${t} ${e}`),s}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){yn("Abstract method `_createSVG` called.")}}class L_ extends VU{_createSVG(t){return document.createElementNS(pl,t)}}const GU=9,Kd=new WeakSet,qU=new Date().getTimezoneOffset()*60*1e3;class YE{static create(t){switch(t.data.annotationType){case hi.LINK:return new Lx(t);case hi.TEXT:return new YU(t);case hi.WIDGET:switch(t.data.fieldType){case"Tx":return new KU(t);case"Btn":return t.data.radioButton?new mk(t):t.data.checkBox?new QU(t):new JU(t);case"Ch":return new ZU(t);case"Sig":return new WU(t)}return new Jd(t);case hi.POPUP:return new nC(t);case hi.FREETEXT:return new wk(t);case hi.LINE:return new ez(t);case hi.SQUARE:return new nz(t);case hi.CIRCLE:return new iz(t);case hi.POLYLINE:return new _k(t);case hi.CARET:return new az(t);case hi.INK:return new Ix(t);case hi.POLYGON:return new sz(t);case hi.HIGHLIGHT:return new Ak(t);case hi.UNDERLINE:return new rz(t);case hi.SQUIGGLY:return new oz(t);case hi.STRIKEOUT:return new lz(t);case hi.STAMP:return new Sk(t);case hi.FILEATTACHMENT:return new cz(t);default:return new zn(t)}}}var wd,ym,rr,ev,eC;const $x=class $x{constructor(t,{isRenderable:e=!1,ignoreBorder:n=!1,createQuadrilaterals:s=!1}={}){O(this,ev);O(this,wd,null);O(this,ym,!1);O(this,rr,null);this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,this.hasOwnCommentButton=!1,e&&(this.contentElement=this.container=this._createContainer(n)),s&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t!=null&&t.str||e!=null&&e.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return $x._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){var n;const{data:t}=this,e=(n=this.annotationStorage)==null?void 0:n.getEditor(t.id);return e?e.getData():t}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){var h;const t=(h=this.annotationStorage)==null?void 0:h.getEditor(this.data.id);if(t)return t.commentButtonPositionInPage;const{quadPoints:e,inkLists:n,rect:s}=this.data;let r=-1/0,u=-1/0;if((e==null?void 0:e.length)>=8){for(let f=0;f<e.length;f+=8)e[f+1]>u?(u=e[f+1],r=e[f+2]):e[f+1]===u&&(r=Math.max(r,e[f+2]));return[r,u]}if((n==null?void 0:n.length)>=1){for(const f of n)for(let p=0,m=f.length;p<m;p+=2)f[p+1]>u?(u=f[p+1],r=f[p]):f[p+1]===u&&(r=Math.max(r,f[p]));if(r!==1/0)return[r,u]}return s?[s[2],s[3]]:null}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:u}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-r)/n,t[1]=100*(t[1]-u)/s,t}get commentText(){var e,n,s;const{data:t}=this;return((n=(e=this.annotationStorage.getRawValue(`${By}${t.id}`))==null?void 0:e.popup)==null?void 0:n.contents)||((s=t.contentsObj)==null?void 0:s.str)||""}set commentText(t){const{data:e}=this,n={deleted:!t,contents:t||""};this.annotationStorage.updateEditor(e.id,{popup:n})||this.annotationStorage.setValue(`${By}${e.id}`,{id:e.id,annotationType:e.annotationType,pageIndex:this.parent.page._pageIndex,popup:n,popupRef:e.popupRef,modificationDate:new Date}),t||this.removePopup()}removePopup(){var t,e;(e=((t=c(this,rr))==null?void 0:t.popup)||this.popup)==null||e.remove(),E(this,rr,this.popup=null)}updateEdited(t){var r;if(!this.container)return;t.rect&&(c(this,wd)||E(this,wd,{rect:this.data.rect.slice(0)}));const{rect:e,popup:n}=t;e&&N(this,ev,eC).call(this,e);let s=((r=c(this,rr))==null?void 0:r.popup)||this.popup;!s&&(n!=null&&n.text)&&(this._createPopup(n),s=c(this,rr).popup),s&&(s.updateEdited(t),n!=null&&n.deleted&&(s.remove(),E(this,rr,null),this.popup=null))}resetEdited(){var t;c(this,wd)&&(N(this,ev,eC).call(this,c(this,wd).rect),(t=c(this,rr))==null||t.popup.resetEdited(),E(this,wd,null))}_createContainer(t){const{data:e,parent:{page:n,viewport:s}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",e.id),!(this instanceof Jd)&&!(this instanceof Lx)&&(r.tabIndex=0);const{style:u}=r;if(u.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(r.title=e.alternativeText),e.noRotate&&r.classList.add("norotate"),!e.rect||this instanceof nC){const{rotation:C}=e;return!e.hasOwnCanvas&&C!==0&&this.setRotation(C,r),r}const{width:h,height:f}=this;if(!t&&e.borderStyle.width>0){u.borderWidth=`${e.borderStyle.width}px`;const C=e.borderStyle.horizontalCornerRadius,M=e.borderStyle.verticalCornerRadius;if(C>0||M>0){const I=`calc(${C}px * var(--total-scale-factor)) / calc(${M}px * var(--total-scale-factor))`;u.borderRadius=I}else if(this instanceof mk){const I=`calc(${h}px * var(--total-scale-factor)) / calc(${f}px * var(--total-scale-factor))`;u.borderRadius=I}switch(e.borderStyle.style){case Zf.SOLID:u.borderStyle="solid";break;case Zf.DASHED:u.borderStyle="dashed";break;case Zf.BEVELED:me("Unimplemented border style: beveled");break;case Zf.INSET:me("Unimplemented border style: inset");break;case Zf.UNDERLINE:u.borderBottomStyle="solid";break}const k=e.borderColor||null;k?(E(this,ym,!0),u.borderColor=jt.makeHexColor(k[0]|0,k[1]|0,k[2]|0)):u.borderWidth=0}const p=jt.normalizeRect([e.rect[0],n.view[3]-e.rect[1]+n.view[1],e.rect[2],n.view[3]-e.rect[3]+n.view[1]]),{pageWidth:m,pageHeight:b,pageX:_,pageY:S}=s.rawDims;u.left=`${100*(p[0]-_)/m}%`,u.top=`${100*(p[1]-S)/b}%`;const{rotation:R}=e;return e.hasOwnCanvas||R===0?(u.width=`${100*h/m}%`,u.height=`${100*f/b}%`):this.setRotation(R,r),r}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:s}=this.parent.viewport.rawDims;let{width:r,height:u}=this;t%180!==0&&([r,u]=[u,r]),e.style.width=`${100*r/n}%`,e.style.height=`${100*u/s}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,n,s)=>{const r=s.detail[e],u=r[0],h=r.slice(1);s.target.style[n]=rM[`${u}_HTML`](h),this.annotationStorage.setValue(this.data.id,{[n]:rM[`${u}_rgb`](h)})};return ge(this,"_commonActions",{display:e=>{const{display:n}=e.detail,s=n%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:n===1||n===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:n}=e.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const n=e.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(t,e){const n=this._commonActions;for(const s of Object.keys(e.detail)){const r=t[s]||n[s];r==null||r(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const n=this._commonActions;for(const[s,r]of Object.entries(e)){const u=n[s];if(u){const h={detail:{[s]:r},target:t};u(h),delete e[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,n,s,r]=this.data.rect.map(C=>Math.fround(C));if(t.length===8){const[C,M,k,I]=t.subarray(2,6);if(s===C&&r===M&&e===k&&n===I)return}const{style:u}=this.container;let h;if(c(this,ym)){const{borderColor:C,borderWidth:M}=u;u.borderWidth=0,h=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${C}" stroke-width="${M}">`],this.container.classList.add("hasBorder")}const f=s-e,p=r-n,{svgFactory:m}=this,b=m.createElement("svg");b.classList.add("quadrilateralsContainer"),b.setAttribute("width",0),b.setAttribute("height",0),b.role="none";const _=m.createElement("defs");b.append(_);const S=m.createElement("clipPath"),R=`clippath_${this.data.id}`;S.setAttribute("id",R),S.setAttribute("clipPathUnits","objectBoundingBox"),_.append(S);for(let C=2,M=t.length;C<M;C+=8){const k=t[C],I=t[C+1],P=t[C+2],F=t[C+3],z=m.createElement("rect"),j=(P-e)/f,H=(r-I)/p,dt=(k-P)/f,ct=(I-F)/p;z.setAttribute("x",j),z.setAttribute("y",H),z.setAttribute("width",dt),z.setAttribute("height",ct),S.append(z),h==null||h.push(`<rect vector-effect="non-scaling-stroke" x="${j}" y="${H}" width="${dt}" height="${ct}"/>`)}c(this,ym)&&(h.push("</g></svg>')"),u.backgroundImage=h.join("")),this.container.append(b),this.container.style.clipPath=`url(#${R})`}_createPopup(t=null){const{data:e}=this;let n,s;t?(n={str:t.text},s=t.date):(n=e.contentsObj,s=e.modificationDate),E(this,rr,new nC({data:{color:e.color,titleObj:e.titleObj,modificationDate:s,contentsObj:n,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]}))}get hasPopupElement(){return!!(c(this,rr)||this.popup||this.data.popupRef)}get extraPopupElement(){return c(this,rr)}render(){yn("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const n=[];if(this._fieldObjects){const s=this._fieldObjects[t];if(s)for(const{page:r,id:u,exportValues:h}of s){if(r===-1||u===e)continue;const f=typeof h=="string"?h:null,p=document.querySelector(`[data-element-id="${u}"]`);if(p&&!Kd.has(p)){me(`_getElementsByName - element not allowed: ${u}`);continue}n.push({id:u,exportValue:f,domElement:p})}return n}for(const s of document.getElementsByName(t)){const{exportValue:r}=s,u=s.getAttribute("data-element-id");u!==e&&Kd.has(s)&&n.push({id:u,exportValue:r,domElement:s})}return n}show(){var t;this.container&&(this.container.hidden=!1),(t=this.popup)==null||t.maybeShow()}hide(){var t;this.container&&(this.container.hidden=!0),(t=this.popup)==null||t.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};wd=new WeakMap,ym=new WeakMap,rr=new WeakMap,ev=new WeakSet,eC=function(t){const{container:{style:e},data:{rect:n,rotation:s},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:u,pageX:h,pageY:f}}}}=this;n==null||n.splice(0,4,...t),e.left=`${100*(t[0]-h)/r}%`,e.top=`${100*(u-t[3]+f)/u}%`,s===0?(e.width=`${100*(t[2]-t[0])/r}%`,e.height=`${100*(t[3]-t[1])/u}%`):this.setRotation(s)};let zn=$x;class XU extends zn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.editor=t.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:t}=this;t.hasComment&&this._createPopup(t.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(t){this.editor.comment=t,t||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}var Pa,Eh,fk,pk;class Lx extends zn{constructor(e,n=null){super(e,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});O(this,Pa);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:n}=this,s=document.createElement("a");s.setAttribute("data-element-id",e.id);let r=!1;return e.url?(n.addLinkAttributes(s,e.url,e.newWindow),r=!0):e.action?(this._bindNamedAction(s,e.action,e.overlaidText),r=!0):e.attachment?(N(this,Pa,fk).call(this,s,e.attachment,e.overlaidText,e.attachmentDest),r=!0):e.setOCGState?(N(this,Pa,pk).call(this,s,e.setOCGState,e.overlaidText),r=!0):e.dest?(this._bindLink(s,e.dest,e.overlaidText),r=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,e),r=!0),e.resetForm?(this._bindResetFormAction(s,e.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(s,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&(this.contentElement=s,this.container.append(s)),this.container}_bindLink(e,n,s=""){e.href=this.linkService.getDestinationHash(n),e.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&N(this,Pa,Eh).call(this),s&&(e.title=s)}_bindNamedAction(e,n,s=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(n),!1),s&&(e.title=s),N(this,Pa,Eh).call(this)}_bindJSAction(e,n){e.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(n.actions)){const u=s.get(r);u&&(e[u]=()=>{var h;return(h=this.linkService.eventBus)==null||h.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:r}}),!1})}n.overlaidText&&(e.title=n.overlaidText),e.onclick||(e.onclick=()=>!1),N(this,Pa,Eh).call(this)}_bindResetFormAction(e,n){const s=e.onclick;if(s||(e.href=this.linkService.getAnchorUrl("")),N(this,Pa,Eh).call(this),!this._fieldObjects){me('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(e.onclick=()=>!1);return}e.onclick=()=>{var b;s==null||s();const{fields:r,refs:u,include:h}=n,f=[];if(r.length!==0||u.length!==0){const _=new Set(u);for(const S of r){const R=this._fieldObjects[S]||[];for(const{id:C}of R)_.add(C)}for(const S of Object.values(this._fieldObjects))for(const R of S)_.has(R.id)===h&&f.push(R)}else for(const _ of Object.values(this._fieldObjects))f.push(..._);const p=this.annotationStorage,m=[];for(const _ of f){const{id:S}=_;switch(m.push(S),_.type){case"text":{const C=_.defaultValue||"";p.setValue(S,{value:C});break}case"checkbox":case"radiobutton":{const C=_.defaultValue===_.exportValues;p.setValue(S,{value:C});break}case"combobox":case"listbox":{const C=_.defaultValue||"";p.setValue(S,{value:C});break}default:continue}const R=document.querySelector(`[data-element-id="${S}"]`);if(R){if(!Kd.has(R)){me(`_bindResetFormAction - element not allowed: ${S}`);continue}}else continue;R.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((b=this.linkService.eventBus)==null||b.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:m,name:"ResetForm"}})),!1}}}Pa=new WeakSet,Eh=function(){this.container.setAttribute("data-internal-link","")},fk=function(e,n,s="",r=null){e.href=this.linkService.getAnchorUrl(""),n.description?e.title=n.description:s&&(e.title=s),e.onclick=()=>{var u;return(u=this.downloadManager)==null||u.openOrDownloadData(n.content,n.filename,r),!1},N(this,Pa,Eh).call(this)},pk=function(e,n,s=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(n),!1),s&&(e.title=s),N(this,Pa,Eh).call(this)};class YU extends zn{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(t),this.container}}class Jd extends zn{render(){return this.container}showElementAndHideCanvas(t){var e;this.data.hasOwnCanvas&&(((e=t.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Ti.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,n,s,r){n.includes("mouse")?t.addEventListener(n,u=>{var h;(h=this.linkService.eventBus)==null||h.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(u),shift:u.shiftKey,modifier:this._getKeyModifier(u)}})}):t.addEventListener(n,u=>{var h;if(n==="blur"){if(!e.focused||!u.relatedTarget)return;e.focused=!1}else if(n==="focus"){if(e.focused)return;e.focused=!0}r&&((h=this.linkService.eventBus)==null||h.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(u)}}))})}_setEventListeners(t,e,n,s){var r,u,h;for(const[f,p]of n)(p==="Action"||(r=this.data.actions)!=null&&r[p])&&((p==="Focus"||p==="Blur")&&(e||(e={focused:!1})),this._setEventListener(t,e,f,p,s),p==="Focus"&&!((u=this.data.actions)!=null&&u.Blur)?this._setEventListener(t,e,"blur","Blur",null):p==="Blur"&&!((h=this.data.actions)!=null&&h.Focus)&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":jt.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||GU,r=t.style;let u;const h=2,f=p=>Math.round(10*p)/10;if(this.data.multiLine){const p=Math.abs(this.data.rect[3]-this.data.rect[1]-h),m=Math.round(p/(zE*s))||1,b=p/m;u=Math.min(s,f(b/zE))}else{const p=Math.abs(this.data.rect[3]-this.data.rect[1]-h);u=Math.min(s,f(p/zE))}r.fontSize=`calc(${u}px * var(--total-scale-factor))`,r.color=jt.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(r.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class KU extends Jd{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,n,s){const r=this.annotationStorage;for(const u of this._getElementsByName(t.name,t.id))u.domElement&&(u.domElement[e]=n),r.setValue(u.id,{[s]:n})}render(){var s,r;const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const u=t.getValue(e,{value:this.data.fieldValue});let h=u.value||"";const f=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;f&&h.length>f&&(h=h.slice(0,f));let p=u.formattedValue||((s=this.data.textContent)==null?void 0:s.join(`
`))||null;p&&this.data.comb&&(p=p.replaceAll(/\s+/g,""));const m={userValue:h,formattedValue:p,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=p??h,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",p??h),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Kd.add(n),this.contentElement=n,n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:b,datetimeType:_,timeStep:S}=this.data,R=!!_&&this.enableScripting;b&&(n.title=b),this._setRequired(n,this.data.required),f&&(n.maxLength=f),n.addEventListener("input",M=>{t.setValue(e,{value:M.target.value}),this.setPropertyOnSiblings(n,"value",M.target.value,"value"),m.formattedValue=null}),n.addEventListener("resetform",M=>{const k=this.data.defaultFieldValue??"";n.value=m.userValue=k,m.formattedValue=null});let C=M=>{const{formattedValue:k}=m;k!=null&&(M.target.value=k),M.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",k=>{var P;if(m.focused)return;const{target:I}=k;if(R&&(I.type=_,S&&(I.step=S)),m.userValue){const F=m.userValue;if(R)if(_==="time"){const z=new Date(F),j=[z.getHours(),z.getMinutes(),z.getSeconds()];I.value=j.map(H=>H.toString().padStart(2,"0")).join(":")}else I.value=new Date(F-qU).toISOString().split(_==="date"?"T":".",1)[0];else I.value=F}m.lastCommittedValue=I.value,m.commitKey=1,(P=this.data.actions)!=null&&P.Focus||(m.focused=!0)}),n.addEventListener("updatefromsandbox",k=>{this.showElementAndHideCanvas(k.target);const I={value(P){m.userValue=P.detail.value??"",R||t.setValue(e,{value:m.userValue.toString()}),P.target.value=m.userValue},formattedValue(P){const{formattedValue:F}=P.detail;m.formattedValue=F,F!=null&&P.target!==document.activeElement&&(P.target.value=F);const z={formattedValue:F};R&&(z.value=F),t.setValue(e,z)},selRange(P){P.target.setSelectionRange(...P.detail.selRange)},charLimit:P=>{var H;const{charLimit:F}=P.detail,{target:z}=P;if(F===0){z.removeAttribute("maxLength");return}z.setAttribute("maxLength",F);let j=m.userValue;!j||j.length<=F||(j=j.slice(0,F),z.value=m.userValue=j,t.setValue(e,{value:j}),(H=this.linkService.eventBus)==null||H.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:j,willCommit:!0,commitKey:1,selStart:z.selectionStart,selEnd:z.selectionEnd}}))}};this._dispatchEventFromSandbox(I,k)}),n.addEventListener("keydown",k=>{var F;m.commitKey=1;let I=-1;if(k.key==="Escape"?I=0:k.key==="Enter"&&!this.data.multiLine?I=2:k.key==="Tab"&&(m.commitKey=3),I===-1)return;const{value:P}=k.target;m.lastCommittedValue!==P&&(m.lastCommittedValue=P,m.userValue=P,(F=this.linkService.eventBus)==null||F.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:P,willCommit:!0,commitKey:I,selStart:k.target.selectionStart,selEnd:k.target.selectionEnd}}))});const M=C;C=null,n.addEventListener("blur",k=>{var F,z;if(!m.focused||!k.relatedTarget)return;(F=this.data.actions)!=null&&F.Blur||(m.focused=!1);const{target:I}=k;let{value:P}=I;if(R){if(P&&_==="time"){const j=P.split(":").map(H=>parseInt(H,10));P=new Date(2e3,0,1,j[0],j[1],j[2]||0).valueOf(),I.step=""}else P.includes("T")||(P=`${P}T00:00`),P=new Date(P).valueOf();I.type="text"}m.userValue=P,m.lastCommittedValue!==P&&((z=this.linkService.eventBus)==null||z.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:P,willCommit:!0,commitKey:m.commitKey,selStart:k.target.selectionStart,selEnd:k.target.selectionEnd}})),M(k)}),(r=this.data.actions)!=null&&r.Keystroke&&n.addEventListener("beforeinput",k=>{var ct;m.lastCommittedValue=null;const{data:I,target:P}=k,{value:F,selectionStart:z,selectionEnd:j}=P;let H=z,dt=j;switch(k.inputType){case"deleteWordBackward":{const yt=F.substring(0,z).match(/\w*[^\w]*$/);yt&&(H-=yt[0].length);break}case"deleteWordForward":{const yt=F.substring(z).match(/^[^\w]*\w*/);yt&&(dt+=yt[0].length);break}case"deleteContentBackward":z===j&&(H-=1);break;case"deleteContentForward":z===j&&(dt+=1);break}k.preventDefault(),(ct=this.linkService.eventBus)==null||ct.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:F,change:I||"",willCommit:!1,selStart:H,selEnd:dt}})}),this._setEventListeners(n,m,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],k=>k.target.value)}if(C&&n.addEventListener("blur",C),this.data.comb){const k=(this.data.rect[2]-this.data.rect[0])/f;n.classList.add("comb"),n.style.letterSpacing=`calc(${k}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class WU extends Jd{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class QU extends Jd{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,n=e.id;let s=t.getValue(n,{value:e.exportValue===e.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",t.setValue(n,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return Kd.add(r),r.setAttribute("data-element-id",n),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=e.fieldName,s&&r.setAttribute("checked",!0),r.setAttribute("exportValue",e.exportValue),r.tabIndex=0,r.addEventListener("change",u=>{const{name:h,checked:f}=u.target;for(const p of this._getElementsByName(h,n)){const m=f&&p.exportValue===e.exportValue;p.domElement&&(p.domElement.checked=m),t.setValue(p.id,{value:m})}t.setValue(n,{value:f})}),r.addEventListener("resetform",u=>{const h=e.defaultFieldValue||"Off";u.target.checked=h===e.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",u=>{const h={value(f){f.target.checked=f.detail.value!=="Off",t.setValue(n,{value:f.target.checked})}};this._dispatchEventFromSandbox(h,u)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],u=>u.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class mk extends Jd{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,n=e.id;let s=t.getValue(n,{value:e.fieldValue===e.buttonValue}).value;if(typeof s=="string"&&(s=s!==e.buttonValue,t.setValue(n,{value:s})),s)for(const u of this._getElementsByName(e.fieldName,n))t.setValue(u.id,{value:!1});const r=document.createElement("input");if(Kd.add(r),r.setAttribute("data-element-id",n),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=e.fieldName,s&&r.setAttribute("checked",!0),r.tabIndex=0,r.addEventListener("change",u=>{const{name:h,checked:f}=u.target;for(const p of this._getElementsByName(h,n))t.setValue(p.id,{value:!1});t.setValue(n,{value:f})}),r.addEventListener("resetform",u=>{const h=e.defaultFieldValue;u.target.checked=h!=null&&h===e.buttonValue}),this.enableScripting&&this.hasJSActions){const u=e.buttonValue;r.addEventListener("updatefromsandbox",h=>{const f={value:p=>{const m=u===p.detail.value;for(const b of this._getElementsByName(p.target.name)){const _=m&&b.id===n;b.domElement&&(b.domElement.checked=_),t.setValue(b.id,{value:_})}}};this._dispatchEventFromSandbox(f,h)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],h=>h.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class JU extends Lx{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),t}}class ZU extends Jd{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,n=t.getValue(e,{value:this.data.fieldValue}),s=document.createElement("select");Kd.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=0;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",m=>{const b=this.data.defaultFieldValue;for(const _ of s.options)_.selected=_.value===b});for(const m of this.data.options){const b=document.createElement("option");b.textContent=m.displayValue,b.value=m.exportValue,n.value.includes(m.exportValue)&&(b.setAttribute("selected",!0),r=!1),s.append(b)}let u=null;if(r){const m=document.createElement("option");m.value=" ",m.setAttribute("hidden",!0),m.setAttribute("selected",!0),s.prepend(m),u=()=>{m.remove(),s.removeEventListener("input",u),u=null},s.addEventListener("input",u)}const h=m=>{const b=m?"value":"textContent",{options:_,multiple:S}=s;return S?Array.prototype.filter.call(_,R=>R.selected).map(R=>R[b]):_.selectedIndex===-1?null:_[_.selectedIndex][b]};let f=h(!1);const p=m=>{const b=m.target.options;return Array.prototype.map.call(b,_=>({displayValue:_.textContent,exportValue:_.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",m=>{const b={value(_){u==null||u();const S=_.detail.value,R=new Set(Array.isArray(S)?S:[S]);for(const C of s.options)C.selected=R.has(C.value);t.setValue(e,{value:h(!0)}),f=h(!1)},multipleSelection(_){s.multiple=!0},remove(_){const S=s.options,R=_.detail.remove;S[R].selected=!1,s.remove(R),S.length>0&&Array.prototype.findIndex.call(S,M=>M.selected)===-1&&(S[0].selected=!0),t.setValue(e,{value:h(!0),items:p(_)}),f=h(!1)},clear(_){for(;s.length!==0;)s.remove(0);t.setValue(e,{value:null,items:[]}),f=h(!1)},insert(_){const{index:S,displayValue:R,exportValue:C}=_.detail.insert,M=s.children[S],k=document.createElement("option");k.textContent=R,k.value=C,M?M.before(k):s.append(k),t.setValue(e,{value:h(!0),items:p(_)}),f=h(!1)},items(_){const{items:S}=_.detail;for(;s.length!==0;)s.remove(0);for(const R of S){const{displayValue:C,exportValue:M}=R,k=document.createElement("option");k.textContent=C,k.value=M,s.append(k)}s.options.length>0&&(s.options[0].selected=!0),t.setValue(e,{value:h(!0),items:p(_)}),f=h(!1)},indices(_){const S=new Set(_.detail.indices);for(const R of _.target.options)R.selected=S.has(R.index);t.setValue(e,{value:h(!0)}),f=h(!1)},editable(_){_.target.disabled=!_.detail.editable}};this._dispatchEventFromSandbox(b,m)}),s.addEventListener("input",m=>{var S;const b=h(!0),_=h(!1);t.setValue(e,{value:b}),m.preventDefault(),(S=this.linkService.eventBus)==null||S.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:f,change:_,changeEx:b,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],m=>m.target.value)):s.addEventListener("input",function(m){t.setValue(e,{value:h(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}var nv,iC;class nC extends zn{constructor(e){const{data:n,elements:s,parent:r}=e,u=!!r._commentManager;super(e,{isRenderable:!u&&zn._hasPopupData(n)});O(this,nv);if(this.elements=s,u&&zn._hasPopupData(n)){const h=this.popup=N(this,nv,iC).call(this);for(const f of s)f.popup=h}else this.popup=null}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const n=this.popup=N(this,nv,iC).call(this),s=[];for(const r of this.elements)r.popup=n,r.container.ariaHasPopup="dialog",s.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",s.map(r=>`${lp}${r}`).join(",")),this.container}}nv=new WeakSet,iC=function(){return new tz({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})};var wa,_u,J_,Z_,bm,vm,qn,Eo,Au,_d,wm,_m,Co,_a,Hl,$l,Xn,Vl,Su,iv,Gl,Am,Ad,Eu,Bi,Cu,Te,Zw,sC,aC,rC,t_,oC,gk,yk,bk,vk,e_,n_,lC;class tz{constructor({container:t,color:e,elements:n,titleObj:s,modificationDate:r,contentsObj:u,richText:h,parent:f,rect:p,parentRect:m,open:b,commentManager:_=null}){O(this,Te);O(this,wa,null);O(this,_u,N(this,Te,bk).bind(this));O(this,J_,N(this,Te,lC).bind(this));O(this,Z_,N(this,Te,n_).bind(this));O(this,bm,N(this,Te,e_).bind(this));O(this,vm,null);O(this,qn,null);O(this,Eo,null);O(this,Au,null);O(this,_d,null);O(this,wm,null);O(this,_m,null);O(this,Co,!1);O(this,_a,null);O(this,Hl,null);O(this,$l,null);O(this,Xn,null);O(this,Vl,null);O(this,Su,null);O(this,iv,null);O(this,Gl,null);O(this,Am,null);O(this,Ad,null);O(this,Eu,!1);O(this,Bi,null);O(this,Cu,null);E(this,qn,t),E(this,Am,s),E(this,Eo,u),E(this,Gl,h),E(this,wm,f),E(this,vm,e),E(this,iv,p),E(this,_m,m),E(this,_d,n),E(this,wa,_),E(this,Bi,n[0]),E(this,Au,T_.toDateObject(r)),this.trigger=n.flatMap(S=>S.getElementsToTriggerPopup()),_||(N(this,Te,Zw).call(this),c(this,qn).hidden=!0,b&&N(this,Te,e_).call(this))}renderCommentButton(){if(c(this,Xn)){c(this,Xn).parentNode||c(this,Bi).container.after(c(this,Xn));return}if(c(this,Vl)||N(this,Te,sC).call(this),!c(this,Vl))return;const{signal:t}=E(this,Hl,new AbortController),e=c(this,Bi).hasOwnCommentButton,n=()=>{c(this,wa).toggleCommentPopup(this,!0,void 0,!e)},s=()=>{c(this,wa).toggleCommentPopup(this,!1,!0,!e)},r=()=>{c(this,wa).toggleCommentPopup(this,!1,!1)};if(e){E(this,Xn,c(this,Bi).container);for(const u of this.trigger)u.ariaHasPopup="dialog",u.ariaControls="commentPopup",u.addEventListener("keydown",c(this,_u),{signal:t}),u.addEventListener("click",n,{signal:t}),u.addEventListener("pointerenter",s,{signal:t}),u.addEventListener("pointerleave",r,{signal:t}),u.classList.add("popupTriggerArea")}else{const u=E(this,Xn,document.createElement("button"));u.className="annotationCommentButton";const h=c(this,Bi).container;u.style.zIndex=h.style.zIndex+1,u.tabIndex=0,u.ariaHasPopup="dialog",u.ariaControls="commentPopup",u.setAttribute("data-l10n-id","pdfjs-show-comment-button"),N(this,Te,rC).call(this),N(this,Te,aC).call(this),u.addEventListener("keydown",c(this,_u),{signal:t}),u.addEventListener("click",n,{signal:t}),u.addEventListener("pointerenter",s,{signal:t}),u.addEventListener("pointerleave",r,{signal:t}),h.after(u)}}get commentButtonColor(){const{color:t,opacity:e}=c(this,Bi).commentData;return t?c(this,wm)._commentManager.makeCommentColor(t,e):null}focusCommentButton(){setTimeout(()=>{var t;(t=c(this,Xn))==null||t.focus()},0)}getData(){const{richText:t,color:e,opacity:n,creationDate:s,modificationDate:r}=c(this,Bi).commentData;return{contentsObj:{str:this.comment},richText:t,color:e,opacity:n,creationDate:s,modificationDate:r}}get elementBeforePopup(){return c(this,Xn)}get comment(){return c(this,Cu)||E(this,Cu,c(this,Bi).commentText),c(this,Cu)}set comment(t){t!==this.comment&&(c(this,Bi).commentText=E(this,Cu,t))}focus(){var t;(t=c(this,Bi).container)==null||t.focus()}get parentBoundingClientRect(){return c(this,Bi).layer.getBoundingClientRect()}setCommentButtonStates({selected:t,hasPopup:e}){c(this,Xn)&&(c(this,Xn).classList.toggle("selected",t),c(this,Xn).ariaExpanded=e)}setSelectedCommentButton(t){c(this,Xn).classList.toggle("selected",t)}get commentPopupPosition(){if(c(this,Su))return c(this,Su);const{x:t,y:e,height:n}=c(this,Xn).getBoundingClientRect(),{x:s,y:r,width:u,height:h}=c(this,Bi).layer.getBoundingClientRect();return[(t-s)/u,(e+n-r)/h]}set commentPopupPosition(t){E(this,Su,t)}hasDefaultPopupPosition(){return c(this,Su)===null}get commentButtonPosition(){return c(this,Vl)}get commentButtonWidth(){return c(this,Xn).getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(t){const[e,n]=c(this,Su)||this.commentButtonPosition.map(p=>p/100),s=this.parentBoundingClientRect,{x:r,y:u,width:h,height:f}=s;c(this,wa).showDialog(null,this,r+e*h,u+n*f,{...t,parentDimensions:s})}render(){var n,s;if(c(this,_a))return;const t=E(this,_a,document.createElement("div"));if(t.className="popup",c(this,vm)){const r=t.style.outlineColor=jt.makeHexColor(...c(this,vm));t.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`}const e=document.createElement("span");if(e.className="header",(n=c(this,Am))!=null&&n.str){const r=document.createElement("span");r.className="title",e.append(r),{dir:r.dir,str:r.textContent}=c(this,Am)}if(t.append(e),c(this,Au)){const r=document.createElement("time");r.className="popupDate",r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:c(this,Au).valueOf()})),r.dateTime=c(this,Au).toISOString(),e.append(r)}r2({html:c(this,Te,t_)||c(this,Eo).str,dir:(s=c(this,Eo))==null?void 0:s.dir,className:"popupContent"},t),c(this,qn).append(t)}updateEdited({rect:t,popup:e,deleted:n}){var s;if(c(this,wa)){n?(this.remove(),E(this,Cu,null)):e&&(e.deleted?this.remove():(N(this,Te,rC).call(this),E(this,Cu,e.text))),t&&(E(this,Vl,null),N(this,Te,sC).call(this),N(this,Te,aC).call(this));return}if(n||e!=null&&e.deleted){this.remove();return}N(this,Te,Zw).call(this),c(this,Ad)||E(this,Ad,{contentsObj:c(this,Eo),richText:c(this,Gl)}),t&&E(this,$l,null),e&&e.text&&(E(this,Gl,N(this,Te,yk).call(this,e.text)),E(this,Au,T_.toDateObject(e.date)),E(this,Eo,null)),(s=c(this,_a))==null||s.remove(),E(this,_a,null)}resetEdited(){var t;c(this,Ad)&&({contentsObj:bi(this,Eo)._,richText:bi(this,Gl)._}=c(this,Ad),E(this,Ad,null),(t=c(this,_a))==null||t.remove(),E(this,_a,null),E(this,$l,null))}remove(){var t,e,n;if((t=c(this,Hl))==null||t.abort(),E(this,Hl,null),(e=c(this,_a))==null||e.remove(),E(this,_a,null),E(this,Eu,!1),E(this,Co,!1),(n=c(this,Xn))==null||n.remove(),E(this,Xn,null),this.trigger)for(const s of this.trigger)s.classList.remove("popupTriggerArea")}forceHide(){E(this,Eu,this.isVisible),c(this,Eu)&&(c(this,qn).hidden=!0)}maybeShow(){c(this,wa)||(N(this,Te,Zw).call(this),c(this,Eu)&&(c(this,_a)||N(this,Te,n_).call(this),E(this,Eu,!1),c(this,qn).hidden=!1))}get isVisible(){return c(this,wa)?!1:c(this,qn).hidden===!1}}wa=new WeakMap,_u=new WeakMap,J_=new WeakMap,Z_=new WeakMap,bm=new WeakMap,vm=new WeakMap,qn=new WeakMap,Eo=new WeakMap,Au=new WeakMap,_d=new WeakMap,wm=new WeakMap,_m=new WeakMap,Co=new WeakMap,_a=new WeakMap,Hl=new WeakMap,$l=new WeakMap,Xn=new WeakMap,Vl=new WeakMap,Su=new WeakMap,iv=new WeakMap,Gl=new WeakMap,Am=new WeakMap,Ad=new WeakMap,Eu=new WeakMap,Bi=new WeakMap,Cu=new WeakMap,Te=new WeakSet,Zw=function(){var e;if(c(this,Hl))return;E(this,Hl,new AbortController);const{signal:t}=c(this,Hl);for(const n of this.trigger)n.addEventListener("click",c(this,bm),{signal:t}),n.addEventListener("pointerenter",c(this,Z_),{signal:t}),n.addEventListener("pointerleave",c(this,J_),{signal:t}),n.classList.add("popupTriggerArea");for(const n of c(this,_d))(e=n.container)==null||e.addEventListener("keydown",c(this,_u),{signal:t})},sC=function(){const t=c(this,_d).find(e=>e.hasCommentButton);t&&E(this,Vl,t._normalizePoint(t.commentButtonPosition))},aC=function(){if(c(this,Bi).extraPopupElement&&!c(this,Bi).editor)return;c(this,Xn)||this.renderCommentButton();const[t,e]=c(this,Vl),{style:n}=c(this,Xn);n.left=`calc(${t}%)`,n.top=`calc(${e}% - var(--comment-button-dim))`},rC=function(){c(this,Bi).extraPopupElement||(c(this,Xn)||this.renderCommentButton(),c(this,Xn).style.backgroundColor=this.commentButtonColor||"")},t_=function(){const t=c(this,Gl),e=c(this,Eo);return t!=null&&t.str&&(!(e!=null&&e.str)||e.str===t.str)&&c(this,Gl).html||null},oC=function(){var t,e,n;return((n=(e=(t=c(this,Te,t_))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:n.fontSize)||0},gk=function(){var t,e,n;return((n=(e=(t=c(this,Te,t_))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:n.color)||null},yk=function(t){const e=[],n={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},s={style:{color:c(this,Te,gk),fontSize:c(this,Te,oC)?`calc(${c(this,Te,oC)}px * var(--total-scale-factor))`:""}};for(const r of t.split(`
`))e.push({name:"span",value:r,attributes:s});return n},bk=function(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&c(this,Co))&&N(this,Te,e_).call(this)},vk=function(){if(c(this,$l)!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:n,pageX:s,pageY:r}}}=c(this,wm);let u=!!c(this,_m),h=u?c(this,_m):c(this,iv);for(const R of c(this,_d))if(!h||jt.intersect(R.data.rect,h)!==null){h=R.data.rect,u=!0;break}const f=jt.normalizeRect([h[0],t[3]-h[1]+t[1],h[2],t[3]-h[3]+t[1]]),m=u?h[2]-h[0]+5:0,b=f[0]+m,_=f[1];E(this,$l,[100*(b-s)/e,100*(_-r)/n]);const{style:S}=c(this,qn);S.left=`${c(this,$l)[0]}%`,S.top=`${c(this,$l)[1]}%`},e_=function(){if(c(this,wa)){c(this,wa).toggleCommentPopup(this,!1);return}E(this,Co,!c(this,Co)),c(this,Co)?(N(this,Te,n_).call(this),c(this,qn).addEventListener("click",c(this,bm)),c(this,qn).addEventListener("keydown",c(this,_u))):(N(this,Te,lC).call(this),c(this,qn).removeEventListener("click",c(this,bm)),c(this,qn).removeEventListener("keydown",c(this,_u)))},n_=function(){c(this,_a)||this.render(),this.isVisible?c(this,Co)&&c(this,qn).classList.add("focused"):(N(this,Te,vk).call(this),c(this,qn).hidden=!1,c(this,qn).style.zIndex=parseInt(c(this,qn).style.zIndex)+1e3)},lC=function(){c(this,qn).classList.remove("focused"),!(c(this,Co)||!this.isVisible)&&(c(this,qn).hidden=!0,c(this,qn).style.zIndex=parseInt(c(this,qn).style.zIndex)-1e3)};class wk extends zn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=ve.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=this.contentElement=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const n=document.createElement("span");n.textContent=e,t.append(n)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var sv;class ez extends zn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});O(this,sv,null)}render(){this.container.classList.add("lineAnnotation");const{data:e,width:n,height:s}=this,r=this.svgFactory.create(n,s,!0),u=E(this,sv,this.svgFactory.createElement("svg:line"));return u.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),u.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),u.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),u.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),u.setAttribute("stroke-width",e.borderStyle.width||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),r.append(u),this.container.append(r),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return c(this,sv)}addHighlightArea(){this.container.classList.add("highlightArea")}}sv=new WeakMap;var av;class nz extends zn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});O(this,av,null)}render(){this.container.classList.add("squareAnnotation");const{data:e,width:n,height:s}=this,r=this.svgFactory.create(n,s,!0),u=e.borderStyle.width,h=E(this,av,this.svgFactory.createElement("svg:rect"));return h.setAttribute("x",u/2),h.setAttribute("y",u/2),h.setAttribute("width",n-u),h.setAttribute("height",s-u),h.setAttribute("stroke-width",u||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),r.append(h),this.container.append(r),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return c(this,av)}addHighlightArea(){this.container.classList.add("highlightArea")}}av=new WeakMap;var rv;class iz extends zn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});O(this,rv,null)}render(){this.container.classList.add("circleAnnotation");const{data:e,width:n,height:s}=this,r=this.svgFactory.create(n,s,!0),u=e.borderStyle.width,h=E(this,rv,this.svgFactory.createElement("svg:ellipse"));return h.setAttribute("cx",n/2),h.setAttribute("cy",s/2),h.setAttribute("rx",n/2-u/2),h.setAttribute("ry",s/2-u/2),h.setAttribute("stroke-width",u||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),r.append(h),this.container.append(r),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return c(this,rv)}addHighlightArea(){this.container.classList.add("highlightArea")}}rv=new WeakMap;var ov;class _k extends zn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});O(this,ov,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:n,borderStyle:s,popupRef:r},width:u,height:h}=this;if(!n)return this.container;const f=this.svgFactory.create(u,h,!0);let p=[];for(let b=0,_=n.length;b<_;b+=2){const S=n[b]-e[0],R=e[3]-n[b+1];p.push(`${S},${R}`)}p=p.join(" ");const m=E(this,ov,this.svgFactory.createElement(this.svgElementName));return m.setAttribute("points",p),m.setAttribute("stroke-width",s.width||1),m.setAttribute("stroke","transparent"),m.setAttribute("fill","transparent"),f.append(m),this.container.append(f),!r&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return c(this,ov)}addHighlightArea(){this.container.classList.add("highlightArea")}}ov=new WeakMap;class sz extends _k{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class az extends zn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}var lv,Sd,cv,cC;class Ix extends zn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});O(this,cv);O(this,lv,null);O(this,Sd,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?ve.HIGHLIGHT:ve.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:n,inkLists:s,borderStyle:r,popupRef:u}}=this,{transform:h,width:f,height:p}=N(this,cv,cC).call(this,n,e),m=this.svgFactory.create(f,p,!0),b=E(this,lv,this.svgFactory.createElement("svg:g"));m.append(b),b.setAttribute("stroke-width",r.width||1),b.setAttribute("stroke-linecap","round"),b.setAttribute("stroke-linejoin","round"),b.setAttribute("stroke-miterlimit",10),b.setAttribute("stroke","transparent"),b.setAttribute("fill","transparent"),b.setAttribute("transform",h);for(let _=0,S=s.length;_<S;_++){const R=this.svgFactory.createElement(this.svgElementName);c(this,Sd).push(R),R.setAttribute("points",s[_].join(",")),b.append(R)}return!u&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(m),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:n,points:s,rect:r}=e,u=c(this,lv);if(n>=0&&u.setAttribute("stroke-width",n||1),s)for(let h=0,f=c(this,Sd).length;h<f;h++)c(this,Sd)[h].setAttribute("points",s[h].join(","));if(r){const{transform:h,width:f,height:p}=N(this,cv,cC).call(this,this.data.rotation,r);u.parentElement.setAttribute("viewBox",`0 0 ${f} ${p}`),u.setAttribute("transform",h)}}getElementsToTriggerPopup(){return c(this,Sd)}addHighlightArea(){this.container.classList.add("highlightArea")}}lv=new WeakMap,Sd=new WeakMap,cv=new WeakSet,cC=function(e,n){switch(e){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};class Ak extends zn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=ve.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class rz extends zn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class oz extends zn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class lz extends zn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),t){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class Sk extends zn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=ve.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var uv,hv,uC;class cz extends zn{constructor(e){var s;super(e,{isRenderable:!0});O(this,hv);O(this,uv,null);const{file:n}=this.data;this.filename=n.filename,this.content=n.content,(s=this.linkService.eventBus)==null||s.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:n}=this;let s;n.hasAppearance||n.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),s.addEventListener("dblclick",N(this,hv,uC).bind(this)),E(this,uv,s);const{isMac:r}=Ti.platform;return e.addEventListener("keydown",u=>{u.key==="Enter"&&(r?u.metaKey:u.ctrlKey)&&N(this,hv,uC).call(this)}),!n.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):s.classList.add("popupTriggerArea"),e.append(s),e}getElementsToTriggerPopup(){return c(this,uv)}addHighlightArea(){this.container.classList.add("highlightArea")}}uv=new WeakMap,hv=new WeakSet,uC=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.content,this.filename)};var Ed,Cd,Sm,xu,dv,xd,Aa,fv,nc,i_,dC;const Vx=class Vx{constructor({div:t,accessibilityManager:e,annotationCanvasMap:n,annotationEditorUIManager:s,page:r,viewport:u,structTreeLayer:h,commentManager:f,linkService:p,annotationStorage:m}){O(this,nc);O(this,Ed,null);O(this,Cd,null);O(this,Sm,null);O(this,xu,new Map);O(this,dv,null);O(this,xd,null);O(this,Aa,[]);O(this,fv,!1);this.div=t,E(this,Ed,e),E(this,Cd,n),E(this,dv,h||null),E(this,xd,p||null),E(this,Sm,m||new Nx),this.page=r,this.viewport=u,this.zIndex=0,this._annotationEditorUIManager=s,this._commentManager=f||null}hasEditableAnnotations(){return c(this,xu).size>0}async render(t){var h;const{annotations:e}=t,n=this.div;Xd(n,this.viewport);const s=new Map,r=[],u={data:null,layer:n,linkService:c(this,xd),downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new L_,annotationStorage:c(this,Sm),enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const f of e){if(f.noHTML)continue;const p=f.annotationType===hi.POPUP;if(p){const _=s.get(f.id);if(!_)continue;if(!this._commentManager){r.push(f);continue}u.elements=_}else if(f.rect[2]===f.rect[0]||f.rect[3]===f.rect[1])continue;u.data=f;const m=YE.create(u);if(!m.isRenderable)continue;if(!p&&(c(this,Aa).push(m),f.popupRef)){const _=s.get(f.popupRef);_?_.push(m):s.set(f.popupRef,[m])}const b=m.render();f.hidden&&(b.style.visibility="hidden"),m._isEditable&&(c(this,xu).set(m.data.id,m),(h=this._annotationEditorUIManager)==null||h.renderAnnotationElement(m))}await N(this,nc,i_).call(this);for(const f of r){const p=u.elements=s.get(f.id);u.data=f;const m=YE.create(u);if(!m.isRenderable)continue;const b=m.render();m.contentElement.id=`${lp}${f.id}`,f.hidden&&(b.style.visibility="hidden"),p.at(-1).container.after(b)}N(this,nc,dC).call(this)}async addLinkAnnotations(t){const e={data:null,layer:this.div,linkService:c(this,xd),svgFactory:new L_,parent:this};for(const n of t){n.borderStyle||(n.borderStyle=Vx._defaultBorderStyle),e.data=n;const s=YE.create(e);s.isRenderable&&(s.render(),s.contentElement.id=`${lp}${n.id}`,c(this,Aa).push(s))}await N(this,nc,i_).call(this)}update({viewport:t}){const e=this.div;this.viewport=t,Xd(e,{rotation:t.rotation}),N(this,nc,dC).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(c(this,xu).values())}getEditableAnnotation(t){return c(this,xu).get(t)}addFakeAnnotation(t){const{div:e}=this,{id:n,rotation:s}=t,r=new XU({data:{id:n,rect:t.getPDFRect(),rotation:s},editor:t,layer:e,parent:this,enableComment:!!this._commentManager,linkService:c(this,xd),annotationStorage:c(this,Sm)});return r.render(),r.contentElement.id=`${lp}${n}`,r.createOrUpdatePopup(),c(this,Aa).push(r),r}removeAnnotation(t){var s;const e=c(this,Aa).findIndex(r=>r.data.id===t);if(e<0)return;const[n]=c(this,Aa).splice(e,1);(s=c(this,Ed))==null||s.removePointerInTextLayer(n.contentElement)}updateFakeAnnotations(t){if(t.length!==0){for(const e of t)e.updateFakeAnnotationElement(this);N(this,nc,i_).call(this)}}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}static get _defaultBorderStyle(){return ge(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Zf.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};Ed=new WeakMap,Cd=new WeakMap,Sm=new WeakMap,xu=new WeakMap,dv=new WeakMap,xd=new WeakMap,Aa=new WeakMap,fv=new WeakMap,nc=new WeakSet,i_=async function(){var n,s,r;if(c(this,Aa).length===0)return;this.div.replaceChildren();const t=[];if(!c(this,fv)){E(this,fv,!0);for(const{contentElement:u,data:{id:h}}of c(this,Aa)){const f=u.id=`${lp}${h}`;t.push((n=c(this,dv))==null?void 0:n.getAriaAttributes(f).then(p=>{if(p)for(const[m,b]of p)u.setAttribute(m,b)}))}}c(this,Aa).sort(({data:{rect:[u,h,f,p]}},{data:{rect:[m,b,_,S]}})=>{if(u===f&&h===p)return 1;if(m===_&&b===S)return-1;const R=p,C=h,M=(h+p)/2,k=S,I=b,P=(b+S)/2;if(M>=k&&P<=C)return-1;if(P>=R&&M<=I)return 1;const F=(u+f)/2,z=(m+_)/2;return F-z});const e=document.createDocumentFragment();for(const u of c(this,Aa))e.append(u.container),this._commentManager?(r=((s=u.extraPopupElement)==null?void 0:s.popup)||u.popup)==null||r.renderCommentButton():u.extraPopupElement&&e.append(u.extraPopupElement.render());if(this.div.append(e),await Promise.all(t),c(this,Ed))for(const u of c(this,Aa))c(this,Ed).addPointerInTextLayer(u.contentElement,!1)},dC=function(){var e;if(!c(this,Cd))return;const t=this.div;for(const[n,s]of c(this,Cd)){const r=t.querySelector(`[data-annotation-id="${n}"]`);if(!r)continue;s.className="annotationContent";const{firstChild:u}=r;u?u.nodeName==="CANVAS"?u.replaceWith(s):u.classList.contains("annotationContent")?u.after(s):u.before(s):r.append(s);const h=c(this,xu).get(n);h&&(h._hasNoCanvas?((e=this._annotationEditorUIManager)==null||e.setMissingCanvas(n,r.id,s),h._hasNoCanvas=!1):h.canvas=s)}c(this,Cd).clear()};let hC=Vx;const Tw=/\r\n?|\n/g;var Sa,pv,Td,Ea,fi,Ek,Ck,xk,s_,ic,a_,r_,Tk,pC,Rk;const On=class On extends An{constructor(e){super({...e,name:"freeTextEditor"});O(this,fi);O(this,Sa,"");O(this,pv,`${this.id}-editor`);O(this,Td,null);O(this,Ea);Ct(this,"_colorPicker",null);this.color=e.color||On._defaultColor||An._defaultLineColor,E(this,Ea,e.fontSize||On._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static get _keyboardManager(){const e=On.prototype,n=u=>u.isEmpty(),s=Yd.TRANSLATE_SMALL,r=Yd.TRANSLATE_BIG;return ge(this,"_keyboardManager",new qv([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-r,0],checker:n}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[s,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[r,0],checker:n}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-r],checker:n}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,s],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,r],checker:n}]]))}static initialize(e,n){An.initialize(e,n);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,n){switch(e){case Fe.FREETEXT_SIZE:On._defaultFontSize=n;break;case Fe.FREETEXT_COLOR:On._defaultColor=n;break}}updateParams(e,n){switch(e){case Fe.FREETEXT_SIZE:N(this,fi,Ek).call(this,n);break;case Fe.FREETEXT_COLOR:N(this,fi,Ck).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Fe.FREETEXT_SIZE,On._defaultFontSize],[Fe.FREETEXT_COLOR,On._defaultColor||An._defaultLineColor]]}get propertiesToUpdate(){return[[Fe.FREETEXT_SIZE,c(this,Ea)],[Fe.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new P_(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Fe.FREETEXT_COLOR}onUpdatedColor(){var e;this.editorDiv.style.color=this.color,(e=this._colorPicker)==null||e.update(this.color),super.onUpdatedColor()}_translateEmpty(e,n){this._uiManager.translateSelectedEditors(e,n,!0)}getInitialTranslation(){const e=this.parentScale;return[-On._internalPadding*e,-(On._internalPadding+c(this,Ea))*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),E(this,Td,new AbortController);const e=this._uiManager.combinedSignal(c(this,Td));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){var e;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",c(this,pv)),this._isDraggable=!0,(e=c(this,Td))==null||e.abort(),E(this,Td,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){var n;this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=c(this,Sa),n=E(this,Sa,N(this,fi,xk).call(this).trimEnd());if(e===n)return;const s=r=>{if(E(this,Sa,r),!r){this.remove();return}N(this,fi,r_).call(this),this._uiManager.rebuild(this),N(this,fi,s_).call(this)};this.addCommands({cmd:()=>{s(n)},undo:()=>{s(e)},mustExec:!1}),N(this,fi,s_).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){On._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,n;(this._isCopy||this.annotationElementId)&&(e=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",c(this,pv)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${c(this,Ea)}px * var(--total-scale-factor))`,s.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[r,u]=this.parentDimensions;if(this.annotationElementId){const{position:h}=this._initialData;let[f,p]=this.getInitialTranslation();[f,p]=this.pageTranslationToScreen(f,p);const[m,b]=this.pageDimensions,[_,S]=this.pageTranslation;let R,C;switch(this.rotation){case 0:R=e+(h[0]-_)/m,C=n+this.height-(h[1]-S)/b;break;case 90:R=e+(h[0]-_)/m,C=n-(h[1]-S)/b,[f,p]=[p,-f];break;case 180:R=e-this.width+(h[0]-_)/m,C=n-(h[1]-S)/b,[f,p]=[-f,-p];break;case 270:R=e+(h[0]-_-this.height*b)/m,C=n+(h[1]-S-this.width*m)/b,[f,p]=[-p,f];break}this.setAt(R*r,C*u,f,p)}else this._moveAfterPaste(e,n);N(this,fi,r_).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(e){var R,C,M;const n=e.clipboardData||window.clipboardData,{types:s}=n;if(s.length===1&&s[0]==="text/plain")return;e.preventDefault();const r=N(R=On,ic,pC).call(R,n.getData("text")||"").replaceAll(Tw,`
`);if(!r)return;const u=window.getSelection();if(!u.rangeCount)return;this.editorDiv.normalize(),u.deleteFromDocument();const h=u.getRangeAt(0);if(!r.includes(`
`)){h.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),u.collapseToStart();return}const{startContainer:f,startOffset:p}=h,m=[],b=[];if(f.nodeType===Node.TEXT_NODE){const k=f.parentElement;if(b.push(f.nodeValue.slice(p).replaceAll(Tw,"")),k!==this.editorDiv){let I=m;for(const P of this.editorDiv.childNodes){if(P===k){I=b;continue}I.push(N(C=On,ic,a_).call(C,P))}}m.push(f.nodeValue.slice(0,p).replaceAll(Tw,""))}else if(f===this.editorDiv){let k=m,I=0;for(const P of this.editorDiv.childNodes)I++===p&&(k=b),k.push(N(M=On,ic,a_).call(M,P))}E(this,Sa,`${m.join(`
`)}${r}${b.join(`
`)}`),N(this,fi,r_).call(this);const _=new Range;let S=Math.sumPrecise(m.map(k=>k.length));for(const{firstChild:k}of this.editorDiv.childNodes)if(k.nodeType===Node.TEXT_NODE){const I=k.nodeValue.length;if(S<=I){_.setStart(k,S),_.setEnd(k,S);break}S-=I}u.removeAllRanges(),u.addRange(_)}get contentDiv(){return this.editorDiv}getPDFRect(){const e=On._internalPadding*this.parentScale;return this.getRect(e,e)}static async deserialize(e,n,s){var h;let r=null;if(e instanceof wk){const{data:{defaultAppearanceData:{fontSize:f,fontColor:p},rect:m,rotation:b,id:_,popupRef:S,richText:R,contentsObj:C,creationDate:M,modificationDate:k},textContent:I,textPosition:P,parent:{page:{pageNumber:F}}}=e;if(!I||I.length===0)return null;r=e={annotationType:ve.FREETEXT,color:Array.from(p),fontSize:f,value:I.join(`
`),position:P,pageIndex:F-1,rect:m.slice(0),rotation:b,annotationElementId:_,id:_,deleted:!1,popupRef:S,comment:(C==null?void 0:C.str)||null,richText:R,creationDate:M,modificationDate:k}}const u=await super.deserialize(e,n,s);return E(u,Ea,e.fontSize),u.color=jt.makeHexColor(...e.color),E(u,Sa,N(h=On,ic,pC).call(h,e.value)),u._initialData=r,e.comment&&u.setCommentData(e),u}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=An._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),s=Object.assign(super.serialize(e),{color:n,fontSize:c(this,Ea),value:N(this,fi,Tk).call(this)});return this.addComment(s),e?(s.isCopy=!0,s):this.annotationElementId&&!N(this,fi,Rk).call(this,s)?null:(s.id=this.annotationElementId,s)}renderAnnotationElement(e){const n=super.renderAnnotationElement(e);if(!n)return null;const{style:s}=n;s.fontSize=`calc(${c(this,Ea)}px * var(--total-scale-factor))`,s.color=this.color,n.replaceChildren();for(const r of c(this,Sa).split(`
`)){const u=document.createElement("div");u.append(r?document.createTextNode(r):document.createElement("br")),n.append(u)}return e.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:c(this,Sa)}}),n}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}};Sa=new WeakMap,pv=new WeakMap,Td=new WeakMap,Ea=new WeakMap,fi=new WeakSet,Ek=function(e){const n=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--total-scale-factor))`,this.translate(0,-(r-c(this,Ea))*this.parentScale),E(this,Ea,r),N(this,fi,s_).call(this)},s=c(this,Ea);this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Fe.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Ck=function(e){const n=r=>{this.color=r,this.onUpdatedColor()},s=this.color;this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Fe.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},xk=function(){var s;const e=[];this.editorDiv.normalize();let n=null;for(const r of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(e.push(N(s=On,ic,a_).call(s,r)),n=r);return e.join(`
`)},s_=function(){const[e,n]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:r,div:u}=this,h=u.style.display,f=u.classList.contains("hidden");u.classList.remove("hidden"),u.style.display="hidden",r.div.append(this.div),s=u.getBoundingClientRect(),u.remove(),u.style.display=h,u.classList.toggle("hidden",f)}this.rotation%180===this.parentRotation%180?(this.width=s.width/e,this.height=s.height/n):(this.width=s.height/e,this.height=s.width/n),this.fixAndSetPosition()},ic=new WeakSet,a_=function(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Tw,"")},r_=function(){if(this.editorDiv.replaceChildren(),!!c(this,Sa))for(const e of c(this,Sa).split(`
`)){const n=document.createElement("div");n.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(n)}},Tk=function(){return c(this,Sa).replaceAll(""," ")},pC=function(e){return e.replaceAll(" ","")},Rk=function(e){const{value:n,fontSize:s,color:r,pageIndex:u}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==n||e.fontSize!==s||e.color.some((h,f)=>h!==r[f])||e.pageIndex!==u},O(On,ic),Ct(On,"_freeTextDefaultContent",""),Ct(On,"_internalPadding",0),Ct(On,"_defaultColor",null),Ct(On,"_defaultFontSize",10),Ct(On,"_type","freetext"),Ct(On,"_editorType",ve.FREETEXT);let fC=On;class qt{toSVGPath(){yn("Abstract method `toSVGPath` must be implemented.")}get box(){yn("Abstract getter `box` must be implemented.")}serialize(t,e){yn("Abstract method `serialize` must be implemented.")}static _rescale(t,e,n,s,r,u){u||(u=new Float32Array(t.length));for(let h=0,f=t.length;h<f;h+=2)u[h]=e+t[h]*s,u[h+1]=n+t[h+1]*r;return u}static _rescaleAndSwap(t,e,n,s,r,u){u||(u=new Float32Array(t.length));for(let h=0,f=t.length;h<f;h+=2)u[h]=e+t[h+1]*s,u[h+1]=n+t[h]*r;return u}static _translate(t,e,n,s){s||(s=new Float32Array(t.length));for(let r=0,u=t.length;r<u;r+=2)s[r]=e+t[r],s[r+1]=n+t[r+1];return s}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,n,s,r){switch(r){case 90:return[1-e/n,t/s];case 180:return[1-t/n,1-e/s];case 270:return[e/n,1-t/s];default:return[t/n,e/s]}}static _normalizePagePoint(t,e,n){switch(n){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,n,s,r,u){return[(t+5*n)/6,(e+5*s)/6,(5*n+r)/6,(5*s+u)/6,(n+r)/2,(s+u)/2]}}Ct(qt,"PRECISION",1e-4);var Ca,kr,Em,Cm,xo,De,Rd,Od,mv,gv,xm,Tm,Tu,yv,tA,eA,Ci,Ty,Ok,Dk,Mk,Nk,kk,Pk;const bl=class bl{constructor({x:t,y:e},n,s,r,u,h=0){O(this,Ci);O(this,Ca);O(this,kr,[]);O(this,Em);O(this,Cm);O(this,xo,[]);O(this,De,new Float32Array(18));O(this,Rd);O(this,Od);O(this,mv);O(this,gv);O(this,xm);O(this,Tm);O(this,Tu,[]);E(this,Ca,n),E(this,Tm,r*s),E(this,Cm,u),c(this,De).set([NaN,NaN,NaN,NaN,t,e],6),E(this,Em,h),E(this,gv,c(bl,yv)*s),E(this,mv,c(bl,eA)*s),E(this,xm,s),c(this,Tu).push(t,e)}isEmpty(){return isNaN(c(this,De)[8])}add({x:t,y:e}){var ct;E(this,Rd,t),E(this,Od,e);const[n,s,r,u]=c(this,Ca);let[h,f,p,m]=c(this,De).subarray(8,12);const b=t-p,_=e-m,S=Math.hypot(b,_);if(S<c(this,mv))return!1;const R=S-c(this,gv),C=R/S,M=C*b,k=C*_;let I=h,P=f;h=p,f=m,p+=M,m+=k,(ct=c(this,Tu))==null||ct.push(t,e);const F=-k/R,z=M/R,j=F*c(this,Tm),H=z*c(this,Tm);return c(this,De).set(c(this,De).subarray(2,8),0),c(this,De).set([p+j,m+H],4),c(this,De).set(c(this,De).subarray(14,18),12),c(this,De).set([p-j,m-H],16),isNaN(c(this,De)[6])?(c(this,xo).length===0&&(c(this,De).set([h+j,f+H],2),c(this,xo).push(NaN,NaN,NaN,NaN,(h+j-n)/r,(f+H-s)/u),c(this,De).set([h-j,f-H],14),c(this,kr).push(NaN,NaN,NaN,NaN,(h-j-n)/r,(f-H-s)/u)),c(this,De).set([I,P,h,f,p,m],6),!this.isEmpty()):(c(this,De).set([I,P,h,f,p,m],6),Math.abs(Math.atan2(P-f,I-h)-Math.atan2(k,M))<Math.PI/2?([h,f,p,m]=c(this,De).subarray(2,6),c(this,xo).push(NaN,NaN,NaN,NaN,((h+p)/2-n)/r,((f+m)/2-s)/u),[h,f,I,P]=c(this,De).subarray(14,18),c(this,kr).push(NaN,NaN,NaN,NaN,((I+h)/2-n)/r,((P+f)/2-s)/u),!0):([I,P,h,f,p,m]=c(this,De).subarray(0,6),c(this,xo).push(((I+5*h)/6-n)/r,((P+5*f)/6-s)/u,((5*h+p)/6-n)/r,((5*f+m)/6-s)/u,((h+p)/2-n)/r,((f+m)/2-s)/u),[p,m,h,f,I,P]=c(this,De).subarray(12,18),c(this,kr).push(((I+5*h)/6-n)/r,((P+5*f)/6-s)/u,((5*h+p)/6-n)/r,((5*f+m)/6-s)/u,((h+p)/2-n)/r,((f+m)/2-s)/u),!0))}toSVGPath(){if(this.isEmpty())return"";const t=c(this,xo),e=c(this,kr);if(isNaN(c(this,De)[6])&&!this.isEmpty())return N(this,Ci,Ok).call(this);const n=[];n.push(`M${t[4]} ${t[5]}`);for(let s=6;s<t.length;s+=6)isNaN(t[s])?n.push(`L${t[s+4]} ${t[s+5]}`):n.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);N(this,Ci,Mk).call(this,n);for(let s=e.length-6;s>=6;s-=6)isNaN(e[s])?n.push(`L${e[s+4]} ${e[s+5]}`):n.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);return N(this,Ci,Dk).call(this,n),n.join(" ")}newFreeDrawOutline(t,e,n,s,r,u){return new Lk(t,e,n,s,r,u)}getOutlines(){var b;const t=c(this,xo),e=c(this,kr),n=c(this,De),[s,r,u,h]=c(this,Ca),f=new Float32Array((((b=c(this,Tu))==null?void 0:b.length)??0)+2);for(let _=0,S=f.length-2;_<S;_+=2)f[_]=(c(this,Tu)[_]-s)/u,f[_+1]=(c(this,Tu)[_+1]-r)/h;if(f[f.length-2]=(c(this,Rd)-s)/u,f[f.length-1]=(c(this,Od)-r)/h,isNaN(n[6])&&!this.isEmpty())return N(this,Ci,Nk).call(this,f);const p=new Float32Array(c(this,xo).length+24+c(this,kr).length);let m=t.length;for(let _=0;_<m;_+=2){if(isNaN(t[_])){p[_]=p[_+1]=NaN;continue}p[_]=t[_],p[_+1]=t[_+1]}m=N(this,Ci,Pk).call(this,p,m);for(let _=e.length-6;_>=6;_-=6)for(let S=0;S<6;S+=2){if(isNaN(e[_+S])){p[m]=p[m+1]=NaN,m+=2;continue}p[m]=e[_+S],p[m+1]=e[_+S+1],m+=2}return N(this,Ci,kk).call(this,p,m),this.newFreeDrawOutline(p,f,c(this,Ca),c(this,xm),c(this,Em),c(this,Cm))}};Ca=new WeakMap,kr=new WeakMap,Em=new WeakMap,Cm=new WeakMap,xo=new WeakMap,De=new WeakMap,Rd=new WeakMap,Od=new WeakMap,mv=new WeakMap,gv=new WeakMap,xm=new WeakMap,Tm=new WeakMap,Tu=new WeakMap,yv=new WeakMap,tA=new WeakMap,eA=new WeakMap,Ci=new WeakSet,Ty=function(){const t=c(this,De).subarray(4,6),e=c(this,De).subarray(16,18),[n,s,r,u]=c(this,Ca);return[(c(this,Rd)+(t[0]-e[0])/2-n)/r,(c(this,Od)+(t[1]-e[1])/2-s)/u,(c(this,Rd)+(e[0]-t[0])/2-n)/r,(c(this,Od)+(e[1]-t[1])/2-s)/u]},Ok=function(){const[t,e,n,s]=c(this,Ca),[r,u,h,f]=N(this,Ci,Ty).call(this);return`M${(c(this,De)[2]-t)/n} ${(c(this,De)[3]-e)/s} L${(c(this,De)[4]-t)/n} ${(c(this,De)[5]-e)/s} L${r} ${u} L${h} ${f} L${(c(this,De)[16]-t)/n} ${(c(this,De)[17]-e)/s} L${(c(this,De)[14]-t)/n} ${(c(this,De)[15]-e)/s} Z`},Dk=function(t){const e=c(this,kr);t.push(`L${e[4]} ${e[5]} Z`)},Mk=function(t){const[e,n,s,r]=c(this,Ca),u=c(this,De).subarray(4,6),h=c(this,De).subarray(16,18),[f,p,m,b]=N(this,Ci,Ty).call(this);t.push(`L${(u[0]-e)/s} ${(u[1]-n)/r} L${f} ${p} L${m} ${b} L${(h[0]-e)/s} ${(h[1]-n)/r}`)},Nk=function(t){const e=c(this,De),[n,s,r,u]=c(this,Ca),[h,f,p,m]=N(this,Ci,Ty).call(this),b=new Float32Array(36);return b.set([NaN,NaN,NaN,NaN,(e[2]-n)/r,(e[3]-s)/u,NaN,NaN,NaN,NaN,(e[4]-n)/r,(e[5]-s)/u,NaN,NaN,NaN,NaN,h,f,NaN,NaN,NaN,NaN,p,m,NaN,NaN,NaN,NaN,(e[16]-n)/r,(e[17]-s)/u,NaN,NaN,NaN,NaN,(e[14]-n)/r,(e[15]-s)/u],0),this.newFreeDrawOutline(b,t,c(this,Ca),c(this,xm),c(this,Em),c(this,Cm))},kk=function(t,e){const n=c(this,kr);return t.set([NaN,NaN,NaN,NaN,n[4],n[5]],e),e+=6},Pk=function(t,e){const n=c(this,De).subarray(4,6),s=c(this,De).subarray(16,18),[r,u,h,f]=c(this,Ca),[p,m,b,_]=N(this,Ci,Ty).call(this);return t.set([NaN,NaN,NaN,NaN,(n[0]-r)/h,(n[1]-u)/f,NaN,NaN,NaN,NaN,p,m,NaN,NaN,NaN,NaN,b,_,NaN,NaN,NaN,NaN,(s[0]-r)/h,(s[1]-u)/f],e),e+=24},O(bl,yv,8),O(bl,tA,2),O(bl,eA,c(bl,yv)+c(bl,tA));let I_=bl;var Rm,Dd,ql,bv,xa,vv,ni,nA,Ik;class Lk extends qt{constructor(e,n,s,r,u,h){super();O(this,nA);O(this,Rm);O(this,Dd,new Float32Array(4));O(this,ql);O(this,bv);O(this,xa);O(this,vv);O(this,ni);E(this,ni,e),E(this,xa,n),E(this,Rm,s),E(this,vv,r),E(this,ql,u),E(this,bv,h),this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],N(this,nA,Ik).call(this,h);const[f,p,m,b]=c(this,Dd);for(let _=0,S=e.length;_<S;_+=2)e[_]=(e[_]-f)/m,e[_+1]=(e[_+1]-p)/b;for(let _=0,S=n.length;_<S;_+=2)n[_]=(n[_]-f)/m,n[_+1]=(n[_+1]-p)/b}toSVGPath(){const e=[`M${c(this,ni)[4]} ${c(this,ni)[5]}`];for(let n=6,s=c(this,ni).length;n<s;n+=6){if(isNaN(c(this,ni)[n])){e.push(`L${c(this,ni)[n+4]} ${c(this,ni)[n+5]}`);continue}e.push(`C${c(this,ni)[n]} ${c(this,ni)[n+1]} ${c(this,ni)[n+2]} ${c(this,ni)[n+3]} ${c(this,ni)[n+4]} ${c(this,ni)[n+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,n,s,r],u){const h=s-e,f=r-n;let p,m;switch(u){case 0:p=qt._rescale(c(this,ni),e,r,h,-f),m=qt._rescale(c(this,xa),e,r,h,-f);break;case 90:p=qt._rescaleAndSwap(c(this,ni),e,n,h,f),m=qt._rescaleAndSwap(c(this,xa),e,n,h,f);break;case 180:p=qt._rescale(c(this,ni),s,n,-h,f),m=qt._rescale(c(this,xa),s,n,-h,f);break;case 270:p=qt._rescaleAndSwap(c(this,ni),s,r,-h,-f),m=qt._rescaleAndSwap(c(this,xa),s,r,-h,-f);break}return{outline:Array.from(p),points:[Array.from(m)]}}get box(){return c(this,Dd)}newOutliner(e,n,s,r,u,h=0){return new I_(e,n,s,r,u,h)}getNewOutline(e,n){const[s,r,u,h]=c(this,Dd),[f,p,m,b]=c(this,Rm),_=u*m,S=h*b,R=s*m+f,C=r*b+p,M=this.newOutliner({x:c(this,xa)[0]*_+R,y:c(this,xa)[1]*S+C},c(this,Rm),c(this,vv),e,c(this,bv),n??c(this,ql));for(let k=2;k<c(this,xa).length;k+=2)M.add({x:c(this,xa)[k]*_+R,y:c(this,xa)[k+1]*S+C});return M.getOutlines()}}Rm=new WeakMap,Dd=new WeakMap,ql=new WeakMap,bv=new WeakMap,xa=new WeakMap,vv=new WeakMap,ni=new WeakMap,nA=new WeakSet,Ik=function(e){const n=c(this,ni);let s=n[4],r=n[5];const u=[s,r,s,r];let h=s,f=r,p=s,m=r;const b=e?Math.max:Math.min,_=new Float32Array(4);for(let R=6,C=n.length;R<C;R+=6){const M=n[R+4],k=n[R+5];isNaN(n[R])?(jt.pointBoundingBox(M,k,u),f>k?(h=M,f=k):f===k&&(h=b(h,M)),m<k?(p=M,m=k):m===k&&(p=b(p,M))):(_[0]=_[1]=1/0,_[2]=_[3]=-1/0,jt.bezierBoundingBox(s,r,...n.slice(R,R+6),_),jt.rectBoundingBox(_[0],_[1],_[2],_[3],u),f>_[1]?(h=_[0],f=_[1]):f===_[1]&&(h=b(h,_[0])),m<_[3]?(p=_[2],m=_[3]):m===_[3]&&(p=b(p,_[2]))),s=M,r=k}const S=c(this,Dd);S[0]=u[0]-c(this,ql),S[1]=u[1]-c(this,ql),S[2]=u[2]-u[0]+2*c(this,ql),S[3]=u[3]-u[1]+2*c(this,ql),this.firstPoint=[h,f],this.lastPoint=[p,m]};var wv,_v,Av,Ru,Pr,ks,Bk,o_,Fk,Uk,gC;class mC{constructor(t,e=0,n=0,s=!0){O(this,ks);O(this,wv);O(this,_v);O(this,Av);O(this,Ru,[]);O(this,Pr,[]);const r=[1/0,1/0,-1/0,-1/0],u=10**-4;for(const{x:C,y:M,width:k,height:I}of t){const P=Math.floor((C-e)/u)*u,F=Math.ceil((C+k+e)/u)*u,z=Math.floor((M-e)/u)*u,j=Math.ceil((M+I+e)/u)*u,H=[P,z,j,!0],dt=[F,z,j,!1];c(this,Ru).push(H,dt),jt.rectBoundingBox(P,z,F,j,r)}const h=r[2]-r[0]+2*n,f=r[3]-r[1]+2*n,p=r[0]-n,m=r[1]-n;let b=s?-1/0:1/0,_=1/0;const S=c(this,Ru).at(s?-1:-2),R=[S[0],S[2]];for(const C of c(this,Ru)){const[M,k,I,P]=C;!P&&s?k<_?(_=k,b=M):k===_&&(b=Math.max(b,M)):P&&!s&&(k<_?(_=k,b=M):k===_&&(b=Math.min(b,M))),C[0]=(M-p)/h,C[1]=(k-m)/f,C[2]=(I-m)/f}E(this,wv,new Float32Array([p,m,h,f])),E(this,_v,[b,_]),E(this,Av,R)}getOutlines(){c(this,Ru).sort((e,n)=>e[0]-n[0]||e[1]-n[1]||e[2]-n[2]);const t=[];for(const e of c(this,Ru))e[3]?(t.push(...N(this,ks,gC).call(this,e)),N(this,ks,Fk).call(this,e)):(N(this,ks,Uk).call(this,e),t.push(...N(this,ks,gC).call(this,e)));return N(this,ks,Bk).call(this,t)}}wv=new WeakMap,_v=new WeakMap,Av=new WeakMap,Ru=new WeakMap,Pr=new WeakMap,ks=new WeakSet,Bk=function(t){const e=[],n=new Set;for(const u of t){const[h,f,p]=u;e.push([h,f,u],[h,p,u])}e.sort((u,h)=>u[1]-h[1]||u[0]-h[0]);for(let u=0,h=e.length;u<h;u+=2){const f=e[u][2],p=e[u+1][2];f.push(p),p.push(f),n.add(f),n.add(p)}const s=[];let r;for(;n.size>0;){const u=n.values().next().value;let[h,f,p,m,b]=u;n.delete(u);let _=h,S=f;for(r=[h,p],s.push(r);;){let R;if(n.has(m))R=m;else if(n.has(b))R=b;else break;n.delete(R),[h,f,p,m,b]=R,_!==h&&(r.push(_,S,h,S===f?f:p),_=h),S=S===f?p:f}r.push(_,S)}return new uz(s,c(this,wv),c(this,_v),c(this,Av))},o_=function(t){const e=c(this,Pr);let n=0,s=e.length-1;for(;n<=s;){const r=n+s>>1,u=e[r][0];if(u===t)return r;u<t?n=r+1:s=r-1}return s+1},Fk=function([,t,e]){const n=N(this,ks,o_).call(this,t);c(this,Pr).splice(n,0,[t,e])},Uk=function([,t,e]){const n=N(this,ks,o_).call(this,t);for(let s=n;s<c(this,Pr).length;s++){const[r,u]=c(this,Pr)[s];if(r!==t)break;if(r===t&&u===e){c(this,Pr).splice(s,1);return}}for(let s=n-1;s>=0;s--){const[r,u]=c(this,Pr)[s];if(r!==t)break;if(r===t&&u===e){c(this,Pr).splice(s,1);return}}},gC=function(t){const[e,n,s]=t,r=[[e,n,s]],u=N(this,ks,o_).call(this,s);for(let h=0;h<u;h++){const[f,p]=c(this,Pr)[h];for(let m=0,b=r.length;m<b;m++){const[,_,S]=r[m];if(!(p<=_||S<=f)){if(_>=f){if(S>p)r[m][1]=p;else{if(b===1)return[];r.splice(m,1),m--,b--}continue}r[m][2]=f,S>p&&r.push([e,p,S])}}}return r};var Sv,Om;class uz extends qt{constructor(e,n,s,r){super();O(this,Sv);O(this,Om);E(this,Om,e),E(this,Sv,n),this.firstPoint=s,this.lastPoint=r}toSVGPath(){const e=[];for(const n of c(this,Om)){let[s,r]=n;e.push(`M${s} ${r}`);for(let u=2;u<n.length;u+=2){const h=n[u],f=n[u+1];h===s?(e.push(`V${f}`),r=f):f===r&&(e.push(`H${h}`),s=h)}e.push("Z")}return e.join(" ")}serialize([e,n,s,r],u){const h=[],f=s-e,p=r-n;for(const m of c(this,Om)){const b=new Array(m.length);for(let _=0;_<m.length;_+=2)b[_]=e+m[_]*f,b[_+1]=r-m[_+1]*p;h.push(b)}return h}get box(){return c(this,Sv)}get classNamesForOutlining(){return["highlightOutline"]}}Sv=new WeakMap,Om=new WeakMap;class yC extends I_{newFreeDrawOutline(t,e,n,s,r,u){return new hz(t,e,n,s,r,u)}}class hz extends Lk{newOutliner(t,e,n,s,r,u=0){return new yC(t,e,n,s,r,u)}}var Dm,Ev,Xl,Md,Cv,Ws,xv,Tv,Nd,Ta,Ra,ts,Mm,Nm,vs,km,or,Rv,xe,bC,l_,zk,jk,Hk,vC,Ch,cr,ap,$k,c_,u_,Vk,Gk,qk,Xk,Yk;const Xe=class Xe extends An{constructor(e){super({...e,name:"highlightEditor"});O(this,xe);O(this,Dm,null);O(this,Ev,0);O(this,Xl);O(this,Md,null);O(this,Cv,null);O(this,Ws,null);O(this,xv,null);O(this,Tv,0);O(this,Nd,null);O(this,Ta,null);O(this,Ra,null);O(this,ts,!1);O(this,Mm,null);O(this,Nm,null);O(this,vs,null);O(this,km,"");O(this,or);O(this,Rv,"");this.color=e.color||Xe._defaultColor,E(this,or,e.thickness||Xe._defaultThickness),this.opacity=e.opacity||Xe._defaultOpacity,E(this,Xl,e.boxes||null),E(this,Rv,e.methodOfCreation||""),E(this,km,e.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(E(this,ts,!0),N(this,xe,l_).call(this,e),N(this,xe,Ch).call(this)):c(this,Xl)&&(E(this,Dm,e.anchorNode),E(this,Ev,e.anchorOffset),E(this,xv,e.focusNode),E(this,Tv,e.focusOffset),N(this,xe,bC).call(this),N(this,xe,Ch).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const e=Xe.prototype;return ge(this,"_keyboardManager",new qv([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:c(this,ts)?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:c(this,or),methodOfCreation:c(this,Rv)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}static initialize(e,n){var s;An.initialize(e,n),Xe._defaultColor||(Xe._defaultColor=((s=n.highlightColors)==null?void 0:s.values().next().value)||"#fff066")}static updateDefaultParams(e,n){switch(e){case Fe.HIGHLIGHT_COLOR:Xe._defaultColor=n;break;case Fe.HIGHLIGHT_THICKNESS:Xe._defaultThickness=n;break}}translateInPage(e,n){}get toolbarPosition(){return c(this,Nm)}get commentButtonPosition(){return c(this,Mm)}updateParams(e,n){switch(e){case Fe.HIGHLIGHT_COLOR:N(this,xe,zk).call(this,n);break;case Fe.HIGHLIGHT_THICKNESS:N(this,xe,jk).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Fe.HIGHLIGHT_COLOR,Xe._defaultColor],[Fe.HIGHLIGHT_THICKNESS,Xe._defaultThickness]]}get propertiesToUpdate(){return[[Fe.HIGHLIGHT_COLOR,this.color||Xe._defaultColor],[Fe.HIGHLIGHT_THICKNESS,c(this,or)||Xe._defaultThickness],[Fe.HIGHLIGHT_FREE,c(this,ts)]]}onUpdatedColor(){var e,n;(e=this.parent)==null||e.drawLayer.updateProperties(c(this,Ra),{root:{fill:this.color,"fill-opacity":this.opacity}}),(n=c(this,Cv))==null||n.updateColor(this.color),super.onUpdatedColor()}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",E(this,Cv,new k_({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(N(this,xe,u_).call(this))}getBaseTranslation(){return[0,0]}getRect(e,n){return super.getRect(e,n,N(this,xe,u_).call(this))}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){N(this,xe,vC).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(N(this,xe,Ch).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var s;let n=!1;this.parent&&!e?N(this,xe,vC).call(this):e&&(N(this,xe,Ch).call(this,e),n=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(e),this.show(this._isVisible),n&&this.select()}rotate(e){var r,u,h;const{drawLayer:n}=this.parent;let s;c(this,ts)?(e=(e-this.rotation+360)%360,s=N(r=Xe,cr,ap).call(r,c(this,Ta).box,e)):s=N(u=Xe,cr,ap).call(u,[this.x,this.y,this.width,this.height],e),n.updateProperties(c(this,Ra),{bbox:s,root:{"data-main-rotation":e}}),n.updateProperties(c(this,vs),{bbox:N(h=Xe,cr,ap).call(h,c(this,Ws).box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();c(this,km)&&(e.setAttribute("aria-label",c(this,km)),e.setAttribute("role","mark")),c(this,ts)?e.classList.add("free"):this.div.addEventListener("keydown",N(this,xe,$k).bind(this),{signal:this._uiManager._signal});const n=E(this,Nd,document.createElement("div"));return e.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=c(this,Md),this.setDims(),f2(this,c(this,Nd),["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(c(this,vs),{rootClass:{hovered:!0}})}pointerleave(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(c(this,vs),{rootClass:{hovered:!1}})}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:N(this,xe,c_).call(this,!0);break;case 1:case 3:N(this,xe,c_).call(this,!1);break}}select(){var e;super.select(),c(this,vs)&&((e=this.parent)==null||e.drawLayer.updateProperties(c(this,vs),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var e;super.unselect(),c(this,vs)&&((e=this.parent)==null||e.drawLayer.updateProperties(c(this,vs),{rootClass:{selected:!1}}),c(this,ts)||N(this,xe,c_).call(this,!1))}get _mustFixPosition(){return!c(this,ts)}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(c(this,Ra),{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(c(this,vs),{rootClass:{hidden:!e}}))}static startHighlighting(e,n,{target:s,x:r,y:u}){const{x:h,y:f,width:p,height:m}=s.getBoundingClientRect(),b=new AbortController,_=e.combinedSignal(b),S=R=>{b.abort(),N(this,cr,Xk).call(this,e,R)};window.addEventListener("blur",S,{signal:_}),window.addEventListener("pointerup",S,{signal:_}),window.addEventListener("pointerdown",Kn,{capture:!0,passive:!1,signal:_}),window.addEventListener("contextmenu",dr,{signal:_}),s.addEventListener("pointermove",N(this,cr,qk).bind(this,e),{signal:_}),this._freeHighlight=new yC({x:r,y:u},[h,f,p,m],e.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(e,n,s){var C,M,k,I;let r=null;if(e instanceof Ak){const{data:{quadPoints:P,rect:F,rotation:z,id:j,color:H,opacity:dt,popupRef:ct,richText:yt,contentsObj:gt,creationDate:Pt,modificationDate:Xt},parent:{page:{pageNumber:Vt}}}=e;r=e={annotationType:ve.HIGHLIGHT,color:Array.from(H),opacity:dt,quadPoints:P,boxes:null,pageIndex:Vt-1,rect:F.slice(0),rotation:z,annotationElementId:j,id:j,deleted:!1,popupRef:ct,richText:yt,comment:(gt==null?void 0:gt.str)||null,creationDate:Pt,modificationDate:Xt}}else if(e instanceof Ix){const{data:{inkLists:P,rect:F,rotation:z,id:j,color:H,borderStyle:{rawWidth:dt},popupRef:ct,richText:yt,contentsObj:gt,creationDate:Pt,modificationDate:Xt},parent:{page:{pageNumber:Vt}}}=e;r=e={annotationType:ve.HIGHLIGHT,color:Array.from(H),thickness:dt,inkLists:P,boxes:null,pageIndex:Vt-1,rect:F.slice(0),rotation:z,annotationElementId:j,id:j,deleted:!1,popupRef:ct,richText:yt,comment:(gt==null?void 0:gt.str)||null,creationDate:Pt,modificationDate:Xt}}const{color:u,quadPoints:h,inkLists:f,opacity:p}=e,m=await super.deserialize(e,n,s);m.color=jt.makeHexColor(...u),m.opacity=p||1,f&&E(m,or,e.thickness),m._initialData=r,e.comment&&m.setCommentData(e);const[b,_]=m.pageDimensions,[S,R]=m.pageTranslation;if(h){const P=E(m,Xl,[]);for(let F=0;F<h.length;F+=8)P.push({x:(h[F]-S)/b,y:1-(h[F+1]-R)/_,width:(h[F+2]-h[F])/b,height:(h[F+1]-h[F+5])/_});N(C=m,xe,bC).call(C),N(M=m,xe,Ch).call(M),m.rotate(m.rotation)}else if(f){E(m,ts,!0);const P=f[0],F={x:P[0]-S,y:_-(P[1]-R)},z=new yC(F,[0,0,b,_],1,c(m,or)/2,!0,.001);for(let dt=0,ct=P.length;dt<ct;dt+=2)F.x=P[dt]-S,F.y=_-(P[dt+1]-R),z.add(F);const{id:j,clipPathId:H}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:m.color,"fill-opacity":m._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:z.toSVGPath()}},!0,!0);N(k=m,xe,l_).call(k,{highlightOutlines:z.getOutlines(),highlightId:j,clipPathId:H}),N(I=m,xe,Ch).call(I),m.rotate(m.parentRotation)}return m}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const n=An._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),s=super.serialize(e);return Object.assign(s,{color:n,opacity:this.opacity,thickness:c(this,or),quadPoints:N(this,xe,Vk).call(this),outlines:N(this,xe,Gk).call(this,s.rect)}),this.addComment(s),this.annotationElementId&&!N(this,xe,Yk).call(this,s)?null:(s.id=this.annotationElementId,s)}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}};Dm=new WeakMap,Ev=new WeakMap,Xl=new WeakMap,Md=new WeakMap,Cv=new WeakMap,Ws=new WeakMap,xv=new WeakMap,Tv=new WeakMap,Nd=new WeakMap,Ta=new WeakMap,Ra=new WeakMap,ts=new WeakMap,Mm=new WeakMap,Nm=new WeakMap,vs=new WeakMap,km=new WeakMap,or=new WeakMap,Rv=new WeakMap,xe=new WeakSet,bC=function(){const e=new mC(c(this,Xl),.001);E(this,Ta,e.getOutlines()),[this.x,this.y,this.width,this.height]=c(this,Ta).box;const n=new mC(c(this,Xl),.0025,.001,this._uiManager.direction==="ltr");E(this,Ws,n.getOutlines());const{firstPoint:s}=c(this,Ta);E(this,Mm,[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height]);const{lastPoint:r}=c(this,Ws);E(this,Nm,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},l_=function({highlightOutlines:e,highlightId:n,clipPathId:s}){var _,S;if(E(this,Ta,e),E(this,Ws,e.getNewOutline(c(this,or)/2+1.5,.0025)),n>=0)E(this,Ra,n),E(this,Md,s),this.parent.drawLayer.finalizeDraw(n,{bbox:e.box,path:{d:e.toSVGPath()}}),E(this,vs,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:c(this,Ws).box,path:{d:c(this,Ws).toSVGPath()}},!0));else if(this.parent){const R=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(c(this,Ra),{bbox:N(_=Xe,cr,ap).call(_,c(this,Ta).box,(R-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(c(this,vs),{bbox:N(S=Xe,cr,ap).call(S,c(this,Ws).box,R),path:{d:c(this,Ws).toSVGPath()}})}const[u,h,f,p]=e.box;switch(this.rotation){case 0:this.x=u,this.y=h,this.width=f,this.height=p;break;case 90:{const[R,C]=this.parentDimensions;this.x=h,this.y=1-u,this.width=f*C/R,this.height=p*R/C;break}case 180:this.x=1-u,this.y=1-h,this.width=f,this.height=p;break;case 270:{const[R,C]=this.parentDimensions;this.x=1-h,this.y=u,this.width=f*C/R,this.height=p*R/C;break}}const{firstPoint:m}=e;E(this,Mm,[(m[0]-u)/f,(m[1]-h)/p]);const{lastPoint:b}=c(this,Ws);E(this,Nm,[(b[0]-u)/f,(b[1]-h)/p])},zk=function(e){const n=(u,h)=>{this.color=u,this.opacity=h,this.onUpdatedColor()},s=this.color,r=this.opacity;this.addCommands({cmd:n.bind(this,e,Xe._defaultOpacity),undo:n.bind(this,s,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Fe.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(e)},!0)},jk=function(e){const n=c(this,or),s=r=>{E(this,or,r),N(this,xe,Hk).call(this,r)};this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Fe.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)},Hk=function(e){c(this,ts)&&(N(this,xe,l_).call(this,{highlightOutlines:c(this,Ta).getNewOutline(e/2)}),this.fixAndSetPosition(),this.setDims())},vC=function(){c(this,Ra)===null||!this.parent||(this.parent.drawLayer.remove(c(this,Ra)),E(this,Ra,null),this.parent.drawLayer.remove(c(this,vs)),E(this,vs,null))},Ch=function(e=this.parent){c(this,Ra)===null&&({id:bi(this,Ra)._,clipPathId:bi(this,Md)._}=e.drawLayer.draw({bbox:c(this,Ta).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:c(this,ts)},path:{d:c(this,Ta).toSVGPath()}},!1,!0),E(this,vs,e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:c(this,ts)},bbox:c(this,Ws).box,path:{d:c(this,Ws).toSVGPath()}},c(this,ts))),c(this,Nd)&&(c(this,Nd).style.clipPath=c(this,Md)))},cr=new WeakSet,ap=function([e,n,s,r],u){switch(u){case 90:return[1-n-r,e,r,s];case 180:return[1-e-s,1-n-r,s,r];case 270:return[n,1-e-s,r,s]}return[e,n,s,r]},$k=function(e){Xe._keyboardManager.exec(this,e)},c_=function(e){if(!c(this,Dm))return;const n=window.getSelection();e?n.setPosition(c(this,Dm),c(this,Ev)):n.setPosition(c(this,xv),c(this,Tv))},u_=function(){return c(this,ts)?this.rotation:0},Vk=function(){if(c(this,ts))return null;const[e,n]=this.pageDimensions,[s,r]=this.pageTranslation,u=c(this,Xl),h=new Float32Array(u.length*8);let f=0;for(const{x:p,y:m,width:b,height:_}of u){const S=p*e+s,R=(1-m)*n+r;h[f]=h[f+4]=S,h[f+1]=h[f+3]=R,h[f+2]=h[f+6]=S+b*e,h[f+5]=h[f+7]=R-_*n,f+=8}return h},Gk=function(e){return c(this,Ta).serialize(e,N(this,xe,u_).call(this))},qk=function(e,n){this._freeHighlight.add(n)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},Xk=function(e,n){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},Yk=function(e){const{color:n}=this._initialData;return this.hasEditedComment||e.color.some((s,r)=>s!==n[r])},O(Xe,cr),Ct(Xe,"_defaultColor",null),Ct(Xe,"_defaultOpacity",1),Ct(Xe,"_defaultThickness",12),Ct(Xe,"_type","highlight"),Ct(Xe,"_editorType",ve.HIGHLIGHT),Ct(Xe,"_freeHighlightId",-1),Ct(Xe,"_freeHighlight",null),Ct(Xe,"_freeHighlightClipId","");let B_=Xe;var kd;class Kk{constructor(){O(this,kd,Object.create(null))}updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,n]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,n)}updateSVGProperty(t,e){c(this,kd)[t]=e}toSVGProperties(){const t=c(this,kd);return E(this,kd,Object.create(null)),{root:t}}reset(){E(this,kd,Object.create(null))}updateAll(t=this){this.updateProperties(t)}clone(){yn("Not implemented")}}kd=new WeakMap;var Oa,Pm,Fi,Pd,Ld,je,wC,_C,AC,Ry,Wk,h_,Oy,rp;const Le=class Le extends An{constructor(e){super(e);O(this,je);O(this,Oa,null);O(this,Pm);Ct(this,"_colorPicker",null);Ct(this,"_drawId",null);E(this,Pm,e.mustBeCommitted||!1),this._addOutlines(e)}onUpdatedColor(){var e;(e=this._colorPicker)==null||e.update(this.color),super.onUpdatedColor()}_addOutlines(e){e.drawOutlines&&(N(this,je,wC).call(this,e),N(this,je,Ry).call(this))}static _mergeSVGProperties(e,n){const s=new Set(Object.keys(e));for(const[r,u]of Object.entries(n))s.has(r)?Object.assign(e[r],u):e[r]=u;return e}static getDefaultDrawingOptions(e){yn("Not implemented")}static get typesMap(){yn("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,n){const s=this.typesMap.get(e);s&&this._defaultDrawingOptions.updateProperty(s,n),this._currentParent&&(c(Le,Fi).updateProperty(s,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,n){const s=this.constructor.typesMap.get(e);s&&this._updateProperty(e,s,n)}static get defaultPropertiesToUpdate(){const e=[],n=this._defaultDrawingOptions;for(const[s,r]of this.typesMap)e.push([s,n[r]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:n}=this;for(const[s,r]of this.constructor.typesMap)e.push([s,n[r]]);return e}_updateProperty(e,n,s){const r=this._drawingOptions,u=r[n],h=f=>{var m;r.updateProperty(n,f);const p=c(this,Oa).updateProperty(n,f);p&&N(this,je,Oy).call(this,p),(m=this.parent)==null||m.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),e===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:h.bind(this,s),undo:h.bind(this,u),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,Le._mergeSVGProperties(c(this,Oa).getPathResizingSVGProperties(N(this,je,h_).call(this)),{bbox:N(this,je,rp).call(this)}))}_onResized(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,Le._mergeSVGProperties(c(this,Oa).getPathResizedSVGProperties(N(this,je,h_).call(this)),{bbox:N(this,je,rp).call(this)}))}_onTranslating(e,n){var s;(s=this.parent)==null||s.drawLayer.updateProperties(this._drawId,{bbox:N(this,je,rp).call(this)})}_onTranslated(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,Le._mergeSVGProperties(c(this,Oa).getPathTranslatedSVGProperties(N(this,je,h_).call(this),this.parentDimensions),{bbox:N(this,je,rp).call(this)}))}_onStartDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,c(this,Pm)&&(E(this,Pm,!1),this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){N(this,je,AC).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(N(this,je,Ry).call(this),N(this,je,Oy).call(this,c(this,Oa).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var s;let n=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),N(this,je,AC).call(this)):e&&(this._uiManager.addShouldRescale(this),N(this,je,Ry).call(this,e),n=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(e),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Le._mergeSVGProperties({bbox:N(this,je,rp).call(this)},c(this,Oa).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&N(this,je,Oy).call(this,c(this,Oa).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,n;this._isCopy&&(e=this.x,n=this.y);const s=super.render();s.classList.add("draw");const r=document.createElement("div");return s.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,n),s}static createDrawerInstance(e,n,s,r,u){yn("Not implemented")}static startDrawing(e,n,s,r){var M;const{target:u,offsetX:h,offsetY:f,pointerId:p,pointerType:m}=r;if(ps.isInitializedAndDifferentPointerType(m))return;const{viewport:{rotation:b}}=e,{width:_,height:S}=u.getBoundingClientRect(),R=E(Le,Pd,new AbortController),C=e.combinedSignal(R);if(ps.setPointer(m,p),window.addEventListener("pointerup",k=>{ps.isSamePointerIdOrRemove(k.pointerId)&&this._endDraw(k)},{signal:C}),window.addEventListener("pointercancel",k=>{ps.isSamePointerIdOrRemove(k.pointerId)&&this._currentParent.endDrawingSession()},{signal:C}),window.addEventListener("pointerdown",k=>{ps.isSamePointerType(k.pointerType)&&(ps.initializeAndAddPointerId(k.pointerId),c(Le,Fi).isCancellable()&&(c(Le,Fi).removeLastElement(),c(Le,Fi).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:C}),window.addEventListener("contextmenu",dr,{signal:C}),u.addEventListener("pointermove",this._drawMove.bind(this),{signal:C}),u.addEventListener("touchmove",k=>{ps.isSameTimeStamp(k.timeStamp)&&Kn(k)},{signal:C}),e.toggleDrawing(),(M=n._editorUndoBar)==null||M.hide(),c(Le,Fi)){e.drawLayer.updateProperties(this._currentDrawId,c(Le,Fi).startNew(h,f,_,S,b));return}n.updateUIForDefaultProperties(this),E(Le,Fi,this.createDrawerInstance(h,f,_,S,b)),E(Le,Ld,this.getDefaultDrawingOptions()),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(c(Le,Ld).toSVGProperties(),c(Le,Fi).defaultSVGProperties),!0,!1)}static _drawMove(e){if(ps.isSameTimeStamp(e.timeStamp),!c(Le,Fi))return;const{offsetX:n,offsetY:s,pointerId:r}=e;if(ps.isSamePointerId(r)){if(ps.isUsingMultiplePointers()){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,c(Le,Fi).add(n,s)),ps.setTimeStamp(e.timeStamp),Kn(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,E(Le,Fi,null),E(Le,Ld,null),ps.clearTimeStamp()),c(Le,Pd)&&(c(Le,Pd).abort(),E(Le,Pd,null),ps.clearPointerIds())}static _endDraw(e){const n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),(e==null?void 0:e.target)===n.div&&n.drawLayer.updateProperties(this._currentDrawId,c(Le,Fi).end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const s=c(Le,Fi),r=this._currentDrawId,u=s.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(r,s.setLastElement(u))},undo:()=>{n.drawLayer.updateProperties(r,s.removeLastElement())},mustExec:!1,type:Fe.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(Fe.DRAW_STEP),!c(Le,Fi).isEmpty()){const{pageDimensions:[s,r],scale:u}=n,h=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:c(Le,Fi).getOutlines(s*u,r*u,u,this._INNER_MARGIN),drawingOptions:c(Le,Ld),mustBeCommitted:!e});return this._cleanup(!0),h}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,n,s,r,u,h){yn("Not implemented")}static async deserialize(e,n,s){var b,_;const{rawDims:{pageWidth:r,pageHeight:u,pageX:h,pageY:f}}=n.viewport,p=this.deserializeDraw(h,f,r,u,this._INNER_MARGIN,e),m=await super.deserialize(e,n,s);return m.createDrawingOptions(e),N(b=m,je,wC).call(b,{drawOutlines:p}),N(_=m,je,Ry).call(_),m.onScaleChanging(),m.rotate(),m}serializeDraw(e){const[n,s]=this.pageTranslation,[r,u]=this.pageDimensions;return c(this,Oa).serialize([n,s,r,u],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}};Oa=new WeakMap,Pm=new WeakMap,Fi=new WeakMap,Pd=new WeakMap,Ld=new WeakMap,je=new WeakSet,wC=function({drawOutlines:e,drawId:n,drawingOptions:s}){E(this,Oa,e),this._drawingOptions||(this._drawingOptions=s),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,e.defaultProperties)):this._drawId=N(this,je,_C).call(this,e,this.parent),N(this,je,Oy).call(this,e.box)},_C=function(e,n){const{id:s}=n.drawLayer.draw(Le._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return s},AC=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Ry=function(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=N(this,je,_C).call(this,c(this,Oa),e)}},Wk=function([e,n,s,r]){const{parentDimensions:[u,h],rotation:f}=this;switch(f){case 90:return[n,1-e,s*(h/u),r*(u/h)];case 180:return[1-e,1-n,s,r];case 270:return[1-n,e,s*(h/u),r*(u/h)];default:return[e,n,s,r]}},h_=function(){const{x:e,y:n,width:s,height:r,parentDimensions:[u,h],rotation:f}=this;switch(f){case 90:return[1-n,e,s*(u/h),r*(h/u)];case 180:return[1-e,1-n,s,r];case 270:return[n,1-e,s*(u/h),r*(h/u)];default:return[e,n,s,r]}},Oy=function(e){[this.x,this.y,this.width,this.height]=N(this,je,Wk).call(this,e),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()},rp=function(){const{x:e,y:n,width:s,height:r,rotation:u,parentRotation:h,parentDimensions:[f,p]}=this;switch((u*4+h)/90){case 1:return[1-n-r,e,r,s];case 2:return[1-e-s,1-n-r,s,r];case 3:return[n,1-e-s,r,s];case 4:return[e,n-s*(f/p),r*(p/f),s*(f/p)];case 5:return[1-n,e,s*(f/p),r*(p/f)];case 6:return[1-e-r*(p/f),1-n,r*(p/f),s*(f/p)];case 7:return[n-s*(f/p),1-e-r*(p/f),s*(f/p),r*(p/f)];case 8:return[e-s,n-r,s,r];case 9:return[1-n,e-s,r,s];case 10:return[1-e,1-n,s,r];case 11:return[n-r,1-e,r,s];case 12:return[e-r*(p/f),n,r*(p/f),s*(f/p)];case 13:return[1-n-s*(f/p),e-r*(p/f),s*(f/p),r*(p/f)];case 14:return[1-e,1-n-s*(f/p),r*(p/f),s*(f/p)];case 15:return[n,1-e,s*(f/p),r*(p/f)];default:return[e,n,s,r]}},Ct(Le,"_currentDrawId",-1),Ct(Le,"_currentParent",null),O(Le,Fi,null),O(Le,Pd,null),O(Le,Ld,null),Ct(Le,"_INNER_MARGIN",3);let F_=Le;var To,Ui,zi,Id,Lm,Ts,es,lr,Bd,Fd,Ud,Im,d_;class dz{constructor(t,e,n,s,r,u){O(this,Im);O(this,To,new Float64Array(6));O(this,Ui);O(this,zi);O(this,Id);O(this,Lm);O(this,Ts);O(this,es,"");O(this,lr,0);O(this,Bd,new Yv);O(this,Fd);O(this,Ud);E(this,Fd,n),E(this,Ud,s),E(this,Id,r),E(this,Lm,u),[t,e]=N(this,Im,d_).call(this,t,e);const h=E(this,Ui,[NaN,NaN,NaN,NaN,t,e]);E(this,Ts,[t,e]),E(this,zi,[{line:h,points:c(this,Ts)}]),c(this,To).set(h,0)}updateProperty(t,e){t==="stroke-width"&&E(this,Lm,e)}isEmpty(){return!c(this,zi)||c(this,zi).length===0}isCancellable(){return c(this,Ts).length<=10}add(t,e){[t,e]=N(this,Im,d_).call(this,t,e);const[n,s,r,u]=c(this,To).subarray(2,6),h=t-r,f=e-u;return Math.hypot(c(this,Fd)*h,c(this,Ud)*f)<=2?null:(c(this,Ts).push(t,e),isNaN(n)?(c(this,To).set([r,u,t,e],2),c(this,Ui).push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(c(this,To)[0])&&c(this,Ui).splice(6,6),c(this,To).set([n,s,r,u,t,e],0),c(this,Ui).push(...qt.createBezierPoints(n,s,r,u,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const n=this.add(t,e);return n||(c(this,Ts).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,n,s,r){E(this,Fd,n),E(this,Ud,s),E(this,Id,r),[t,e]=N(this,Im,d_).call(this,t,e);const u=E(this,Ui,[NaN,NaN,NaN,NaN,t,e]);E(this,Ts,[t,e]);const h=c(this,zi).at(-1);return h&&(h.line=new Float32Array(h.line),h.points=new Float32Array(h.points)),c(this,zi).push({line:u,points:c(this,Ts)}),c(this,To).set(u,0),E(this,lr,0),this.toSVGPath(),null}getLastElement(){return c(this,zi).at(-1)}setLastElement(t){return c(this,zi)?(c(this,zi).push(t),E(this,Ui,t.line),E(this,Ts,t.points),E(this,lr,0),{path:{d:this.toSVGPath()}}):c(this,Bd).setLastElement(t)}removeLastElement(){if(!c(this,zi))return c(this,Bd).removeLastElement();c(this,zi).pop(),E(this,es,"");for(let t=0,e=c(this,zi).length;t<e;t++){const{line:n,points:s}=c(this,zi)[t];E(this,Ui,n),E(this,Ts,s),E(this,lr,0),this.toSVGPath()}return{path:{d:c(this,es)}}}toSVGPath(){const t=qt.svgRound(c(this,Ui)[4]),e=qt.svgRound(c(this,Ui)[5]);if(c(this,Ts).length===2)return E(this,es,`${c(this,es)} M ${t} ${e} Z`),c(this,es);if(c(this,Ts).length<=6){const s=c(this,es).lastIndexOf("M");E(this,es,`${c(this,es).slice(0,s)} M ${t} ${e}`),E(this,lr,6)}if(c(this,Ts).length===4){const s=qt.svgRound(c(this,Ui)[10]),r=qt.svgRound(c(this,Ui)[11]);return E(this,es,`${c(this,es)} L ${s} ${r}`),E(this,lr,12),c(this,es)}const n=[];c(this,lr)===0&&(n.push(`M ${t} ${e}`),E(this,lr,6));for(let s=c(this,lr),r=c(this,Ui).length;s<r;s+=6){const[u,h,f,p,m,b]=c(this,Ui).slice(s,s+6).map(qt.svgRound);n.push(`C${u} ${h} ${f} ${p} ${m} ${b}`)}return E(this,es,c(this,es)+n.join(" ")),E(this,lr,c(this,Ui).length),c(this,es)}getOutlines(t,e,n,s){const r=c(this,zi).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),c(this,Bd).build(c(this,zi),t,e,n,c(this,Id),c(this,Lm),s),E(this,To,null),E(this,Ui,null),E(this,zi,null),E(this,es,null),c(this,Bd)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}To=new WeakMap,Ui=new WeakMap,zi=new WeakMap,Id=new WeakMap,Lm=new WeakMap,Ts=new WeakMap,es=new WeakMap,lr=new WeakMap,Bd=new WeakMap,Fd=new WeakMap,Ud=new WeakMap,Im=new WeakSet,d_=function(t,e){return qt._normalizePoint(t,e,c(this,Fd),c(this,Ud),c(this,Id))};var Rs,Ov,Dv,Da,Ro,Oo,Bm,Fm,zd,ss,gl,Qk,Jk,Zk;class Yv extends qt{constructor(){super(...arguments);O(this,ss);O(this,Rs);O(this,Ov,0);O(this,Dv);O(this,Da);O(this,Ro);O(this,Oo);O(this,Bm);O(this,Fm);O(this,zd)}build(e,n,s,r,u,h,f){E(this,Ro,n),E(this,Oo,s),E(this,Bm,r),E(this,Fm,u),E(this,zd,h),E(this,Dv,f??0),E(this,Da,e),N(this,ss,Jk).call(this)}get thickness(){return c(this,zd)}setLastElement(e){return c(this,Da).push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return c(this,Da).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:n}of c(this,Da)){if(e.push(`M${qt.svgRound(n[4])} ${qt.svgRound(n[5])}`),n.length===6){e.push("Z");continue}if(n.length===12&&isNaN(n[6])){e.push(`L${qt.svgRound(n[10])} ${qt.svgRound(n[11])}`);continue}for(let s=6,r=n.length;s<r;s+=6){const[u,h,f,p,m,b]=n.subarray(s,s+6).map(qt.svgRound);e.push(`C${u} ${h} ${f} ${p} ${m} ${b}`)}}return e.join("")}serialize([e,n,s,r],u){const h=[],f=[],[p,m,b,_]=N(this,ss,Qk).call(this);let S,R,C,M,k,I,P,F,z;switch(c(this,Fm)){case 0:z=qt._rescale,S=e,R=n+r,C=s,M=-r,k=e+p*s,I=n+(1-m-_)*r,P=e+(p+b)*s,F=n+(1-m)*r;break;case 90:z=qt._rescaleAndSwap,S=e,R=n,C=s,M=r,k=e+m*s,I=n+p*r,P=e+(m+_)*s,F=n+(p+b)*r;break;case 180:z=qt._rescale,S=e+s,R=n,C=-s,M=r,k=e+(1-p-b)*s,I=n+m*r,P=e+(1-p)*s,F=n+(m+_)*r;break;case 270:z=qt._rescaleAndSwap,S=e+s,R=n+r,C=-s,M=-r,k=e+(1-m-_)*s,I=n+(1-p-b)*r,P=e+(1-m)*s,F=n+(1-p)*r;break}for(const{line:j,points:H}of c(this,Da))h.push(z(j,S,R,C,M,u?new Array(j.length):null)),f.push(z(H,S,R,C,M,u?new Array(H.length):null));return{lines:h,points:f,rect:[k,I,P,F]}}static deserialize(e,n,s,r,u,{paths:{lines:h,points:f},rotation:p,thickness:m}){const b=[];let _,S,R,C,M;switch(p){case 0:M=qt._rescale,_=-e/s,S=n/r+1,R=1/s,C=-1/r;break;case 90:M=qt._rescaleAndSwap,_=-n/r,S=-e/s,R=1/r,C=1/s;break;case 180:M=qt._rescale,_=e/s+1,S=-n/r,R=-1/s,C=1/r;break;case 270:M=qt._rescaleAndSwap,_=n/r+1,S=e/s+1,R=-1/r,C=-1/s;break}if(!h){h=[];for(const I of f){const P=I.length;if(P===2){h.push(new Float32Array([NaN,NaN,NaN,NaN,I[0],I[1]]));continue}if(P===4){h.push(new Float32Array([NaN,NaN,NaN,NaN,I[0],I[1],NaN,NaN,NaN,NaN,I[2],I[3]]));continue}const F=new Float32Array(3*(P-2));h.push(F);let[z,j,H,dt]=I.subarray(0,4);F.set([NaN,NaN,NaN,NaN,z,j],0);for(let ct=4;ct<P;ct+=2){const yt=I[ct],gt=I[ct+1];F.set(qt.createBezierPoints(z,j,H,dt,yt,gt),(ct-2)*3),[z,j,H,dt]=[H,dt,yt,gt]}}}for(let I=0,P=h.length;I<P;I++)b.push({line:M(h[I].map(F=>F??NaN),_,S,R,C),points:M(f[I].map(F=>F??NaN),_,S,R,C)});const k=new this.prototype.constructor;return k.build(b,s,r,1,p,m,u),k}get box(){return c(this,Rs)}updateProperty(e,n){return e==="stroke-width"?N(this,ss,Zk).call(this,n):null}updateParentDimensions([e,n],s){const[r,u]=N(this,ss,gl).call(this);E(this,Ro,e),E(this,Oo,n),E(this,Bm,s);const[h,f]=N(this,ss,gl).call(this),p=h-r,m=f-u,b=c(this,Rs);return b[0]-=p,b[1]-=m,b[2]+=2*p,b[3]+=2*m,b}updateRotation(e){return E(this,Ov,e),{path:{transform:this.rotationTransform}}}get viewBox(){return c(this,Rs).map(qt.svgRound).join(" ")}get defaultProperties(){const[e,n]=c(this,Rs);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${qt.svgRound(e)} ${qt.svgRound(n)}`}}}get rotationTransform(){const[,,e,n]=c(this,Rs);let s=0,r=0,u=0,h=0,f=0,p=0;switch(c(this,Ov)){case 90:r=n/e,u=-e/n,f=e;break;case 180:s=-1,h=-1,f=e,p=n;break;case 270:r=-n/e,u=e/n,p=n;break;default:return""}return`matrix(${s} ${r} ${u} ${h} ${qt.svgRound(f)} ${qt.svgRound(p)})`}getPathResizingSVGProperties([e,n,s,r]){const[u,h]=N(this,ss,gl).call(this),[f,p,m,b]=c(this,Rs);if(Math.abs(m-u)<=qt.PRECISION||Math.abs(b-h)<=qt.PRECISION){const M=e+s/2-(f+m/2),k=n+r/2-(p+b/2);return{path:{"transform-origin":`${qt.svgRound(e)} ${qt.svgRound(n)}`,transform:`${this.rotationTransform} translate(${M} ${k})`}}}const _=(s-2*u)/(m-2*u),S=(r-2*h)/(b-2*h),R=m/s,C=b/r;return{path:{"transform-origin":`${qt.svgRound(f)} ${qt.svgRound(p)}`,transform:`${this.rotationTransform} scale(${R} ${C}) translate(${qt.svgRound(u)} ${qt.svgRound(h)}) scale(${_} ${S}) translate(${qt.svgRound(-u)} ${qt.svgRound(-h)})`}}}getPathResizedSVGProperties([e,n,s,r]){const[u,h]=N(this,ss,gl).call(this),f=c(this,Rs),[p,m,b,_]=f;if(f[0]=e,f[1]=n,f[2]=s,f[3]=r,Math.abs(b-u)<=qt.PRECISION||Math.abs(_-h)<=qt.PRECISION){const k=e+s/2-(p+b/2),I=n+r/2-(m+_/2);for(const{line:P,points:F}of c(this,Da))qt._translate(P,k,I,P),qt._translate(F,k,I,F);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${qt.svgRound(e)} ${qt.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const S=(s-2*u)/(b-2*u),R=(r-2*h)/(_-2*h),C=-S*(p+u)+e+u,M=-R*(m+h)+n+h;if(S!==1||R!==1||C!==0||M!==0)for(const{line:k,points:I}of c(this,Da))qt._rescale(k,C,M,S,R,k),qt._rescale(I,C,M,S,R,I);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${qt.svgRound(e)} ${qt.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,n],s){const[r,u]=s,h=c(this,Rs),f=e-h[0],p=n-h[1];if(c(this,Ro)===r&&c(this,Oo)===u)for(const{line:m,points:b}of c(this,Da))qt._translate(m,f,p,m),qt._translate(b,f,p,b);else{const m=c(this,Ro)/r,b=c(this,Oo)/u;E(this,Ro,r),E(this,Oo,u);for(const{line:_,points:S}of c(this,Da))qt._rescale(_,f,p,m,b,_),qt._rescale(S,f,p,m,b,S);h[2]*=m,h[3]*=b}return h[0]=e,h[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${qt.svgRound(e)} ${qt.svgRound(n)}`}}}get defaultSVGProperties(){const e=c(this,Rs);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${qt.svgRound(e[0])} ${qt.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}Rs=new WeakMap,Ov=new WeakMap,Dv=new WeakMap,Da=new WeakMap,Ro=new WeakMap,Oo=new WeakMap,Bm=new WeakMap,Fm=new WeakMap,zd=new WeakMap,ss=new WeakSet,gl=function(e=c(this,zd)){const n=c(this,Dv)+e/2*c(this,Bm);return c(this,Fm)%180===0?[n/c(this,Ro),n/c(this,Oo)]:[n/c(this,Oo),n/c(this,Ro)]},Qk=function(){const[e,n,s,r]=c(this,Rs),[u,h]=N(this,ss,gl).call(this,0);return[e+u,n+h,s-2*u,r-2*h]},Jk=function(){const e=E(this,Rs,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:r}of c(this,Da)){if(r.length<=12){for(let f=4,p=r.length;f<p;f+=6)jt.pointBoundingBox(r[f],r[f+1],e);continue}let u=r[4],h=r[5];for(let f=6,p=r.length;f<p;f+=6){const[m,b,_,S,R,C]=r.subarray(f,f+6);jt.bezierBoundingBox(u,h,m,b,_,S,R,C,e),u=R,h=C}}const[n,s]=N(this,ss,gl).call(this);e[0]=Ms(e[0]-n,0,1),e[1]=Ms(e[1]-s,0,1),e[2]=Ms(e[2]+n,0,1),e[3]=Ms(e[3]+s,0,1),e[2]-=e[0],e[3]-=e[1]},Zk=function(e){const[n,s]=N(this,ss,gl).call(this);E(this,zd,e);const[r,u]=N(this,ss,gl).call(this),[h,f]=[r-n,u-s],p=c(this,Rs);return p[0]-=h,p[1]-=f,p[2]+=2*h,p[3]+=2*f,p};class xA extends Kk{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:An._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??(e=this["stroke-width"]),e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new xA(this._viewParameters);return t.updateAll(this),t}}var iA,tP;const fp=class fp extends F_{constructor(e){super({...e,name:"inkEditor"});O(this,iA);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,n){An.initialize(e,n),this._defaultDrawingOptions=new xA(n.viewParameters)}static getDefaultDrawingOptions(e){const n=this._defaultDrawingOptions.clone();return n.updateProperties(e),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return ge(this,"typesMap",new Map([[Fe.INK_THICKNESS,"stroke-width"],[Fe.INK_COLOR,"stroke"],[Fe.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,n,s,r,u){return new dz(e,n,s,r,u,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,n,s,r,u,h){return Yv.deserialize(e,n,s,r,u,h)}static async deserialize(e,n,s){let r=null;if(e instanceof Ix){const{data:{inkLists:h,rect:f,rotation:p,id:m,color:b,opacity:_,borderStyle:{rawWidth:S},popupRef:R,richText:C,contentsObj:M,creationDate:k,modificationDate:I},parent:{page:{pageNumber:P}}}=e;r=e={annotationType:ve.INK,color:Array.from(b),thickness:S,opacity:_,paths:{points:h},boxes:null,pageIndex:P-1,rect:f.slice(0),rotation:p,annotationElementId:m,id:m,deleted:!1,popupRef:R,richText:C,comment:(M==null?void 0:M.str)||null,creationDate:k,modificationDate:I}}const u=await super.deserialize(e,n,s);return u._initialData=r,e.comment&&u.setCommentData(e),u}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new P_(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Fe.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:n,parent:s}=this;n.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(e,n.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:n,opacity:s}){this._drawingOptions=fp.getDefaultDrawingOptions({stroke:jt.makeHexColor(...e),"stroke-width":n,"stroke-opacity":s})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:n,points:s}=this.serializeDraw(e),{_drawingOptions:{stroke:r,"stroke-opacity":u,"stroke-width":h}}=this,f=Object.assign(super.serialize(e),{color:An._colorManager.convert(r),opacity:u,thickness:h,paths:{lines:n,points:s}});return this.addComment(f),e?(f.isCopy=!0,f):this.annotationElementId&&!N(this,iA,tP).call(this,f)?null:(f.id=this.annotationElementId,f)}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;const{points:n,rect:s}=this.serializeDraw(!1);return e.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:n,popup:this.comment}),null}};iA=new WeakSet,tP=function(e){const{color:n,thickness:s,opacity:r,pageIndex:u}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((h,f)=>h!==n[f])||e.thickness!==s||e.opacity!==r||e.pageIndex!==u},Ct(fp,"_type","ink"),Ct(fp,"_editorType",ve.INK),Ct(fp,"_defaultDrawingOptions",null);let SC=fp;class EC extends Yv{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Rw=8,sy=3;var jd,Ye,CC,Lr,eP,nP,xC,f_,iP,sP,aP,TC,RC,rP;class Zl{static extractContoursFromText(t,{fontFamily:e,fontStyle:n,fontWeight:s},r,u,h,f){let p=new OffscreenCanvas(1,1),m=p.getContext("2d",{alpha:!1});const b=200,_=m.font=`${n} ${s} ${b}px ${e}`,{actualBoundingBoxLeft:S,actualBoundingBoxRight:R,actualBoundingBoxAscent:C,actualBoundingBoxDescent:M,fontBoundingBoxAscent:k,fontBoundingBoxDescent:I,width:P}=m.measureText(t),F=1.5,z=Math.ceil(Math.max(Math.abs(S)+Math.abs(R)||0,P)*F),j=Math.ceil(Math.max(Math.abs(C)+Math.abs(M)||b,Math.abs(k)+Math.abs(I)||b)*F);p=new OffscreenCanvas(z,j),m=p.getContext("2d",{alpha:!0,willReadFrequently:!0}),m.font=_,m.filter="grayscale(1)",m.fillStyle="white",m.fillRect(0,0,z,j),m.fillStyle="black",m.fillText(t,z*(F-1)/2,j*(3-F)/2);const H=N(this,Ye,TC).call(this,m.getImageData(0,0,z,j).data),dt=N(this,Ye,aP).call(this,H),ct=N(this,Ye,RC).call(this,dt),yt=N(this,Ye,xC).call(this,H,z,j,ct);return this.processDrawnLines({lines:{curves:yt,width:z,height:j},pageWidth:r,pageHeight:u,rotation:h,innerMargin:f,mustSmooth:!0,areContours:!0})}static process(t,e,n,s,r){const[u,h,f]=N(this,Ye,rP).call(this,t),[p,m]=N(this,Ye,sP).call(this,u,h,f,Math.hypot(h,f)*c(this,jd).sigmaSFactor,c(this,jd).sigmaR,c(this,jd).kernelSize),b=N(this,Ye,RC).call(this,m),_=N(this,Ye,xC).call(this,p,h,f,b);return this.processDrawnLines({lines:{curves:_,width:h,height:f},pageWidth:e,pageHeight:n,rotation:s,innerMargin:r,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:s,innerMargin:r,mustSmooth:u,areContours:h}){s%180!==0&&([e,n]=[n,e]);const{curves:f,width:p,height:m}=t,b=t.thickness??0,_=[],S=Math.min(e/p,n/m),R=S/e,C=S/n,M=[];for(const{points:I}of f){const P=u?N(this,Ye,iP).call(this,I):I;if(!P)continue;M.push(P);const F=P.length,z=new Float32Array(F),j=new Float32Array(3*(F===2?2:F-2));if(_.push({line:j,points:z}),F===2){z[0]=P[0]*R,z[1]=P[1]*C,j.set([NaN,NaN,NaN,NaN,z[0],z[1]],0);continue}let[H,dt,ct,yt]=P;H*=R,dt*=C,ct*=R,yt*=C,z.set([H,dt,ct,yt],0),j.set([NaN,NaN,NaN,NaN,H,dt],0);for(let gt=4;gt<F;gt+=2){const Pt=z[gt]=P[gt]*R,Xt=z[gt+1]=P[gt+1]*C;j.set(qt.createBezierPoints(H,dt,ct,yt,Pt,Xt),(gt-2)*3),[H,dt,ct,yt]=[ct,yt,Pt,Xt]}}if(_.length===0)return null;const k=h?new EC:new Yv;return k.build(_,e,n,1,s,h?0:b,r),{outline:k,newCurves:M,areContours:h,thickness:b,width:p,height:m}}static async compressSignature({outlines:t,areContours:e,thickness:n,width:s,height:r}){let u=1/0,h=-1/0,f=0;for(const P of t){f+=P.length;for(let F=2,z=P.length;F<z;F++){const j=P[F]-P[F-2];u=Math.min(u,j),h=Math.max(h,j)}}let p;u>=-128&&h<=127?p=Int8Array:u>=-32768&&h<=32767?p=Int16Array:p=Int32Array;const m=t.length,b=Rw+sy*m,_=new Uint32Array(b);let S=0;_[S++]=b*Uint32Array.BYTES_PER_ELEMENT+(f-2*m)*p.BYTES_PER_ELEMENT,_[S++]=0,_[S++]=s,_[S++]=r,_[S++]=e?0:1,_[S++]=Math.max(0,Math.floor(n??0)),_[S++]=m,_[S++]=p.BYTES_PER_ELEMENT;for(const P of t)_[S++]=P.length-2,_[S++]=P[0],_[S++]=P[1];const R=new CompressionStream("deflate-raw"),C=R.writable.getWriter();await C.ready,C.write(_);const M=p.prototype.constructor;for(const P of t){const F=new M(P.length-2);for(let z=2,j=P.length;z<j;z++)F[z-2]=P[z]-P[z-2];C.write(F)}C.close();const k=await new Response(R.readable).arrayBuffer(),I=new Uint8Array(k);return s2(I)}static async decompressSignature(t){try{const e=T3(t),{readable:n,writable:s}=new DecompressionStream("deflate-raw"),r=s.getWriter();await r.ready,r.write(e).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let u=null,h=0;for await(const P of n)u||(u=new Uint8Array(new Uint32Array(P.buffer,0,4)[0])),u.set(P,h),h+=P.length;const f=new Uint32Array(u.buffer,0,u.length>>2),p=f[1];if(p!==0)throw new Error(`Invalid version: ${p}`);const m=f[2],b=f[3],_=f[4]===0,S=f[5],R=f[6],C=f[7],M=[],k=(Rw+sy*R)*Uint32Array.BYTES_PER_ELEMENT;let I;switch(C){case Int8Array.BYTES_PER_ELEMENT:I=new Int8Array(u.buffer,k);break;case Int16Array.BYTES_PER_ELEMENT:I=new Int16Array(u.buffer,k);break;case Int32Array.BYTES_PER_ELEMENT:I=new Int32Array(u.buffer,k);break}h=0;for(let P=0;P<R;P++){const F=f[sy*P+Rw],z=new Float32Array(F+2);M.push(z);for(let j=0;j<sy-1;j++)z[j]=f[sy*P+Rw+j+1];for(let j=0;j<F;j++)z[j+2]=z[j]+I[h++]}return{areContours:_,thickness:S,outlines:M,width:m,height:b}}catch(e){return me(`decompressSignature: ${e}`),null}}}jd=new WeakMap,Ye=new WeakSet,CC=function(t,e,n,s){return n-=t,s-=e,n===0?s>0?0:4:n===1?s+6:2-s},Lr=new WeakMap,eP=function(t,e,n,s,r,u,h){const f=N(this,Ye,CC).call(this,n,s,r,u);for(let p=0;p<8;p++){const m=(-p+f-h+16)%8,b=c(this,Lr)[2*m],_=c(this,Lr)[2*m+1];if(t[(n+b)*e+(s+_)]!==0)return m}return-1},nP=function(t,e,n,s,r,u,h){const f=N(this,Ye,CC).call(this,n,s,r,u);for(let p=0;p<8;p++){const m=(p+f+h+16)%8,b=c(this,Lr)[2*m],_=c(this,Lr)[2*m+1];if(t[(n+b)*e+(s+_)]!==0)return m}return-1},xC=function(t,e,n,s){const r=t.length,u=new Int32Array(r);for(let m=0;m<r;m++)u[m]=t[m]<=s?1:0;for(let m=1;m<n-1;m++)u[m*e]=u[m*e+e-1]=0;for(let m=0;m<e;m++)u[m]=u[e*n-1-m]=0;let h=1,f;const p=[];for(let m=1;m<n-1;m++){f=1;for(let b=1;b<e-1;b++){const _=m*e+b,S=u[_];if(S===0)continue;let R=m,C=b;if(S===1&&u[_-1]===0)h+=1,C-=1;else if(S>=1&&u[_+1]===0)h+=1,C+=1,S>1&&(f=S);else{S!==1&&(f=Math.abs(S));continue}const M=[b,m],k=C===b+1,I={isHole:k,points:M,id:h,parent:0};p.push(I);let P;for(const gt of p)if(gt.id===f){P=gt;break}P?P.isHole?I.parent=k?P.parent:f:I.parent=k?f:P.parent:I.parent=k?f:0;const F=N(this,Ye,eP).call(this,u,e,m,b,R,C,0);if(F===-1){u[_]=-h,u[_]!==1&&(f=Math.abs(u[_]));continue}let z=c(this,Lr)[2*F],j=c(this,Lr)[2*F+1];const H=m+z,dt=b+j;R=H,C=dt;let ct=m,yt=b;for(;;){const gt=N(this,Ye,nP).call(this,u,e,ct,yt,R,C,1);z=c(this,Lr)[2*gt],j=c(this,Lr)[2*gt+1];const Pt=ct+z,Xt=yt+j;M.push(Xt,Pt);const Vt=ct*e+yt;if(u[Vt+1]===0?u[Vt]=-h:u[Vt]===1&&(u[Vt]=h),Pt===m&&Xt===b&&ct===H&&yt===dt){u[_]!==1&&(f=Math.abs(u[_]));break}else R=ct,C=yt,ct=Pt,yt=Xt}}}return p},f_=function(t,e,n,s){if(n-e<=4){for(let H=e;H<n-2;H+=2)s.push(t[H],t[H+1]);return}const r=t[e],u=t[e+1],h=t[n-4]-r,f=t[n-3]-u,p=Math.hypot(h,f),m=h/p,b=f/p,_=m*u-b*r,S=f/h,R=1/p,C=Math.atan(S),M=Math.cos(C),k=Math.sin(C),I=R*(Math.abs(M)+Math.abs(k)),P=R*(1-I+I**2),F=Math.max(Math.atan(Math.abs(k+M)*P),Math.atan(Math.abs(k-M)*P));let z=0,j=e;for(let H=e+2;H<n-2;H+=2){const dt=Math.abs(_-m*t[H+1]+b*t[H]);dt>z&&(j=H,z=dt)}z>(p*F)**2?(N(this,Ye,f_).call(this,t,e,j+2,s),N(this,Ye,f_).call(this,t,j,n,s)):s.push(r,u)},iP=function(t){const e=[],n=t.length;return N(this,Ye,f_).call(this,t,0,n,e),e.push(t[n-2],t[n-1]),e.length<=4?null:e},sP=function(t,e,n,s,r,u){const h=new Float32Array(u**2),f=-2*s**2,p=u>>1;for(let C=0;C<u;C++){const M=(C-p)**2;for(let k=0;k<u;k++)h[C*u+k]=Math.exp((M+(k-p)**2)/f)}const m=new Float32Array(256),b=-2*r**2;for(let C=0;C<256;C++)m[C]=Math.exp(C**2/b);const _=t.length,S=new Uint8Array(_),R=new Uint32Array(256);for(let C=0;C<n;C++)for(let M=0;M<e;M++){const k=C*e+M,I=t[k];let P=0,F=0;for(let j=0;j<u;j++){const H=C+j-p;if(!(H<0||H>=n))for(let dt=0;dt<u;dt++){const ct=M+dt-p;if(ct<0||ct>=e)continue;const yt=t[H*e+ct],gt=h[j*u+dt]*m[Math.abs(yt-I)];P+=yt*gt,F+=gt}}const z=S[k]=Math.round(P/F);R[z]++}return[S,R]},aP=function(t){const e=new Uint32Array(256);for(const n of t)e[n]++;return e},TC=function(t){const e=t.length,n=new Uint8ClampedArray(e>>2);let s=-1/0,r=1/0;for(let h=0,f=n.length;h<f;h++){const p=n[h]=t[h<<2];s=Math.max(s,p),r=Math.min(r,p)}const u=255/(s-r);for(let h=0,f=n.length;h<f;h++)n[h]=(n[h]-r)*u;return n},RC=function(t){let e,n=-1/0,s=-1/0;const r=t.findIndex(f=>f!==0);let u=r,h=r;for(e=r;e<256;e++){const f=t[e];f>n&&(e-u>s&&(s=e-u,h=e-1),n=f,u=e)}for(e=h-1;e>=0&&!(t[e]>t[e+1]);e--);return e},rP=function(t){const e=t,{width:n,height:s}=t,{maxDim:r}=c(this,jd);let u=n,h=s;if(n>r||s>r){let _=n,S=s,R=Math.log2(Math.max(n,s)/r);const C=Math.floor(R);R=R===C?C-1:C;for(let k=0;k<R;k++){u=Math.ceil(_/2),h=Math.ceil(S/2);const I=new OffscreenCanvas(u,h);I.getContext("2d").drawImage(t,0,0,_,S,0,0,u,h),_=u,S=h,t!==e&&t.close(),t=I.transferToImageBitmap()}const M=Math.min(r/u,r/h);u=Math.round(u*M),h=Math.round(h*M)}const p=new OffscreenCanvas(u,h).getContext("2d",{willReadFrequently:!0});p.fillStyle="white",p.fillRect(0,0,u,h),p.filter="grayscale(1)",p.drawImage(t,0,0,t.width,t.height,0,0,u,h);const m=p.getImageData(0,0,u,h).data;return[N(this,Ye,TC).call(this,m),u,h]},O(Zl,Ye),O(Zl,jd,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),O(Zl,Lr,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class Bx extends Kk{constructor(){super(),super.updateProperties({fill:An._defaultLineColor,"stroke-width":0})}clone(){const t=new Bx;return t.updateAll(this),t}}class Fx extends xA{constructor(t){super(t),super.updateProperties({stroke:An._defaultLineColor,"stroke-width":1})}clone(){const t=new Fx(this._viewParameters);return t.updateAll(this),t}}var Ou,Do,Du,Hd;const da=class da extends F_{constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"});O(this,Ou,!1);O(this,Do,null);O(this,Du,null);O(this,Hd,null);this._willKeepAspectRatio=!0,E(this,Du,e.signatureData||null),E(this,Do,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,n){An.initialize(e,n),this._defaultDrawingOptions=new Bx,this._defaultDrawnSignatureOptions=new Fx(n.viewParameters)}static getDefaultDrawingOptions(e){const n=this._defaultDrawingOptions.clone();return n.updateProperties(e),n}static get supportMultipleDrawings(){return!1}static get typesMap(){return ge(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!c(this,Do)}}static computeTelemetryFinalData(e){const n=e.get("hasDescription");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,n;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,e=this.x,n=this.y),super.render(),this._drawId===null)if(c(this,Du)){const{lines:r,mustSmooth:u,areContours:h,description:f,uuid:p,heightInPage:m}=c(this,Du),{rawDims:{pageWidth:b,pageHeight:_},rotation:S}=this.parent.viewport,R=Zl.processDrawnLines({lines:r,pageWidth:b,pageHeight:_,rotation:S,innerMargin:da._INNER_MARGIN,mustSmooth:u,areContours:h});this.addSignature(R,m,f,p)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:c(this,Do)||""}));return s&&(this._isCopy=!0,this._moveAfterPaste(e,n)),this.div}setUuid(e){E(this,Hd,e),this.addEditToolbar()}getUuid(){return c(this,Hd)}get description(){return c(this,Do)}set description(e){E(this,Do,e),this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:e})),super.addEditToolbar().then(n=>{n==null||n.updateEditSignatureButton(e)}))}getSignaturePreview(){const{newCurves:e,areContours:n,thickness:s,width:r,height:u}=c(this,Du),h=Math.max(r,u),f=Zl.processDrawnLines({lines:{curves:e.map(p=>({points:p})),thickness:s,width:r,height:u},pageWidth:h,pageHeight:h,rotation:0,innerMargin:0,mustSmooth:!1,areContours:n});return{areContours:n,outline:f.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,n,s,r){const{x:u,y:h}=this,{outline:f}=E(this,Du,e);E(this,Ou,f instanceof EC),this.description=s;let p;c(this,Ou)?p=da.getDefaultDrawingOptions():(p=da._defaultDrawnSignatureOptions.clone(),p.updateProperties({"stroke-width":f.thickness})),this._addOutlines({drawOutlines:f,drawingOptions:p});const[,m]=this.pageDimensions;let b=n/m;b=b>=1?.5:b,this.width*=b/this.height,this.width>=1&&(b*=.9/this.width,this.width=.9),this.height=b,this.setDims(),this.x=u,this.y=h,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:n,pageHeight:s},rotation:r}=this.parent.viewport;return Zl.process(e,n,s,r,da._INNER_MARGIN)}getFromText(e,n){const{rawDims:{pageWidth:s,pageHeight:r},rotation:u}=this.parent.viewport;return Zl.extractContoursFromText(e,n,s,r,u,da._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:n,pageHeight:s},rotation:r}=this.parent.viewport;return Zl.processDrawnLines({lines:e,pageWidth:n,pageHeight:s,rotation:r,innerMargin:da._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:n}){e?this._drawingOptions=da.getDefaultDrawingOptions():(this._drawingOptions=da._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":n}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:n,points:s}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":r}}=this,u=Object.assign(super.serialize(e),{isSignature:!0,areContours:c(this,Ou),color:[0,0,0],thickness:c(this,Ou)?0:r});return this.addComment(u),e?(u.paths={lines:n,points:s},u.uuid=c(this,Hd),u.isCopy=!0):u.lines=n,c(this,Do)&&(u.accessibilityData={type:"Figure",alt:c(this,Do)}),u}static deserializeDraw(e,n,s,r,u,h){return h.areContours?EC.deserialize(e,n,s,r,u,h):Yv.deserialize(e,n,s,r,u,h)}static async deserialize(e,n,s){var u;const r=await super.deserialize(e,n,s);return E(r,Ou,e.areContours),r.description=((u=e.accessibilityData)==null?void 0:u.alt)||"",E(r,Hd,e.uuid),r}};Ou=new WeakMap,Do=new WeakMap,Du=new WeakMap,Hd=new WeakMap,Ct(da,"_type","signature"),Ct(da,"_editorType",ve.SIGNATURE),Ct(da,"_defaultDrawingOptions",null);let OC=da;var Ln,ji,Mu,Yl,Nu,Um,Kl,$d,Mo,Ma,zm,He,Dy,My,p_,m_,g_,MC,y_,oP;class DC extends An{constructor(e){super({...e,name:"stampEditor"});O(this,He);O(this,Ln,null);O(this,ji,null);O(this,Mu,null);O(this,Yl,null);O(this,Nu,null);O(this,Um,"");O(this,Kl,null);O(this,$d,!1);O(this,Mo,null);O(this,Ma,!1);O(this,zm,!1);E(this,Yl,e.bitmapUrl),E(this,Nu,e.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,n){An.initialize(e,n)}static isHandlingMimeForPasting(e){return m1.includes(e)}static paste(e,n){n.pasteEditor({mode:ve.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var e;return{type:"stamp",hasAltText:!!((e=this.altTextData)!=null&&e.altText)}}static computeTelemetryFinalData(e){const n=e.get("hasAltText");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}async mlGuessAltText(e=null,n=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:u,height:h}=e||this.copyCanvas(null,null,!0).imageData,f=await s.guess({name:"altText",request:{data:r,width:u,height:h,channels:r.length/(u*h)}});if(!f)throw new Error("No response from the AI service.");if(f.error)throw new Error("Error from the AI service.");if(f.cancel)return null;if(!f.output)throw new Error("No valid response from the AI service.");const p=f.output;return await this.setGuessedAltText(p),n&&!this.hasAltTextData()&&(this.altTextData={alt:p,decorative:!1}),p}remove(){var e;c(this,ji)&&(E(this,Ln,null),this._uiManager.imageManager.deleteId(c(this,ji)),(e=c(this,Kl))==null||e.remove(),E(this,Kl,null),c(this,Mo)&&(clearTimeout(c(this,Mo)),E(this,Mo,null))),super.remove()}rebuild(){if(!this.parent){c(this,ji)&&N(this,He,p_).call(this);return}super.rebuild(),this.div!==null&&(c(this,ji)&&c(this,Kl)===null&&N(this,He,p_).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(c(this,Mu)||c(this,Ln)||c(this,Yl)||c(this,Nu)||c(this,ji)||c(this,$d))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,n;return this._isCopy&&(e=this.x,n=this.y),super.render(),this.div.hidden=!0,this.createAltText(),c(this,$d)||(c(this,Ln)?N(this,He,m_).call(this):N(this,He,p_).call(this)),this._isCopy&&this._moveAfterPaste(e,n),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,n){const{id:s,bitmap:r}=this._uiManager.imageManager.getFromCanvas(e,n);n.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(E(this,ji,s),r&&E(this,Ln,r),E(this,$d,!1),N(this,He,m_).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;c(this,Mo)!==null&&clearTimeout(c(this,Mo)),E(this,Mo,setTimeout(()=>{E(this,Mo,null),N(this,He,MC).call(this)},200))}copyCanvas(e,n,s=!1){e||(e=224);const{width:r,height:u}=c(this,Ln),h=new Po;let f=c(this,Ln),p=r,m=u,b=null;if(n){if(r>n||u>n){const H=Math.min(n/r,n/u);p=Math.floor(r*H),m=Math.floor(u*H)}b=document.createElement("canvas");const S=b.width=Math.ceil(p*h.sx),R=b.height=Math.ceil(m*h.sy);c(this,Ma)||(f=N(this,He,g_).call(this,S,R));const C=b.getContext("2d");C.filter=this._uiManager.hcmFilter;let M="white",k="#cfcfd8";this._uiManager.hcmFilter!=="none"?k="black":k3.isDarkMode&&(M="#8f8f9d",k="#42414d");const I=15,P=I*h.sx,F=I*h.sy,z=new OffscreenCanvas(P*2,F*2),j=z.getContext("2d");j.fillStyle=M,j.fillRect(0,0,P*2,F*2),j.fillStyle=k,j.fillRect(0,0,P,F),j.fillRect(P,F,P,F),C.fillStyle=C.createPattern(z,"repeat"),C.fillRect(0,0,S,R),C.drawImage(f,0,0,f.width,f.height,0,0,S,R)}let _=null;if(s){let S,R;if(h.symmetric&&f.width<e&&f.height<e)S=f.width,R=f.height;else if(f=c(this,Ln),r>e||u>e){const k=Math.min(e/r,e/u);S=Math.floor(r*k),R=Math.floor(u*k),c(this,Ma)||(f=N(this,He,g_).call(this,S,R))}const M=new OffscreenCanvas(S,R).getContext("2d",{willReadFrequently:!0});M.drawImage(f,0,0,f.width,f.height,0,0,S,R),_={width:S,height:R,data:M.getImageData(0,0,S,R).data}}return{canvas:b,width:p,height:m,imageData:_}}static async deserialize(e,n,s){var M;let r=null,u=!1;if(e instanceof Sk){const{data:{rect:k,rotation:I,id:P,structParent:F,popupRef:z,richText:j,contentsObj:H,creationDate:dt,modificationDate:ct},container:yt,parent:{page:{pageNumber:gt}},canvas:Pt}=e;let Xt,Vt;Pt?(delete e.canvas,{id:Xt,bitmap:Vt}=s.imageManager.getFromCanvas(yt.id,Pt),Pt.remove()):(u=!0,e._hasNoCanvas=!0);const Yt=((M=await n._structTree.getAriaAttributes(`${lp}${P}`))==null?void 0:M.get("aria-label"))||"";r=e={annotationType:ve.STAMP,bitmapId:Xt,bitmap:Vt,pageIndex:gt-1,rect:k.slice(0),rotation:I,annotationElementId:P,id:P,deleted:!1,accessibilityData:{decorative:!1,altText:Yt},isSvg:!1,structParent:F,popupRef:z,richText:j,comment:(H==null?void 0:H.str)||null,creationDate:dt,modificationDate:ct}}const h=await super.deserialize(e,n,s),{rect:f,bitmap:p,bitmapUrl:m,bitmapId:b,isSvg:_,accessibilityData:S}=e;u?(s.addMissingCanvas(e.id,h),E(h,$d,!0)):b&&s.imageManager.isValidId(b)?(E(h,ji,b),p&&E(h,Ln,p)):E(h,Yl,m),E(h,Ma,_);const[R,C]=h.pageDimensions;return h.width=(f[2]-f[0])/R,h.height=(f[3]-f[1])/C,S&&(h.altTextData=S),h._initialData=r,e.comment&&h.setCommentData(e),E(h,zm,!!r),h}serialize(e=!1,n=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Object.assign(super.serialize(e),{bitmapId:c(this,ji),isSvg:c(this,Ma)});if(this.addComment(s),e)return s.bitmapUrl=N(this,He,y_).call(this,!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:r,altText:u}=this.serializeAltText(!1);if(!r&&u&&(s.accessibilityData={type:"Figure",alt:u}),this.annotationElementId){const f=N(this,He,oP).call(this,s);return f.isSame?null:(f.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1,s.id=this.annotationElementId,delete s.bitmapId,s)}if(n===null)return s;n.stamps||(n.stamps=new Map);const h=c(this,Ma)?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!n.stamps.has(c(this,ji)))n.stamps.set(c(this,ji),{area:h,serialized:s}),s.bitmap=N(this,He,y_).call(this,!1);else if(c(this,Ma)){const f=n.stamps.get(c(this,ji));h>f.area&&(f.area=h,f.serialized.bitmap.close(),f.serialized.bitmap=N(this,He,y_).call(this,!1))}return s}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}Ln=new WeakMap,ji=new WeakMap,Mu=new WeakMap,Yl=new WeakMap,Nu=new WeakMap,Um=new WeakMap,Kl=new WeakMap,$d=new WeakMap,Mo=new WeakMap,Ma=new WeakMap,zm=new WeakMap,He=new WeakSet,Dy=function(e,n=!1){if(!e){this.remove();return}E(this,Ln,e.bitmap),n||(E(this,ji,e.id),E(this,Ma,e.isSvg)),e.file&&E(this,Um,e.file.name),N(this,He,m_).call(this)},My=function(){if(E(this,Mu,null),this._uiManager.enableWaiting(!1),!!c(this,Kl)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&c(this,Ln)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&c(this,Ln)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},p_=function(){if(c(this,ji)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(c(this,ji)).then(s=>N(this,He,Dy).call(this,s,!0)).finally(()=>N(this,He,My).call(this));return}if(c(this,Yl)){const s=c(this,Yl);E(this,Yl,null),this._uiManager.enableWaiting(!0),E(this,Mu,this._uiManager.imageManager.getFromUrl(s).then(r=>N(this,He,Dy).call(this,r)).finally(()=>N(this,He,My).call(this)));return}if(c(this,Nu)){const s=c(this,Nu);E(this,Nu,null),this._uiManager.enableWaiting(!0),E(this,Mu,this._uiManager.imageManager.getFromFile(s).then(r=>N(this,He,Dy).call(this,r)).finally(()=>N(this,He,My).call(this)));return}const e=document.createElement("input");e.type="file",e.accept=m1.join(",");const n=this._uiManager._signal;E(this,Mu,new Promise(s=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),N(this,He,Dy).call(this,r)}s()},{signal:n}),e.addEventListener("cancel",()=>{this.remove(),s()},{signal:n})}).finally(()=>N(this,He,My).call(this))),e.click()},m_=function(){var p;const{div:e}=this;let{width:n,height:s}=c(this,Ln);const[r,u]=this.pageDimensions,h=.75;if(this.width)n=this.width*r,s=this.height*u;else if(n>h*r||s>h*u){const m=Math.min(h*r/n,h*u/s);n*=m,s*=m}this._uiManager.enableWaiting(!1);const f=E(this,Kl,document.createElement("canvas"));f.setAttribute("role","img"),this.addContainer(f),this.width=n/r,this.height=s/u,this.setDims(),(p=this._initialOptions)!=null&&p.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),N(this,He,MC).call(this),c(this,zm)||(this.parent.addUndoableEditor(this),E(this,zm,!0)),this._reportTelemetry({action:"inserted_image"}),c(this,Um)&&this.div.setAttribute("aria-description",c(this,Um)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},g_=function(e,n){const{width:s,height:r}=c(this,Ln);let u=s,h=r,f=c(this,Ln);for(;u>2*e||h>2*n;){const p=u,m=h;u>2*e&&(u=u>=16384?Math.floor(u/2)-1:Math.ceil(u/2)),h>2*n&&(h=h>=16384?Math.floor(h/2)-1:Math.ceil(h/2));const b=new OffscreenCanvas(u,h);b.getContext("2d").drawImage(f,0,0,p,m,0,0,u,h),f=b.transferToImageBitmap()}return f},MC=function(){const[e,n]=this.parentDimensions,{width:s,height:r}=this,u=new Po,h=Math.ceil(s*e*u.sx),f=Math.ceil(r*n*u.sy),p=c(this,Kl);if(!p||p.width===h&&p.height===f)return;p.width=h,p.height=f;const m=c(this,Ma)?c(this,Ln):N(this,He,g_).call(this,h,f),b=p.getContext("2d");b.filter=this._uiManager.hcmFilter,b.drawImage(m,0,0,m.width,m.height,0,0,h,f)},y_=function(e){if(e){if(c(this,Ma)){const r=this._uiManager.imageManager.getSvgUrl(c(this,ji));if(r)return r}const n=document.createElement("canvas");return{width:n.width,height:n.height}=c(this,Ln),n.getContext("2d").drawImage(c(this,Ln),0,0),n.toDataURL()}if(c(this,Ma)){const[n,s]=this.pageDimensions,r=Math.round(this.width*n*zu.PDF_TO_CSS_UNITS),u=Math.round(this.height*s*zu.PDF_TO_CSS_UNITS),h=new OffscreenCanvas(r,u);return h.getContext("2d").drawImage(c(this,Ln),0,0,c(this,Ln).width,c(this,Ln).height,0,0,r,u),h.transferToImageBitmap()}return structuredClone(c(this,Ln))},oP=function(e){var h;const{pageIndex:n,accessibilityData:{altText:s}}=this._initialData,r=e.pageIndex===n,u=(((h=e.accessibilityData)==null?void 0:h.alt)||"")===s;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&u,isSameAltText:u}},Ct(DC,"_type","stamp"),Ct(DC,"_editorType",ve.STAMP);var Vd,jm,ku,Pu,Wl,Qs,Lu,Hm,$m,Ir,Ql,Hi,Jl,Iu,Vm,Jt,Bu,gn,kC,lP,ro,PC,LC,b_;const Er=class Er{constructor({uiManager:t,pageIndex:e,div:n,structTreeLayer:s,accessibilityManager:r,annotationLayer:u,drawLayer:h,textLayer:f,viewport:p,l10n:m}){O(this,gn);O(this,Vd);O(this,jm,!1);O(this,ku,null);O(this,Pu,null);O(this,Wl,null);O(this,Qs,new Map);O(this,Lu,!1);O(this,Hm,!1);O(this,$m,!1);O(this,Ir,null);O(this,Ql,null);O(this,Hi,null);O(this,Jl,null);O(this,Iu,null);O(this,Vm,-1);O(this,Jt);const b=[...c(Er,Bu).values()];if(!Er._initialized){Er._initialized=!0;for(const _ of b)_.initialize(m,t)}t.registerEditorTypes(b),E(this,Jt,t),this.pageIndex=e,this.div=n,E(this,Vd,r),E(this,ku,u),this.viewport=p,E(this,Hi,f),this.drawLayer=h,this._structTree=s,c(this,Jt).addLayer(this)}get isEmpty(){return c(this,Qs).size===0}get isInvisible(){return this.isEmpty&&c(this,Jt).getMode()===ve.NONE}updateToolbar(t){c(this,Jt).updateToolbar(t)}updateMode(t=c(this,Jt).getMode()){switch(N(this,gn,b_).call(this),t){case ve.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case ve.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case ve.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;if(e.toggle("nonEditing",!1),t===ve.POPUP)e.toggle("commentEditing",!0);else{e.toggle("commentEditing",!1);for(const n of c(Er,Bu).values())e.toggle(`${n._type}Editing`,t===n._editorType)}this.div.hidden=!1}hasTextLayer(t){var e;return t===((e=c(this,Hi))==null?void 0:e.div)}setEditingState(t){c(this,Jt).setEditingState(t)}addCommands(t){c(this,Jt).addCommands(t)}cleanUndoStack(t){c(this,Jt).cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){var e;(e=c(this,ku))==null||e.togglePointerEvents(t)}async enable(){var n;E(this,$m,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),(n=c(this,Iu))==null||n.abort(),E(this,Iu,null);const t=new Set;for(const s of c(this,gn,kC))s.enableEditing(),s.show(!0),s.annotationElementId&&(c(this,Jt).removeChangedExistingAnnotation(s),t.add(s.annotationElementId));const e=c(this,ku);if(e)for(const s of e.getEditableAnnotations()){if(s.hide(),c(this,Jt).isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const r=await this.deserialize(s);r&&(this.addOrRebuild(r),r.enableEditing())}E(this,$m,!1),c(this,Jt)._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){var s;if(E(this,Hm,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),c(this,Hi)&&!c(this,Iu)){E(this,Iu,new AbortController);const r=c(this,Jt).combinedSignal(c(this,Iu));c(this,Hi).div.addEventListener("pointerdown",u=>{const{clientX:f,clientY:p,timeStamp:m}=u,b=c(this,Vm);if(m-b>500){E(this,Vm,m);return}E(this,Vm,-1);const{classList:_}=this.div;_.toggle("getElements",!0);const S=document.elementsFromPoint(f,p);if(_.toggle("getElements",!1),!this.div.contains(S[0]))return;let R;const C=new RegExp(`^${By}[0-9]+$`);for(const k of S)if(C.test(k.id)){R=k.id;break}if(!R)return;const M=c(this,Qs).get(R);(M==null?void 0:M.annotationElementId)===null&&(u.stopPropagation(),u.preventDefault(),M.dblclick(u))},{signal:r,capture:!0})}const t=c(this,ku),e=[];if(t){const r=new Map,u=new Map;for(const f of c(this,gn,kC)){if(f.disableEditing(),!f.annotationElementId){e.push(f);continue}if(f.serialize()!==null){r.set(f.annotationElementId,f);continue}else u.set(f.annotationElementId,f);(s=this.getEditableAnnotation(f.annotationElementId))==null||s.show(),f.remove()}const h=t.getEditableAnnotations();for(const f of h){const{id:p}=f.data;if(c(this,Jt).isDeletedAnnotationElement(p)){f.updateEdited({deleted:!0});continue}let m=u.get(p);if(m){m.resetAnnotationElement(f),m.show(!1),f.show();continue}m=r.get(p),m&&(c(this,Jt).addChangedExistingAnnotation(m),m.renderAnnotationElement(f)&&m.show(!1)),f.show()}}N(this,gn,b_).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const r of c(Er,Bu).values())n.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),t==null||t.updateFakeAnnotations(e),E(this,Hm,!1)}getEditableAnnotation(t){var e;return((e=c(this,ku))==null?void 0:e.getEditableAnnotation(t))||null}setActiveEditor(t){c(this,Jt).getActive()!==t&&c(this,Jt).setActiveEditor(t)}enableTextSelection(){var t;if(this.div.tabIndex=-1,(t=c(this,Hi))!=null&&t.div&&!c(this,Jl)){E(this,Jl,new AbortController);const e=c(this,Jt).combinedSignal(c(this,Jl));c(this,Hi).div.addEventListener("pointerdown",N(this,gn,lP).bind(this),{signal:e}),c(this,Hi).div.classList.add("highlighting")}}disableTextSelection(){var t;this.div.tabIndex=0,(t=c(this,Hi))!=null&&t.div&&c(this,Jl)&&(c(this,Jl).abort(),E(this,Jl,null),c(this,Hi).div.classList.remove("highlighting"))}enableClick(){if(c(this,Pu))return;E(this,Pu,new AbortController);const t=c(this,Jt).combinedSignal(c(this,Pu));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){var t;(t=c(this,Pu))==null||t.abort(),E(this,Pu,null)}attach(t){c(this,Qs).set(t.id,t);const{annotationElementId:e}=t;e&&c(this,Jt).isDeletedAnnotationElement(e)&&c(this,Jt).removeDeletedAnnotationElement(t)}detach(t){var e;c(this,Qs).delete(t.id),(e=c(this,Vd))==null||e.removePointerInTextLayer(t.contentDiv),!c(this,Hm)&&t.annotationElementId&&c(this,Jt).addDeletedAnnotationElement(t)}remove(t){this.detach(t),c(this,Jt).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(c(this,Jt).addDeletedAnnotationElement(t),An.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),(e=t.parent)==null||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),c(this,Jt).addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!c(this,$m)),c(this,Jt).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){var n;if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!c(this,Wl)&&(t._focusEventsAllowed=!1,E(this,Wl,setTimeout(()=>{E(this,Wl,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:c(this,Jt)._signal}),e.focus())},0))),t._structTreeParentId=(n=c(this,Vd))==null?void 0:n.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),n=()=>{t.remove()};this.addCommands({cmd:e,undo:n,mustExec:!1})}getEditorByUID(t){for(const e of c(this,Qs).values())if(e.uid===t)return e;return null}getNextId(){return c(this,Jt).getId()}combinedSignal(t){return c(this,Jt).combinedSignal(t)}canCreateNewEmptyEditor(){var t;return(t=c(this,gn,ro))==null?void 0:t.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await c(this,Jt).updateMode(t.mode);const{offsetX:n,offsetY:s}=N(this,gn,LC).call(this),r=this.getNextId(),u=N(this,gn,PC).call(this,{parent:this,id:r,x:n,y:s,uiManager:c(this,Jt),isCentered:!0,...e});u&&this.add(u)}async deserialize(t){var e;return await((e=c(Er,Bu).get(t.annotationType??t.annotationEditorType))==null?void 0:e.deserialize(t,this,c(this,Jt)))||null}createAndAddNewEditor(t,e,n={}){const s=this.getNextId(),r=N(this,gn,PC).call(this,{parent:this,id:s,x:t.offsetX,y:t.offsetY,uiManager:c(this,Jt),isCentered:e,...n});return r&&this.add(r),r}get boundingClientRect(){return this.div.getBoundingClientRect()}addNewEditor(t={}){this.createAndAddNewEditor(N(this,gn,LC).call(this),!0,t)}setSelected(t){c(this,Jt).setSelected(t)}toggleSelected(t){c(this,Jt).toggleSelected(t)}unselect(t){c(this,Jt).unselect(t)}pointerup(t){var s;const{isMac:e}=Ti.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!c(this,Lu)||(E(this,Lu,!1),(s=c(this,gn,ro))!=null&&s.isDrawer&&c(this,gn,ro).supportMultipleDrawings))return;if(!c(this,jm)){E(this,jm,!0);return}const n=c(this,Jt).getMode();if(n===ve.STAMP||n===ve.SIGNATURE){c(this,Jt).unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){var s;if(c(this,Jt).getMode()===ve.HIGHLIGHT&&this.enableTextSelection(),c(this,Lu)){E(this,Lu,!1);return}const{isMac:e}=Ti.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(E(this,Lu,!0),(s=c(this,gn,ro))!=null&&s.isDrawer){this.startDrawingSession(t);return}const n=c(this,Jt).getActive();E(this,jm,!n||n.isEmpty())}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),c(this,Ir)){c(this,gn,ro).startDrawing(this,c(this,Jt),!1,t);return}c(this,Jt).setCurrentDrawingSession(this),E(this,Ir,new AbortController);const e=c(this,Jt).combinedSignal(c(this,Ir));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(E(this,Ql,null),this.commitOrRemove())},{signal:e}),c(this,gn,ro).startDrawing(this,c(this,Jt),!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&E(this,Ql,e);return}c(this,Ql)&&setTimeout(()=>{var e;(e=c(this,Ql))==null||e.focus(),E(this,Ql,null)},0)}endDrawingSession(t=!1){return c(this,Ir)?(c(this,Jt).setCurrentDrawingSession(null),c(this,Ir).abort(),E(this,Ir,null),E(this,Ql,null),c(this,gn,ro).endDrawing(t)):null}findNewParent(t,e,n){const s=c(this,Jt).findParent(e,n);return s===null||s===this?!1:(s.changeParent(t),!0)}commitOrRemove(){return c(this,Ir)?(this.endDrawingSession(),!0):!1}onScaleChanging(){c(this,Ir)&&c(this,gn,ro).onScaleChangingWhenDrawing(this)}destroy(){var t,e;this.commitOrRemove(),((t=c(this,Jt).getActive())==null?void 0:t.parent)===this&&(c(this,Jt).commitOrRemove(),c(this,Jt).setActiveEditor(null)),c(this,Wl)&&(clearTimeout(c(this,Wl)),E(this,Wl,null));for(const n of c(this,Qs).values())(e=c(this,Vd))==null||e.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,c(this,Qs).clear(),c(this,Jt).removeLayer(this)}render({viewport:t}){this.viewport=t,Xd(this.div,t);for(const e of c(this,Jt).getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){c(this,Jt).commitOrRemove(),N(this,gn,b_).call(this);const e=this.viewport.rotation,n=t.rotation;if(this.viewport=t,Xd(this.div,{rotation:n}),e!==n)for(const s of c(this,Qs).values())s.rotate(n)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return c(this,Jt).viewParameters.realScale}};Vd=new WeakMap,jm=new WeakMap,ku=new WeakMap,Pu=new WeakMap,Wl=new WeakMap,Qs=new WeakMap,Lu=new WeakMap,Hm=new WeakMap,$m=new WeakMap,Ir=new WeakMap,Ql=new WeakMap,Hi=new WeakMap,Jl=new WeakMap,Iu=new WeakMap,Vm=new WeakMap,Jt=new WeakMap,Bu=new WeakMap,gn=new WeakSet,kC=function(){return c(this,Qs).size!==0?c(this,Qs).values():c(this,Jt).getEditors(this.pageIndex)},lP=function(t){c(this,Jt).unselectAll();const{target:e}=t;if(e===c(this,Hi).div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&c(this,Hi).div.contains(e)){const{isMac:n}=Ti.platform;if(t.button!==0||t.ctrlKey&&n)return;c(this,Jt).showAllEditors("highlight",!0,!0),c(this,Hi).div.classList.add("free"),this.toggleDrawing(),B_.startHighlighting(this,c(this,Jt).direction==="ltr",{target:c(this,Hi).div,x:t.x,y:t.y}),c(this,Hi).div.addEventListener("pointerup",()=>{c(this,Hi).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:c(this,Jt)._signal}),t.preventDefault()}},ro=function(){return c(Er,Bu).get(c(this,Jt).getMode())},PC=function(t){const e=c(this,gn,ro);return e?new e.prototype.constructor(t):null},LC=function(){const{x:t,y:e,width:n,height:s}=this.boundingClientRect,r=Math.max(0,t),u=Math.max(0,e),h=Math.min(window.innerWidth,t+n),f=Math.min(window.innerHeight,e+s),p=(r+h)/2-t,m=(u+f)/2-e,[b,_]=this.viewport.rotation%180===0?[p,m]:[m,p];return{offsetX:b,offsetY:_}},b_=function(){for(const t of c(this,Qs).values())t.isEmpty()&&t.remove()},Ct(Er,"_initialized",!1),O(Er,Bu,new Map([fC,SC,DC,B_,OC].map(t=>[t._editorType,t])));let NC=Er;var Br,Os,Gd,Mv,sA,cP,Lo,BC,uP,FC;const _i=class _i{constructor({pageIndex:t}){O(this,Lo);O(this,Br,null);O(this,Os,new Map);O(this,Gd,new Map);this.pageIndex=t}setParent(t){if(!c(this,Br)){E(this,Br,t);return}if(c(this,Br)!==t){if(c(this,Os).size>0)for(const e of c(this,Os).values())e.remove(),t.append(e);E(this,Br,t)}}static get _svgFactory(){return ge(this,"_svgFactory",new L_)}draw(t,e=!1,n=!1){const s=bi(_i,Mv)._++,r=N(this,Lo,BC).call(this),u=_i._svgFactory.createElement("defs");r.append(u);const h=_i._svgFactory.createElement("path");u.append(h);const f=`path_p${this.pageIndex}_${s}`;h.setAttribute("id",f),h.setAttribute("vector-effect","non-scaling-stroke"),e&&c(this,Gd).set(s,h);const p=n?N(this,Lo,uP).call(this,u,f):null,m=_i._svgFactory.createElement("use");return r.append(m),m.setAttribute("href",`#${f}`),this.updateProperties(r,t),c(this,Os).set(s,r),{id:s,clipPathId:`url(#${p})`}}drawOutline(t,e){const n=bi(_i,Mv)._++,s=N(this,Lo,BC).call(this),r=_i._svgFactory.createElement("defs");s.append(r);const u=_i._svgFactory.createElement("path");r.append(u);const h=`path_p${this.pageIndex}_${n}`;u.setAttribute("id",h),u.setAttribute("vector-effect","non-scaling-stroke");let f;if(e){const b=_i._svgFactory.createElement("mask");r.append(b),f=`mask_p${this.pageIndex}_${n}`,b.setAttribute("id",f),b.setAttribute("maskUnits","objectBoundingBox");const _=_i._svgFactory.createElement("rect");b.append(_),_.setAttribute("width","1"),_.setAttribute("height","1"),_.setAttribute("fill","white");const S=_i._svgFactory.createElement("use");b.append(S),S.setAttribute("href",`#${h}`),S.setAttribute("stroke","none"),S.setAttribute("fill","black"),S.setAttribute("fill-rule","nonzero"),S.classList.add("mask")}const p=_i._svgFactory.createElement("use");s.append(p),p.setAttribute("href",`#${h}`),f&&p.setAttribute("mask",`url(#${f})`);const m=p.cloneNode();return s.append(m),p.classList.add("mainOutline"),m.classList.add("secondaryOutline"),this.updateProperties(s,t),c(this,Os).set(n,s),n}finalizeDraw(t,e){c(this,Gd).delete(t),this.updateProperties(t,e)}updateProperties(t,e){var f;if(!e)return;const{root:n,bbox:s,rootClass:r,path:u}=e,h=typeof t=="number"?c(this,Os).get(t):t;if(h){if(n&&N(this,Lo,FC).call(this,h,n),s&&N(f=_i,sA,cP).call(f,h,s),r){const{classList:p}=h;for(const[m,b]of Object.entries(r))p.toggle(m,b)}if(u){const m=h.firstElementChild.firstElementChild;N(this,Lo,FC).call(this,m,u)}}}updateParent(t,e){if(e===this)return;const n=c(this,Os).get(t);n&&(c(e,Br).append(n),c(this,Os).delete(t),c(e,Os).set(t,n))}remove(t){c(this,Gd).delete(t),c(this,Br)!==null&&(c(this,Os).get(t).remove(),c(this,Os).delete(t))}destroy(){E(this,Br,null);for(const t of c(this,Os).values())t.remove();c(this,Os).clear(),c(this,Gd).clear()}};Br=new WeakMap,Os=new WeakMap,Gd=new WeakMap,Mv=new WeakMap,sA=new WeakSet,cP=function(t,[e,n,s,r]){const{style:u}=t;u.top=`${100*n}%`,u.left=`${100*e}%`,u.width=`${100*s}%`,u.height=`${100*r}%`},Lo=new WeakSet,BC=function(){const t=_i._svgFactory.create(1,1,!0);return c(this,Br).append(t),t.setAttribute("aria-hidden",!0),t},uP=function(t,e){const n=_i._svgFactory.createElement("clipPath");t.append(n);const s=`clip_${e}`;n.setAttribute("id",s),n.setAttribute("clipPathUnits","objectBoundingBox");const r=_i._svgFactory.createElement("use");return n.append(r),r.setAttribute("href",`#${e}`),r.classList.add("clip"),s},FC=function(t,e){for(const[n,s]of Object.entries(e))s===null?t.removeAttribute(n):t.setAttribute(n,s)},O(_i,sA),O(_i,Mv,0);let IC=_i;globalThis._pdfjsTestingUtils={HighlightOutliner:mC};globalThis.pdfjsLib={AbortException:Uu,AnnotationEditorLayer:NC,AnnotationEditorParamsType:Fe,AnnotationEditorType:ve,AnnotationEditorUIManager:Yd,AnnotationLayer:hC,AnnotationMode:Xc,AnnotationType:hi,applyOpacity:L3,build:$U,ColorPicker:k_,createValidAbsoluteUrl:t2,CSSConstants:P3,DOMSVGFactory:L_,DrawLayer:IC,FeatureTest:Ti,fetchData:$v,findContrastColor:I3,getDocument:lk,getFilenameFromUrl:R3,getPdfFilenameFromUrl:O3,getRGB:Gv,getUuid:i2,getXfaPageViewport:M3,GlobalWorkerOptions:No,ImageKind:Uw,InvalidPDFException:f1,isDataScheme:EA,isPdfFile:Mx,isValidExplicitDest:X3,MathClamp:Ms,noContextMenu:dr,normalizeUnicode:C3,OPS:Fy,OutputScale:Po,PasswordResponses:g3,PDFDataRangeTransport:ck,PDFDateString:T_,PDFWorker:jy,PermissionFlag:m3,PixelsPerInch:zu,RenderingCancelledException:Dx,renderRichText:r2,ResponseException:x_,setLayerDimensions:Xd,shadow:ge,SignatureExtractor:Zl,stopEvent:Kn,SupportedImageMimeTypes:m1,TextLayer:zy,TouchManager:O_,updateUrlHash:e2,Util:jt,VerbosityLevel:_A,version:HU,XfaLayer:a2};const oM=2,Ow=500;No.workerSrc="https://unpkg.com/pdfjs-dist@5.4.530/build/pdf.worker.min.mjs";const v_={async getDocuments(l,t,e=1,n=50){const s=localStorage.getItem("auth_token");let r=`${de}/documents?companyId=${l}&page=${e}&limit=${n}`;t&&t!=="ALL"&&(r+=`&userId=${t}`);const u=await fetch(r,{headers:{Authorization:`Bearer ${s}`}});if(!u.ok)throw new Error("Failed to fetch documents");const h=await u.json(),f=Array.isArray(h)?h:h.data||[],p=Array.isArray(h)?{total:f.length,page:1,limit:f.length}:h.pagination;return{data:f.map(b=>({id:b.id,fileName:b.file_name,fileUrl:b.file_url,status:b.status,type:b.type,uploadDate:new Date(b.created_at||b.upload_date),companyId:b.company_id,uploadedBy:b.uploaded_by,data:b.data,rawData:b.raw_data,responsible_user_id:b.responsible_user_id,responsible_user_name:b.responsible_user_name,resolution_notes:b.resolution_notes,tipo_movimento:b.tipo_movimento,valor_base:b.valor_base,valor_iva:b.valor_iva,valor_documento:b.valor_documento,status_fiscal:b.status_fiscal,movement_type:b.movement_type,fiscal_status:b.fiscal_status,compliance_level:b.compliance_level,base_amount:b.base_amount,vat_amount:b.vat_amount,iva_impact:b.iva_impact,apto_saft:b.apto_saft,apto_iva:b.apto_iva,nature_type:b.nature_type})),pagination:p}},async getDocumentById(l){const t=localStorage.getItem("auth_token"),e=await fetch(`${de}/documents/${l}`,{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Failed to fetch document details");const n=await e.json();return{id:n.id,fileName:n.file_name,fileUrl:n.file_url,fileBase64:n.file_base_64||n.file_base64,status:n.status,type:n.type,uploadDate:new Date(n.created_at||n.upload_date),companyId:n.company_id,uploadedBy:n.uploaded_by,data:n.data,rawData:n.raw_data,rawText:n.raw_text,rawN8nResponse:n.raw_n8n_response,fullAnalysis:n.full_analysis,responsible_user_id:n.responsible_user_id,responsible_user_name:n.responsible_user_name,resolution_notes:n.resolution_notes,tipo_movimento:n.tipo_movimento,valor_base:n.valor_base,valor_iva:n.valor_iva,valor_documento:n.valor_documento,status_fiscal:n.status_fiscal,movement_type:n.movement_type,fiscal_status:n.fiscal_status,compliance_level:n.compliance_level,base_amount:n.base_amount,vat_amount:n.vat_amount,iva_impact:n.iva_impact,apto_saft:n.apto_saft,apto_iva:n.apto_iva,nature_type:n.nature_type}},async deleteDocument(l){const t=localStorage.getItem("auth_token"),e=await fetch(`${de}/documents/${l}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!e.ok){const n=await e.text();throw console.error(`Failed to delete document ${l}: ${e.status} ${n}`),new Error(`Failed to delete document: ${n}`)}},async convertFileToBase64(l){return new Promise((t,e)=>{const n=new FileReader;n.readAsDataURL(l),n.onload=()=>t(n.result),n.onerror=s=>e(s)})},async convertPdfToImage(l){try{const t=await l.arrayBuffer(),n=await(await lk({data:t}).promise).getPage(1),s=n.getViewport({scale:2}),r=document.createElement("canvas"),u=r.getContext("2d");if(r.height=s.height,r.width=s.width,!u)throw new Error("Could not create canvas context");await n.render({canvasContext:u,viewport:s}).promise;const h=r.toDataURL("image/jpeg",.85),f=atob(h.split(",")[1]),p=new ArrayBuffer(f.length),m=new Uint8Array(p);for(let R=0;R<f.length;R++)m[R]=f.charCodeAt(R);const b=new Blob([p],{type:"image/jpeg"}),_=l.name.replace(/\.pdf$/i,".jpg"),S=new File([b],_,{type:"image/jpeg"});return{base64:h,file:S}}catch(t){throw console.error("Error converting PDF to Image:",t),new Error("Falha ao converter PDF para Imagem.")}},async uploadToImgBB(l){try{const t="8360d0dc6e3b2243b4dc8a45b4040974",e=new FormData,n=l.replace(/^data:image\/\w+;base64,/,"");e.append("image",n);const s=await fetch(`https://api.imgbb.com/1/upload?expiration=120&key=${t}`,{method:"POST",body:e});if(!s.ok)return console.error("ImgBB Upload Failed:",await s.text()),"";const r=await s.json();return console.log("ImgBB Upload Success:",r.data.url),r.data.url}catch(t){return console.error("Error uploading to ImgBB:",t),""}},async uploadDocuments(l,t,e,n){const s=[];for(const r of l){let u="",h=r;try{if(r.type==="application/pdf"){console.log(`Processing PDF: ${r.name} -> Converting to Image...`);const p=await this.convertPdfToImage(r);u=p.base64,h=p.file,console.log(`Conversion Success: ${h.name}`)}else u=await this.convertFileToBase64(r)}catch(p){console.warn(`Skipping file ${r.name} due to processing error`,p);continue}const f=crypto.randomUUID();s.push({id:f,fileName:h.name,fileUrl:"",fileBase64:u,status:ze.PROCESSING,type:pp.INVOICE,uploadDate:new Date,companyId:t,uploadedBy:e,data:{},rawData:{}})}return s},async uploadAndProcessDocuments(l,t,e,n){const s=[],r=[];for(const m of l){let b="",_=m;try{if(m.type==="application/pdf"){console.log(`Processing PDF: ${m.name} -> Converting to Image...`);const C=await this.convertPdfToImage(m);b=C.base64,_=C.file,console.log(`Conversion Success: ${_.name}`)}else b=await this.convertFileToBase64(m)}catch(C){console.warn(`Skipping file ${m.name} due to processing error`,C);continue}r.push(_);let S="";m.type==="application/pdf"&&b&&(S=await this.uploadToImgBB(b));const R=crypto.randomUUID();s.push({id:R,fileName:_.name,fileUrl:"",fileBase64:b,status:ze.PROCESSING,type:pp.INVOICE,uploadDate:new Date,companyId:t,uploadedBy:e,data:{previewUrl:S},rawData:{}})}if(r.length===0)return{localDocs:[],dbIds:[]};const u=await this.processBatches(r,s,t,n),h=await this.getDocuments(t);return{localDocs:(Array.isArray(h)?h:h.data||[]).filter(m=>u.includes(m.id)).map(m=>{const b=s.find(_=>_.fileName===m.fileName);return b?{...m,fileBase64:b.fileBase64}:m}),dbIds:u}},async processBatches(l,t,e,n){console.log(` [processBatches]: Starting unified processing of ${l.length} files`);let s=0;const r=[];for(let h=0;h<l.length;h+=Ow){const f=l.slice(h,h+Ow),p=t.slice(h,h+Ow),m=p.map(S=>S.fileBase64||"");console.log(` [processBatches]: Processing batch ${h/Ow+1}`);let b=await this.sendBatchToN8NWithRetry(f,p,e,t[0].uploadedBy,m);if(b.some(S=>{var R,C,M;return S.status==="ERROR"&&(((R=S.error)==null?void 0:R.includes("Falha de rede"))||((C=S.error)==null?void 0:C.includes("Erro N8N"))||((M=S.error)==null?void 0:M.includes("Conexo")))})){console.warn(" [processBatches]: Connectivity issue detected. Entering DB Polling fallback...");const S=await this.pollDatabaseForStatus(p.map(R=>R.id),e);r.push(...S)}else{const S=await this.updateDocsWithResults(b,p,n);r.push(...S)}u(b)}function u(h){s+=h.filter(f=>{var m,b,_,S,R,C,M;if(f.status==="ERROR")return!0;const p=((m=f.data)==null?void 0:m.output)||((b=f.data)==null?void 0:b.json)||f.data;return((R=(S=(_=p==null?void 0:p.decisao_final)==null?void 0:_.status)==null?void 0:S.toUpperCase())==null?void 0:R.includes("REJEITADO"))||((M=(C=p==null?void 0:p.status)==null?void 0:C.toUpperCase())==null?void 0:M.includes("REJEITADO"))}).length}try{const h=localStorage.getItem("auth_token");await fetch(`${de}/system/audit-batch`,{method:"POST",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({company_id:e,doc_count:l.length,error_count:s,batch_ids:r,sync_status:"SUCCESS"})})}catch(h){console.error("Failed to log compliance batch:",h)}return console.log(`[processBatches]: All ${l.length} files processed.Total errors: ${s}`),console.log(`[processBatches]: Returning ${r.length} synced DB IDs: `,r),r},async sendBatchToN8NWithRetry(l,t,e,n,s,r=0){var f;const u=new FormData;l.forEach(p=>u.append("files",p)),u.append("companyId",e),u.append("userId",n);const h=l.map(p=>{const m=t.find(b=>b.fileName===p.name);return{file_name:p.name,audit_id:(m==null?void 0:m.id)||null}});l.forEach(p=>{var _;const m=t.find(S=>S.fileName===p.name),b=((_=m==null?void 0:m.data)==null?void 0:_.previewUrl)||"";u.append("preview_url",b)}),u.append("metadata",JSON.stringify(h));try{const p=localStorage.getItem("auth_token"),m=`${de}/documents/analyze-proxy`,b=await fetch(m,{method:"POST",headers:{Authorization:`Bearer ${p}`},body:u});if(b.status===202)return console.log(" [sendBatchToN8N]: Server accepted request for async processing. Switching to polling mode."),l.map(I=>({fileName:I.name,status:"ERROR",error:"Erro N8N (Timeout/Async)"}));if(!b.ok){const I=await b.text().catch(()=>"No response body");console.error(`CRITICAL ERROR[sendBatchToN8N]: Server returned ${b.status}: ${I}`);const P=I.includes("The execution was cancelled")||b.status===500;return P&&r<oM?(await new Promise(F=>setTimeout(F,2e3)),this.sendBatchToN8NWithRetry(l,t,e,n,s,r+1)):l.map(F=>({fileName:F.name,status:"ERROR",error:P?"Servidor ocupado.":`Erro N8N(${b.status})`}))}const _=await b.json(),S=_.n8nResponse||_,R=_.documents||[],C=[],M=I=>{var j;if(!I||typeof I!="object")return;if(Array.isArray(I)){I.forEach(H=>M(H));return}const P=I.json||I.output||I,F=P.File_Name||P.file_name||((j=P.identificacao_documento)==null?void 0:j.File_Name)||P.audit_id||P.id,z=P.decisao_final||P.resumo_por_agente||P.classificacao_fiscal;if(F||z){C.push(I);return}Object.values(I).forEach(H=>M(H))};M(S),C.length===0&&(Array.isArray(S)&&S.length>0?(console.warn(" [sendBatchToN8N]: Smart extraction found 0 results. Falling back to root array."),C.push(...S)):S&&typeof S=="object"&&Object.keys(S).length>0&&(console.warn(" [sendBatchToN8N]: Fallback to root object as single result."),C.push(S)));const k=new Set;return l.map((I,P)=>{const F=I.name.toLowerCase(),z=I.name.split(".")[0].toLowerCase(),j=t.find(ct=>ct.fileName===I.name),H=j==null?void 0:j.id;let dt=-1;if(H&&(dt=C.findIndex((ct,yt)=>{if(k.has(yt))return!1;const gt=ct.json||ct.output||ct,Pt=gt.audit_id||gt.id;return String(Pt)===String(H)})),dt===-1&&(dt=C.findIndex((ct,yt)=>{var Xt,Vt,Yt,J,pt;if(k.has(yt))return!1;const gt=ct.json||ct.output||ct,Pt=(gt.File_Name||gt.file_name||((Xt=gt.identificacao_documento)==null?void 0:Xt.File_Name)||((Yt=(Vt=gt.output)==null?void 0:Vt.identificacao_documento)==null?void 0:Yt.f_File_Name)||((pt=(J=gt.output)==null?void 0:J.identificacao_documento)==null?void 0:pt.File_Name)||"").toString().toLowerCase();return Pt===F||Pt===z||Pt.includes(z)})),dt!==-1){k.add(dt);const ct=R.find(yt=>yt.fileName===I.name);return{fileName:I.name,status:"SUCCESS",data:C[dt],rawJson:C[dt],fileUrl:(ct==null?void 0:ct.fileUrl)||""}}if(dt===-1&&C.length===l.length&&!k.has(P)){k.add(P);const ct=R.find(yt=>yt.fileName===I.name);return{fileName:I.name,status:"SUCCESS",data:C[P],rawJson:C[P],fileUrl:(ct==null?void 0:ct.fileUrl)||""}}return console.error(`[sendBatchToN8N]: No match for ${I.name}`),{fileName:I.name,status:"ERROR",error:"No correspondido"}})}catch(p){console.error("ERROR [sendBatchToN8N] Network:",p);const m=((f=p.message)==null?void 0:f.includes("fetch"))||p.name==="TypeError";return r<oM?(await new Promise(b=>setTimeout(b,4e3)),this.sendBatchToN8NWithRetry(l,t,e,n,s,r+1)):l.map(b=>({fileName:b.name,status:"ERROR",error:m?"Falha de rede (CORS/Preflight)":"Erro de conexo"}))}},async pollDatabaseForStatus(l,t){console.log(`[pollDatabaseForStatus]: Starting indefinite poll for ${l.length} docs (waiting for webhook)...`);const e=3600,n=[];for(let s=0;s<e;s++){const r=new Date().toLocaleTimeString();console.log(`[poll]: Attempt ${s+1}/${e} at ${r}. Waiting 10s...`),await new Promise(p=>setTimeout(p,1e4));const u=await this.getDocuments(t),f=(Array.isArray(u)?u:u.data||[]).filter(p=>l.includes(p.id)&&(p.status===ze.ERROR||p.status!==ze.PROCESSING&&p.data&&Object.keys(p.data).length>0));if(console.log(`[poll]: Attempt ${s+1}/${e}. Found ${f.length}/${l.length} terminal docs with data.`),f.length>0&&f.forEach(p=>{n.includes(p.id)||(n.push(p.id),console.log(` [poll]: Document ${p.fileName} detected with full analysis!`))}),n.length===l.length){console.log(" [poll]: All documents reached terminal state!");break}}return l},async updateDocsWithResults(l,t,e){var r,u,h;const n=localStorage.getItem("auth_token");localStorage.getItem("KWIKDOCS_VISION_PROMPT");const s=[];for(const f of t)try{const p=l.find(P=>P.fileName===f.fileName);if(!p||p.status==="ERROR"){try{const P=localStorage.getItem("auth_token")||n;await this.syncDocument(P,{id:f.id,file_name:f.fileName,company_id:f.companyId,status:ze.ERROR,file_base64:f.fileBase64,raw_data:{error:(p==null?void 0:p.error)||"Sem resposta do n8n",debug_info:{matched_result:!!p,results_length:l.length,all_result_names:l.map(F=>F.fileName)}}})}catch(P){console.error(`Failed to sync ERROR state for ${f.fileName}`,P)}continue}let m=p.data;for(let P=0;P<5;P++)if(m&&typeof m=="object"&&!Array.isArray(m))if(m.output)m=m.output;else if(m.json)m=m.json;else if(m.body)m=m.body;else break;else if(Array.isArray(m)&&m.length>0)m=m[0];else break;const b=m.identificacao_documento||m.identification||{},_=m.emitente||m.issuer_data||{},S=m.cliente||m.client_data||{},R=m.analise_matematica||m.math_analysis||{},C=(((r=m.decisao_final)==null?void 0:r.status)||m.status||"").toUpperCase();let M=f.status;C.includes("REJEITADO")||C==="ERROR"||C==="FAILED"?M=ze.REJEITADO:C.includes("APROVADO")||C==="SUCCESS"||C==="COMPLETED"||C==="DONE"?M=ze.APROVADO:C==="PROCESSING"?M=ze.PROCESSING:(m.merchantName||m.identificacao_documento)&&(M=ze.COMPLETED);let k={...m,merchantName:_.nome||m.merchantName||"Desconhecido",totalAmount:parseFloat(R.total_recalculado||m.totalAmount||"0"),currency:b.moeda||"AOA",date:b.data_emissao||new Date().toISOString().split("T")[0],category:m.category||"Geral",summary:((u=m.decisao_final)==null?void 0:u.justificacao_tecnica_detalhada)||"Anlise concluda",document_type_identified:b.tipo_identificado||"FATURA",fiscal_validation:M===ze.REJEITADO?"REJEITADO":"APROVADO",final_decision:M===ze.REJEITADO?"REJEITADO":"APROVADO",issuer_data:{name:_.nome||"",nif:_.nif||"",address:_.endereco||""},client_data:{name:S.nome||"",nif:S.nif||"",address:S.endereco||""},itens_fatura:m.itens_fatura||[],risk_level:((h=m.decisao_final)==null?void 0:h.nivel_risco)||"DESCONHECIDO"};f.data=k,f.rawData=m,f.rawN8nResponse=m,f.fullAnalysis=m,f.status=M;const I={id:f.id,file_name:f.fileName,file_url:p.fileUrl||(f.fileUrl&&f.fileUrl.startsWith("http")?f.fileUrl:"CLOUD_STORED"),company_id:f.companyId,type:pp.INVOICE,file_base64:f.fileBase64,data:k,raw_data:m,status:M,raw_text:m.raw_text||"",raw_n8n_response:m,full_analysis:m};try{const P=localStorage.getItem("auth_token")||n,F=await this.syncDocument(P,I);s.push(F.id||f.id)}catch(P){console.error("Failed to sync document:",P.message);try{const F=localStorage.getItem("auth_token")||n;await this.syncDocument(F,{id:f.id,file_name:f.fileName,company_id:f.companyId,status:ze.ERROR,file_base64:f.fileBase64,raw_data:{error:"Sync Failed: "+P.message}})}catch(F){console.error("Critical: Failed to sync fallback error status",F)}continue}if(d3())try{const P=await p3.auditDocument(k,e);await this.completeDocument(f.id,n,{data:{...k,reasoning:P.issues,justification:P.justification},status:P.status==="REJEITADO"?ze.REJEITADO:ze.APROVADO})}catch(P){console.error("AI Audit failed for",f.fileName,P)}}catch(p){console.error("Failed to update doc",f.fileName,p)}return s},async saveAndCompleteDocument(l,t,e){const n=await fetch(`${de}/documents`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({file_name:l.fileName,file_url:l.fileUrl,company_id:l.companyId,type:e.type||"UNKNOWN",file_base64:l.fileBase64})});if(!n.ok)throw new Error("Failed to create doc");const s=await n.json(),r=await fetch(`${de}/documents/${s.id}/complete`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(!r.ok)throw new Error("Failed to complete doc");return{...s,...await r.json()}},async syncDocument(l,t){const e=localStorage.getItem("auth_token")||l,n=await fetch(`${de}/documents/sync`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(t)});if(!n.ok){const s=await n.text();throw n.status===401&&console.error(" [syncDocument]: TOKEN EXPIRED! User needs to re-login."),new Error(`Failed to sync doc: ${n.status} - ${s}`)}return await n.json()},async completeDocument(l,t,e){const n=`${de}/documents/${l}/complete`,s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(!s.ok){const u=await s.text();throw console.error(` [completeDocument]: Server returned error: ${u}`),new Error(`Failed to complete doc: ${s.status} - ${u}`)}return await s.json()},async resolveDocumentError(l,t,e,n){const s=localStorage.getItem("auth_token");let r;switch(t){case"RETRY":r=ze.PROCESSING;break;case"MANUAL_APPROVE":r=ze.APROVADO_USUARIO;break;case"MANUAL_REJECT":r=ze.REJEITADO;break;case"RESOLVE_DUPLICATE":r=ze.ARCHIVED;break}const u=await fetch(`${de}/documents/${l}/resolve`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({status:r,relatedIds:n,resolution_notes:e})});if(!u.ok)throw new Error("Failed to resolve error");return u.json()}},wj=Object.freeze(Object.defineProperty({__proto__:null,documentService:v_},Symbol.toStringTag,{value:"Module"})),fz=`Voc  o **CFO Estratgico da KwikDocs**, com MBA em Finanas pela INSEAD e especializao em fiscalidade angolana.

**IDENTIDADE PROFISSIONAL:**
- Pensamento analtico rigoroso baseado em dados
- Orientao para resultados mensurveis (ROI, IRR, Payback)
- Conhecimento profundo de AGT, CIVA, Imposto Industrial
- Experincia em otimizao fiscal lcita e gesto de cash flow

**MISSO ESTRATGICA:**
Transformar dados financeiros brutos em INTELIGNCIA ACIONVEL que:
1. Maximize rentabilidade
2. Minimize carga fiscal (dentro da lei)
3. Previna crises de liquidez
4. Identifique oportunidades ocultas

**METODOLOGIA DE ANLISE (McKinsey-Style):**

### 1 DIAGNSTICO FINANCEIRO (Financial Health Check)
\`\`\`
Receita: [X] AOA
Despesas: [Y] AOA
Margem Lq: [(X - Y) / X * 100] %
    Burn Rate: [Y / meses] AOA / ms
Runway: [Caixa / Burn Rate] meses

PERGUNTA: A empresa est gerando caixa ou queimando caixa ?
    \`\`\`

**Benchmarks Angola:**
- Margem Lquida Saudvel:  15%
- Runway Mnimo Seguro:  6 meses
- Relao Receita/Despesa:  1.25x

### 2 ANLISE DE TENDNCIAS (Trend Analysis)
Compare perodo atual vs anterior:
- Receita: / X%
- Despesas: / Y%
- Categorias com maior variao

**Padres a identificar:**
- Despesas crescendo mais rpido que receita   ALERTA
- Concentrao excessiva em poucos fornecedores  RISCO
- Sazonalidade no reconhecida  OPORTUNIDADE

### 3 CAA AO DESPERDCIO (Cost Leakage Analysis)
**Perguntas-chave:**
- Algum fornecedor representa >20% das despesas? (risco de dependncia)
- H categorias 50%+ acima do benchmark setorial?
- Despesas recorrentes sem contrato formal? (poder de negociao perdido)
- Pagamentos em duplicidade ou valores arredondados suspeitos?

### 4 OTIMIZAO FISCAL (Tax Engineering)
**Angola - Regras AGT:**
- IVA Geral: 14% | Reduzido: 5% | Isentos: Sade, Educao
- Imposto Industrial: 30% (lucros)
- Reteno na Fonte: 6.5% (servios) | 15% (aluguis)

**Estratgias Lcitas:**
- Maximizar dedues legais (despesas operacionais)
- Aproveitar isenes setoriais
- Estruturar contratos para reduzir reteno
- Timing de despesas (acelerao/diferimento)
- Regime simplificado vs geral (anlise custo-benefcio)

### 5 PROJEO DE CASH FLOW (Forecasting)
**Modelo de 3 Cenrios:**
\`\`\`
OTIMISTA: Receita + 20 % | Despesas + 5 %   CF: [X]
REALISTA: Receita + 5 %  | Despesas + 3 %   CF: [Y]
PESSIMISTA: Receita - 10 % | Despesas + 10 %  CF: [Z]
    \`\`\`

**Fatores a considerar:**
- Sazonalidade do negcio
- Faturas pendentes (aging)
- Compromissos fixos (aluguel, salrios)
- Prazos fiscais (AGT)

### 6 PLANO DE AO (Action Roadmap)
**Priorizao (Matriz Eisenhower Financeira):**
\`\`\`
URGENTE + IMPORTANTE:
- Liquidez crtica(runway < 3 meses)
    - Multas fiscais iminentes
        - Fornecedores chave inadimplentes

IMPORTANTE + NO URGENTE:
- Renegociao de contratos
    - Otimizao de estrutura fiscal
        - Diversificao de fornecedores

NO URGENTE + URGENTE:
- Pequenas correes operacionais

NO URGENTE + NO IMPORTANTE:
- Nice - to - have
    \`\`\`

**Para cada ao, defina:**
- Responsvel: [Cargo/Pessoa]
- Prazo: [Data especfica]
- Impacto Financeiro: [AOA ou %]
- Complexidade: [Baixa/Mdia/Alta]

### 7 GESTO DE RISCO (Risk Matrix)
**Categorias de Risco:**
- **LIQUIDEZ**: Runway < 6 meses, Overdue > 30% receita
- **FISCAL**: Multas AGT, IVA no recuperado, Reteno ausente
- **OPERACIONAL**: Dependncia de 1-2 fornecedores
- **COMPLIANCE**: Documentos sem NIF, Prazos no cumpridos

**Para cada risco:**
- Probabilidade: [0-100%]
- Impacto Financeiro: [AOA]
- Estratgia de Mitigao: [Ao concreta]

**TOM DE COMUNICAO:**
- **Executivo**: Direto ao ponto, sem jargo desnecessrio
- **Quantitativo**: Sempre que possvel, use nmeros (%, AOA, meses)
- **Acionvel**: Cada insight deve ter uma ao clara
- **Honesto**: Se os dados so ruins, diga. Se so bons, celebre brevemente.

**FORMATO DE SADA (JSON):**
Retorne um relatrio estruturado completo seguindo a interface StrategistReport.
Inclua:
- executive_summary (3-4 pargrafos, linguagem de boardroom)
- financial_health_score (0-100, baseado em margem, runway, tendncias)
- key_metrics (mtricas calculadas precisamente)
- key_trends (mnimo 3, mximo 7 tendncias relevantes)
- risks (mnimo 2, ordenados por severidade)
- opportunities (mnimo 3, ordenados por ROI)
- cash_flow_forecast (3 cenrios + breakdown mensal)
- action_plan (5-10 aes SMART)
- tax_optimization (estratgias concretas com base legal)

**REGRAS DE OURO:**
1. NUNCA invente nmeros - use apenas dados fornecidos
2. SEMPRE cite base legal para estratgias fiscais
3. PRIORIZE impacto financeiro mensurvel
4. SEJA especfico em prazos e responsveis
5. CALCULE ROI para cada oportunidade`,hP=`Voc  o **Consultor Fiscal Snior KwikDocs**, especializado em legislao angolana e anlise documental inteligente.

**BASES DE CONHECIMENTO:**
1. Cdigo Geral Tributrio (CGT)
2. Cdigo do IVA (CIVA)  
3. Imposto Industrial
4. Regulamentos AGT
5. Base de Documentos Fiscais da Empresa (Faturas, Recibos, Notas)

**PROTOCOLO DE ANLISE (Chain-of-Thought):**

1. **COMPREENSO DA PERGUNTA**
   - Classifique: Dvida legal? Busca de documento? Clculo fiscal? Compliance?
   - Identifique entidades: NIFs, valores, datas, categorias
   - Determine escopo temporal (se aplicvel)

2. **ANLISE DO CONTEXTO RECUPERADO**
   - Avalie a qualidade dos documentos (score de relevncia)
   - Identifique gaps: O que est presente? O que falta?
   - Verifique consistncia: Dados conflitantes?

3. **SNTESE MULTI-FONTE**
   - **Lei**: Qual artigo/regulamento se aplica?
   - **Documentos**: O que dizem as faturas/recibos da empresa?
   - **Clculos**: Se necessrio, mostre a matemtica passo-a-passo
   - **Compliance**: Status (Conforme/No Conforme/Revisar)

4. **RESPOSTA ESTRUTURADA**
   - Use Markdown com sees claras
   - Cite fontes especficas: "Art. 18 CIVA" ou "Fatura #123"
   - Se houver clculos, apresente em tabela
   - Destaque riscos fiscais com 

**REGRAS DE QUALIDADE:**

 **SEMPRE:**
- Cite a fonte exata (lei ou documento ID)
- Admita quando o contexto  insuficiente
- Apresente nmeros com formatao angolana (1.000.000,00 AOA)
- Destaque prazos e deadlines
- Use linguagem tcnica mas acessvel

 **NUNCA:**
- Invente valores ou artigos de lei
- Ignore dados conflitantes (sempre mencione)
- Responda sem citar fonte
- Use grias ou linguagem informal
- Faa recomendaes sem base legal

**FORMATO DE RESPOSTA:**

###  Resumo Executivo
[Resposta direta em 1-2 frases]

###  Anlise Detalhada
[Explicao tcnica com citaes]

###  Dados Relevantes (se aplicvel)
[Tabela ou lista de documentos/valores]

###  Base Legal
[Artigos de lei citados]

###  Alertas e Recomendaes
[Riscos fiscais ou aes necessrias]

---

**CONTEXTO RECUPERADO:**
{{CONTEXT}}

**PERGUNTA DO USURIO:**
{{QUESTION}}`,pz=`Voc  um especialista em otimizao de buscas semnticas para documentos fiscais.

**TAREFA:** Transforme a pergunta do usurio em uma query de busca otimizada.

**HISTRICO DA CONVERSA:**
{{HISTORY}}

**NOVA PERGUNTA:**
{{QUERY}}

**INSTRUES:**
1. Resolva pronomes (ele, isso, aquilo) usando o contexto
2. Expanda abreviaes fiscais (IVA  Imposto sobre Valor Acrescentado)
3. Adicione sinnimos relevantes (fatura = invoice = nota fiscal)
4. Mantenha entidades-chave: NIFs, valores monetrios, datas
5. Se a pergunta for continuao, COMBINE com o tpico anterior

**EXEMPLOS:**
- "Quanto paguei em faturas?"  "faturas emitidas total valor pago despesas"
- "E em Maro?"  "faturas maro 2026 total valor despesas"
- "Quais sem NIF?"  "documentos faturas recibos sem NIF emitente fornecedor"

**OUTPUT:** Retorne APENAS a query otimizada, sem explicaes.`;class mz{constructor(){this.conversationContext=new Map,this.queryCache=new Map,this.cacheExpiry=300*1e3}getAuthToken(){return localStorage.getItem("auth_token")}async analyzeQueryIntent(t){const e=t.toLowerCase(),n={fiscalRule:/(artigo|art\.|cgt|civa|lei|regulamento|cdigo)/i,calculation:/(quanto|total|soma|mdia|calcul)/i,compliance:/(conforme|legal|permitido|obrigatrio|prazo)/i,documentSearch:/(fatura|recibo|documento|nota|compra|venda)/i},s=e.match(/\b\d{9,10}\b/),r=e.match(/\d{4}-\d{2}-\d{2}|\d{2}\/\d{2}\/\d{4}/),u=e.match(/\d+[\.,]?\d*\s*(aoa|kwanza|kz)/i),h=[];s&&h.push(`NIF:${s[0]}`),r&&h.push(`DATA:${r[0]}`),u&&h.push(`VALOR:${u[0]}`);let f="GENERAL";return n.fiscalRule.test(t)?f="FISCAL_RULE":n.documentSearch.test(t)?f="DOCUMENT_SEARCH":n.calculation.test(t)?f="CALCULATION":n.compliance.test(t)&&(f="COMPLIANCE"),{type:f,entities:h,requires_calculation:n.calculation.test(t)}}async optimizeQueryWithHistory(t,e){var u;if(!e||e.length===0)return t;const n=`${t}:${e.length}`;if(this.queryCache.has(n)){const h=this.queryCache.get(n);if(h&&Date.now()-h.timestamp<this.cacheExpiry)return console.log("[RAG] Query otimizada do cache"),h.optimizedQuery}const s=e.slice(-8).map(h=>`${h.role==="user"?"":""}: ${h.text}`).join(`
`),r=pz.replace("{{HISTORY}}",s).replace("{{QUERY}}",t);try{const p=((u=(await(await u1()).chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:"Voc  um otimizador de queries de busca. Retorne APENAS a query otimizada."},{role:"user",content:r}],temperature:0,max_tokens:100})).choices[0].message.content)==null?void 0:u.trim())||t;return this.queryCache.set(n,{optimizedQuery:p,timestamp:Date.now()}),console.log(`[RAG] Query: "${t}"  "${p}"`),p}catch(h){return console.warn("[RAG] Erro ao otimizar query, usando original:",h),t}}async retrieveContextFromDB(t,e="ALL",n={}){try{const s=this.getAuthToken();if(!s)throw new Error("Autenticao necessria para busca RAG");const r={query:t,companyId:e,maxResults:n.maxResults||10,minRelevanceScore:n.minRelevanceScore||.3,dateRange:n.dateRange},u=await fetch("/api/rag/search",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(r)});if(!u.ok)throw new Error(`Busca falhou: ${u.statusText}`);const h=await u.json();return this.buildStructuredContext(h,t)}catch(s){return console.error("[RAG] Erro na busca:",s),this.buildEmptyContext(s)}}buildStructuredContext(t,e){var p;const{results:n,stats:s,metadata:r}=t,u=`
 **ESTATSTICAS DA BASE DE DADOS**

 Total de Documentos: ${((p=s.totalDocs)==null?void 0:p.toLocaleString("pt-AO"))||0}
 Valor Total Processado: ${this.formatCurrency(s.totalAmount||0)}
 Documentos Aprovados: ${s.approvedCount||0}
 Documentos Rejeitados: ${s.rejectedCount||0}
 Sem NIF do Emitente: ${s.missingNifCount||0}
${s.dateRange?` Perodo: ${s.dateRange.earliest} at ${s.dateRange.latest}`:""}
`,h=r?`
 **QUALIDADE DA BUSCA**

 Qualidade: ${r.search_quality}
 Documentos Analisados: ${r.total_chunks_searched}
 Relevncia Mdia: ${(r.avg_relevance_score*100).toFixed(1)}%
`:"";let f="";return n.length===0?f=`
 **NENHUM DOCUMENTO ENCONTRADO**
A busca por "${e}" no retornou resultados.
Sugestes:
- Tente termos mais genricos
- Verifique a grafia de nomes/NIFs
- Amplie o perodo de busca
`:f=`
 **DOCUMENTOS RELEVANTES (${n.length})**

${n.map((m,b)=>this.formatDocument(m,b+1)).join(`

`)}
`,{documents:f,statistics:u,quality_metrics:h,search_metadata:r||{}}}formatDocument(t,e){var r,u,h;const n=t.data||{},s=t.relevance_score?` Relevncia: ${(t.relevance_score*100).toFixed(1)}%`:"";return`
**[${e}] ${t.file_name}** (ID: ${t.id})
${s}

  Fornecedor: ${n.merchantName||((r=n.issuer_data)==null?void 0:r.name)||"N/A"}
  NIF Emitente: ${((u=n.issuer_data)==null?void 0:u.nif)||"SEM NIF"}
  Valor Total: ${this.formatCurrency(n.totalAmount)}
  Data: ${this.formatDate(n.date||n.created_at)}
  Categoria: ${n.category||"No categorizado"}
  Itens: ${((h=n.items)==null?void 0:h.length)||0}
  Status: ${n.approval_status||"Pendente"}
${n.tax_info?`  IVA: ${this.formatCurrency(n.tax_info.vat||0)}`:""}
${n.notes?`  Obs: ${n.notes}`:""}
`}buildEmptyContext(t){return{documents:` Erro ao buscar documentos: ${t.message}`,statistics:"Estatsticas indisponveis",quality_metrics:"",search_metadata:{}}}async generateResponse(t,e=[],n="",s="ALL",r){try{const u=await this.analyzeQueryIntent(t);console.log("[RAG] Inteno detectada:",u.type);const h=await this.optimizeQueryWithHistory(t,e),f=await this.retrieveContextFromDB(h,s),p=await JN.getPrompt("rag"),m=r||p.prompt_text||hP,b=p.model_override||QN.CHAT||"gpt-4o-mini",_=p.temperature??.3,S=`
${f.statistics}
${f.quality_metrics}
${f.documents}

${n?`
**CONTEXTO ADICIONAL:**
${n}`:""}

**INTENO DA PERGUNTA:** ${u.type}
**ENTIDADES IDENTIFICADAS:** ${u.entities.join(", ")||"Nenhuma"}
`,R=m.replace("{{CONTEXT}}",S).replace("{{QUESTION}}",t),k=(await(await u1()).chat.completions.create({model:b,messages:[{role:"system",content:"Voc  um Consultor Fiscal Snior especializado em Angola."},...this.buildConversationHistory(e),{role:"user",content:R}],temperature:_,max_tokens:2e3})).choices[0].message.content||"No consegui processar sua solicitao.";return this.postProcessAnswer(k,f)}catch(u){return console.error("[RAG] Erro ao gerar resposta:",u),this.generateErrorResponse(u)}}buildConversationHistory(t){return t.slice(-6).map(e=>({role:e.role==="user"?"user":"assistant",content:e.text}))}postProcessAnswer(t,e){let n=t;return e.search_metadata.total_chunks_searched>0&&(n+=`

---
*Busca realizada em ${e.search_metadata.total_chunks_searched} documentos | Qualidade: ${e.search_metadata.search_quality}*`),n}generateErrorResponse(t){return`
###  Servio Temporariamente Indisponvel

Ocorreu um erro ao processar sua solicitao:
\`${t.message}\`

**Possveis causas:**
- Conexo com o banco de dados
- Erro de autenticao
- Limite de API excedido

**Tente:**
1. Atualizar a pgina
2. Fazer login novamente
3. Simplificar a pergunta

Se o problema persistir, contate o suporte tcnico.
`}formatCurrency(t){return new Intl.NumberFormat("pt-AO",{style:"currency",currency:"AOA",minimumFractionDigits:2}).format(t||0)}formatDate(t){if(!t)return"Data no disponvel";const e=new Date(t);return new Intl.DateTimeFormat("pt-AO",{year:"numeric",month:"long",day:"numeric"}).format(e)}clearCache(){this.queryCache.clear(),this.conversationContext.clear(),console.log("[RAG] Cache limpo")}getPerformanceMetrics(){return{cached_queries:this.queryCache.size,conversation_contexts:this.conversationContext.size,cache_expiry_ms:this.cacheExpiry}}}const _j=new mz,gz=`
Voc  um motor de extrao de dados fiscais para Angola (KwikDocs Parser).
Sua tarefa  receber o texto bruto ou imagem de uma fatura/recibo e extrair um JSON estruturado.

CAMPOS OBRIGATRIOS:
- merchantName: Nome da entidade emitente.
- nif: NIF do emitente (formato 10 dgitos).
- date: Data do documento (ISO YYYY-MM-DD).
- totalAmount: Valor total lquido a pagar.
- taxAmount: Valor do IVA/Imposto.
- invoiceNo: Nmero da fatura (ex: FT 2024/1).

REGRAS DE EXTRAO:
1. Se o NIF no for claro, tente inferir pelo padro, mas marque "confidence" como baixo.
2. Ignore itens no fiscais (ex: anotaes a caneta irrelevantes).
3. Classifique a categoria da despesa baseada nos itens (ex: "Alimentao", "Transporte", "Servios").
4. Normalize a moeda para Kz (Kwanza). Se for outra moeda, indique a taxa de cmbio se visvel.

SADA: Apenas JSON vlido, sem markdown.
`,yz=`Voc  um perito forense em documentos fiscais digitais.
Analise a imagem em busca de autenticidade, selos e assinaturas.`;var w_={exports:{}},bz=w_.exports,lM;function vz(){return lM||(lM=1,(function(l,t){(function(e,n){l.exports=n()})(bz,function(){var e=function(g,v){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,x){A.__proto__=x}||function(A,x){for(var D in x)Object.prototype.hasOwnProperty.call(x,D)&&(A[D]=x[D])})(g,v)},n=function(){return(n=Object.assign||function(g){for(var v,A=1,x=arguments.length;A<x;A++)for(var D in v=arguments[A])Object.prototype.hasOwnProperty.call(v,D)&&(g[D]=v[D]);return g}).apply(this,arguments)};function s(g,v,A){for(var x,D=0,L=v.length;D<L;D++)!x&&D in v||((x=x||Array.prototype.slice.call(v,0,D))[D]=v[D]);return g.concat(x||Array.prototype.slice.call(v))}var r=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:PL,u=Object.keys,h=Array.isArray;function f(g,v){return typeof v!="object"||u(v).forEach(function(A){g[A]=v[A]}),g}typeof Promise>"u"||r.Promise||(r.Promise=Promise);var p=Object.getPrototypeOf,m={}.hasOwnProperty;function b(g,v){return m.call(g,v)}function _(g,v){typeof v=="function"&&(v=v(p(g))),(typeof Reflect>"u"?u:Reflect.ownKeys)(v).forEach(function(A){R(g,A,v[A])})}var S=Object.defineProperty;function R(g,v,A,x){S(g,v,f(A&&b(A,"get")&&typeof A.get=="function"?{get:A.get,set:A.set,configurable:!0}:{value:A,configurable:!0,writable:!0},x))}function C(g){return{from:function(v){return g.prototype=Object.create(v.prototype),R(g.prototype,"constructor",g),{extend:_.bind(null,g.prototype)}}}}var M=Object.getOwnPropertyDescriptor,k=[].slice;function I(g,v,A){return k.call(g,v,A)}function P(g,v){return v(g)}function F(g){if(!g)throw new Error("Assertion Failed")}function z(g){r.setImmediate?setImmediate(g):setTimeout(g,0)}function j(g,v){if(typeof v=="string"&&b(g,v))return g[v];if(!v)return g;if(typeof v!="string"){for(var A=[],x=0,D=v.length;x<D;++x){var L=j(g,v[x]);A.push(L)}return A}var U=v.indexOf(".");if(U!==-1){var $=g[v.substr(0,U)];return $==null?void 0:j($,v.substr(U+1))}}function H(g,v,A){if(g&&v!==void 0&&!("isFrozen"in Object&&Object.isFrozen(g)))if(typeof v!="string"&&"length"in v){F(typeof A!="string"&&"length"in A);for(var x=0,D=v.length;x<D;++x)H(g,v[x],A[x])}else{var L,U,$=v.indexOf(".");$!==-1?(L=v.substr(0,$),(U=v.substr($+1))===""?A===void 0?h(g)&&!isNaN(parseInt(L))?g.splice(L,1):delete g[L]:g[L]=A:H($=!($=g[L])||!b(g,L)?g[L]={}:$,U,A)):A===void 0?h(g)&&!isNaN(parseInt(v))?g.splice(v,1):delete g[v]:g[v]=A}}function dt(g){var v,A={};for(v in g)b(g,v)&&(A[v]=g[v]);return A}var ct=[].concat;function yt(g){return ct.apply([],g)}var mi="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(yt([8,16,32,64].map(function(g){return["Int","Uint","Float"].map(function(v){return v+g+"Array"})}))).filter(function(g){return r[g]}),gt=new Set(mi.map(function(g){return r[g]})),Pt=null;function Xt(g){return Pt=new WeakMap,g=(function v(A){if(!A||typeof A!="object")return A;var x=Pt.get(A);if(x)return x;if(h(A)){x=[],Pt.set(A,x);for(var D=0,L=A.length;D<L;++D)x.push(v(A[D]))}else if(gt.has(A.constructor))x=A;else{var U,$=p(A);for(U in x=$===Object.prototype?{}:Object.create($),Pt.set(A,x),A)b(A,U)&&(x[U]=v(A[U]))}return x})(g),Pt=null,g}var Vt={}.toString;function Yt(g){return Vt.call(g).slice(8,-1)}var J=typeof Symbol<"u"?Symbol.iterator:"@@iterator",pt=typeof J=="symbol"?function(g){var v;return g!=null&&(v=g[J])&&v.apply(g)}:function(){return null};function Et(g,v){return v=g.indexOf(v),0<=v&&g.splice(v,1),0<=v}var Wt={};function Zt(g){var v,A,x,D;if(arguments.length===1){if(h(g))return g.slice();if(this===Wt&&typeof g=="string")return[g];if(D=pt(g)){for(A=[];!(x=D.next()).done;)A.push(x.value);return A}if(g==null)return[g];if(typeof(v=g.length)!="number")return[g];for(A=new Array(v);v--;)A[v]=g[v];return A}for(v=arguments.length,A=new Array(v);v--;)A[v]=arguments[v];return A}var G=typeof Symbol<"u"?function(g){return g[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},En=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ss=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(En),ft={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function _t(g,v){this.name=g,this.message=v}function Mt(g,v){return g+". Errors: "+Object.keys(v).map(function(A){return v[A].toString()}).filter(function(A,x,D){return D.indexOf(A)===x}).join(`
`)}function It(g,v,A,x){this.failures=v,this.failedKeys=x,this.successCount=A,this.message=Mt(g,v)}function Gt(g,v){this.name="BulkError",this.failures=Object.keys(v).map(function(A){return v[A]}),this.failuresByPos=v,this.message=Mt(g,this.failures)}C(_t).from(Error).extend({toString:function(){return this.name+": "+this.message}}),C(It).from(_t),C(Gt).from(_t);var Ft=Ss.reduce(function(g,v){return g[v]=v+"Error",g},{}),Ke=_t,Dt=Ss.reduce(function(g,v){var A=v+"Error";function x(D,L){this.name=A,D?typeof D=="string"?(this.message="".concat(D).concat(L?`
 `+L:""),this.inner=L||null):typeof D=="object"&&(this.message="".concat(D.name," ").concat(D.message),this.inner=D):(this.message=ft[v]||A,this.inner=null)}return C(x).from(Ke),g[v]=x,g},{});Dt.Syntax=SyntaxError,Dt.Type=TypeError,Dt.Range=RangeError;var pi=En.reduce(function(g,v){return g[v+"Error"]=Dt[v],g},{}),bn=Ss.reduce(function(g,v){return["Syntax","Type","Range"].indexOf(v)===-1&&(g[v+"Error"]=Dt[v]),g},{});function Ee(){}function os(g){return g}function ws(g,v){return g==null||g===os?v:function(A){return v(g(A))}}function Oi(g,v){return function(){g.apply(this,arguments),v.apply(this,arguments)}}function Hr(g,v){return g===Ee?v:function(){var A=g.apply(this,arguments);A!==void 0&&(arguments[0]=A);var x=this.onsuccess,D=this.onerror;this.onsuccess=null,this.onerror=null;var L=v.apply(this,arguments);return x&&(this.onsuccess=this.onsuccess?Oi(x,this.onsuccess):x),D&&(this.onerror=this.onerror?Oi(D,this.onerror):D),L!==void 0?L:A}}function Io(g,v){return g===Ee?v:function(){g.apply(this,arguments);var A=this.onsuccess,x=this.onerror;this.onsuccess=this.onerror=null,v.apply(this,arguments),A&&(this.onsuccess=this.onsuccess?Oi(A,this.onsuccess):A),x&&(this.onerror=this.onerror?Oi(x,this.onerror):x)}}function Zs(g,v){return g===Ee?v:function(A){var x=g.apply(this,arguments);f(A,x);var D=this.onsuccess,L=this.onerror;return this.onsuccess=null,this.onerror=null,A=v.apply(this,arguments),D&&(this.onsuccess=this.onsuccess?Oi(D,this.onsuccess):D),L&&(this.onerror=this.onerror?Oi(L,this.onerror):L),x===void 0?A===void 0?void 0:A:f(x,A)}}function Bo(g,v){return g===Ee?v:function(){return v.apply(this,arguments)!==!1&&g.apply(this,arguments)}}function pr(g,v){return g===Ee?v:function(){var A=g.apply(this,arguments);if(A&&typeof A.then=="function"){for(var x=this,D=arguments.length,L=new Array(D);D--;)L[D]=arguments[D];return A.then(function(){return v.apply(x,L)})}return v.apply(this,arguments)}}bn.ModifyError=It,bn.DexieError=_t,bn.BulkError=Gt;var te=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ht(g){te=g}var se={},oe=100,mi=typeof Promise>"u"?[]:(function(){var g=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[g,p(g),g];var v=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[v,p(v),g]})(),En=mi[0],Ss=mi[1],mi=mi[2],Ss=Ss&&Ss.then,fe=En&&En.constructor,Oe=!!mi,In=function(g,v){Vu.push([g,v]),mr&&(queueMicrotask(Kv),mr=!1)},Ia=!0,mr=!0,$r=[],gi=[],$i=os,Vi={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ee,pgp:!1,env:{},finalize:Ee},Ut=Vi,Vu=[],Fo=0,Zd=[];function Lt(g){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var v=this._PSD=Ut;if(typeof g!="function"){if(g!==se)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&gr(this,this._value))}this._state=null,this._value=null,++v.ref,(function A(x,D){try{D(function(L){if(x._state===null){if(L===x)throw new TypeError("A promise cannot be resolved with itself.");var U=x._lib&&Vr();L&&typeof L.then=="function"?A(x,function($,X){L instanceof Lt?L._then($,X):L.then($,X)}):(x._state=!0,x._value=L,qu(x)),U&&Ba()}},gr.bind(null,x))}catch(L){gr(x,L)}})(this,g)}var lc={get:function(){var g=Ut,v=Ku;function A(x,D){var L=this,U=!g.global&&(g!==Ut||v!==Ku),$=U&&!_s(),X=new Lt(function(Y,et){Uo(L,new Gu(tf(x,g,U,$),tf(D,g,U,$),Y,et,g))});return this._consoleTask&&(X._consoleTask=this._consoleTask),X}return A.prototype=se,A},set:function(g){R(this,"then",g&&g.prototype===se?lc:{get:function(){return g},set:lc.set})}};function Gu(g,v,A,x,D){this.onFulfilled=typeof g=="function"?g:null,this.onRejected=typeof v=="function"?v:null,this.resolve=A,this.reject=x,this.psd=D}function gr(g,v){var A,x;gi.push(v),g._state===null&&(A=g._lib&&Vr(),v=$i(v),g._state=!1,g._value=v,x=g,$r.some(function(D){return D._value===x._value})||$r.push(x),qu(g),A&&Ba())}function qu(g){var v=g._listeners;g._listeners=[];for(var A=0,x=v.length;A<x;++A)Uo(g,v[A]);var D=g._PSD;--D.ref||D.finalize(),Fo===0&&(++Fo,In(function(){--Fo==0&&Km()},[]))}function Uo(g,v){if(g._state!==null){var A=g._state?v.onFulfilled:v.onRejected;if(A===null)return(g._state?v.resolve:v.reject)(g._value);++v.psd.ref,++Fo,In(TA,[A,g,v])}else g._listeners.push(v)}function TA(g,v,A){try{var x,D=v._value;!v._state&&gi.length&&(gi=[]),x=te&&v._consoleTask?v._consoleTask.run(function(){return g(D)}):g(D),v._state||gi.indexOf(D)!==-1||(function(L){for(var U=$r.length;U;)if($r[--U]._value===L._value)return $r.splice(U,1)})(v),A.resolve(x)}catch(L){A.reject(L)}finally{--Fo==0&&Km(),--A.psd.ref||A.psd.finalize()}}function Kv(){ta(Vi,function(){Vr()&&Ba()})}function Vr(){var g=Ia;return mr=Ia=!1,g}function Ba(){var g,v,A;do for(;0<Vu.length;)for(g=Vu,Vu=[],A=g.length,v=0;v<A;++v){var x=g[v];x[0].apply(null,x[1])}while(0<Vu.length);mr=Ia=!0}function Km(){var g=$r;$r=[],g.forEach(function(x){x._PSD.onunhandled.call(null,x._value,x)});for(var v=Zd.slice(0),A=v.length;A;)v[--A]()}function Xu(g){return new Lt(se,!1,g)}function dn(g,v){var A=Ut;return function(){var x=Vr(),D=Ut;try{return qr(A,!0),g.apply(this,arguments)}catch(L){v&&v(L)}finally{qr(D,!1),x&&Ba()}}}_(Lt.prototype,{then:lc,_then:function(g,v){Uo(this,new Gu(null,null,g,v,Ut))},catch:function(g){if(arguments.length===1)return this.then(null,g);var v=g,A=arguments[1];return typeof v=="function"?this.then(null,function(x){return(x instanceof v?A:Xu)(x)}):this.then(null,function(x){return(x&&x.name===v?A:Xu)(x)})},finally:function(g){return this.then(function(v){return Lt.resolve(g()).then(function(){return v})},function(v){return Lt.resolve(g()).then(function(){return Xu(v)})})},timeout:function(g,v){var A=this;return g<1/0?new Lt(function(x,D){var L=setTimeout(function(){return D(new Dt.Timeout(v))},g);A.then(x,D).finally(clearTimeout.bind(null,L))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&R(Lt.prototype,Symbol.toStringTag,"Dexie.Promise"),Vi.env=Qm(),_(Lt,{all:function(){var g=Zt.apply(null,arguments).map(uc);return new Lt(function(v,A){g.length===0&&v([]);var x=g.length;g.forEach(function(D,L){return Lt.resolve(D).then(function(U){g[L]=U,--x||v(g)},A)})})},resolve:function(g){return g instanceof Lt?g:g&&typeof g.then=="function"?new Lt(function(v,A){g.then(v,A)}):new Lt(se,!0,g)},reject:Xu,race:function(){var g=Zt.apply(null,arguments).map(uc);return new Lt(function(v,A){g.map(function(x){return Lt.resolve(x).then(v,A)})})},PSD:{get:function(){return Ut},set:function(g){return Ut=g}},totalEchoes:{get:function(){return Ku}},newPSD:vn,usePSD:ta,scheduler:{get:function(){return In},set:function(g){In=g}},rejectionMapper:{get:function(){return $i},set:function(g){$i=g}},follow:function(g,v){return new Lt(function(A,x){return vn(function(D,L){var U=Ut;U.unhandleds=[],U.onunhandled=L,U.finalize=Oi(function(){var $,X=this;$=function(){X.unhandleds.length===0?D():L(X.unhandleds[0])},Zd.push(function Y(){$(),Zd.splice(Zd.indexOf(Y),1)}),++Fo,In(function(){--Fo==0&&Km()},[])},U.finalize),g()},v,A,x)})}}),fe&&(fe.allSettled&&R(Lt,"allSettled",function(){var g=Zt.apply(null,arguments).map(uc);return new Lt(function(v){g.length===0&&v([]);var A=g.length,x=new Array(A);g.forEach(function(D,L){return Lt.resolve(D).then(function(U){return x[L]={status:"fulfilled",value:U}},function(U){return x[L]={status:"rejected",reason:U}}).then(function(){return--A||v(x)})})})}),fe.any&&typeof AggregateError<"u"&&R(Lt,"any",function(){var g=Zt.apply(null,arguments).map(uc);return new Lt(function(v,A){g.length===0&&A(new AggregateError([]));var x=g.length,D=new Array(x);g.forEach(function(L,U){return Lt.resolve(L).then(function($){return v($)},function($){D[U]=$,--x||A(new AggregateError(D))})})})}),fe.withResolvers&&(Lt.withResolvers=fe.withResolvers));var Wn={awaits:0,echoes:0,id:0},Wm=0,cc=[],Yu=0,Ku=0,Gr=0;function vn(g,v,A,x){var D=Ut,L=Object.create(D);return L.parent=D,L.ref=0,L.global=!1,L.id=++Gr,Vi.env,L.env=Oe?{Promise:Lt,PromiseProp:{value:Lt,configurable:!0,writable:!0},all:Lt.all,race:Lt.race,allSettled:Lt.allSettled,any:Lt.any,resolve:Lt.resolve,reject:Lt.reject}:{},v&&f(L,v),++D.ref,L.finalize=function(){--this.parent.ref||this.parent.finalize()},x=ta(L,g,A,x),L.ref===0&&L.finalize(),x}function Qn(){return Wn.id||(Wn.id=++Wm),++Wn.awaits,Wn.echoes+=oe,Wn.id}function _s(){return!!Wn.awaits&&(--Wn.awaits==0&&(Wn.id=0),Wn.echoes=Wn.awaits*oe,!0)}function uc(g){return Wn.echoes&&g&&g.constructor===fe?(Qn(),g.then(function(v){return _s(),v},function(v){return _s(),tn(v)})):g}function RA(){var g=cc[cc.length-1];cc.pop(),qr(g,!1)}function qr(g,v){var A,x=Ut;(v?!Wn.echoes||Yu++&&g===Ut:!Yu||--Yu&&g===Ut)||queueMicrotask(v?(function(D){++Ku,Wn.echoes&&--Wn.echoes!=0||(Wn.echoes=Wn.awaits=Wn.id=0),cc.push(Ut),qr(D,!0)}).bind(null,g):RA),g!==Ut&&(Ut=g,x===Vi&&(Vi.env=Qm()),Oe&&(A=Vi.env.Promise,v=g.env,(x.global||g.global)&&(Object.defineProperty(r,"Promise",v.PromiseProp),A.all=v.all,A.race=v.race,A.resolve=v.resolve,A.reject=v.reject,v.allSettled&&(A.allSettled=v.allSettled),v.any&&(A.any=v.any))))}function Qm(){var g=r.Promise;return Oe?{Promise:g,PromiseProp:Object.getOwnPropertyDescriptor(r,"Promise"),all:g.all,race:g.race,allSettled:g.allSettled,any:g.any,resolve:g.resolve,reject:g.reject}:{}}function ta(g,v,A,x,D){var L=Ut;try{return qr(g,!0),v(A,x,D)}finally{qr(L,!1)}}function tf(g,v,A,x){return typeof g!="function"?g:function(){var D=Ut;A&&Qn(),qr(v,!0);try{return g.apply(this,arguments)}finally{qr(D,!1),x&&queueMicrotask(_s)}}}function Xr(g){Promise===fe&&Wn.echoes===0?Yu===0?g():enqueueNativeMicroTask(g):setTimeout(g,0)}(""+Ss).indexOf("[native code]")===-1&&(Qn=_s=Ee);var tn=Lt.reject,ea="",ls="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Jn="String expected.",zo=[],Wu="__dbnames",yr="readonly",Yr="readwrite";function jo(g,v){return g?v?function(){return g.apply(this,arguments)&&v.apply(this,arguments)}:g:v}var Jm={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Qu(g){return typeof g!="string"||/\./.test(g)?function(v){return v}:function(v){return v[g]===void 0&&g in v&&delete(v=Xt(v))[g],v}}function Wv(){throw Dt.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Re(g,v){try{var A=Ju(g),x=Ju(v);if(A!==x)return A==="Array"?1:x==="Array"?-1:A==="binary"?1:x==="binary"?-1:A==="string"?1:x==="string"?-1:A==="Date"?1:x!=="Date"?NaN:-1;switch(A){case"number":case"Date":case"string":return v<g?1:g<v?-1:0;case"binary":return(function(D,L){for(var U=D.length,$=L.length,X=U<$?U:$,Y=0;Y<X;++Y)if(D[Y]!==L[Y])return D[Y]<L[Y]?-1:1;return U===$?0:U<$?-1:1})(Fa(g),Fa(v));case"Array":return(function(D,L){for(var U=D.length,$=L.length,X=U<$?U:$,Y=0;Y<X;++Y){var et=Re(D[Y],L[Y]);if(et!==0)return et}return U===$?0:U<$?-1:1})(g,v)}}catch{}return NaN}function Ju(g){var v=typeof g;return v!="object"?v:ArrayBuffer.isView(g)?"binary":(g=Yt(g),g==="ArrayBuffer"?"binary":g)}function Fa(g){return g instanceof Uint8Array?g:ArrayBuffer.isView(g)?new Uint8Array(g.buffer,g.byteOffset,g.byteLength):new Uint8Array(g)}function Gi(g,v,A){var x=g.schema.yProps;return x?(v&&0<A.numFailures&&(v=v.filter(function(D,L){return!A.failures[L]})),Promise.all(x.map(function(D){return D=D.updatesTable,v?g.db.table(D).where("k").anyOf(v).delete():g.db.table(D).clear()})).then(function(){return A})):A}var hc=(Qv.prototype.execute=function(g){var v=this["@@propmod"];if(v.add!==void 0){var A=v.add;if(h(A))return s(s([],h(g)?g:[],!0),A).sort();if(typeof A=="number")return(Number(g)||0)+A;if(typeof A=="bigint")try{return BigInt(g)+A}catch{return BigInt(0)+A}throw new TypeError("Invalid term ".concat(A))}if(v.remove!==void 0){var x=v.remove;if(h(x))return h(g)?g.filter(function(D){return!x.includes(D)}).sort():[];if(typeof x=="number")return Number(g)-x;if(typeof x=="bigint")try{return BigInt(g)-x}catch{return BigInt(0)-x}throw new TypeError("Invalid subtrahend ".concat(x))}return A=(A=v.replacePrefix)===null||A===void 0?void 0:A[0],A&&typeof g=="string"&&g.startsWith(A)?v.replacePrefix[1]+g.substring(A.length):g},Qv);function Qv(g){this["@@propmod"]=g}function ef(g,v){for(var A=u(v),x=A.length,D=!1,L=0;L<x;++L){var U=A[L],$=v[U],X=j(g,U);$ instanceof hc?(H(g,U,$.execute(X)),D=!0):X!==$&&(H(g,U,$),D=!0)}return D}var Zm=(Ge.prototype._trans=function(g,v,A){var x=this._tx||Ut.trans,D=this.name,L=te&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(g==="readonly"?"read":"write"," ").concat(this.name));function U(Y,et,q){if(!q.schema[D])throw new Dt.NotFound("Table "+D+" not part of transaction");return v(q.idbtrans,q)}var $=Vr();try{var X=x&&x.db._novip===this.db._novip?x===Ut.trans?x._promise(g,U,A):vn(function(){return x._promise(g,U,A)},{trans:x,transless:Ut.transless||Ut}):(function Y(et,q,it,K){if(et.idbdb&&(et._state.openComplete||Ut.letThrough||et._vip)){var Z=et._createTransaction(q,it,et._dbSchema);try{Z.create(),et._state.PR1398_maxLoop=3}catch(tt){return tt.name===Ft.InvalidState&&et.isOpen()&&0<--et._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),et.close({disableAutoOpen:!1}),et.open().then(function(){return Y(et,q,it,K)})):tn(tt)}return Z._promise(q,function(tt,nt){return vn(function(){return Ut.trans=Z,K(tt,nt,Z)})}).then(function(tt){if(q==="readwrite")try{Z.idbtrans.commit()}catch{}return q==="readonly"?tt:Z._completion.then(function(){return tt})})}if(et._state.openComplete)return tn(new Dt.DatabaseClosed(et._state.dbOpenError));if(!et._state.isBeingOpened){if(!et._state.autoOpen)return tn(new Dt.DatabaseClosed);et.open().catch(Ee)}return et._state.dbReadyPromise.then(function(){return Y(et,q,it,K)})})(this.db,g,[this.name],U);return L&&(X._consoleTask=L,X=X.catch(function(Y){return console.trace(Y),tn(Y)})),X}finally{$&&Ba()}},Ge.prototype.get=function(g,v){var A=this;return g&&g.constructor===Object?this.where(g).first(v):g==null?tn(new Dt.Type("Invalid argument to Table.get()")):this._trans("readonly",function(x){return A.core.get({trans:x,key:g}).then(function(D){return A.hook.reading.fire(D)})}).then(v)},Ge.prototype.where=function(g){if(typeof g=="string")return new this.db.WhereClause(this,g);if(h(g))return new this.db.WhereClause(this,"[".concat(g.join("+"),"]"));var v=u(g);if(v.length===1)return this.where(v[0]).equals(g[v[0]]);var A=this.schema.indexes.concat(this.schema.primKey).filter(function($){if($.compound&&v.every(function(Y){return 0<=$.keyPath.indexOf(Y)})){for(var X=0;X<v.length;++X)if(v.indexOf($.keyPath[X])===-1)return!1;return!0}return!1}).sort(function($,X){return $.keyPath.length-X.keyPath.length})[0];if(A&&this.db._maxKey!==ea){var L=A.keyPath.slice(0,v.length);return this.where(L).equals(L.map(function(X){return g[X]}))}!A&&te&&console.warn("The query ".concat(JSON.stringify(g)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(v.join("+"),"]"));var x=this.schema.idxByName;function D($,X){return Re($,X)===0}var U=v.reduce(function(q,X){var Y=q[0],et=q[1],q=x[X],it=g[X];return[Y||q,Y||!q?jo(et,q&&q.multi?function(K){return K=j(K,X),h(K)&&K.some(function(Z){return D(it,Z)})}:function(K){return D(it,j(K,X))}):et]},[null,null]),L=U[0],U=U[1];return L?this.where(L.name).equals(g[L.keyPath]).filter(U):A?this.filter(U):this.where(v).equals("")},Ge.prototype.filter=function(g){return this.toCollection().and(g)},Ge.prototype.count=function(g){return this.toCollection().count(g)},Ge.prototype.offset=function(g){return this.toCollection().offset(g)},Ge.prototype.limit=function(g){return this.toCollection().limit(g)},Ge.prototype.each=function(g){return this.toCollection().each(g)},Ge.prototype.toArray=function(g){return this.toCollection().toArray(g)},Ge.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Ge.prototype.orderBy=function(g){return new this.db.Collection(new this.db.WhereClause(this,h(g)?"[".concat(g.join("+"),"]"):g))},Ge.prototype.reverse=function(){return this.toCollection().reverse()},Ge.prototype.mapToClass=function(g){var v,A=this.db,x=this.name;function D(){return v!==null&&v.apply(this,arguments)||this}(this.schema.mappedClass=g).prototype instanceof Wv&&((function(X,Y){if(typeof Y!="function"&&Y!==null)throw new TypeError("Class extends value "+String(Y)+" is not a constructor or null");function et(){this.constructor=X}e(X,Y),X.prototype=Y===null?Object.create(Y):(et.prototype=Y.prototype,new et)})(D,v=g),Object.defineProperty(D.prototype,"db",{get:function(){return A},enumerable:!1,configurable:!0}),D.prototype.table=function(){return x},g=D);for(var L=new Set,U=g.prototype;U;U=p(U))Object.getOwnPropertyNames(U).forEach(function(X){return L.add(X)});function $(X){if(!X)return X;var Y,et=Object.create(g.prototype);for(Y in X)if(!L.has(Y))try{et[Y]=X[Y]}catch{}return et}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=$,this.hook("reading",$),g},Ge.prototype.defineClass=function(){return this.mapToClass(function(g){f(this,g)})},Ge.prototype.add=function(g,v){var A=this,x=this.schema.primKey,D=x.auto,L=x.keyPath,U=g;return L&&D&&(U=Qu(L)(g)),this._trans("readwrite",function($){return A.core.mutate({trans:$,type:"add",keys:v!=null?[v]:null,values:[U]})}).then(function($){return $.numFailures?Lt.reject($.failures[0]):$.lastResult}).then(function($){if(L)try{H(g,L,$)}catch{}return $})},Ge.prototype.upsert=function(g,v){var A=this,x=this.schema.primKey.keyPath;return this._trans("readwrite",function(D){return A.core.get({trans:D,key:g}).then(function(L){var U=L??{};return ef(U,v),x&&H(U,x,g),A.core.mutate({trans:D,type:"put",values:[U],keys:[g],upsert:!0,updates:{keys:[g],changeSpecs:[v]}}).then(function($){return $.numFailures?Lt.reject($.failures[0]):!!L})})})},Ge.prototype.update=function(g,v){return typeof g!="object"||h(g)?this.where(":id").equals(g).modify(v):(g=j(g,this.schema.primKey.keyPath),g===void 0?tn(new Dt.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(g).modify(v))},Ge.prototype.put=function(g,v){var A=this,x=this.schema.primKey,D=x.auto,L=x.keyPath,U=g;return L&&D&&(U=Qu(L)(g)),this._trans("readwrite",function($){return A.core.mutate({trans:$,type:"put",values:[U],keys:v!=null?[v]:null})}).then(function($){return $.numFailures?Lt.reject($.failures[0]):$.lastResult}).then(function($){if(L)try{H(g,L,$)}catch{}return $})},Ge.prototype.delete=function(g){var v=this;return this._trans("readwrite",function(A){return v.core.mutate({trans:A,type:"delete",keys:[g]}).then(function(x){return Gi(v,[g],x)}).then(function(x){return x.numFailures?Lt.reject(x.failures[0]):void 0})})},Ge.prototype.clear=function(){var g=this;return this._trans("readwrite",function(v){return g.core.mutate({trans:v,type:"deleteRange",range:Jm}).then(function(A){return Gi(g,null,A)})}).then(function(v){return v.numFailures?Lt.reject(v.failures[0]):void 0})},Ge.prototype.bulkGet=function(g){var v=this;return this._trans("readonly",function(A){return v.core.getMany({keys:g,trans:A}).then(function(x){return x.map(function(D){return v.hook.reading.fire(D)})})})},Ge.prototype.bulkAdd=function(g,v,A){var x=this,D=Array.isArray(v)?v:void 0,L=(A=A||(D?void 0:v))?A.allKeys:void 0;return this._trans("readwrite",function(U){var Y=x.schema.primKey,$=Y.auto,Y=Y.keyPath;if(Y&&D)throw new Dt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(D&&D.length!==g.length)throw new Dt.InvalidArgument("Arguments objects and keys must have the same length");var X=g.length,Y=Y&&$?g.map(Qu(Y)):g;return x.core.mutate({trans:U,type:"add",keys:D,values:Y,wantResults:L}).then(function(Z){var q=Z.numFailures,it=Z.results,K=Z.lastResult,Z=Z.failures;if(q===0)return L?it:K;throw new Gt("".concat(x.name,".bulkAdd(): ").concat(q," of ").concat(X," operations failed"),Z)})})},Ge.prototype.bulkPut=function(g,v,A){var x=this,D=Array.isArray(v)?v:void 0,L=(A=A||(D?void 0:v))?A.allKeys:void 0;return this._trans("readwrite",function(U){var Y=x.schema.primKey,$=Y.auto,Y=Y.keyPath;if(Y&&D)throw new Dt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(D&&D.length!==g.length)throw new Dt.InvalidArgument("Arguments objects and keys must have the same length");var X=g.length,Y=Y&&$?g.map(Qu(Y)):g;return x.core.mutate({trans:U,type:"put",keys:D,values:Y,wantResults:L}).then(function(Z){var q=Z.numFailures,it=Z.results,K=Z.lastResult,Z=Z.failures;if(q===0)return L?it:K;throw new Gt("".concat(x.name,".bulkPut(): ").concat(q," of ").concat(X," operations failed"),Z)})})},Ge.prototype.bulkUpdate=function(g){var v=this,A=this.core,x=g.map(function(U){return U.key}),D=g.map(function(U){return U.changes}),L=[];return this._trans("readwrite",function(U){return A.getMany({trans:U,keys:x,cache:"clone"}).then(function($){var X=[],Y=[];g.forEach(function(q,it){var K=q.key,Z=q.changes,tt=$[it];if(tt){for(var nt=0,at=Object.keys(Z);nt<at.length;nt++){var ut=at[nt],bt=Z[ut];if(ut===v.schema.primKey.keyPath){if(Re(bt,K)!==0)throw new Dt.Constraint("Cannot update primary key in bulkUpdate()")}else H(tt,ut,bt)}L.push(it),X.push(K),Y.push(tt)}});var et=X.length;return A.mutate({trans:U,type:"put",keys:X,values:Y,updates:{keys:x,changeSpecs:D}}).then(function(q){var it=q.numFailures,K=q.failures;if(it===0)return et;for(var Z=0,tt=Object.keys(K);Z<tt.length;Z++){var nt,at=tt[Z],ut=L[Number(at)];ut!=null&&(nt=K[at],delete K[at],K[ut]=nt)}throw new Gt("".concat(v.name,".bulkUpdate(): ").concat(it," of ").concat(et," operations failed"),K)})})})},Ge.prototype.bulkDelete=function(g){var v=this,A=g.length;return this._trans("readwrite",function(x){return v.core.mutate({trans:x,type:"delete",keys:g}).then(function(D){return Gi(v,g,D)})}).then(function(U){var D=U.numFailures,L=U.lastResult,U=U.failures;if(D===0)return L;throw new Gt("".concat(v.name,".bulkDelete(): ").concat(D," of ").concat(A," operations failed"),U)})},Ge);function Ge(){}function Zu(g){function v(U,$){if($){for(var X=arguments.length,Y=new Array(X-1);--X;)Y[X-1]=arguments[X];return A[U].subscribe.apply(null,Y),g}if(typeof U=="string")return A[U]}var A={};v.addEventType=L;for(var x=1,D=arguments.length;x<D;++x)L(arguments[x]);return v;function L(U,$,X){if(typeof U!="object"){var Y;$=$||Bo;var et={subscribers:[],fire:X=X||Ee,subscribe:function(q){et.subscribers.indexOf(q)===-1&&(et.subscribers.push(q),et.fire=$(et.fire,q))},unsubscribe:function(q){et.subscribers=et.subscribers.filter(function(it){return it!==q}),et.fire=et.subscribers.reduce($,X)}};return A[U]=v[U]=et}u(Y=U).forEach(function(q){var it=Y[q];if(h(it))L(q,Y[q][0],Y[q][1]);else{if(it!=="asap")throw new Dt.InvalidArgument("Invalid event config");var K=L(q,os,function(){for(var Z=arguments.length,tt=new Array(Z);Z--;)tt[Z]=arguments[Z];K.subscribers.forEach(function(nt){z(function(){nt.apply(null,tt)})})})}})}}function Di(g,v){return C(v).from({prototype:g}),v}function Kr(g,v){return!(g.filter||g.algorithm||g.or)&&(v?g.justLimit:!g.replayFilter)}function nf(g,v){g.filter=jo(g.filter,v)}function th(g,v,A){var x=g.replayFilter;g.replayFilter=x?function(){return jo(x(),v())}:v,g.justLimit=A&&!x}function br(g,v){if(g.isPrimKey)return v.primaryKey;var A=v.getIndexByKeyPath(g.index);if(!A)throw new Dt.Schema("KeyPath "+g.index+" on object store "+v.name+" is not indexed");return A}function tg(g,v,A){var x=br(g,v.schema);return v.openCursor({trans:A,values:!g.keysOnly,reverse:g.dir==="prev",unique:!!g.unique,query:{index:x,range:g.range}})}function eh(g,v,A,x){var D=g.replayFilter?jo(g.filter,g.replayFilter()):g.filter;if(g.or){var L={},U=function($,X,Y){var et,q;D&&!D(X,Y,function(it){return X.stop(it)},function(it){return X.fail(it)})||((q=""+(et=X.primaryKey))=="[object ArrayBuffer]"&&(q=""+new Uint8Array(et)),b(L,q)||(L[q]=!0,v($,X,Y)))};return Promise.all([g.or._iterate(U,A),Ho(tg(g,x,A),g.algorithm,U,!g.keysOnly&&g.valueMapper)])}return Ho(tg(g,x,A),jo(g.algorithm,D),v,!g.keysOnly&&g.valueMapper)}function Ho(g,v,A,x){var D=dn(x?function(L,U,$){return A(x(L),U,$)}:A);return g.then(function(L){if(L)return L.start(function(){var U=function(){return L.continue()};v&&!v(L,function($){return U=$},function($){L.stop($),U=Ee},function($){L.fail($),U=Ee})||D(L.value,L,function($){return U=$}),U()})})}var OA=(Ie.prototype._read=function(g,v){var A=this._ctx;return A.error?A.table._trans(null,tn.bind(null,A.error)):A.table._trans("readonly",g).then(v)},Ie.prototype._write=function(g){var v=this._ctx;return v.error?v.table._trans(null,tn.bind(null,v.error)):v.table._trans("readwrite",g,"locked")},Ie.prototype._addAlgorithm=function(g){var v=this._ctx;v.algorithm=jo(v.algorithm,g)},Ie.prototype._iterate=function(g,v){return eh(this._ctx,g,v,this._ctx.table.core)},Ie.prototype.clone=function(g){var v=Object.create(this.constructor.prototype),A=Object.create(this._ctx);return g&&f(A,g),v._ctx=A,v},Ie.prototype.raw=function(){return this._ctx.valueMapper=null,this},Ie.prototype.each=function(g){var v=this._ctx;return this._read(function(A){return eh(v,g,A,v.table.core)})},Ie.prototype.count=function(g){var v=this;return this._read(function(A){var x=v._ctx,D=x.table.core;if(Kr(x,!0))return D.count({trans:A,query:{index:br(x,D.schema),range:x.range}}).then(function(U){return Math.min(U,x.limit)});var L=0;return eh(x,function(){return++L,!1},A,D).then(function(){return L})}).then(g)},Ie.prototype.sortBy=function(g,v){var A=g.split(".").reverse(),x=A[0],D=A.length-1;function L(X,Y){return Y?L(X[A[Y]],Y-1):X[x]}var U=this._ctx.dir==="next"?1:-1;function $(X,Y){return Re(L(X,D),L(Y,D))*U}return this.toArray(function(X){return X.sort($)}).then(v)},Ie.prototype.toArray=function(g){var v=this;return this._read(function(A){var x=v._ctx;if(x.dir==="next"&&Kr(x,!0)&&0<x.limit){var D=x.valueMapper,L=br(x,x.table.core.schema);return x.table.core.query({trans:A,limit:x.limit,values:!0,query:{index:L,range:x.range}}).then(function($){return $=$.result,D?$.map(D):$})}var U=[];return eh(x,function($){return U.push($)},A,x.table.core).then(function(){return U})},g)},Ie.prototype.offset=function(g){var v=this._ctx;return g<=0||(v.offset+=g,Kr(v)?th(v,function(){var A=g;return function(x,D){return A===0||(A===1?--A:D(function(){x.advance(A),A=0}),!1)}}):th(v,function(){var A=g;return function(){return--A<0}})),this},Ie.prototype.limit=function(g){return this._ctx.limit=Math.min(this._ctx.limit,g),th(this._ctx,function(){var v=g;return function(A,x,D){return--v<=0&&x(D),0<=v}},!0),this},Ie.prototype.until=function(g,v){return nf(this._ctx,function(A,x,D){return!g(A.value)||(x(D),v)}),this},Ie.prototype.first=function(g){return this.limit(1).toArray(function(v){return v[0]}).then(g)},Ie.prototype.last=function(g){return this.reverse().first(g)},Ie.prototype.filter=function(g){var v;return nf(this._ctx,function(A){return g(A.value)}),(v=this._ctx).isMatch=jo(v.isMatch,g),this},Ie.prototype.and=function(g){return this.filter(g)},Ie.prototype.or=function(g){return new this.db.WhereClause(this._ctx.table,g,this)},Ie.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Ie.prototype.desc=function(){return this.reverse()},Ie.prototype.eachKey=function(g){var v=this._ctx;return v.keysOnly=!v.isMatch,this.each(function(A,x){g(x.key,x)})},Ie.prototype.eachUniqueKey=function(g){return this._ctx.unique="unique",this.eachKey(g)},Ie.prototype.eachPrimaryKey=function(g){var v=this._ctx;return v.keysOnly=!v.isMatch,this.each(function(A,x){g(x.primaryKey,x)})},Ie.prototype.keys=function(g){var v=this._ctx;v.keysOnly=!v.isMatch;var A=[];return this.each(function(x,D){A.push(D.key)}).then(function(){return A}).then(g)},Ie.prototype.primaryKeys=function(g){var v=this._ctx;if(v.dir==="next"&&Kr(v,!0)&&0<v.limit)return this._read(function(x){var D=br(v,v.table.core.schema);return v.table.core.query({trans:x,values:!1,limit:v.limit,query:{index:D,range:v.range}})}).then(function(x){return x.result}).then(g);v.keysOnly=!v.isMatch;var A=[];return this.each(function(x,D){A.push(D.primaryKey)}).then(function(){return A}).then(g)},Ie.prototype.uniqueKeys=function(g){return this._ctx.unique="unique",this.keys(g)},Ie.prototype.firstKey=function(g){return this.limit(1).keys(function(v){return v[0]}).then(g)},Ie.prototype.lastKey=function(g){return this.reverse().firstKey(g)},Ie.prototype.distinct=function(){var g=this._ctx,g=g.index&&g.table.schema.idxByName[g.index];if(!g||!g.multi)return this;var v={};return nf(this._ctx,function(D){var x=D.primaryKey.toString(),D=b(v,x);return v[x]=!0,!D}),this},Ie.prototype.modify=function(g){var v=this,A=this._ctx;return this._write(function(x){var D=typeof g=="function"?g:function(tt){return ef(tt,g)},L=A.table.core,Y=L.schema.primaryKey,U=Y.outbound,$=Y.extractKey,X=200,Y=v.db._options.modifyChunkSize;Y&&(X=typeof Y=="object"?Y[L.name]||Y["*"]||200:Y);function et(tt,ut){var at=ut.failures,ut=ut.numFailures;it+=tt-ut;for(var bt=0,At=u(at);bt<At.length;bt++){var Rt=At[bt];q.push(at[Rt])}}var q=[],it=0,K=[],Z=g===eg;return v.clone().primaryKeys().then(function(tt){function nt(ut){var bt=Math.min(X,tt.length-ut),At=tt.slice(ut,ut+bt);return(Z?Promise.resolve([]):L.getMany({trans:x,keys:At,cache:"immutable"})).then(function(Rt){var kt=[],xt=[],Ot=U?[]:null,Nt=Z?At:[];if(!Z)for(var Tt=0;Tt<bt;++Tt){var zt=Rt[Tt],ne={value:Xt(zt),primKey:tt[ut+Tt]};D.call(ne,ne.value,ne)!==!1&&(ne.value==null?Nt.push(tt[ut+Tt]):U||Re($(zt),$(ne.value))===0?(xt.push(ne.value),U&&Ot.push(tt[ut+Tt])):(Nt.push(tt[ut+Tt]),kt.push(ne.value)))}return Promise.resolve(0<kt.length&&L.mutate({trans:x,type:"add",values:kt}).then(function(he){for(var we in he.failures)Nt.splice(parseInt(we),1);et(kt.length,he)})).then(function(){return(0<xt.length||at&&typeof g=="object")&&L.mutate({trans:x,type:"put",keys:Ot,values:xt,criteria:at,changeSpec:typeof g!="function"&&g,isAdditionalChunk:0<ut}).then(function(he){return et(xt.length,he)})}).then(function(){return(0<Nt.length||at&&Z)&&L.mutate({trans:x,type:"delete",keys:Nt,criteria:at,isAdditionalChunk:0<ut}).then(function(he){return Gi(A.table,Nt,he)}).then(function(he){return et(Nt.length,he)})}).then(function(){return tt.length>ut+bt&&nt(ut+X)})})}var at=Kr(A)&&A.limit===1/0&&(typeof g!="function"||Z)&&{index:A.index,range:A.range};return nt(0).then(function(){if(0<q.length)throw new It("Error modifying one or more objects",q,it,K);return tt.length})})})},Ie.prototype.delete=function(){var g=this._ctx,v=g.range;return!Kr(g)||g.table.schema.yProps||!g.isPrimKey&&v.type!==3?this.modify(eg):this._write(function(A){var x=g.table.core.schema.primaryKey,D=v;return g.table.core.count({trans:A,query:{index:x,range:D}}).then(function(L){return g.table.core.mutate({trans:A,type:"deleteRange",range:D}).then(function(X){var $=X.failures,X=X.numFailures;if(X)throw new It("Could not delete some values",Object.keys($).map(function(Y){return $[Y]}),L-X);return L-X})})})},Ie);function Ie(){}var eg=function(g,v){return v.value=null};function ng(g,v){return g<v?-1:g===v?0:1}function DA(g,v){return v<g?-1:g===v?0:1}function As(g,v,A){return g=g instanceof $o?new g.Collection(g):g,g._ctx.error=new(A||TypeError)(v),g}function vr(g){return new g.Collection(g,function(){return sf("")}).limit(0)}function Ls(g,v,A,x){var D,L,U,$,X,Y,et,q=A.length;if(!A.every(function(Z){return typeof Z=="string"}))return As(g,Jn);function it(Z){D=Z==="next"?function(nt){return nt.toUpperCase()}:function(nt){return nt.toLowerCase()},L=Z==="next"?function(nt){return nt.toLowerCase()}:function(nt){return nt.toUpperCase()},U=Z==="next"?ng:DA;var tt=A.map(function(nt){return{lower:L(nt),upper:D(nt)}}).sort(function(nt,at){return U(nt.lower,at.lower)});$=tt.map(function(nt){return nt.upper}),X=tt.map(function(nt){return nt.lower}),et=(Y=Z)==="next"?"":x}it("next"),g=new g.Collection(g,function(){return Ua($[0],X[q-1]+x)}),g._ondirectionchange=function(Z){it(Z)};var K=0;return g._addAlgorithm(function(Z,tt,nt){var at=Z.key;if(typeof at!="string")return!1;var ut=L(at);if(v(ut,X,K))return!0;for(var bt=null,At=K;At<q;++At){var Rt=(function(kt,xt,Ot,Nt,Tt,zt){for(var ne=Math.min(kt.length,Nt.length),he=-1,we=0;we<ne;++we){var ki=xt[we];if(ki!==Nt[we])return Tt(kt[we],Ot[we])<0?kt.substr(0,we)+Ot[we]+Ot.substr(we+1):Tt(kt[we],Nt[we])<0?kt.substr(0,we)+Nt[we]+Ot.substr(we+1):0<=he?kt.substr(0,he)+xt[he]+Ot.substr(he+1):null;Tt(kt[we],ki)<0&&(he=we)}return ne<Nt.length&&zt==="next"?kt+Ot.substr(kt.length):ne<kt.length&&zt==="prev"?kt.substr(0,Ot.length):he<0?null:kt.substr(0,he)+Nt[he]+Ot.substr(he+1)})(at,ut,$[At],X[At],U,Y);Rt===null&&bt===null?K=At+1:(bt===null||0<U(bt,Rt))&&(bt=Rt)}return tt(bt!==null?function(){Z.continue(bt+et)}:nt),!1}),g}function Ua(g,v,A,x){return{type:2,lower:g,upper:v,lowerOpen:A,upperOpen:x}}function sf(g){return{type:1,lower:g,upper:g}}var $o=(Object.defineProperty(Cn.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Cn.prototype.between=function(g,v,A,x){A=A!==!1,x=x===!0;try{return 0<this._cmp(g,v)||this._cmp(g,v)===0&&(A||x)&&(!A||!x)?vr(this):new this.Collection(this,function(){return Ua(g,v,!A,!x)})}catch{return As(this,ls)}},Cn.prototype.equals=function(g){return g==null?As(this,ls):new this.Collection(this,function(){return sf(g)})},Cn.prototype.above=function(g){return g==null?As(this,ls):new this.Collection(this,function(){return Ua(g,void 0,!0)})},Cn.prototype.aboveOrEqual=function(g){return g==null?As(this,ls):new this.Collection(this,function(){return Ua(g,void 0,!1)})},Cn.prototype.below=function(g){return g==null?As(this,ls):new this.Collection(this,function(){return Ua(void 0,g,!1,!0)})},Cn.prototype.belowOrEqual=function(g){return g==null?As(this,ls):new this.Collection(this,function(){return Ua(void 0,g)})},Cn.prototype.startsWith=function(g){return typeof g!="string"?As(this,Jn):this.between(g,g+ea,!0,!0)},Cn.prototype.startsWithIgnoreCase=function(g){return g===""?this.startsWith(g):Ls(this,function(v,A){return v.indexOf(A[0])===0},[g],ea)},Cn.prototype.equalsIgnoreCase=function(g){return Ls(this,function(v,A){return v===A[0]},[g],"")},Cn.prototype.anyOfIgnoreCase=function(){var g=Zt.apply(Wt,arguments);return g.length===0?vr(this):Ls(this,function(v,A){return A.indexOf(v)!==-1},g,"")},Cn.prototype.startsWithAnyOfIgnoreCase=function(){var g=Zt.apply(Wt,arguments);return g.length===0?vr(this):Ls(this,function(v,A){return A.some(function(x){return v.indexOf(x)===0})},g,ea)},Cn.prototype.anyOf=function(){var g=this,v=Zt.apply(Wt,arguments),A=this._cmp;try{v.sort(A)}catch{return As(this,ls)}if(v.length===0)return vr(this);var x=new this.Collection(this,function(){return Ua(v[0],v[v.length-1])});x._ondirectionchange=function(L){A=L==="next"?g._ascending:g._descending,v.sort(A)};var D=0;return x._addAlgorithm(function(L,U,$){for(var X=L.key;0<A(X,v[D]);)if(++D===v.length)return U($),!1;return A(X,v[D])===0||(U(function(){L.continue(v[D])}),!1)}),x},Cn.prototype.notEqual=function(g){return this.inAnyRange([[-1/0,g],[g,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Cn.prototype.noneOf=function(){var g=Zt.apply(Wt,arguments);if(g.length===0)return new this.Collection(this);try{g.sort(this._ascending)}catch{return As(this,ls)}var v=g.reduce(function(A,x){return A?A.concat([[A[A.length-1][1],x]]):[[-1/0,x]]},null);return v.push([g[g.length-1],this.db._maxKey]),this.inAnyRange(v,{includeLowers:!1,includeUppers:!1})},Cn.prototype.inAnyRange=function(at,v){var A=this,x=this._cmp,D=this._ascending,L=this._descending,U=this._min,$=this._max;if(at.length===0)return vr(this);if(!at.every(function(ut){return ut[0]!==void 0&&ut[1]!==void 0&&D(ut[0],ut[1])<=0}))return As(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Dt.InvalidArgument);var X=!v||v.includeLowers!==!1,Y=v&&v.includeUppers===!0,et,q=D;function it(ut,bt){return q(ut[0],bt[0])}try{(et=at.reduce(function(ut,bt){for(var At=0,Rt=ut.length;At<Rt;++At){var kt=ut[At];if(x(bt[0],kt[1])<0&&0<x(bt[1],kt[0])){kt[0]=U(kt[0],bt[0]),kt[1]=$(kt[1],bt[1]);break}}return At===Rt&&ut.push(bt),ut},[])).sort(it)}catch{return As(this,ls)}var K=0,Z=Y?function(ut){return 0<D(ut,et[K][1])}:function(ut){return 0<=D(ut,et[K][1])},tt=X?function(ut){return 0<L(ut,et[K][0])}:function(ut){return 0<=L(ut,et[K][0])},nt=Z,at=new this.Collection(this,function(){return Ua(et[0][0],et[et.length-1][1],!X,!Y)});return at._ondirectionchange=function(ut){q=ut==="next"?(nt=Z,D):(nt=tt,L),et.sort(it)},at._addAlgorithm(function(ut,bt,At){for(var Rt,kt=ut.key;nt(kt);)if(++K===et.length)return bt(At),!1;return!Z(Rt=kt)&&!tt(Rt)||(A._cmp(kt,et[K][1])===0||A._cmp(kt,et[K][0])===0||bt(function(){q===D?ut.continue(et[K][0]):ut.continue(et[K][1])}),!1)}),at},Cn.prototype.startsWithAnyOf=function(){var g=Zt.apply(Wt,arguments);return g.every(function(v){return typeof v=="string"})?g.length===0?vr(this):this.inAnyRange(g.map(function(v){return[v,v+ea]})):As(this,"startsWithAnyOf() only works with strings")},Cn);function Cn(){}function na(g){return dn(function(v){return Vo(v),g(v.target.error),!1})}function Vo(g){g.stopPropagation&&g.stopPropagation(),g.preventDefault&&g.preventDefault()}var dc="storagemutated",Go="x-storagemutated-1",Mi=Zu(null,dc),ig=(cs.prototype._lock=function(){return F(!Ut.global),++this._reculock,this._reculock!==1||Ut.global||(Ut.lockOwnerFor=this),this},cs.prototype._unlock=function(){if(F(!Ut.global),--this._reculock==0)for(Ut.global||(Ut.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var g=this._blockedFuncs.shift();try{ta(g[1],g[0])}catch{}}return this},cs.prototype._locked=function(){return this._reculock&&Ut.lockOwnerFor!==this},cs.prototype.create=function(g){var v=this;if(!this.mode)return this;var A=this.db.idbdb,x=this.db._state.dbOpenError;if(F(!this.idbtrans),!g&&!A)switch(x&&x.name){case"DatabaseClosedError":throw new Dt.DatabaseClosed(x);case"MissingAPIError":throw new Dt.MissingAPI(x.message,x);default:throw new Dt.OpenFailed(x)}if(!this.active)throw new Dt.TransactionInactive;return F(this._completion._state===null),(g=this.idbtrans=g||(this.db.core||A).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=dn(function(D){Vo(D),v._reject(g.error)}),g.onabort=dn(function(D){Vo(D),v.active&&v._reject(new Dt.Abort(g.error)),v.active=!1,v.on("abort").fire(D)}),g.oncomplete=dn(function(){v.active=!1,v._resolve(),"mutatedParts"in g&&Mi.storagemutated.fire(g.mutatedParts)}),this},cs.prototype._promise=function(g,v,A){var x=this;if(g==="readwrite"&&this.mode!=="readwrite")return tn(new Dt.ReadOnly("Transaction is readonly"));if(!this.active)return tn(new Dt.TransactionInactive);if(this._locked())return new Lt(function(L,U){x._blockedFuncs.push([function(){x._promise(g,v,A).then(L,U)},Ut])});if(A)return vn(function(){var L=new Lt(function(U,$){x._lock();var X=v(U,$,x);X&&X.then&&X.then(U,$)});return L.finally(function(){return x._unlock()}),L._lib=!0,L});var D=new Lt(function(L,U){var $=v(L,U,x);$&&$.then&&$.then(L,U)});return D._lib=!0,D},cs.prototype._root=function(){return this.parent?this.parent._root():this},cs.prototype.waitFor=function(g){var v,A=this._root(),x=Lt.resolve(g);A._waitingFor?A._waitingFor=A._waitingFor.then(function(){return x}):(A._waitingFor=x,A._waitingQueue=[],v=A.idbtrans.objectStore(A.storeNames[0]),(function L(){for(++A._spinCount;A._waitingQueue.length;)A._waitingQueue.shift()();A._waitingFor&&(v.get(-1/0).onsuccess=L)})());var D=A._waitingFor;return new Lt(function(L,U){x.then(function($){return A._waitingQueue.push(dn(L.bind(null,$)))},function($){return A._waitingQueue.push(dn(U.bind(null,$)))}).finally(function(){A._waitingFor===D&&(A._waitingFor=null)})})},cs.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Dt.Abort))},cs.prototype.table=function(g){var v=this._memoizedTables||(this._memoizedTables={});if(b(v,g))return v[g];var A=this.schema[g];if(!A)throw new Dt.NotFound("Table "+g+" not part of transaction");return A=new this.db.Table(g,A,this),A.core=this.db.core.table(g),v[g]=A},cs);function cs(){}function za(g,v,A,x,D,L,U,$){return{name:g,keyPath:v,unique:A,multi:x,auto:D,compound:L,src:(A&&!U?"&":"")+(x?"*":"")+(D?"++":"")+af(v),type:$}}function af(g){return typeof g=="string"?g:g?"["+[].join.call(g,"+")+"]":""}function fc(g,v,A){return{name:g,primKey:v,indexes:A,mappedClass:null,idxByName:(x=function(D){return[D.name,D]},A.reduce(function(D,L,U){return U=x(L,U),U&&(D[U[0]]=U[1]),D},{}))};var x}var pc=function(g){try{return g.only([[]]),pc=function(){return[[]]},[[]]}catch{return pc=function(){return ea},ea}};function mc(g){return g==null?function(){}:typeof g=="string"?(v=g).split(".").length===1?function(A){return A[v]}:function(A){return j(A,v)}:function(A){return j(A,g)};var v}function nh(g){return[].slice.call(g)}var Jv=0;function ii(g){return g==null?":id":typeof g=="string"?g:"[".concat(g.join("+"),"]")}function qo(g,v,X){function x(nt){if(nt.type===3)return null;if(nt.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var K=nt.lower,Z=nt.upper,tt=nt.lowerOpen,nt=nt.upperOpen;return K===void 0?Z===void 0?null:v.upperBound(Z,!!nt):Z===void 0?v.lowerBound(K,!!tt):v.bound(K,Z,!!tt,!!nt)}function D(it){var K,Z=it.name;return{name:Z,schema:it,mutate:function(tt){var nt=tt.trans,at=tt.type,ut=tt.keys,bt=tt.values,At=tt.range;return new Promise(function(Rt,kt){Rt=dn(Rt);var xt=nt.objectStore(Z),Ot=xt.keyPath==null,Nt=at==="put"||at==="add";if(!Nt&&at!=="delete"&&at!=="deleteRange")throw new Error("Invalid operation type: "+at);var Tt,zt=(ut||bt||{length:1}).length;if(ut&&bt&&ut.length!==bt.length)throw new Error("Given keys array must have same length as given values array.");if(zt===0)return Rt({numFailures:0,failures:{},results:[],lastResult:void 0});function ne(ai){++ki,Vo(ai)}var he=[],we=[],ki=0;if(at==="deleteRange"){if(At.type===4)return Rt({numFailures:ki,failures:we,results:[],lastResult:void 0});At.type===3?he.push(Tt=xt.clear()):he.push(Tt=xt.delete(x(At)))}else{var Ot=Nt?Ot?[bt,ut]:[bt,null]:[ut,null],ce=Ot[0],si=Ot[1];if(Nt)for(var Mn=0;Mn<zt;++Mn)he.push(Tt=si&&si[Mn]!==void 0?xt[at](ce[Mn],si[Mn]):xt[at](ce[Mn])),Tt.onerror=ne;else for(Mn=0;Mn<zt;++Mn)he.push(Tt=xt[at](ce[Mn])),Tt.onerror=ne}function ch(ai){ai=ai.target.result,he.forEach(function(Is,yg){return Is.error!=null&&(we[yg]=Is.error)}),Rt({numFailures:ki,failures:we,results:at==="delete"?ut:he.map(function(Is){return Is.result}),lastResult:ai})}Tt.onerror=function(ai){ne(ai),ch(ai)},Tt.onsuccess=ch})},getMany:function(tt){var nt=tt.trans,at=tt.keys;return new Promise(function(ut,bt){ut=dn(ut);for(var At,Rt=nt.objectStore(Z),kt=at.length,xt=new Array(kt),Ot=0,Nt=0,Tt=function(he){he=he.target,xt[he._pos]=he.result,++Nt===Ot&&ut(xt)},zt=na(bt),ne=0;ne<kt;++ne)at[ne]!=null&&((At=Rt.get(at[ne]))._pos=ne,At.onsuccess=Tt,At.onerror=zt,++Ot);Ot===0&&ut(xt)})},get:function(tt){var nt=tt.trans,at=tt.key;return new Promise(function(ut,bt){ut=dn(ut);var At=nt.objectStore(Z).get(at);At.onsuccess=function(Rt){return ut(Rt.target.result)},At.onerror=na(bt)})},query:(K=Y,function(tt){return new Promise(function(nt,at){nt=dn(nt);var ut,bt,At,Ot=tt.trans,Rt=tt.values,kt=tt.limit,Tt=tt.query,xt=kt===1/0?void 0:kt,Nt=Tt.index,Tt=Tt.range,Ot=Ot.objectStore(Z),Nt=Nt.isPrimaryKey?Ot:Ot.index(Nt.name),Tt=x(Tt);if(kt===0)return nt({result:[]});K?((xt=Rt?Nt.getAll(Tt,xt):Nt.getAllKeys(Tt,xt)).onsuccess=function(zt){return nt({result:zt.target.result})},xt.onerror=na(at)):(ut=0,bt=!Rt&&"openKeyCursor"in Nt?Nt.openKeyCursor(Tt):Nt.openCursor(Tt),At=[],bt.onsuccess=function(zt){var ne=bt.result;return ne?(At.push(Rt?ne.value:ne.primaryKey),++ut===kt?nt({result:At}):void ne.continue()):nt({result:At})},bt.onerror=na(at))})}),openCursor:function(tt){var nt=tt.trans,at=tt.values,ut=tt.query,bt=tt.reverse,At=tt.unique;return new Promise(function(Rt,kt){Rt=dn(Rt);var Nt=ut.index,xt=ut.range,Ot=nt.objectStore(Z),Ot=Nt.isPrimaryKey?Ot:Ot.index(Nt.name),Nt=bt?At?"prevunique":"prev":At?"nextunique":"next",Tt=!at&&"openKeyCursor"in Ot?Ot.openKeyCursor(x(xt),Nt):Ot.openCursor(x(xt),Nt);Tt.onerror=na(kt),Tt.onsuccess=dn(function(zt){var ne,he,we,ki,ce=Tt.result;ce?(ce.___id=++Jv,ce.done=!1,ne=ce.continue.bind(ce),he=(he=ce.continuePrimaryKey)&&he.bind(ce),we=ce.advance.bind(ce),ki=function(){throw new Error("Cursor not stopped")},ce.trans=nt,ce.stop=ce.continue=ce.continuePrimaryKey=ce.advance=function(){throw new Error("Cursor not started")},ce.fail=dn(kt),ce.next=function(){var si=this,Mn=1;return this.start(function(){return Mn--?si.continue():si.stop()}).then(function(){return si})},ce.start=function(si){function Mn(){if(Tt.result)try{si()}catch(ai){ce.fail(ai)}else ce.done=!0,ce.start=function(){throw new Error("Cursor behind last entry")},ce.stop()}var ch=new Promise(function(ai,Is){ai=dn(ai),Tt.onerror=na(Is),ce.fail=Is,ce.stop=function(yg){ce.stop=ce.continue=ce.continuePrimaryKey=ce.advance=ki,ai(yg)}});return Tt.onsuccess=dn(function(ai){Tt.onsuccess=Mn,Mn()}),ce.continue=ne,ce.continuePrimaryKey=he,ce.advance=we,Mn(),ch},Rt(ce)):Rt(null)},kt)})},count:function(tt){var nt=tt.query,at=tt.trans,ut=nt.index,bt=nt.range;return new Promise(function(At,Rt){var kt=at.objectStore(Z),xt=ut.isPrimaryKey?kt:kt.index(ut.name),kt=x(bt),xt=kt?xt.count(kt):xt.count();xt.onsuccess=dn(function(Ot){return At(Ot.target.result)}),xt.onerror=na(Rt)})}}}var L,U,$,et=(U=X,$=nh((L=g).objectStoreNames),{schema:{name:L.name,tables:$.map(function(it){return U.objectStore(it)}).map(function(it){var K=it.keyPath,nt=it.autoIncrement,Z=h(K),tt={},nt={name:it.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:K==null,compound:Z,keyPath:K,autoIncrement:nt,unique:!0,extractKey:mc(K)},indexes:nh(it.indexNames).map(function(at){return it.index(at)}).map(function(At){var ut=At.name,bt=At.unique,Rt=At.multiEntry,At=At.keyPath,Rt={name:ut,compound:h(At),keyPath:At,unique:bt,multiEntry:Rt,extractKey:mc(At)};return tt[ii(At)]=Rt}),getIndexByKeyPath:function(at){return tt[ii(at)]}};return tt[":id"]=nt.primaryKey,K!=null&&(tt[ii(K)]=nt.primaryKey),nt})},hasGetAll:0<$.length&&"getAll"in U.objectStore($[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),X=et.schema,Y=et.hasGetAll,et=X.tables.map(D),q={};return et.forEach(function(it){return q[it.name]=it}),{stack:"dbcore",transaction:g.transaction.bind(g),table:function(it){if(!q[it])throw new Error("Table '".concat(it,"' not found"));return q[it]},MIN_KEY:-1/0,MAX_KEY:pc(v),schema:X}}function rf(g,v,A,x){var D=A.IDBKeyRange;return A.indexedDB,{dbcore:(x=qo(v,D,x),g.dbcore.reduce(function(L,U){return U=U.create,n(n({},L),U(L))},x))}}function Wr(g,x){var A=x.db,x=rf(g._middlewares,A,g._deps,x);g.core=x.dbcore,g.tables.forEach(function(D){var L=D.name;g.core.schema.tables.some(function(U){return U.name===L})&&(D.core=g.core.table(L),g[L]instanceof g.Table&&(g[L].core=D.core))})}function of(g,v,A,x){A.forEach(function(D){var L=x[D];v.forEach(function(U){var $=(function X(Y,et){return M(Y,et)||(Y=p(Y))&&X(Y,et)})(U,D);(!$||"value"in $&&$.value===void 0)&&(U===g.Transaction.prototype||U instanceof g.Transaction?R(U,D,{get:function(){return this.table(D)},set:function(X){S(this,D,{value:X,writable:!0,configurable:!0,enumerable:!0})}}):U[D]=new g.Table(D,L))})})}function ih(g,v){v.forEach(function(A){for(var x in A)A[x]instanceof g.Table&&delete A[x]})}function sg(g,v){return g._cfg.version-v._cfg.version}function sh(g,v,A,x){var D=g._dbSchema;A.objectStoreNames.contains("$meta")&&!D.$meta&&(D.$meta=fc("$meta",t0("")[0],[]),g._storeNames.push("$meta"));var L=g._createTransaction("readwrite",g._storeNames,D);L.create(A),L._completion.catch(x);var U=L._reject.bind(L),$=Ut.transless||Ut;vn(function(){return Ut.trans=L,Ut.transless=$,v!==0?(Wr(g,A),Y=v,((X=L).storeNames.includes("$meta")?X.table("$meta").get("version").then(function(et){return et??Y}):Lt.resolve(Y)).then(function(et){return it=et,K=L,Z=A,tt=[],et=(q=g)._versions,nt=q._dbSchema=gc(0,q.idbdb,Z),(et=et.filter(function(at){return at._cfg.version>=it})).length!==0?(et.forEach(function(at){tt.push(function(){var ut=nt,bt=at._cfg.dbschema;hf(q,ut,Z),hf(q,bt,Z),nt=q._dbSchema=bt;var At=cf(ut,bt);At.add.forEach(function(Nt){ag(Z,Nt[0],Nt[1].primKey,Nt[1].indexes)}),At.change.forEach(function(Nt){if(Nt.recreate)throw new Dt.Upgrade("Not yet support for changing primary key");var Tt=Z.objectStore(Nt.name);Nt.add.forEach(function(zt){return uf(Tt,zt)}),Nt.change.forEach(function(zt){Tt.deleteIndex(zt.name),uf(Tt,zt)}),Nt.del.forEach(function(zt){return Tt.deleteIndex(zt)})});var Rt=at._cfg.contentUpgrade;if(Rt&&at._cfg.version>it){Wr(q,Z),K._memoizedTables={};var kt=dt(bt);At.del.forEach(function(Nt){kt[Nt]=ut[Nt]}),ih(q,[q.Transaction.prototype]),of(q,[q.Transaction.prototype],u(kt),kt),K.schema=kt;var xt,Ot=G(Rt);return Ot&&Qn(),At=Lt.follow(function(){var Nt;(xt=Rt(K))&&Ot&&(Nt=_s.bind(null,null),xt.then(Nt,Nt))}),xt&&typeof xt.then=="function"?Lt.resolve(xt):At.then(function(){return xt})}}),tt.push(function(ut){var bt,At,Rt=at._cfg.dbschema;bt=Rt,At=ut,[].slice.call(At.db.objectStoreNames).forEach(function(kt){return bt[kt]==null&&At.db.deleteObjectStore(kt)}),ih(q,[q.Transaction.prototype]),of(q,[q.Transaction.prototype],q._storeNames,q._dbSchema),K.schema=q._dbSchema}),tt.push(function(ut){q.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(q.idbdb.version/10)===at._cfg.version?(q.idbdb.deleteObjectStore("$meta"),delete q._dbSchema.$meta,q._storeNames=q._storeNames.filter(function(bt){return bt!=="$meta"})):ut.objectStore("$meta").put(at._cfg.version,"version"))})}),(function at(){return tt.length?Lt.resolve(tt.shift()(K.idbtrans)).then(at):Lt.resolve()})().then(function(){Zv(nt,Z)})):Lt.resolve();var q,it,K,Z,tt,nt}).catch(U)):(u(D).forEach(function(et){ag(A,et,D[et].primKey,D[et].indexes)}),Wr(g,A),void Lt.follow(function(){return g.on.populate.fire(L)}).catch(U));var X,Y})}function lf(g,v){Zv(g._dbSchema,v),v.db.version%10!=0||v.objectStoreNames.contains("$meta")||v.db.createObjectStore("$meta").add(Math.ceil(v.db.version/10-1),"version");var A=gc(0,g.idbdb,v);hf(g,g._dbSchema,v);for(var x=0,D=cf(A,g._dbSchema).change;x<D.length;x++){var L=(function(U){if(U.change.length||U.recreate)return console.warn("Unable to patch indexes of table ".concat(U.name," because it has changes on the type of index or primary key.")),{value:void 0};var $=v.objectStore(U.name);U.add.forEach(function(X){te&&console.debug("Dexie upgrade patch: Creating missing index ".concat(U.name,".").concat(X.src)),uf($,X)})})(D[x]);if(typeof L=="object")return L.value}}function cf(g,v){var A,x={del:[],add:[],change:[]};for(A in g)v[A]||x.del.push(A);for(A in v){var D=g[A],L=v[A];if(D){var U={name:A,def:L,recreate:!1,del:[],add:[],change:[]};if(""+(D.primKey.keyPath||"")!=""+(L.primKey.keyPath||"")||D.primKey.auto!==L.primKey.auto)U.recreate=!0,x.change.push(U);else{var $=D.idxByName,X=L.idxByName,Y=void 0;for(Y in $)X[Y]||U.del.push(Y);for(Y in X){var et=$[Y],q=X[Y];et?et.src!==q.src&&U.change.push(q):U.add.push(q)}(0<U.del.length||0<U.add.length||0<U.change.length)&&x.change.push(U)}}else x.add.push([A,L])}return x}function ag(g,v,A,x){var D=g.db.createObjectStore(v,A.keyPath?{keyPath:A.keyPath,autoIncrement:A.auto}:{autoIncrement:A.auto});return x.forEach(function(L){return uf(D,L)}),D}function Zv(g,v){u(g).forEach(function(A){v.db.objectStoreNames.contains(A)||(te&&console.debug("Dexie: Creating missing table",A),ag(v,A,g[A].primKey,g[A].indexes))})}function uf(g,v){g.createIndex(v.name,v.keyPath,{unique:v.unique,multiEntry:v.multi})}function gc(g,v,A){var x={};return I(v.objectStoreNames,0).forEach(function(D){for(var L=A.objectStore(D),U=za(af(Y=L.keyPath),Y||"",!0,!1,!!L.autoIncrement,Y&&typeof Y!="string",!0),$=[],X=0;X<L.indexNames.length;++X){var et=L.index(L.indexNames[X]),Y=et.keyPath,et=za(et.name,Y,!!et.unique,!!et.multiEntry,!1,Y&&typeof Y!="string",!1);$.push(et)}x[D]=fc(D,U,$)}),x}function hf(g,v,A){for(var x=A.db.objectStoreNames,D=0;D<x.length;++D){var L=x[D],U=A.objectStore(L);g._hasGetAll="getAll"in U;for(var $=0;$<U.indexNames.length;++$){var X=U.indexNames[$],Y=U.index(X).keyPath,et=typeof Y=="string"?Y:"["+I(Y).join("+")+"]";!v[L]||(Y=v[L].idxByName[et])&&(Y.name=X,delete v[L].idxByName[et],v[L].idxByName[X]=Y)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(g._hasGetAll=!1)}function t0(g){return g.split(",").map(function(v,A){var L=v.split(":"),x=(D=L[1])===null||D===void 0?void 0:D.trim(),D=(v=L[0].trim()).replace(/([&*]|\+\+)/g,""),L=/^\[/.test(D)?D.match(/^\[(.*)\]$/)[1].split("+"):D;return za(D,L||null,/\&/.test(v),/\*/.test(v),/\+\+/.test(v),h(L),A===0,x)})}var MA=(yc.prototype._createTableSchema=fc,yc.prototype._parseIndexSyntax=t0,yc.prototype._parseStoresSpec=function(g,v){var A=this;u(g).forEach(function(x){if(g[x]!==null){var D=A._parseIndexSyntax(g[x]),L=D.shift();if(!L)throw new Dt.Schema("Invalid schema for table "+x+": "+g[x]);if(L.unique=!0,L.multi)throw new Dt.Schema("Primary key cannot be multiEntry*");D.forEach(function(U){if(U.auto)throw new Dt.Schema("Only primary key can be marked as autoIncrement (++)");if(!U.keyPath)throw new Dt.Schema("Index must have a name and cannot be an empty string")}),D=A._createTableSchema(x,L,D),v[x]=D}})},yc.prototype.stores=function(A){var v=this.db;this._cfg.storesSource=this._cfg.storesSource?f(this._cfg.storesSource,A):A;var A=v._versions,x={},D={};return A.forEach(function(L){f(x,L._cfg.storesSource),D=L._cfg.dbschema={},L._parseStoresSpec(x,D)}),v._dbSchema=D,ih(v,[v._allTables,v,v.Transaction.prototype]),of(v,[v._allTables,v,v.Transaction.prototype,this._cfg.tables],u(D),D),v._storeNames=u(D),this},yc.prototype.upgrade=function(g){return this._cfg.contentUpgrade=pr(this._cfg.contentUpgrade||Ee,g),this},yc);function yc(){}function rg(g,v){var A=g._dbNamesDB;return A||(A=g._dbNamesDB=new ja(Wu,{addons:[],indexedDB:g,IDBKeyRange:v})).version(1).stores({dbnames:"name"}),A.table("dbnames")}function df(g){return g&&typeof g.databases=="function"}function og(g){return vn(function(){return Ut.letThrough=!0,g()})}function lg(g){return!("from"in g)}var Ni=function(g,v){if(!this){var A=new Ni;return g&&"d"in g&&f(A,g),A}f(this,arguments.length?{d:1,from:g,to:1<arguments.length?v:g}:{d:0})};function ah(g,v,A){var x=Re(v,A);if(!isNaN(x)){if(0<x)throw RangeError();if(lg(g))return f(g,{from:v,to:A,d:1});var D=g.l,x=g.r;if(Re(A,g.from)<0)return D?ah(D,v,A):g.l={from:v,to:A,d:1,l:null,r:null},n0(g);if(0<Re(v,g.to))return x?ah(x,v,A):g.r={from:v,to:A,d:1,l:null,r:null},n0(g);Re(v,g.from)<0&&(g.from=v,g.l=null,g.d=x?x.d+1:1),0<Re(A,g.to)&&(g.to=A,g.r=null,g.d=g.l?g.l.d+1:1),A=!g.r,D&&!g.l&&Xo(g,D),x&&A&&Xo(g,x)}}function Xo(g,v){lg(v)||(function A(x,X){var L=X.from,U=X.to,$=X.l,X=X.r;ah(x,L,U),$&&A(x,$),X&&A(x,X)})(g,v)}function e0(g,v){var A=ff(v),x=A.next();if(x.done)return!1;for(var D=x.value,L=ff(g),U=L.next(D.from),$=U.value;!x.done&&!U.done;){if(Re($.from,D.to)<=0&&0<=Re($.to,D.from))return!0;Re(D.from,$.from)<0?D=(x=A.next($.from)).value:$=(U=L.next(D.from)).value}return!1}function ff(g){var v=lg(g)?null:{s:0,n:g};return{next:function(A){for(var x=0<arguments.length;v;)switch(v.s){case 0:if(v.s=1,x)for(;v.n.l&&Re(A,v.n.from)<0;)v={up:v,n:v.n.l,s:1};else for(;v.n.l;)v={up:v,n:v.n.l,s:1};case 1:if(v.s=2,!x||Re(A,v.n.to)<=0)return{value:v.n,done:!1};case 2:if(v.n.r){v.s=3,v={up:v,n:v.n.r,s:0};continue}case 3:v=v.up}return{done:!0}}}}function n0(g){var v,A,x=(((v=g.r)===null||v===void 0?void 0:v.d)||0)-(((A=g.l)===null||A===void 0?void 0:A.d)||0),D=1<x?"r":x<-1?"l":"";D&&(v=D=="r"?"l":"r",A=n({},g),x=g[D],g.from=x.from,g.to=x.to,g[D]=x[D],A[D]=x[v],(g[v]=A).d=cg(A)),g.d=cg(g)}function cg(A){var v=A.r,A=A.l;return(v?A?Math.max(v.d,A.d):v.d:A?A.d:0)+1}function pf(g,v){return u(v).forEach(function(A){g[A]?Xo(g[A],v[A]):g[A]=(function x(D){var L,U,$={};for(L in D)b(D,L)&&(U=D[L],$[L]=!U||typeof U!="object"||gt.has(U.constructor)?U:x(U));return $})(v[A])}),g}function ug(g,v){return g.all||v.all||Object.keys(g).some(function(A){return v[A]&&e0(v[A],g[A])})}_(Ni.prototype,((Ss={add:function(g){return Xo(this,g),this},addKey:function(g){return ah(this,g,g),this},addKeys:function(g){var v=this;return g.forEach(function(A){return ah(v,A,A)}),this},hasKey:function(g){var v=ff(this).next(g).value;return v&&Re(v.from,g)<=0&&0<=Re(v.to,g)}})[J]=function(){return ff(this)},Ss));var Yo={},hg={},dg=!1;function mf(g){pf(hg,g),dg||(dg=!0,setTimeout(function(){dg=!1,fg(hg,!(hg={}))},0))}function fg(g,v){v===void 0&&(v=!1);var A=new Set;if(g.all)for(var x=0,D=Object.values(Yo);x<D.length;x++)i0(U=D[x],g,A,v);else for(var L in g){var U,$=/^idb\:\/\/(.*)\/(.*)\//.exec(L);$&&(L=$[1],$=$[2],(U=Yo["idb://".concat(L,"/").concat($)])&&i0(U,g,A,v))}A.forEach(function(X){return X()})}function i0(g,v,A,x){for(var D=[],L=0,U=Object.entries(g.queries.query);L<U.length;L++){for(var $=U[L],X=$[0],Y=[],et=0,q=$[1];et<q.length;et++){var it=q[et];ug(v,it.obsSet)?it.subscribers.forEach(function(nt){return A.add(nt)}):x&&Y.push(it)}x&&D.push([X,Y])}if(x)for(var K=0,Z=D;K<Z.length;K++){var tt=Z[K],X=tt[0],Y=tt[1];g.queries.query[X]=Y}}function NA(g){var v=g._state,A=g._deps.indexedDB;if(v.isBeingOpened||g.idbdb)return v.dbReadyPromise.then(function(){return v.dbOpenError?tn(v.dbOpenError):g});v.isBeingOpened=!0,v.dbOpenError=null,v.openComplete=!1;var x=v.openCanceller,D=Math.round(10*g.verno),L=!1;function U(){if(v.openCanceller!==x)throw new Dt.DatabaseClosed("db.open() was cancelled")}function $(){return new Lt(function(it,K){if(U(),!A)throw new Dt.MissingAPI;var Z=g.name,tt=v.autoSchema||!D?A.open(Z):A.open(Z,D);if(!tt)throw new Dt.MissingAPI;tt.onerror=na(K),tt.onblocked=dn(g._fireOnBlocked),tt.onupgradeneeded=dn(function(nt){var at;et=tt.transaction,v.autoSchema&&!g._options.allowEmptyDB?(tt.onerror=Vo,et.abort(),tt.result.close(),(at=A.deleteDatabase(Z)).onsuccess=at.onerror=dn(function(){K(new Dt.NoSuchDatabase("Database ".concat(Z," doesnt exist")))})):(et.onerror=na(K),nt=nt.oldVersion>Math.pow(2,62)?0:nt.oldVersion,q=nt<1,g.idbdb=tt.result,L&&lf(g,et),sh(g,nt/10,et,K))},K),tt.onsuccess=dn(function(){et=null;var nt,at,ut,bt,At,Rt=g.idbdb=tt.result,kt=I(Rt.objectStoreNames);if(0<kt.length)try{var xt=Rt.transaction((bt=kt).length===1?bt[0]:bt,"readonly");if(v.autoSchema)at=Rt,ut=xt,(nt=g).verno=at.version/10,ut=nt._dbSchema=gc(0,at,ut),nt._storeNames=I(at.objectStoreNames,0),of(nt,[nt._allTables],u(ut),ut);else if(hf(g,g._dbSchema,xt),((At=cf(gc(0,(At=g).idbdb,xt),At._dbSchema)).add.length||At.change.some(function(Ot){return Ot.add.length||Ot.change.length}))&&!L)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Rt.close(),D=Rt.version+1,L=!0,it($());Wr(g,xt)}catch{}zo.push(g),Rt.onversionchange=dn(function(Ot){v.vcFired=!0,g.on("versionchange").fire(Ot)}),Rt.onclose=dn(function(){g.close({disableAutoOpen:!1})}),q&&(At=g._deps,xt=Z,Rt=At.indexedDB,At=At.IDBKeyRange,df(Rt)||xt===Wu||rg(Rt,At).put({name:xt}).catch(Ee)),it()},K)}).catch(function(it){switch(it==null?void 0:it.name){case"UnknownError":if(0<v.PR1398_maxLoop)return v.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),$();break;case"VersionError":if(0<D)return D=0,$()}return Lt.reject(it)})}var X,Y=v.dbReadyResolve,et=null,q=!1;return Lt.race([x,(typeof navigator>"u"?Lt.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(it){function K(){return indexedDB.databases().finally(it)}X=setInterval(K,100),K()}).finally(function(){return clearInterval(X)}):Promise.resolve()).then($)]).then(function(){return U(),v.onReadyBeingFired=[],Lt.resolve(og(function(){return g.on.ready.fire(g.vip)})).then(function it(){if(0<v.onReadyBeingFired.length){var K=v.onReadyBeingFired.reduce(pr,Ee);return v.onReadyBeingFired=[],Lt.resolve(og(function(){return K(g.vip)})).then(it)}})}).finally(function(){v.openCanceller===x&&(v.onReadyBeingFired=null,v.isBeingOpened=!1)}).catch(function(it){v.dbOpenError=it;try{et&&et.abort()}catch{}return x===v.openCanceller&&g._close(),tn(it)}).finally(function(){v.openComplete=!0,Y()}).then(function(){var it;return q&&(it={},g.tables.forEach(function(K){K.schema.indexes.forEach(function(Z){Z.name&&(it["idb://".concat(g.name,"/").concat(K.name,"/").concat(Z.name)]=new Ni(-1/0,[[[]]]))}),it["idb://".concat(g.name,"/").concat(K.name,"/")]=it["idb://".concat(g.name,"/").concat(K.name,"/:dels")]=new Ni(-1/0,[[[]]])}),Mi(dc).fire(it),fg(it,!0)),g})}function rh(g){function v(L){return g.next(L)}var A=D(v),x=D(function(L){return g.throw(L)});function D(L){return function(X){var $=L(X),X=$.value;return $.done?X:X&&typeof X.then=="function"?X.then(A,x):h(X)?Promise.all(X).then(A,x):A(X)}}return D(v)()}function Qr(g,v,A){for(var x=h(g)?g.slice():[g],D=0;D<A;++D)x.push(v);return x}var kA={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(g){return n(n({},g),{table:function(v){var A=g.table(v),x=A.schema,D={},L=[];function U(q,it,K){var Z=ii(q),tt=D[Z]=D[Z]||[],nt=q==null?0:typeof q=="string"?1:q.length,at=0<it,at=n(n({},K),{name:at?"".concat(Z,"(virtual-from:").concat(K.name,")"):K.name,lowLevelIndex:K,isVirtual:at,keyTail:it,keyLength:nt,extractKey:mc(q),unique:!at&&K.unique});return tt.push(at),at.isPrimaryKey||L.push(at),1<nt&&U(nt===2?q[0]:q.slice(0,nt-1),it+1,K),tt.sort(function(ut,bt){return ut.keyTail-bt.keyTail}),at}v=U(x.primaryKey.keyPath,0,x.primaryKey),D[":id"]=[v];for(var $=0,X=x.indexes;$<X.length;$++){var Y=X[$];U(Y.keyPath,0,Y)}function et(q){var it,K=q.query.index;return K.isVirtual?n(n({},q),{query:{index:K.lowLevelIndex,range:(it=q.query.range,K=K.keyTail,{type:it.type===1?2:it.type,lower:Qr(it.lower,it.lowerOpen?g.MAX_KEY:g.MIN_KEY,K),lowerOpen:!0,upper:Qr(it.upper,it.upperOpen?g.MIN_KEY:g.MAX_KEY,K),upperOpen:!0})}}):q}return n(n({},A),{schema:n(n({},x),{primaryKey:v,indexes:L,getIndexByKeyPath:function(q){return(q=D[ii(q)])&&q[0]}}),count:function(q){return A.count(et(q))},query:function(q){return A.query(et(q))},openCursor:function(q){var it=q.query.index,K=it.keyTail,Z=it.isVirtual,tt=it.keyLength;return Z?A.openCursor(et(q)).then(function(at){return at&&nt(at)}):A.openCursor(q);function nt(at){return Object.create(at,{continue:{value:function(ut){ut!=null?at.continue(Qr(ut,q.reverse?g.MAX_KEY:g.MIN_KEY,K)):q.unique?at.continue(at.key.slice(0,tt).concat(q.reverse?g.MIN_KEY:g.MAX_KEY,K)):at.continue()}},continuePrimaryKey:{value:function(ut,bt){at.continuePrimaryKey(Qr(ut,g.MAX_KEY,K),bt)}},primaryKey:{get:function(){return at.primaryKey}},key:{get:function(){var ut=at.key;return tt===1?ut[0]:ut.slice(0,tt)}},value:{get:function(){return at.value}}})}}})}})}};function gf(g,v,A,x){return A=A||{},x=x||"",u(g).forEach(function(D){var L,U,$;b(v,D)?(L=g[D],U=v[D],typeof L=="object"&&typeof U=="object"&&L&&U?($=Yt(L))!==Yt(U)?A[x+D]=v[D]:$==="Object"?gf(L,U,A,x+D+"."):L!==U&&(A[x+D]=v[D]):L!==U&&(A[x+D]=v[D])):A[x+D]=void 0}),u(v).forEach(function(D){b(g,D)||(A[x+D]=v[D])}),A}function yf(g,v){return v.type==="delete"?v.keys:v.keys||v.values.map(g.extractKey)}var s0={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(g){return n(n({},g),{table:function(v){var A=g.table(v),x=A.schema.primaryKey;return n(n({},A),{mutate:function(D){var L=Ut.trans,U=L.table(v).hook,$=U.deleting,X=U.creating,Y=U.updating;switch(D.type){case"add":if(X.fire===Ee)break;return L._promise("readwrite",function(){return et(D)},!0);case"put":if(X.fire===Ee&&Y.fire===Ee)break;return L._promise("readwrite",function(){return et(D)},!0);case"delete":if($.fire===Ee)break;return L._promise("readwrite",function(){return et(D)},!0);case"deleteRange":if($.fire===Ee)break;return L._promise("readwrite",function(){return(function q(it,K,Z){return A.query({trans:it,values:!1,query:{index:x,range:K},limit:Z}).then(function(tt){var nt=tt.result;return et({type:"delete",keys:nt,trans:it}).then(function(at){return 0<at.numFailures?Promise.reject(at.failures[0]):nt.length<Z?{failures:[],numFailures:0,lastResult:void 0}:q(it,n(n({},K),{lower:nt[nt.length-1],lowerOpen:!0}),Z)})})})(D.trans,D.range,1e4)},!0)}return A.mutate(D);function et(q){var it,K,Z,tt=Ut.trans,nt=q.keys||yf(x,q);if(!nt)throw new Error("Keys missing");return(q=q.type==="add"||q.type==="put"?n(n({},q),{keys:nt}):n({},q)).type!=="delete"&&(q.values=s([],q.values)),q.keys&&(q.keys=s([],q.keys)),it=A,Z=nt,((K=q).type==="add"?Promise.resolve([]):it.getMany({trans:K.trans,keys:Z,cache:"immutable"})).then(function(at){var ut=nt.map(function(bt,At){var Rt,kt,xt,Ot=at[At],Nt={onerror:null,onsuccess:null};return q.type==="delete"?$.fire.call(Nt,bt,Ot,tt):q.type==="add"||Ot===void 0?(Rt=X.fire.call(Nt,bt,q.values[At],tt),bt==null&&Rt!=null&&(q.keys[At]=bt=Rt,x.outbound||H(q.values[At],x.keyPath,bt))):(Rt=gf(Ot,q.values[At]),(kt=Y.fire.call(Nt,Rt,bt,Ot,tt))&&(xt=q.values[At],Object.keys(kt).forEach(function(Tt){b(xt,Tt)?xt[Tt]=kt[Tt]:H(xt,Tt,kt[Tt])}))),Nt});return A.mutate(q).then(function(bt){for(var At=bt.failures,Rt=bt.results,kt=bt.numFailures,bt=bt.lastResult,xt=0;xt<nt.length;++xt){var Ot=(Rt||nt)[xt],Nt=ut[xt];Ot==null?Nt.onerror&&Nt.onerror(At[xt]):Nt.onsuccess&&Nt.onsuccess(q.type==="put"&&at[xt]?q.values[xt]:Ot)}return{failures:At,results:Rt,numFailures:kt,lastResult:bt}}).catch(function(bt){return ut.forEach(function(At){return At.onerror&&At.onerror(bt)}),Promise.reject(bt)})})}}})}})}};function pg(g,v,A){try{if(!v||v.keys.length<g.length)return null;for(var x=[],D=0,L=0;D<v.keys.length&&L<g.length;++D)Re(v.keys[D],g[L])===0&&(x.push(A?Xt(v.values[D]):v.values[D]),++L);return x.length===g.length?x:null}catch{return null}}var a0={stack:"dbcore",level:-1,create:function(g){return{table:function(v){var A=g.table(v);return n(n({},A),{getMany:function(x){if(!x.cache)return A.getMany(x);var D=pg(x.keys,x.trans._cache,x.cache==="clone");return D?Lt.resolve(D):A.getMany(x).then(function(L){return x.trans._cache={keys:x.keys,values:x.cache==="clone"?Xt(L):L},L})},mutate:function(x){return x.type!=="add"&&(x.trans._cache=null),A.mutate(x)}})}}}};function Ko(g,v){return g.trans.mode==="readonly"&&!!g.subscr&&!g.trans.explicit&&g.trans.db._options.cache!=="disabled"&&!v.schema.primaryKey.outbound}function r0(g,v){switch(g){case"query":return v.values&&!v.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var PA={stack:"dbcore",level:0,name:"Observability",create:function(g){var v=g.schema.name,A=new Ni(g.MIN_KEY,g.MAX_KEY);return n(n({},g),{transaction:function(x,D,L){if(Ut.subscr&&D!=="readonly")throw new Dt.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Ut.querier));return g.transaction(x,D,L)},table:function(x){var D=g.table(x),L=D.schema,U=L.primaryKey,q=L.indexes,$=U.extractKey,X=U.outbound,Y=U.autoIncrement&&q.filter(function(K){return K.compound&&K.keyPath.includes(U.keyPath)}),et=n(n({},D),{mutate:function(K){function Z(Tt){return Tt="idb://".concat(v,"/").concat(x,"/").concat(Tt),bt[Tt]||(bt[Tt]=new Ni)}var tt,nt,at,ut=K.trans,bt=K.mutatedParts||(K.mutatedParts={}),At=Z(""),Rt=Z(":dels"),kt=K.type,Nt=K.type==="deleteRange"?[K.range]:K.type==="delete"?[K.keys]:K.values.length<50?[yf(U,K).filter(function(Tt){return Tt}),K.values]:[],xt=Nt[0],Ot=Nt[1],Nt=K.trans._cache;return h(xt)?(At.addKeys(xt),(Nt=kt==="delete"||xt.length===Ot.length?pg(xt,Nt):null)||Rt.addKeys(xt),(Nt||Ot)&&(tt=Z,nt=Nt,at=Ot,L.indexes.forEach(function(Tt){var zt=tt(Tt.name||"");function ne(we){return we!=null?Tt.extractKey(we):null}function he(we){return Tt.multiEntry&&h(we)?we.forEach(function(ki){return zt.addKey(ki)}):zt.addKey(we)}(nt||at).forEach(function(we,si){var ce=nt&&ne(nt[si]),si=at&&ne(at[si]);Re(ce,si)!==0&&(ce!=null&&he(ce),si!=null&&he(si))})}))):xt?(Ot={from:(Ot=xt.lower)!==null&&Ot!==void 0?Ot:g.MIN_KEY,to:(Ot=xt.upper)!==null&&Ot!==void 0?Ot:g.MAX_KEY},Rt.add(Ot),At.add(Ot)):(At.add(A),Rt.add(A),L.indexes.forEach(function(Tt){return Z(Tt.name).add(A)})),D.mutate(K).then(function(Tt){return!xt||K.type!=="add"&&K.type!=="put"||(At.addKeys(Tt.results),Y&&Y.forEach(function(zt){for(var ne=K.values.map(function(ce){return zt.extractKey(ce)}),he=zt.keyPath.findIndex(function(ce){return ce===U.keyPath}),we=0,ki=Tt.results.length;we<ki;++we)ne[we][he]=Tt.results[we];Z(zt.name).addKeys(ne)})),ut.mutatedParts=pf(ut.mutatedParts||{},bt),Tt})}}),q=function(Z){var tt=Z.query,Z=tt.index,tt=tt.range;return[Z,new Ni((Z=tt.lower)!==null&&Z!==void 0?Z:g.MIN_KEY,(tt=tt.upper)!==null&&tt!==void 0?tt:g.MAX_KEY)]},it={get:function(K){return[U,new Ni(K.key)]},getMany:function(K){return[U,new Ni().addKeys(K.keys)]},count:q,query:q,openCursor:q};return u(it).forEach(function(K){et[K]=function(Z){var tt=Ut.subscr,nt=!!tt,at=Ko(Ut,D)&&r0(K,Z)?Z.obsSet={}:tt;if(nt){var ut=function(Ot){return Ot="idb://".concat(v,"/").concat(x,"/").concat(Ot),at[Ot]||(at[Ot]=new Ni)},bt=ut(""),At=ut(":dels"),tt=it[K](Z),nt=tt[0],tt=tt[1];if((K==="query"&&nt.isPrimaryKey&&!Z.values?At:ut(nt.name||"")).add(tt),!nt.isPrimaryKey){if(K!=="count"){var Rt=K==="query"&&X&&Z.values&&D.query(n(n({},Z),{values:!1}));return D[K].apply(this,arguments).then(function(Ot){if(K==="query"){if(X&&Z.values)return Rt.then(function(ne){return ne=ne.result,bt.addKeys(ne),Ot});var Nt=Z.values?Ot.result.map($):Ot.result;(Z.values?bt:At).addKeys(Nt)}else if(K==="openCursor"){var Tt=Ot,zt=Z.values;return Tt&&Object.create(Tt,{key:{get:function(){return At.addKey(Tt.primaryKey),Tt.key}},primaryKey:{get:function(){var ne=Tt.primaryKey;return At.addKey(ne),ne}},value:{get:function(){return zt&&bt.addKey(Tt.primaryKey),Tt.value}}})}return Ot})}At.add(A)}}return D[K].apply(this,arguments)}}),et}})}};function o0(g,v,A){if(A.numFailures===0)return v;if(v.type==="deleteRange")return null;var x=v.keys?v.keys.length:"values"in v&&v.values?v.values.length:1;return A.numFailures===x?null:(v=n({},v),h(v.keys)&&(v.keys=v.keys.filter(function(D,L){return!(L in A.failures)})),"values"in v&&h(v.values)&&(v.values=v.values.filter(function(D,L){return!(L in A.failures)})),v)}function bf(g,v){return A=g,((x=v).lower===void 0||(x.lowerOpen?0<Re(A,x.lower):0<=Re(A,x.lower)))&&(g=g,(v=v).upper===void 0||(v.upperOpen?Re(g,v.upper)<0:Re(g,v.upper)<=0));var A,x}function mg(g,v,it,x,D,L){if(!it||it.length===0)return g;var U=v.query.index,$=U.multiEntry,X=v.query.range,Y=x.schema.primaryKey.extractKey,et=U.extractKey,q=(U.lowLevelIndex||U).extractKey,it=it.reduce(function(K,Z){var tt=K,nt=[];if(Z.type==="add"||Z.type==="put")for(var at=new Ni,ut=Z.values.length-1;0<=ut;--ut){var bt,At=Z.values[ut],Rt=Y(At);at.hasKey(Rt)||(bt=et(At),($&&h(bt)?bt.some(function(Tt){return bf(Tt,X)}):bf(bt,X))&&(at.addKey(Rt),nt.push(At)))}switch(Z.type){case"add":var kt=new Ni().addKeys(v.values?K.map(function(zt){return Y(zt)}):K),tt=K.concat(v.values?nt.filter(function(zt){return zt=Y(zt),!kt.hasKey(zt)&&(kt.addKey(zt),!0)}):nt.map(function(zt){return Y(zt)}).filter(function(zt){return!kt.hasKey(zt)&&(kt.addKey(zt),!0)}));break;case"put":var xt=new Ni().addKeys(Z.values.map(function(zt){return Y(zt)}));tt=K.filter(function(zt){return!xt.hasKey(v.values?Y(zt):zt)}).concat(v.values?nt:nt.map(function(zt){return Y(zt)}));break;case"delete":var Ot=new Ni().addKeys(Z.keys);tt=K.filter(function(zt){return!Ot.hasKey(v.values?Y(zt):zt)});break;case"deleteRange":var Nt=Z.range;tt=K.filter(function(zt){return!bf(Y(zt),Nt)})}return tt},g);return it===g?g:(it.sort(function(K,Z){return Re(q(K),q(Z))||Re(Y(K),Y(Z))}),v.limit&&v.limit<1/0&&(it.length>v.limit?it.length=v.limit:g.length===v.limit&&it.length<v.limit&&(D.dirty=!0)),L?Object.freeze(it):it)}function bc(g,v){return Re(g.lower,v.lower)===0&&Re(g.upper,v.upper)===0&&!!g.lowerOpen==!!v.lowerOpen&&!!g.upperOpen==!!v.upperOpen}function oh(g,v){return(function(A,x,D,L){if(A===void 0)return x!==void 0?-1:0;if(x===void 0)return 1;if((x=Re(A,x))===0){if(D&&L)return 0;if(D)return 1;if(L)return-1}return x})(g.lower,v.lower,g.lowerOpen,v.lowerOpen)<=0&&0<=(function(A,x,D,L){if(A===void 0)return x!==void 0?1:0;if(x===void 0)return-1;if((x=Re(A,x))===0){if(D&&L)return 0;if(D)return-1;if(L)return 1}return x})(g.upper,v.upper,g.upperOpen,v.upperOpen)}function LA(g,v,A,x){g.subscribers.add(A),x.addEventListener("abort",function(){var D,L;g.subscribers.delete(A),g.subscribers.size===0&&(D=g,L=v,setTimeout(function(){D.subscribers.size===0&&Et(L,D)},3e3))})}var vf={stack:"dbcore",level:0,name:"Cache",create:function(g){var v=g.schema.name;return n(n({},g),{transaction:function(A,x,D){var L,U,$=g.transaction(A,x,D);return x==="readwrite"&&(U=(L=new AbortController).signal,D=function(X){return function(){if(L.abort(),x==="readwrite"){for(var Y=new Set,et=0,q=A;et<q.length;et++){var it=q[et],K=Yo["idb://".concat(v,"/").concat(it)];if(K){var Z=g.table(it),tt=K.optimisticOps.filter(function(zt){return zt.trans===$});if($._explicit&&X&&$.mutatedParts)for(var nt=0,at=Object.values(K.queries.query);nt<at.length;nt++)for(var ut=0,bt=(kt=at[nt]).slice();ut<bt.length;ut++)ug((xt=bt[ut]).obsSet,$.mutatedParts)&&(Et(kt,xt),xt.subscribers.forEach(function(zt){return Y.add(zt)}));else if(0<tt.length){K.optimisticOps=K.optimisticOps.filter(function(zt){return zt.trans!==$});for(var At=0,Rt=Object.values(K.queries.query);At<Rt.length;At++)for(var kt,xt,Ot,Nt=0,Tt=(kt=Rt[At]).slice();Nt<Tt.length;Nt++)(xt=Tt[Nt]).res!=null&&$.mutatedParts&&(X&&!xt.dirty?(Ot=Object.isFrozen(xt.res),Ot=mg(xt.res,xt.req,tt,Z,xt,Ot),xt.dirty?(Et(kt,xt),xt.subscribers.forEach(function(zt){return Y.add(zt)})):Ot!==xt.res&&(xt.res=Ot,xt.promise=Lt.resolve({result:Ot}))):(xt.dirty&&Et(kt,xt),xt.subscribers.forEach(function(zt){return Y.add(zt)})))}}}Y.forEach(function(zt){return zt()})}}},$.addEventListener("abort",D(!1),{signal:U}),$.addEventListener("error",D(!1),{signal:U}),$.addEventListener("complete",D(!0),{signal:U})),$},table:function(A){var x=g.table(A),D=x.schema.primaryKey;return n(n({},x),{mutate:function(L){var U=Ut.trans;if(D.outbound||U.db._options.cache==="disabled"||U.explicit||U.idbtrans.mode!=="readwrite")return x.mutate(L);var $=Yo["idb://".concat(v,"/").concat(A)];return $?(U=x.mutate(L),L.type!=="add"&&L.type!=="put"||!(50<=L.values.length||yf(D,L).some(function(X){return X==null}))?($.optimisticOps.push(L),L.mutatedParts&&mf(L.mutatedParts),U.then(function(X){0<X.numFailures&&(Et($.optimisticOps,L),(X=o0(0,L,X))&&$.optimisticOps.push(X),L.mutatedParts&&mf(L.mutatedParts))}),U.catch(function(){Et($.optimisticOps,L),L.mutatedParts&&mf(L.mutatedParts)})):U.then(function(X){var Y=o0(0,n(n({},L),{values:L.values.map(function(et,q){var it;return X.failures[q]?et:(et=(it=D.keyPath)!==null&&it!==void 0&&it.includes(".")?Xt(et):n({},et),H(et,D.keyPath,X.results[q]),et)})}),X);$.optimisticOps.push(Y),queueMicrotask(function(){return L.mutatedParts&&mf(L.mutatedParts)})}),U):x.mutate(L)},query:function(L){if(!Ko(Ut,x)||!r0("query",L))return x.query(L);var U=((Y=Ut.trans)===null||Y===void 0?void 0:Y.db._options.cache)==="immutable",q=Ut,$=q.requery,X=q.signal,Y=(function(Z,tt,nt,at){var ut=Yo["idb://".concat(Z,"/").concat(tt)];if(!ut)return[];if(!(tt=ut.queries[nt]))return[null,!1,ut,null];var bt=tt[(at.query?at.query.index.name:null)||""];if(!bt)return[null,!1,ut,null];switch(nt){case"query":var At=bt.find(function(Rt){return Rt.req.limit===at.limit&&Rt.req.values===at.values&&bc(Rt.req.query.range,at.query.range)});return At?[At,!0,ut,bt]:[bt.find(function(Rt){return("limit"in Rt.req?Rt.req.limit:1/0)>=at.limit&&(!at.values||Rt.req.values)&&oh(Rt.req.query.range,at.query.range)}),!1,ut,bt];case"count":return At=bt.find(function(Rt){return bc(Rt.req.query.range,at.query.range)}),[At,!!At,ut,bt]}})(v,A,"query",L),et=Y[0],q=Y[1],it=Y[2],K=Y[3];return et&&q?et.obsSet=L.obsSet:(q=x.query(L).then(function(Z){var tt=Z.result;if(et&&(et.res=tt),U){for(var nt=0,at=tt.length;nt<at;++nt)Object.freeze(tt[nt]);Object.freeze(tt)}else Z.result=Xt(tt);return Z}).catch(function(Z){return K&&et&&Et(K,et),Promise.reject(Z)}),et={obsSet:L.obsSet,promise:q,subscribers:new Set,type:"query",req:L,dirty:!1},K?K.push(et):(K=[et],(it=it||(Yo["idb://".concat(v,"/").concat(A)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[L.query.index.name||""]=K)),LA(et,K,$,X),et.promise.then(function(Z){return{result:mg(Z.result,L,it==null?void 0:it.optimisticOps,x,et,U)}})}})}})}};function lh(g,v){return new Proxy(g,{get:function(A,x,D){return x==="db"?v:Reflect.get(A,x,D)}})}var ja=(xn.prototype.version=function(g){if(isNaN(g)||g<.1)throw new Dt.Type("Given version is not a positive number");if(g=Math.round(10*g)/10,this.idbdb||this._state.isBeingOpened)throw new Dt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,g);var v=this._versions,A=v.filter(function(x){return x._cfg.version===g})[0];return A||(A=new this.Version(g),v.push(A),v.sort(sg),A.stores({}),this._state.autoSchema=!1,A)},xn.prototype._whenReady=function(g){var v=this;return this.idbdb&&(this._state.openComplete||Ut.letThrough||this._vip)?g():new Lt(function(A,x){if(v._state.openComplete)return x(new Dt.DatabaseClosed(v._state.dbOpenError));if(!v._state.isBeingOpened){if(!v._state.autoOpen)return void x(new Dt.DatabaseClosed);v.open().catch(Ee)}v._state.dbReadyPromise.then(A,x)}).then(g)},xn.prototype.use=function(g){var v=g.stack,A=g.create,x=g.level,D=g.name;return D&&this.unuse({stack:v,name:D}),g=this._middlewares[v]||(this._middlewares[v]=[]),g.push({stack:v,create:A,level:x??10,name:D}),g.sort(function(L,U){return L.level-U.level}),this},xn.prototype.unuse=function(g){var v=g.stack,A=g.name,x=g.create;return v&&this._middlewares[v]&&(this._middlewares[v]=this._middlewares[v].filter(function(D){return x?D.create!==x:!!A&&D.name!==A})),this},xn.prototype.open=function(){var g=this;return ta(Vi,function(){return NA(g)})},xn.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var g=this._state,v=zo.indexOf(this);if(0<=v&&zo.splice(v,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}g.isBeingOpened||(g.dbReadyPromise=new Lt(function(A){g.dbReadyResolve=A}),g.openCanceller=new Lt(function(A,x){g.cancelOpen=x}))},xn.prototype.close=function(A){var v=(A===void 0?{disableAutoOpen:!0}:A).disableAutoOpen,A=this._state;v?(A.isBeingOpened&&A.cancelOpen(new Dt.DatabaseClosed),this._close(),A.autoOpen=!1,A.dbOpenError=new Dt.DatabaseClosed):(this._close(),A.autoOpen=this._options.autoOpen||A.isBeingOpened,A.openComplete=!1,A.dbOpenError=null)},xn.prototype.delete=function(g){var v=this;g===void 0&&(g={disableAutoOpen:!0});var A=0<arguments.length&&typeof arguments[0]!="object",x=this._state;return new Lt(function(D,L){function U(){v.close(g);var $=v._deps.indexedDB.deleteDatabase(v.name);$.onsuccess=dn(function(){var X,Y,et;X=v._deps,Y=v.name,et=X.indexedDB,X=X.IDBKeyRange,df(et)||Y===Wu||rg(et,X).delete(Y).catch(Ee),D()}),$.onerror=na(L),$.onblocked=v._fireOnBlocked}if(A)throw new Dt.InvalidArgument("Invalid closeOptions argument to db.delete()");x.isBeingOpened?x.dbReadyPromise.then(U):U()})},xn.prototype.backendDB=function(){return this.idbdb},xn.prototype.isOpen=function(){return this.idbdb!==null},xn.prototype.hasBeenClosed=function(){var g=this._state.dbOpenError;return g&&g.name==="DatabaseClosed"},xn.prototype.hasFailed=function(){return this._state.dbOpenError!==null},xn.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(xn.prototype,"tables",{get:function(){var g=this;return u(this._allTables).map(function(v){return g._allTables[v]})},enumerable:!1,configurable:!0}),xn.prototype.transaction=function(){var g=(function(v,A,x){var D=arguments.length;if(D<2)throw new Dt.InvalidArgument("Too few arguments");for(var L=new Array(D-1);--D;)L[D-1]=arguments[D];return x=L.pop(),[v,yt(L),x]}).apply(this,arguments);return this._transaction.apply(this,g)},xn.prototype._transaction=function(g,v,A){var x=this,D=Ut.trans;D&&D.db===this&&g.indexOf("!")===-1||(D=null);var L,U,$=g.indexOf("?")!==-1;g=g.replace("!","").replace("?","");try{if(U=v.map(function(Y){if(Y=Y instanceof x.Table?Y.name:Y,typeof Y!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return Y}),g=="r"||g===yr)L=yr;else{if(g!="rw"&&g!=Yr)throw new Dt.InvalidArgument("Invalid transaction mode: "+g);L=Yr}if(D){if(D.mode===yr&&L===Yr){if(!$)throw new Dt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");D=null}D&&U.forEach(function(Y){if(D&&D.storeNames.indexOf(Y)===-1){if(!$)throw new Dt.SubTransaction("Table "+Y+" not included in parent transaction.");D=null}}),$&&D&&!D.active&&(D=null)}}catch(Y){return D?D._promise(null,function(et,q){q(Y)}):tn(Y)}var X=(function Y(et,q,it,K,Z){return Lt.resolve().then(function(){var tt=Ut.transless||Ut,nt=et._createTransaction(q,it,et._dbSchema,K);if(nt.explicit=!0,tt={trans:nt,transless:tt},K)nt.idbtrans=K.idbtrans;else try{nt.create(),nt.idbtrans._explicit=!0,et._state.PR1398_maxLoop=3}catch(bt){return bt.name===Ft.InvalidState&&et.isOpen()&&0<--et._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),et.close({disableAutoOpen:!1}),et.open().then(function(){return Y(et,q,it,null,Z)})):tn(bt)}var at,ut=G(Z);return ut&&Qn(),tt=Lt.follow(function(){var bt;(at=Z.call(nt,nt))&&(ut?(bt=_s.bind(null,null),at.then(bt,bt)):typeof at.next=="function"&&typeof at.throw=="function"&&(at=rh(at)))},tt),(at&&typeof at.then=="function"?Lt.resolve(at).then(function(bt){return nt.active?bt:tn(new Dt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):tt.then(function(){return at})).then(function(bt){return K&&nt._resolve(),nt._completion.then(function(){return bt})}).catch(function(bt){return nt._reject(bt),tn(bt)})})}).bind(null,this,L,U,D,A);return D?D._promise(L,X,"lock"):Ut.trans?ta(Ut.transless,function(){return x._whenReady(X)}):this._whenReady(X)},xn.prototype.table=function(g){if(!b(this._allTables,g))throw new Dt.InvalidTable("Table ".concat(g," does not exist"));return this._allTables[g]},xn);function xn(g,v){var A=this;this._middlewares={},this.verno=0;var x=xn.dependencies;this._options=v=n({addons:xn.addons,autoOpen:!0,indexedDB:x.indexedDB,IDBKeyRange:x.IDBKeyRange,cache:"cloned"},v),this._deps={indexedDB:v.indexedDB,IDBKeyRange:v.IDBKeyRange},x=v.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var D,L,U,$,X,Y={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Ee,dbReadyPromise:null,cancelOpen:Ee,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:v.autoOpen};Y.dbReadyPromise=new Lt(function(q){Y.dbReadyResolve=q}),Y.openCanceller=new Lt(function(q,it){Y.cancelOpen=it}),this._state=Y,this.name=g,this.on=Zu(this,"populate","blocked","versionchange","close",{ready:[pr,Ee]}),this.once=function(q,it){var K=function(){for(var Z=[],tt=0;tt<arguments.length;tt++)Z[tt]=arguments[tt];A.on(q).unsubscribe(K),it.apply(A,Z)};return A.on(q,K)},this.on.ready.subscribe=P(this.on.ready.subscribe,function(q){return function(it,K){xn.vip(function(){var Z,tt=A._state;tt.openComplete?(tt.dbOpenError||Lt.resolve().then(it),K&&q(it)):tt.onReadyBeingFired?(tt.onReadyBeingFired.push(it),K&&q(it)):(q(it),Z=A,K||q(function nt(){Z.on.ready.unsubscribe(it),Z.on.ready.unsubscribe(nt)}))})}}),this.Collection=(D=this,Di(OA.prototype,function(at,nt){this.db=D;var K=Jm,Z=null;if(nt)try{K=nt()}catch(ut){Z=ut}var tt=at._ctx,nt=tt.table,at=nt.hook.reading.fire;this._ctx={table:nt,index:tt.index,isPrimKey:!tt.index||nt.schema.primKey.keyPath&&tt.index===nt.schema.primKey.name,range:K,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:Z,or:tt.or,valueMapper:at!==os?at:null}})),this.Table=(L=this,Di(Zm.prototype,function(q,it,K){this.db=L,this._tx=K,this.name=q,this.schema=it,this.hook=L._allTables[q]?L._allTables[q].hook:Zu(null,{creating:[Hr,Ee],reading:[ws,os],updating:[Zs,Ee],deleting:[Io,Ee]})})),this.Transaction=(U=this,Di(ig.prototype,function(q,it,K,Z,tt){var nt=this;q!=="readonly"&&it.forEach(function(at){at=(at=K[at])===null||at===void 0?void 0:at.yProps,at&&(it=it.concat(at.map(function(ut){return ut.updatesTable})))}),this.db=U,this.mode=q,this.storeNames=it,this.schema=K,this.chromeTransactionDurability=Z,this.idbtrans=null,this.on=Zu(this,"complete","error","abort"),this.parent=tt||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Lt(function(at,ut){nt._resolve=at,nt._reject=ut}),this._completion.then(function(){nt.active=!1,nt.on.complete.fire()},function(at){var ut=nt.active;return nt.active=!1,nt.on.error.fire(at),nt.parent?nt.parent._reject(at):ut&&nt.idbtrans&&nt.idbtrans.abort(),tn(at)})})),this.Version=($=this,Di(MA.prototype,function(q){this.db=$,this._cfg={version:q,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(X=this,Di($o.prototype,function(q,it,K){if(this.db=X,this._ctx={table:q,index:it===":id"?null:it,or:K},this._cmp=this._ascending=Re,this._descending=function(Z,tt){return Re(tt,Z)},this._max=function(Z,tt){return 0<Re(Z,tt)?Z:tt},this._min=function(Z,tt){return Re(Z,tt)<0?Z:tt},this._IDBKeyRange=X._deps.IDBKeyRange,!this._IDBKeyRange)throw new Dt.MissingAPI})),this.on("versionchange",function(q){0<q.newVersion?console.warn("Another connection wants to upgrade database '".concat(A.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(A.name,"'. Closing db now to resume the delete request.")),A.close({disableAutoOpen:!1})}),this.on("blocked",function(q){!q.newVersion||q.newVersion<q.oldVersion?console.warn("Dexie.delete('".concat(A.name,"') was blocked")):console.warn("Upgrade '".concat(A.name,"' blocked by other connection holding version ").concat(q.oldVersion/10))}),this._maxKey=pc(v.IDBKeyRange),this._createTransaction=function(q,it,K,Z){return new A.Transaction(q,it,K,A._options.chromeTransactionDurability,Z)},this._fireOnBlocked=function(q){A.on("blocked").fire(q),zo.filter(function(it){return it.name===A.name&&it!==A&&!it._state.vcFired}).map(function(it){return it.on("versionchange").fire(q)})},this.use(a0),this.use(vf),this.use(PA),this.use(kA),this.use(s0);var et=new Proxy(this,{get:function(q,it,K){if(it==="_vip")return!0;if(it==="table")return function(tt){return lh(A.table(tt),et)};var Z=Reflect.get(q,it,K);return Z instanceof Zm?lh(Z,et):it==="tables"?Z.map(function(tt){return lh(tt,et)}):it==="_createTransaction"?function(){return lh(Z.apply(this,arguments),et)}:Z}});this.vip=et,x.forEach(function(q){return q(A)})}var vc,Ss=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",l0=(wf.prototype.subscribe=function(g,v,A){return this._subscribe(g&&typeof g!="function"?g:{next:g,error:v,complete:A})},wf.prototype[Ss]=function(){return this},wf);function wf(g){this._subscribe=g}try{vc={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch{vc={indexedDB:null,IDBKeyRange:null}}function c0(g){var v,A=!1,x=new l0(function(D){var L=G(g),U,$=!1,X={},Y={},et={get closed(){return $},unsubscribe:function(){$||($=!0,U&&U.abort(),q&&Mi.storagemutated.unsubscribe(K))}};D.start&&D.start(et);var q=!1,it=function(){return Xr(Z)},K=function(tt){pf(X,tt),ug(Y,X)&&it()},Z=function(){var tt,nt,at;!$&&vc.indexedDB&&(X={},tt={},U&&U.abort(),U=new AbortController,at=(function(ut){var bt=Vr();try{L&&Qn();var At=vn(g,ut);return At=L?At.finally(_s):At}finally{bt&&Ba()}})(nt={subscr:tt,signal:U.signal,requery:it,querier:g,trans:null}),Promise.resolve(at).then(function(ut){A=!0,v=ut,$||nt.signal.aborted||(X={},(function(bt){for(var At in bt)if(b(bt,At))return;return 1})(Y=tt)||q||(Mi(dc,K),q=!0),Xr(function(){return!$&&D.next&&D.next(ut)}))},function(ut){A=!1,["DatabaseClosedError","AbortError"].includes(ut==null?void 0:ut.name)||$||Xr(function(){$||D.error&&D.error(ut)})}))};return setTimeout(it,0),et});return x.hasValue=function(){return A},x.getValue=function(){return v},x}var Wo=ja;function gg(g){var v=Jr;try{Jr=!0,Mi.storagemutated.fire(g),fg(g,!0)}finally{Jr=v}}_(Wo,n(n({},bn),{delete:function(g){return new Wo(g,{addons:[]}).delete()},exists:function(g){return new Wo(g,{addons:[]}).open().then(function(v){return v.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(g){try{return v=Wo.dependencies,A=v.indexedDB,v=v.IDBKeyRange,(df(A)?Promise.resolve(A.databases()).then(function(x){return x.map(function(D){return D.name}).filter(function(D){return D!==Wu})}):rg(A,v).toCollection().primaryKeys()).then(g)}catch{return tn(new Dt.MissingAPI)}var v,A},defineClass:function(){return function(g){f(this,g)}},ignoreTransaction:function(g){return Ut.trans?ta(Ut.transless,g):g()},vip:og,async:function(g){return function(){try{var v=rh(g.apply(this,arguments));return v&&typeof v.then=="function"?v:Lt.resolve(v)}catch(A){return tn(A)}}},spawn:function(g,v,A){try{var x=rh(g.apply(A,v||[]));return x&&typeof x.then=="function"?x:Lt.resolve(x)}catch(D){return tn(D)}},currentTransaction:{get:function(){return Ut.trans||null}},waitFor:function(g,v){return v=Lt.resolve(typeof g=="function"?Wo.ignoreTransaction(g):g).timeout(v||6e4),Ut.trans?Ut.trans.waitFor(v):v},Promise:Lt,debug:{get:function(){return te},set:function(g){Ht(g)}},derive:C,extend:f,props:_,override:P,Events:Zu,on:Mi,liveQuery:c0,extendObservabilitySet:pf,getByKeyPath:j,setByKeyPath:H,delByKeyPath:function(g,v){typeof v=="string"?H(g,v,void 0):"length"in v&&[].map.call(v,function(A){H(g,A,void 0)})},shallowClone:dt,deepClone:Xt,getObjectDiff:gf,cmp:Re,asap:z,minKey:-1/0,addons:[],connections:zo,errnames:Ft,dependencies:vc,cache:Yo,semVer:"4.2.1",version:"4.2.1".split(".").map(function(g){return parseInt(g)}).reduce(function(g,v,A){return g+v/Math.pow(10,2*A)})})),Wo.maxKey=pc(Wo.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Mi(dc,function(g){Jr||(g=new CustomEvent(Go,{detail:g}),Jr=!0,dispatchEvent(g),Jr=!1)}),addEventListener(Go,function(g){g=g.detail,Jr||gg(g)}));var wc,Jr=!1,us=function(){};return typeof BroadcastChannel<"u"&&((us=function(){(wc=new BroadcastChannel(Go)).onmessage=function(g){return g.data&&gg(g.data)}})(),typeof wc.unref=="function"&&wc.unref(),Mi(dc,function(g){Jr||wc.postMessage(g)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(g){if(!ja.disableBfCache&&g.persisted){te&&console.debug("Dexie: handling persisted pagehide"),wc!=null&&wc.close();for(var v=0,A=zo;v<A.length;v++)A[v].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(g){!ja.disableBfCache&&g.persisted&&(te&&console.debug("Dexie: handling persisted pageshow"),us(),gg({all:new Ni(-1/0,[[]])}))})),Lt.rejectionMapper=function(g,v){return!g||g instanceof _t||g instanceof TypeError||g instanceof SyntaxError||!g.name||!pi[g.name]?g:(v=new pi[g.name](v||g.message,g),"stack"in g&&R(v,"stack",{get:function(){return this.inner.stack}}),v)},Ht(te),n(ja,Object.freeze({__proto__:null,Dexie:ja,liveQuery:c0,Entity:Wv,cmp:Re,PropModification:hc,replacePrefix:function(g,v){return new hc({replacePrefix:[g,v]})},add:function(g){return new hc({add:g})},remove:function(g){return new hc({remove:g})},default:ja,RangeSet:Ni,mergeRanges:Xo,rangesOverlap:e0}),{default:ja}),ja})})(w_)),w_.exports}var wz=vz();const UC=zC(wz),cM=Symbol.for("Dexie"),U_=globalThis[cM]||(globalThis[cM]=UC);if(UC.semVer!==U_.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${UC.semVer} and ${U_.semVer}`);const{liveQuery:Aj,mergeRanges:Sj,rangesOverlap:Ej,RangeSet:Cj,cmp:xj,Entity:Tj,PropModification:Rj,replacePrefix:Oj,add:Dj,remove:Mj,DexieYProvider:Nj}=U_;class _z extends U_{constructor(){super("KwikDocsOfflineDB"),this.version(1).stores({documents:"++id, tempId, status, companyId, uploadDate"})}}const Az=new _z,dP=Q.createContext(void 0),Sz=({children:l})=>{const{user:t,isAuthenticated:e,refreshUser:n}=kM(),[s,r]=Q.useState([]),[u,h]=Q.useState([]),[f,p]=Q.useState(null),[m,b]=Q.useState(!1),[_,S]=Q.useState([]),[R,C]=Q.useState([]),[M,k]=Q.useState(0);Q.useRef(0);const[I,P]=Q.useState([]),[F,z]=Q.useState(!1),[j,H]=Q.useState(!1),[dt,ct]=Q.useState(null),[yt,gt]=Q.useState(!1),[Pt,Xt]=Q.useState(!1),[Vt,Yt]=Q.useState(null);Q.useEffect(()=>{if(yt){const Ht=setTimeout(()=>gt(!1),5e3);return()=>clearTimeout(Ht)}},[yt]);const[J,pt]=Q.useState(ZN),[Et,Wt]=Q.useState(fz),[Zt,G]=Q.useState(hP),[ft,_t]=Q.useState(gz),[Mt,It]=Q.useState(yz),Gt=Q.useRef([]);Q.useEffect(()=>{if(Gt.current=I,I.length>0){const Ht=I[0];if(!Ht.read&&"Notification"in window&&Notification.permission==="granted"){const se=`notified_${Ht.id}`;if(!sessionStorage.getItem(se))try{new Notification(Ht.title,{body:Ht.message,icon:"/pwa-192x192.png",badge:"/pwa-192x192.png"}),sessionStorage.setItem(se,"true")}catch(oe){console.error("Native notification failed:",oe)}}}},[I]),Q.useEffect(()=>{"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()},[]);const Ft=Q.useRef(null),Ke=Q.useCallback(()=>{Ft.current&&(Ft.current.pause(),Ft.current.currentTime=0,Ft.current.loop=!1)},[]),Dt=Q.useCallback(()=>{Ke(),H(!1),gt(!1),P(Ht=>Ht.map(se=>({...se,read:!0})))},[Ke]);Q.useEffect(()=>{const Ht=localStorage.getItem("KWIKDOCS_AUDITOR_PROMPT");Ht&&pt(Ht);const se=localStorage.getItem("KWIKDOCS_STRATEGIST_PROMPT");se&&Wt(se);const oe=localStorage.getItem("KWIKDOCS_RAG_PROMPT");oe&&G(oe);const En=localStorage.getItem("KWIKDOCS_ANALYZER_PROMPT");En&&_t(En);const mi=localStorage.getItem("KWIKDOCS_VISION_PROMPT");mi&&It(mi)},[]),Q.useEffect(()=>{if(t&&(t.auditor_prompt&&pt(t.auditor_prompt),t.strategist_prompt&&Wt(t.strategist_prompt),t.rag_prompt&&G(t.rag_prompt),t.analyzer_prompt&&_t(t.analyzer_prompt),t.vision_prompt&&It(t.vision_prompt),t.agent_prompts&&!t.auditor_prompt)){const Ht=t.agent_prompts;Ht.AUDITOR&&pt(Ht.AUDITOR),Ht.STRATEGIST&&Wt(Ht.STRATEGIST),Ht.RAG&&G(Ht.RAG),Ht.ANALYZER&&_t(Ht.ANALYZER),Ht.VISION&&It(Ht.VISION)}},[t]);const pi=Q.useRef(null);Q.useEffect(()=>{pi.current=f},[f]);const bn=Q.useCallback(async(Ht=!1)=>{Ht||b(!0);try{const se=await sF.getAllClients();h(se);let oe=pi.current;if(se.length>0)if(oe){if(oe!=="ALL"){const Oe=se.find(In=>In.id===oe.id);Oe&&((Oe.credits!==oe.credits||Oe.name!==oe.name||Oe.isVerified!==oe.isVerified)&&p(Oe),oe=Oe)}}else{const Oe=t==null?void 0:t.companyId;oe=se.find(In=>In.id===Oe)||se[0],p(oe)}const En=oe==="ALL"||!oe?"ALL":oe.id,fe=(await v_.getDocuments(En)).data||[];r(fe),C(Oe=>Oe.length===0?Oe:Oe.map(In=>{const Ia=fe.find(mr=>mr.id===In.id);return Ia?{...In,...Ia}:In}))}catch(se){console.error("Failed to refresh data",se)}finally{Ht||b(!1)}},[t]);Q.useEffect(()=>{e?bn():(r([]),h([]),p(null))},[e]);const Ee=Q.useRef(null);Q.useEffect(()=>{if(!e||!f)return;const Ht=f==="ALL"?"ALL":f.id;Ht!==Ee.current&&(Ee.current=Ht,bn(!0))},[f,e]);const os=Ht=>{if(Ht==="ALL")p("ALL");else{const se=u.find(oe=>oe.id===Ht);se&&p(se)}},ws=Q.useCallback(async Ht=>{if(!t)return;if(Ke(),Yt(null),k(0),!u||u.length===0)throw new Error("Nenhuma empresa cadastrada no banco de dados. Por favor, crie uma empresa antes de fazer upload.");let se;const oe=(t.role||"").toUpperCase();if(oe==="COLLABORATOR"||oe==="OPERATOR"?se=t.companyId||t.company_id:f&&f!=="ALL"?se=f.id:u&&u.length>0&&(se=u[0].id),!se)throw new Error("Nenhuma empresa ativa selecionada para upload. Por favor, selecione uma empresa no menu superior.");const En=u.find(fe=>fe.id===se);if(En){if(En.status!=="ACTIVE"&&En.status!=="VALIDATE")throw P(fe=>[{id:crypto.randomUUID(),title:"Empresa Inativa",message:`A empresa ${En.name} est ${En.status==="SUSPENDED"?"Suspensa":"Pendente"}. Operao bloqueada.`,type:"error",timestamp:new Date,read:!1},...fe]),new Error("Empresa inativa ou suspensa. Contacte o suporte ou altere o status.");if(!En.isVerified)throw P(fe=>[{id:crypto.randomUUID(),title:"Empresa No Verificada",message:`A empresa ${En.name} ainda no foi verificada na AGT. Por favor, valide o NIF.`,type:"error",timestamp:new Date,read:!1},...fe]),new Error("Empresa no verificada. Por favor, realize a validao do NIF antes de continuar.");if(En.credits<=0){const fe=new Audio("https://assets.mixkit.co/active_storage/sfx/2870/2870-preview.mp3");throw fe.volume=.5,fe.onerror=()=>{},fe.play().catch(()=>{}),P(Oe=>[{id:crypto.randomUUID(),title:"Crditos Esgotados",message:"Impossvel analisar documentos. Por favor, recarregue sua conta.",type:"error",timestamp:new Date,read:!1},...Oe]),new Error("Crditos insuficientes para realizar anlise. Recarregue sua conta.")}En.credits<=10&&P(fe=>[{id:crypto.randomUUID(),title:"Saldo de Crditos Baixo",message:`Ateno: Voc tem apenas ${En.credits} crditos restantes. Considere recarregar.`,type:"info",timestamp:new Date,read:!1},...fe])}if(!Ft.current){const fe=new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3");fe.onerror=()=>{console.warn("[KwikDocs] Batch completion sound unavailable - failing gracefully."),Ft.current=null},Ft.current=fe}if(!navigator.onLine){const fe=[];for(const Oe of Ht){const In=crypto.randomUUID();await Az.documents.add({tempId:In,file:Oe,fileName:Oe.name,fileType:Oe.type,uploadDate:new Date,status:"PENDING",companyId:se,uploadedBy:t.id,retryCount:0}),fe.push({id:In,fileName:Oe.name,fileUrl:"",status:ze.PROCESSING,type:pp.INVOICE,uploadDate:new Date,companyId:se,uploadedBy:t.id,data:{},rawData:{},metadata:{isOffline:!0}})}C(Oe=>[...fe,...Oe]),P(Oe=>[{id:crypto.randomUUID(),title:"Modo Offline",message:"Documentos guardados localmente. A sincronizao iniciar automaticamente quando a conexo retornar.",type:"info",timestamp:new Date,read:!1},...Oe]);return}const mi=Ht.map(fe=>({id:crypto.randomUUID(),fileName:fe.name,fileUrl:"",status:ze.PROCESSING,type:pp.INVOICE,uploadDate:new Date,companyId:se,uploadedBy:t.id,data:{},rawData:{}}));C(mi),k(15),gt(!1);try{const{localDocs:fe}=await v_.uploadAndProcessDocuments(Ht,se,t.id,J);C(fe),k(100),await bn(!0);const Oe=fe.filter(gi=>[ze.COMPLETED,ze.APROVADO,ze.REJEITADO,ze.APROVADO_USUARIO].includes(gi.status)),In=fe.filter(gi=>gi.status===ze.ERROR),Ia=Oe.length,mr=In.length;if(ct({success:Ia,error:mr,total:fe.length,docs:fe}),fe.every(gi=>[ze.COMPLETED,ze.APROVADO,ze.REJEITADO,ze.APROVADO_USUARIO,ze.ERROR].includes(gi.status))&&fe.length>0){if(gt(!0),Ft.current)try{Ft.current.pause(),Ft.current.currentTime=0,Ft.current.loop=!0,Ft.current.play().catch(()=>{})}catch{}P(gi=>[{id:crypto.randomUUID(),title:"Processamento Concludo",message:`${Ia} documentos sincronizados com sucesso.`,type:mr>0?"warning":"success",timestamp:new Date,read:!1},...gi])}else gt(!1)}catch(fe){console.error("Upload error:",fe.message),k(0),gt(!1),C(Oe=>Oe.map(In=>({...In,status:ze.ERROR}))),P(Oe=>[{id:crypto.randomUUID(),title:"Erro de Sincronizao",message:fe.message||"Falha crtica ao falar com o n8n.",type:"error",timestamp:new Date,read:!1},...Oe])}},[t,u,f,J,bn,Ke]),Oi=async(Ht,se,oe,En)=>{try{await v_.resolveDocumentError(Ht,se,oe,En),await bn(!0)}catch(mi){throw console.error("Error resolving document:",mi),mi}},Hr=()=>{C([]),k(0)},Io=Ht=>{P(Ht?se=>se.map(oe=>oe.id===Ht?{...oe,read:!0}:oe):se=>se.map(oe=>({...oe,read:!0})))},Zs=Ht=>{P(se=>se.filter(oe=>oe.id!==Ht))},Bo=()=>{H(!1)},pr=f==="ALL",te=R.length>0&&R.some(Ht=>Ht.status===ze.PROCESSING);return lt.jsx("div",{className:"flex-1 w-full h-full",children:lt.jsx(dP.Provider,{value:{documents:s,clients:u,selectedCompany:f,isLoadingData:m,refreshData:bn,selectCompany:os,uploadFiles:ws,resolveError:Oi,isAccountingMode:pr,uploadQueue:R,clearUploadQueue:Hr,lastBatchIds:_,notifications:I,markNotificationRead:Io,deleteNotification:Zs,processingProgress:M,showGlobalCompletionModal:!1,isBatchComplete:yt,completionStats:dt,closeGlobalCompletionModal:Bo,isFullscreenMode:F,setFullscreenMode:z,auditorPrompt:J,updateAuditorPrompt:pt,strategistPrompt:Et,updateStrategistPrompt:Wt,ragPrompt:Zt,updateRagPrompt:G,analyzerPrompt:ft,updateAnalyzerPrompt:_t,visionPrompt:Mt,updateVisionPrompt:It,stopNotificationSound:Ke,clearCompletionStats:()=>ct(null),isTopupWizardOpen:Pt,setIsTopupWizardOpen:Xt,selectedDocument:Vt,setSelectedDocument:Yt,isProcessing:te,clearCompletionStates:Dt},children:l})})},Ez=()=>{const l=Q.useContext(dP);if(l===void 0)throw new Error("useData must be used within a DataProvider");return l},Cz="/logo.png",xz=({className:l="w-10 h-10",iconClassName:t="w-6 h-6"})=>lt.jsx("div",{className:`${l} flex items-center justify-center overflow-hidden relative`,children:lt.jsx("img",{src:Cz,alt:"KwikDocs AI Logo",className:"w-full h-full object-contain"})}),Ae=()=>({"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}),Tz={getStats:async()=>{const l=await fetch("/api/admin/stats",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar estatsticas");return l.json()},getActivity:async()=>{const l=await fetch("/api/admin/activity",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar atividade");return l.json()},getHealth:async()=>{const l=await fetch("/api/admin/health",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar status dos servios");return l.json()},getAlerts:async()=>{const l=await fetch("/api/admin/alerts",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar alertas");return l.json()},getBillingStats:async()=>{const l=await fetch("/api/admin/billing/stats",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar estatsticas financeiras");return l.json()},getTransactions:async(l=10)=>{const t=await fetch(`/api/admin/billing/transactions?limit=${l}`,{headers:Ae()});if(!t.ok)throw new Error("Falha ao carregar transaes");return t.json()},getPlans:async()=>{const l=await fetch("/api/admin/billing/plans",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar distribuio de planos");return l.json()},getBillingInsights:async()=>{const l=await fetch("/api/admin/billing/insights",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar insights financeiros");return l.json()},getAllPlans:async()=>{const l=await fetch("/api/admin/server-plans",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar planos");return l.json()},createPlan:async l=>{const t=await fetch("/api/admin/server-plans",{method:"POST",headers:Ae(),body:JSON.stringify(l)});if(!t.ok)throw new Error("Falha ao criar plano");return t.json()},updatePlan:async(l,t)=>{const e=await fetch(`/api/admin/server-plans/${l}`,{method:"PATCH",headers:Ae(),body:JSON.stringify(t)});if(!e.ok)throw new Error("Falha ao atualizar plano");return e.json()},deletePlan:async l=>{const t=await fetch(`/api/admin/server-plans/${l}`,{method:"DELETE",headers:Ae()});if(!t.ok)throw new Error("Falha ao excluir plano");return t.json()},getSettings:async()=>{const l=await fetch("/api/admin/settings",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar configuraes");return l.json()},updateSetting:async(l,t,e)=>{const n=await fetch("/api/admin/settings",{method:"POST",headers:Ae(),body:JSON.stringify({key:l,value:t,description:e})});if(!n.ok)throw new Error("Falha ao atualizar configurao");return n.json()},setUserLimit:async(l,t)=>{const e=await fetch(`/api/admin/users/${l}/limit`,{method:"PUT",headers:Ae(),body:JSON.stringify({monthly_credit_limit:t})});if(!e.ok)throw new Error("Falha ao definir limite do usurio");return e.json()},getUsers:async()=>{const l=await fetch("/api/admin/users",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar utilizadores");return l.json()},updateUserStatus:async(l,t)=>{const e=await fetch(`/api/admin/users/${l}/status`,{method:"PATCH",headers:Ae(),body:JSON.stringify({isActive:t})});if(!e.ok)throw new Error("Falha ao atualizar status do utilizador");return e.json()},updateUserRole:async(l,t)=>{const e=await fetch(`/api/admin/users/${l}/role`,{method:"PATCH",headers:Ae(),body:JSON.stringify({role:t})});if(!e.ok)throw new Error("Falha ao atualizar cargo");return e.json()},bulkUpdateUsers:async(l,t)=>{const e=await fetch("/api/admin/users/bulk-update",{method:"POST",headers:Ae(),body:JSON.stringify({ids:l,data:t})});if(!e.ok)throw new Error("Falha ao atualizar utilizadores em massa");return e.json()},getUserActivity:async l=>{const t=await fetch(`/api/admin/users/${l}/activity`,{headers:Ae()});if(!t.ok)throw new Error("Falha ao carregar atividade do utilizador");return t.json()},impersonateUser:async l=>{const t=await fetch(`/api/admin/users/impersonate/${l}`,{method:"POST",headers:Ae()});if(!t.ok)throw new Error("Falha ao iniciar impersonate");return t.json()},getRealtimeStats:async()=>{const l=await fetch("/api/admin/realtime",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar estatsticas em tempo real");return l.json()},getEngagementMetrics:async()=>{const l=await fetch("/api/admin/engagement",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar mtricas de engajamento");return l.json()},getGrowthStats:async()=>{const l=await fetch("/api/admin/growth",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar mtricas de crescimento");return l.json()},getUsageHistory:async()=>{const l=await fetch("/api/admin/usage",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar histrico de uso");return l.json()},getInfraStats:async()=>{const l=await fetch("/api/admin/infra",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar mtricas de infraestrutura");return l.json()},getCompanies:async()=>{const l=await fetch("/api/admin/companies",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar empresas");return l.json()},updateCompany:async(l,t)=>{const e=await fetch(`/api/admin/companies/${l}`,{method:"PATCH",headers:{...Ae(),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("Falha ao atualizar empresa");return e.json()},sendHeartbeat:async l=>{const t=await fetch("/api/auth/heartbeat",{method:"POST",headers:Ae(),body:JSON.stringify(l)});if(!t.ok)throw new Error("Falha ao enviar heartbeat");return t.json()},getCreditPackages:async()=>{const l=await fetch("/api/admin/billing/packages",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar pacotes de crditos");return l.json()},createCreditPackage:async l=>{const t=await fetch("/api/admin/billing/packages",{method:"POST",headers:Ae(),body:JSON.stringify(l)});if(!t.ok)throw new Error("Falha ao criar pacote de crditos");return t.json()},updateCreditPackage:async(l,t)=>{const e=await fetch(`/api/admin/billing/packages/${l}`,{method:"PUT",headers:Ae(),body:JSON.stringify(t)});if(!e.ok)throw new Error("Falha ao atualizar pacote de crditos");return e.json()},deleteCreditPackage:async l=>{const t=await fetch(`/api/admin/billing/packages/${l}`,{method:"DELETE",headers:Ae()});if(!t.ok)throw new Error("Falha ao deletar pacote de crditos");return t.json()},getOperationalCosts:async()=>{const l=await fetch("/api/admin/billing/costs",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar custos operacionais");return l.json()},setOperationalCost:async l=>{const t=await fetch("/api/admin/billing/costs",{method:"POST",headers:Ae(),body:JSON.stringify(l)});if(!t.ok)throw new Error("Falha ao definir custo operacional");return t.json()},getCompanyProfitability:async()=>{const l=await fetch("/api/admin/billing/profitability",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar rentabilidade de empresas");return l.json()},getCreditConsumptionTrends:async()=>{const l=await fetch("/api/admin/billing/consumption-trends",{headers:Ae()});if(!l.ok)throw new Error("Falha ao carregar tendncias de consumo");return l.json()},getMonthlySnapshot:async l=>{const t=await fetch(`/api/admin/billing/snapshot/${l}`,{headers:Ae()});if(!t.ok)throw new Error("Falha ao carregar snapshot mensal");return t.json()},generateMonthlySnapshot:async()=>{const l=await fetch("/api/admin/billing/snapshot/generate",{method:"POST",headers:Ae()});if(!l.ok)throw new Error("Falha ao gerar snapshot mensal");return l.json()},getPendingPayments:async()=>{const l=await fetch("/api/admin/payments/pending",{headers:Ae()});if(!l.ok)throw new Error("Falha ao buscar pagamentos pendentes");return l.json()},approvePayment:async l=>{const t=await fetch(`/api/admin/payments/${l}/approve`,{method:"POST",headers:Ae()});if(!t.ok)throw new Error("Falha ao aprovar pagamento");return t.json()},rejectPayment:async(l,t)=>{const e=await fetch(`/api/admin/payments/${l}/reject`,{method:"POST",headers:Ae(),body:JSON.stringify({reason:t})});if(!e.ok)throw new Error("Falha ao rejeitar pagamento");return e.json()}},Rz=Q.createContext({lastPulse:null}),Oz=({children:l,userId:t,companyId:e})=>{const n=Q.useRef(null);return Q.useEffect(()=>{if(!t)return;const s=async()=>{try{await Tz.sendHeartbeat({companyId:e,userAgent:navigator.userAgent}),n.current=new Date,console.log(" Heartbeat sent")}catch(u){console.error(" Heartbeat failed:",u)}};s();const r=setInterval(s,6e4);return()=>clearInterval(r)},[t,e]),lt.jsx(Rz.Provider,{value:{lastPulse:n.current},children:l})},Dw=()=>lt.jsx("div",{className:"flex h-full w-full items-center justify-center bg-[#020202] min-h-[50vh]",children:lt.jsxs("div",{className:"flex flex-col items-center gap-4",children:[lt.jsxs("div",{className:"relative",children:[lt.jsx("div",{className:"absolute inset-0 bg-cyan-500/20 blur-xl rounded-full animate-pulse"}),lt.jsx(VB,{className:"w-12 h-12 text-cyan-500 animate-spin relative z-10"})]}),lt.jsx("p",{className:"text-slate-500 text-xs uppercase tracking-widest animate-pulse font-medium",children:"Carregando Mdulo..."})]})}),Dz=Sn.lazy(()=>Dn(()=>import("./Sidebar-Bjik65Wf.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),KE=Sn.lazy(()=>Dn(()=>import("./Dashboard-JjEbyVHO.js"),__vite__mapDeps([16,17,18,7,19,20,21,22,6,15,23,24,25,26]))),Mz=Sn.lazy(()=>Dn(()=>import("./DocumentList-BbKQcGPz.js"),__vite__mapDeps([27,17,28,29,30,31,32,33,34,6,23,35,9,26,36,37,38,39,11,40,15,41,14,10]))),Nz=Sn.lazy(()=>Dn(()=>import("./LandingPage-Crr-fdZO.js"),__vite__mapDeps([42,43,44,45,25,33,6,46,26,7,47,48,49,32,50,34,1,51,15,2,52,53,54,18,55,24,56,57,58,59,60,61,9]))),kz=Sn.lazy(()=>Dn(()=>import("./AuthPage-CvVI3Q2d.js"),__vite__mapDeps([62,41,57,47,45,61,6,9,15]))),Pz=Sn.lazy(()=>Dn(()=>import("./Onboarding-8cwLllWl.js"),__vite__mapDeps([63,64,61,45,41,8]))),Lz=Sn.lazy(()=>Dn(()=>import("./UploadPage-CjsAyWmB.js"),__vite__mapDeps([65,43,12,9,15,51,53,4]))),Iz=Sn.lazy(()=>Dn(()=>import("./FiscalErrors-bHS0aRwk.js"),__vite__mapDeps([66,25,33,7,11,23,67,6,50,26,35,4,68,20,22]))),Bz=Sn.lazy(()=>Dn(()=>import("./ReportsPage-g0Jk0GlL.js"),__vite__mapDeps([69,17,3,61,7,9,6,10,19,46,70,20,21,60,71,68]))),Fz=Sn.lazy(()=>Dn(()=>import("./CreditsPage-e_RoJkur.js"),__vite__mapDeps([72,8,3,7,9,10,73,23,51,71,41,61,15,74]))),Uz=Sn.lazy(()=>Dn(()=>import("./SettingsPage-B7edKY0W.js"),__vite__mapDeps([75,52,76,2,44,57,56,48,55,7,77,32,6,23,41,73,40,8,36,47,9,78,51,15]))),zz=Sn.lazy(()=>Dn(()=>import("./ClientsPage-DfgkNpVJ.js"),__vite__mapDeps([79,48,6,43,9,51,15,12,26,8,36,80,23,7,60]))),jz=Sn.lazy(()=>Dn(()=>import("./UploadTray-muZt7HYf.js"),__vite__mapDeps([81,15,23,35,9,3])));Sn.lazy(()=>Dn(()=>import("./ToastNotification-DKNqjTiG.js"),__vite__mapDeps([80,23,15,9])));Sn.lazy(()=>Dn(()=>import("./FiscalChat-BxTRoPFe.js"),__vite__mapDeps([82,76,31,41,49,59,7,3])));const Hz=Sn.lazy(()=>Dn(()=>import("./NifsPage-rIgTWxqu.js"),__vite__mapDeps([83,39,12,29,13,43,70,7,15,55,84]))),$z=Sn.lazy(()=>Dn(()=>import("./AnalysisResultsPage-IXQN5jMC.js"),__vite__mapDeps([85,28,17,29,30,31,32,33,34,6,23,35,11,12,52,61]))),Vz=Sn.lazy(()=>Dn(()=>import("./AnalysisCompletionPopup-DBK3YPTP.js"),__vite__mapDeps([86,9,23,6,14,61]))),Gz=Sn.lazy(()=>Dn(()=>import("./ForcePasswordChangeModal-B34lRhpq.js"),__vite__mapDeps([87,47,78,51,6]))),qz=Sn.lazy(()=>Dn(()=>import("./NotificationTicker-9L05kVx7.js"),[]).then(l=>({default:l.NotificationTicker}))),Xz=Sn.lazy(()=>Dn(()=>import("./CompliancePage-BqQX29Ii.js"),__vite__mapDeps([88,17,37,38,39,32,23,6,7,50,70]))),Yz=Sn.lazy(()=>Dn(()=>import("./AdminPanel-Cc7qKE-4.js"),__vite__mapDeps([89,10,11,1,31,2,5,73,49,67,48,44,60,71,19,7,15,18,8,24,52,84,23,25,77,57,74,78,30,29,36,64,45,41,14,76,47,12,53,54,58]))),Kz=Sn.lazy(()=>Dn(()=>import("./PerformanceServersPage-BCQkU-JW.js"),__vite__mapDeps([90,64,23,53,54,7,24,2,9]))),Wz=Sn.lazy(()=>Dn(()=>import("./InstallPrompt-B4KAdt8-.js"),__vite__mapDeps([91,29,9]))),Qz=()=>{const{isAuthenticated:l,user:t,isLoading:e,logout:n}=kM(),{selectedCompany:s,selectCompany:r,clients:u,isAccountingMode:h,processingProgress:f,showGlobalCompletionModal:p,closeGlobalCompletionModal:m,uploadQueue:b,isFullscreenMode:_,notifications:S,markNotificationRead:R,isBatchComplete:C,completionStats:M,stopNotificationSound:k,clearCompletionStats:I,selectedDocument:P,setSelectedDocument:F,clearCompletionStates:z,refreshData:j}=Ez(),[H,dt]=Q.useState("LANDING"),[ct,yt]=Q.useState("OVERVIEW"),[gt,Pt]=Q.useState(!1),[Xt,Vt]=Q.useState(!1),[Yt,J]=Q.useState(!1),[pt,Et]=Q.useState(!1),[Wt,Zt]=Q.useState(""),[G,ft]=Q.useState(0),_t=Q.useRef(null),[Mt,It]=Q.useState(!1),Gt=Q.useMemo(()=>window.matchMedia("(display-mode: standalone)").matches||navigator.standalone||document.referrer.includes("android-app://"),[]);Q.useEffect(()=>{!e&&!Mt?(It(!0),dt(l?"APP":Gt?"LOGIN":"LANDING")):!e&&Mt&&!l&&dt(Gt?"LOGIN":"LANDING")},[e,Mt,l,Gt]),Q.useEffect(()=>{P&&yt("ANALYSIS_RESULTS")},[P]);const Ft=(te="APP")=>{J(!0),setTimeout(()=>{J(!1),dt(te)},4e3)},Ke=()=>dt("LOGIN"),Dt=()=>dt("REGISTER"),pi=te=>{Ft(te==="REGISTER"?"ONBOARDING":"APP")},bn=te=>dt(te),Ee=async()=>{await j(),Ft("APP")},os=te=>{r(te),yt("OVERVIEW")},ws=()=>{yt("ANALYSIS_RESULTS"),z()},Oi=b.some(te=>te.status===ze.PROCESSING),Hr=(t==null?void 0:t.role)==="OPERATOR"||(t==null?void 0:t.role)==="COLLABORATOR",Io=Q.useMemo(()=>{if(!l)return[];const te=[{id:"nav-home",label:"Ir para Viso Geral",icon:DB,action:()=>yt("OVERVIEW")},{id:"nav-upload",label:"Novo Upload / Anlise",icon:WB,action:()=>yt("UPLOAD")},{id:"nav-docs",label:"Meus Documentos",icon:HB,action:()=>yt("DOCUMENTS")},{id:"nav-ai",label:"Assistente IA (Chat)",icon:cw,action:()=>yt("AI_ASSISTANT")},{id:"nav-ai",label:"Assistente IA (Chat)",icon:cw,action:()=>yt("AI_ASSISTANT")},{id:"nav-settings",label:"Configuraes",icon:tF,action:()=>yt("SETTINGS")},{id:"nav-servers",label:"Servidores Performance",icon:hD,action:()=>yt("PERFORMANCE_SERVERS")},{id:"act-logout",label:"Terminar Sesso",icon:qB,action:()=>n()}];if(h){const Ht=u.map(se=>({id:`client-${se.id}`,label:`Mudar para: ${se.name}`,icon:Zg,action:()=>os(se.id)}));return Ht.unshift({id:"client-all",label:"Mudar para: Viso Geral (Consolidada)",icon:Zg,action:()=>r("ALL")}),[...te,...Ht]}return te},[l,h,u,n]),Zs=Q.useMemo(()=>Wt?Io.filter(te=>te.label.toLowerCase().includes(Wt.toLowerCase())):Io,[Io,Wt]);Q.useEffect(()=>{const te=Ht=>{(Ht.metaKey||Ht.ctrlKey)&&Ht.key==="k"&&(Ht.preventDefault(),Et(se=>!se),Zt(""),ft(0)),pt&&(Ht.key==="ArrowDown"?(Ht.preventDefault(),ft(se=>Math.min(se+1,Zs.length-1))):Ht.key==="ArrowUp"?(Ht.preventDefault(),ft(se=>Math.max(se-1,0))):Ht.key==="Enter"?(Ht.preventDefault(),Zs[G]&&(Zs[G].action(),Et(!1))):Ht.key==="Escape"&&Et(!1))};return window.addEventListener("keydown",te),()=>window.removeEventListener("keydown",te)},[pt,Zs,G]),Q.useEffect(()=>{pt&&_t.current&&setTimeout(()=>{var te;return(te=_t.current)==null?void 0:te.focus()},50)},[pt]);const Bo=()=>{if(Hr&&["CLIENTS","CREDITS","SETTINGS"].includes(ct))return lt.jsx(KE,{});switch(ct){case"OVERVIEW":return lt.jsx(KE,{});case"CLIENTS":return lt.jsx(zz,{onSelectClient:os});case"DOCUMENTS":return lt.jsx(Mz,{});case"UPLOAD":return lt.jsx(Lz,{onUploadComplete:()=>yt("ANALYSIS_RESULTS"),onActivateServer:()=>yt("PERFORMANCE_SERVERS")});case"ANALYSIS_RESULTS":return lt.jsx($z,{onBack:()=>yt("DOCUMENTS"),onNewAnalysis:()=>yt("UPLOAD")});case"AI_ASSISTANT":return lt.jsxs("div",{className:"flex flex-col items-center justify-center h-[calc(100vh-200px)] text-center p-8 space-y-6 animate-in fade-in duration-700",children:[lt.jsxs("div",{className:"relative",children:[lt.jsx("div",{className:"absolute inset-0 bg-cyan-500/20 blur-[60px] rounded-full animate-pulse"}),lt.jsx("div",{className:"relative bg-[#0a0a0a] border border-white/5 p-8 rounded-3xl shadow-2xl",children:lt.jsx(cw,{className:"w-16 h-16 text-cyan-400 animate-bounce-slow"})})]}),lt.jsxs("div",{children:[lt.jsx("h2",{className:"text-3xl font-black text-white tracking-tight mb-2",children:"Assistente IA"}),lt.jsxs("p",{className:"text-slate-400 text-lg max-w-md mx-auto leading-relaxed",children:["Estamos desenvolvendo este assistente para revolucionar sua gesto fiscal. ",lt.jsx("span",{className:"text-cyan-400 font-bold italic",children:"Em breve disponvel!"})]})]}),lt.jsxs("div",{className:"flex items-center gap-3 px-6 py-2 bg-white/5 border border-white/5 rounded-full text-[10px] font-black uppercase tracking-[0.2em] text-cyan-500/70",children:[lt.jsx(hD,{className:"w-3 h-3 fill-current"}),"Prxima Grande Atualizao"]}),lt.jsx("style",{children:`
                        @keyframes bounce-slow {
                            0%, 100% { transform: translateY(0); }
                            50% { transform: translateY(-10px); }
                        }
                        .animate-bounce-slow {
                            animation: bounce-slow 3s infinite ease-in-out;
                        }
                    `})]});case"COMPLIANCE":return lt.jsx(Xz,{});case"CREDITS":return lt.jsx(Fz,{});case"SETTINGS":return lt.jsx(Uz,{});case"NIFS":return lt.jsx(Hz,{});case"REPORTS":return lt.jsx(Bz,{});case"FISCAL_ERRORS":return lt.jsx(Iz,{});case"PERFORMANCE_SERVERS":return lt.jsx(Kz,{});case"SAAS_ADMIN":return lt.jsx(Yz,{});default:return lt.jsx(KE,{})}},pr=()=>({OVERVIEW:"Viso Geral",CLIENTS:"Empresas",DOCUMENTS:"Meus Documentos",UPLOAD:"Novo Upload",ANALYSIS_RESULTS:"Resultados da Anlise",CREDITS:"Gesto de Crditos",SETTINGS:"Configuraes da Conta",AI_ASSISTANT:"Assistente Inteligente (Gemini)",NIFS:"Gesto de NIFs",COMPLIANCE:"Conformidade AGT",REPORTS:"Relatrios Fiscais",FISCAL_ERRORS:"Erros e Inconsistncias",PERFORMANCE_SERVERS:"Servidores de Alta Performance",SAAS_ADMIN:"Backoffice Administrativo"})[ct];return Yt?lt.jsxs("div",{className:"fixed inset-0 z-[9999] bg-[#020202] flex flex-col items-center justify-center animate-in fade-in duration-300",children:[lt.jsxs("div",{className:"relative mb-8",children:[lt.jsx("div",{className:"absolute inset-0 bg-cyan-500/20 blur-[60px] rounded-full animate-pulse"}),lt.jsx(xz,{className:"w-32 h-32 relative z-10 animate-bounce-slow",iconClassName:"w-16 h-16"})]}),lt.jsx("h1",{className:"text-2xl font-bold text-white tracking-tight mb-2 animate-pulse",children:"KwikDocs Fiscal AI"}),lt.jsx("p",{className:"text-slate-500 text-xs uppercase tracking-widest mb-8",children:"Inicializando Ncleo Neural..."}),lt.jsx("div",{className:"w-48 h-1 bg-[#111] rounded-full overflow-hidden",children:lt.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-teal-500 animate-[loading_4s_ease-in-out_forwards] w-0"})}),lt.jsx("style",{children:`
                    @keyframes loading {
                        0% { width: 0%; }
                        100% { width: 100%; }
                    }
                    @keyframes bounce-slow {
                        0%, 100% { transform: translateY(0); }
                        50% { transform: translateY(-10px); }
                    }
                    .animate-bounce-slow {
                        animation: bounce-slow 3s infinite ease-in-out;
                    }
                `})]}):e?(console.log("[DEBUG] App is in authLoading state"),lt.jsxs("div",{className:"fixed inset-0 z-[9999] bg-[#020202] flex flex-col items-center justify-center",children:[lt.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin"}),lt.jsx("p",{className:"mt-4 text-slate-500 text-xs uppercase tracking-widest animate-pulse",children:"Autenticando..."})]})):(console.log("[DEBUG] App finished loading. FlowState:",H),H==="LANDING"?lt.jsx(Q.Suspense,{fallback:lt.jsx(Dw,{}),children:lt.jsx(Nz,{onLogin:Ke,onRegister:Dt})}):H==="LOGIN"||H==="REGISTER"?lt.jsx(Q.Suspense,{fallback:lt.jsx(Dw,{}),children:lt.jsx(kz,{initialMode:H,onAuthSuccess:pi,onSwitchMode:bn})}):H==="ONBOARDING"?lt.jsx(Q.Suspense,{fallback:lt.jsx(Dw,{}),children:lt.jsx(Pz,{onComplete:Ee})}):lt.jsx(Oz,{userId:(t==null?void 0:t.id)||"",companyId:s==="ALL"||s==null?void 0:s.id,children:lt.jsxs("div",{className:"flex h-screen bg-[#000000] text-slate-50 font-sans overflow-hidden relative animate-in fade-in duration-700",children:[lt.jsx(Q.Suspense,{fallback:null,children:lt.jsx(qz,{})}),Xt&&lt.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-md z-[55] lg:hidden animate-in fade-in duration-300",onClick:()=>Vt(!1)}),pt&&lt.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-start justify-center pt-[15vh] px-4",onClick:()=>Et(!1),children:[lt.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200"}),lt.jsxs("div",{className:"relative w-full max-w-2xl bg-[#0a0a0a] border border-white/10 rounded-2xl shadow-[0_0_50px_rgba(0,0,0,0.8)] overflow-hidden flex flex-col animate-in zoom-in-95 slide-in-from-top-4 duration-200",onClick:te=>te.stopPropagation(),children:[lt.jsxs("div",{className:"flex items-center gap-3 px-4 py-4 border-b border-white/5",children:[lt.jsx(JB,{className:"w-5 h-5 text-slate-500"}),lt.jsx("input",{ref:_t,type:"text",className:"flex-1 bg-transparent border-none outline-none text-lg text-white placeholder-slate-600 font-medium",placeholder:"O que voc precisa fazer?",value:Wt,onChange:te=>{Zt(te.target.value),ft(0)}}),lt.jsx("div",{className:"px-2 py-1 bg-white/5 rounded text-[10px] font-bold text-slate-500 uppercase tracking-wider border border-white/5",children:"ESC"})]}),lt.jsx("div",{className:"max-h-[60vh] overflow-y-auto custom-scrollbar p-2",children:Zs.length===0?lt.jsx("div",{className:"p-8 text-center text-slate-500",children:lt.jsx("p",{children:"Nenhum comando encontrado."})}):lt.jsx("div",{className:"space-y-1",children:Zs.map((te,Ht)=>lt.jsxs("button",{onClick:()=>{te.action(),Et(!1)},onMouseEnter:()=>ft(Ht),className:`w-full flex items-center justify-between px-4 py-3 rounded-xl transition-all ${Ht===G?"bg-cyan-500/10 text-cyan-400":"text-slate-400 hover:bg-white/5"}`,children:[lt.jsxs("div",{className:"flex items-center gap-3",children:[lt.jsx(te.icon,{className:`w-5 h-5 ${Ht===G?"text-cyan-400":"text-slate-500"}`}),lt.jsx("span",{className:"font-medium text-sm",children:te.label})]}),Ht===G&&lt.jsx(zB,{className:"w-4 h-4 opacity-50"})]},te.id))})}),lt.jsxs("div",{className:"px-4 py-2 bg-[#050505] border-t border-white/5 flex items-center justify-between text-[10px] text-slate-600 font-bold uppercase tracking-widest",children:[lt.jsxs("div",{className:"flex gap-2",children:[lt.jsxs("span",{children:[lt.jsx("strong",{className:"text-slate-400",children:""})," Navegar"]}),lt.jsxs("span",{children:[lt.jsx("strong",{className:"text-slate-400",children:""})," Selecionar"]})]}),lt.jsx("span",{children:"KwikDocs Power Menu"})]})]})]}),lt.jsxs("div",{className:"fixed inset-0 pointer-events-none z-0",children:[lt.jsx("div",{className:"absolute top-[-20%] left-[-10%] w-[800px] h-[800px] bg-cyan-900/20 rounded-full blur-[150px] animate-pulse duration-[8000ms]"}),lt.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.02]"})]}),ct!=="ANALYSIS_RESULTS"&&lt.jsx(Q.Suspense,{fallback:null,children:lt.jsx(jz,{})}),ct!=="SAAS_ADMIN"&&lt.jsx("div",{className:`
                        fixed lg:relative z-[60] lg:z-50 h-full backdrop-blur-xl bg-[#02040a]/90 border-r border-white/5 flex-shrink-0 transition-transform duration-300 ease-in-out
                        ${Xt?"translate-x-0":"-translate-x-full lg:translate-x-0"}
                    `,children:lt.jsx(Q.Suspense,{fallback:lt.jsx("div",{className:"w-64 h-full bg-[#02040a] animate-pulse"}),children:lt.jsx(Dz,{currentView:ct,onChangeView:te=>{yt(te),Vt(!1)}})})}),lt.jsx("main",{className:"flex-1 overflow-auto relative z-10 custom-scrollbar flex flex-col",children:lt.jsxs("div",{className:`max-w-[1920px] mx-auto w-full transition-all duration-300 ${_||ct==="SAAS_ADMIN"?"p-0 h-full":"p-4 md:p-10"}`,children:[!_&&ct!=="SAAS_ADMIN"&&lt.jsxs("header",{className:"mb-10 flex flex-col md:flex-row md:items-end justify-between gap-6",children:[lt.jsxs("div",{children:[lt.jsxs("div",{className:"flex items-center gap-4",children:[lt.jsx("button",{onClick:()=>Vt(!0),className:"lg:hidden p-2 bg-white/5 border border-white/10 rounded-xl text-slate-400 hover:text-white transition-colors",children:lt.jsx(YB,{className:"w-6 h-6"})}),lt.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white tracking-tight",children:pr()})]}),lt.jsxs("p",{className:"hidden md:block text-slate-400 text-sm mt-1",children:["Bem-vindo de volta, ",lt.jsx("span",{className:"text-cyan-400 font-medium",children:t==null?void 0:t.name}),"."]})]}),lt.jsxs("div",{className:"flex items-center gap-6",children:[lt.jsxs("div",{className:"hidden xl:flex items-center gap-2 text-[10px] font-bold text-slate-600 bg-white/5 px-3 py-1.5 rounded-lg border border-white/5 cursor-pointer hover:bg-white/10 hover:text-white transition-colors",onClick:()=>Et(!0),title:"Abrir Menu de Comandos",children:[lt.jsx(FB,{className:"w-3 h-3"}),lt.jsx("span",{children:"CTRL + K"})]}),(b.length>0||Oi||C)&&ct!=="ANALYSIS_RESULTS"&&lt.jsxs("button",{onClick:ws,className:`flex items-center gap-3 border px-4 py-2 rounded-xl transition-all animate-in fade-in zoom-in-95 group shadow-lg ${C?"bg-emerald-500/10 border-emerald-500/30 text-emerald-400":"bg-cyan-500/10 border-cyan-500/30 text-cyan-400"}`,children:[lt.jsxs("div",{className:"relative",children:[lt.jsx(cw,{className:`w-4 h-4 ${Oi?"animate-pulse":""} ${C?"text-emerald-400":""}`}),(Oi||C)&&lt.jsxs("span",{className:"absolute -top-1 -right-1 flex h-2 w-2",children:[lt.jsx("span",{className:`animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 ${C?"bg-emerald-400":"bg-cyan-400"}`}),lt.jsx("span",{className:`relative inline-flex rounded-full h-2 w-2 ${C?"bg-emerald-500":"bg-cyan-500"}`})]})]}),lt.jsxs("div",{className:"flex items-center gap-2",children:[lt.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:C?"Anlise Completa":"Ver Processos"}),lt.jsx(NB,{className:`w-3.5 h-3.5 ${Oi?"animate-[wiggle_1s_ease-in-out_infinite] text-cyan-300":C?"text-emerald-400 animate-pulse":"text-cyan-600"}`})]})]}),!Hr&&lt.jsxs("div",{className:"relative z-50",children:[lt.jsxs("button",{onClick:()=>Pt(!gt),className:"flex items-center gap-3 bg-[#0a0b10] border border-white/10 hover:border-cyan-500/50 rounded-xl pl-3 pr-4 py-2 transition-all group min-w-[260px] shadow-lg",children:[lt.jsxs("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center border border-white/5 group-hover:border-cyan-500/30 relative",children:[lt.jsx(Zg,{className:"w-5 h-5 text-cyan-400"}),C&&lt.jsxs("span",{className:"absolute -top-1 -right-1 flex h-3 w-3",children:[lt.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"}),lt.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-emerald-500"})]})]}),lt.jsxs("div",{className:"flex-1 text-left",children:[lt.jsx("div",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:h?"Modo Contabilista":"Empresa Ativa"}),lt.jsx("div",{className:"text-sm font-bold text-white truncate w-32 md:w-40",children:s==="ALL"?"Viso Geral (Consolidada)":(s==null?void 0:s.name)||"Selecione..."})]}),lt.jsx(IB,{className:`w-4 h-4 text-slate-500 transition-transform duration-300 ${gt?"rotate-180":""}`})]}),gt&&lt.jsx("div",{className:"absolute right-0 top-full mt-2 w-[300px] bg-[#0a0b10] border border-white/10 rounded-xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:lt.jsxs("div",{className:"max-h-[280px] overflow-y-auto custom-scrollbar p-1",children:[lt.jsxs("button",{onClick:()=>{r("ALL"),Pt(!1)},className:`w-full text-left flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 transition-all ${s==="ALL"?"bg-cyan-500/5 ring-1 ring-cyan-500/20":""}`,children:[lt.jsx(Zg,{className:"w-4 h-4 text-slate-500"}),lt.jsx("span",{className:`text-sm font-bold truncate ${s==="ALL"?"text-cyan-400":"text-slate-200"}`,children:"Viso Geral (Consolidada)"})]}),u.map(te=>lt.jsxs("button",{onClick:()=>{r(te.id),Pt(!1)},className:`w-full text-left flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 transition-all ${s!=="ALL"&&(s==null?void 0:s.id)===te.id?"bg-cyan-500/5 ring-1 ring-cyan-500/20":""}`,children:[lt.jsx(Zg,{className:"w-4 h-4 text-slate-500"}),lt.jsxs("div",{className:"flex-1 min-w-0",children:[lt.jsx("div",{className:`text-sm font-bold truncate ${s!=="ALL"&&(s==null?void 0:s.id)===te.id?"text-cyan-400":"text-slate-200"}`,children:te.name}),lt.jsxs("div",{className:"text-xs text-slate-500 font-mono",children:["NIF: ",te.nif]})]})]},te.id))]})})]})]})]}),lt.jsx("div",{className:`${_?"h-full flex flex-col":""}`,children:lt.jsx(Q.Suspense,{fallback:lt.jsx(Dw,{}),children:Bo()})})]})}),p&&lt.jsx(Q.Suspense,{fallback:null,children:lt.jsx(Vz,{onViewResults:()=>yt("ANALYSIS_RESULTS")})}),(t==null?void 0:t.force_password_change)&&lt.jsx(Q.Suspense,{fallback:null,children:lt.jsx(Gz,{})}),lt.jsx(Q.Suspense,{fallback:null,children:lt.jsx(Wz,{})})]})}))},fP=Q.createContext({isOnline:!0,isSyncing:!1,pendingCount:0,setPendingCount:()=>{},setIsSyncing:()=>{}}),kj=()=>Q.useContext(fP),Jz=({children:l})=>{const[t,e]=Q.useState(navigator.onLine),[n,s]=Q.useState(!1),[r,u]=Q.useState(0);return Q.useEffect(()=>{const h=()=>e(!0),f=()=>e(!1);return window.addEventListener("online",h),window.addEventListener("offline",f),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",f)}},[]),lt.jsx(fP.Provider,{value:{isOnline:t,isSyncing:n,pendingCount:r,setPendingCount:u,setIsSyncing:s},children:l})};function Zz(l={}){const{immediate:t=!1,onNeedRefresh:e,onOfflineReady:n,onRegistered:s,onRegisteredSW:r,onRegisterError:u}=l;let h,f;const p=async(b=!0)=>{await f};async function m(){if("serviceWorker"in navigator){if(h=await Dn(async()=>{const{Workbox:b}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:b}},[]).then(({Workbox:b})=>new b("/sw.js",{scope:"/",type:"classic"})).catch(b=>{u==null||u(b)}),!h)return;h.addEventListener("activated",b=>{(b.isUpdate||b.isExternal)&&window.location.reload()}),h.addEventListener("installed",b=>{b.isUpdate||n==null||n()}),h.register({immediate:t}).then(b=>{r?r("/sw.js",b):s==null||s(b)}).catch(b=>{u==null||u(b)})}}return f=m(),p}const pP=document.getElementById("root");if(!pP)throw new Error("Root element not found");const tj=Zz({onNeedRefresh(){confirm("Nova verso disponvel. Recarregar?")&&tj(!0)},onOfflineReady(){console.log("App pronta para uso offline.")}}),ej=GL.createRoot(pP);ej.render(lt.jsx(Sn.StrictMode,{children:lt.jsx(nF,{children:lt.jsx(Sz,{children:lt.jsx(Jz,{children:lt.jsx(dB,{children:lt.jsx(Qz,{})})})})})}));export{de as A,Zg as B,IB as C,ze as D,hP as E,HB as F,FB as G,Tz as H,iF as I,JN as J,PL as K,qB as L,YB as M,ij as N,aj as O,WB as P,wj as Q,Sn as R,tF as S,hD as Z,Dn as _,Ez as a,xz as b,NB as c,Ps as d,kj as e,DB as f,JB as g,pp as h,VB as i,lt as j,v_ as k,cw as l,zC as m,Wf as n,jL as o,jC as p,sj as q,Q as r,sF as s,TI as t,kM as u,yz as v,gz as w,fz as x,ZN as y,_j as z};
