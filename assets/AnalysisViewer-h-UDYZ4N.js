const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-BXxfUXS_.js","assets/index-J78_TlI6.js","assets/index-CLM23Pdi.css","assets/jspdf.plugin.autotable-DLiqeKdq.js"])))=>i.map(i=>d[i]);
import{d as _,r as w,a as De,R as pe,j as e,F as ue,l as Me,B as Ie,n as Re,_ as Q}from"./index-J78_TlI6.js";import{a as $e}from"./formatters-DUYcZ69c.js";import{D as Oe}from"./download-DWa1ktEb.js";import{T as ze}from"./target-CR39MDLI.js";import{B as Pe}from"./bot-BI8oJrgp.js";import{S as Le}from"./scale-BED4e_Dj.js";import{O as Ve}from"./octagon-alert-WMrmy5y9.js";import{F as Ue}from"./file-check-D0GgYD-n.js";import{S as Be}from"./siren-BAvF9pVf.js";import{T as We}from"./triangle-alert-CKc6-SxM.js";import{C as Je}from"./circle-check-BtkD6xxC.js";import{C as qe}from"./chevron-up-Cni0Exm5.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"m14 13-8.381 8.38a1 1 0 0 1-3.001-3l8.384-8.381",key:"pgg06f"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m21.5 10.5-8-8",key:"a17d9x"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m8.5 7.5 8 8",key:"1oyaui"}]],Ye=_("gavel",He);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],Xe=_("lightbulb",Ze);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M16 5H3",key:"m91uny"}],["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 19H3",key:"zzsher"}],["path",{d:"m15.5 9.5 5 5",key:"ytk86i"}],["path",{d:"m20.5 9.5-5 5",key:"17o44f"}]],Ke=_("list-x",Ge);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],et=_("rotate-ccw",Qe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]],st=_("scan",tt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],lt=_("shopping-bag",at);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],ot=_("zoom-in",rt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],nt=_("zoom-out",it),A=({children:s,className:x="",title:b,icon:j,color:N="slate",delay:k=0,fullWidth:O=!1})=>{const z={slate:"bg-slate-500/10 text-slate-400",blue:"bg-blue-500/10 text-blue-400",emerald:"bg-emerald-500/10 text-emerald-400",amber:"bg-amber-500/10 text-amber-400",red:"bg-red-500/10 text-red-400",cyan:"bg-cyan-500/10 text-cyan-400",purple:"bg-purple-500/10 text-purple-400",indigo:"bg-indigo-500/10 text-indigo-400"};return e.jsxs("div",{className:`
                relative overflow-hidden rounded-[20px] bg-[#0c0c0c] border border-white/[0.05] hover:border-white/10 
                shadow-xl transition-all duration-300 animate-in fade-in slide-in-from-bottom-4 group
                ${O?"col-span-1 lg:col-span-2 xl:col-span-3":""}
                ${x}
            `,style:{animationDelay:`${k}ms`,animationFillMode:"both"},children:[b&&e.jsxs("div",{className:"flex items-center gap-3 px-6 py-4 border-b border-white/[0.05] bg-[#0f0f0f]/50",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${z[N]}`,children:e.jsx(j,{className:"w-4 h-4"})}),e.jsx("h3",{className:"font-bold text-white text-xs uppercase tracking-wider",children:b})]}),e.jsx("div",{className:"p-6",children:s})]})},v=({label:s,value:x,sub:b,highlight:j=!1,warning:N=!1})=>e.jsxs("div",{className:"mb-1",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1",children:s}),e.jsx("p",{className:`text-sm font-medium ${N?"text-red-400":j?"text-white":"text-slate-300"} truncate`,children:x||"-"}),b&&e.jsx("p",{className:"text-[10px] text-slate-500 font-mono mt-0.5",children:b})]}),$=({children:s,color:x="slate"})=>{const b={slate:"bg-slate-500/10 text-slate-400 border-slate-500/20",emerald:"bg-emerald-500/10 text-emerald-400 border-emerald-500/20",red:"bg-red-500/10 text-red-400 border-red-500/20",amber:"bg-amber-500/10 text-amber-400 border-amber-500/20",blue:"bg-blue-500/10 text-blue-400 border-blue-500/20",cyan:"bg-cyan-500/10 text-cyan-400 border-cyan-500/20",purple:"bg-purple-500/10 text-purple-400 border-purple-500/20",indigo:"bg-indigo-500/10 text-indigo-400 border-indigo-500/20"};return e.jsx("span",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider border ${b[x]}`,children:s})},g=(s,x="AOA")=>s==null?"-":$e(s),vt=({document:s})=>{var oe,ie,ne,ce,de,xe,me;const[x,b]=w.useState(!1),[j,N]=w.useState(1),[k,O]=w.useState({x:0,y:0}),[z,ee]=w.useState(!1),[te,fe]=w.useState({x:0,y:0}),ge=w.useRef(null),be=w.useRef(null),{stopNotificationSound:se}=De();pe.useEffect(()=>{se()},[se]);const je=async()=>{var a,i,m,D,M,t,l,c,d,I;try{const{utils:R,writeFile:X,book_new:h,book_append_sheet:G}=await Q(async()=>{const{utils:B,writeFile:Ce,book_new:Ee,book_append_sheet:Fe}=await import("./xlsx-ebvMUq42.js");return{utils:B,writeFile:Ce,book_new:Ee,book_append_sheet:Fe}},[]),f=s.rawN8nResponse||{};let r=Array.isArray(f)?(a=f[0])==null?void 0:a.output:f.output||f.json||s.data||{};r&&r.resultado_analise&&typeof r.resultado_analise=="object"&&(r={...r,...r.resultado_analise});const K=[{ID:(s==null?void 0:s.id)||"-",Arquivo:(s==null?void 0:s.fileName)||"-",Emitente:((i=r==null?void 0:r.emitente)==null?void 0:i.nome)||((m=s.data)==null?void 0:m.merchantName)||"-","NIF Emitente":((D=r==null?void 0:r.emitente)==null?void 0:D.nif)||(s==null?void 0:s.nif_emitente)||"-","Data Emissão":((M=r==null?void 0:r.documento)==null?void 0:M.data_emissao)||((t=s.data)==null?void 0:t.date)||"-","Total Geral":((l=r==null?void 0:r.totais)==null?void 0:l.total_geral)||(s==null?void 0:s.valor_documento)||0,"Total IVA":((c=r==null?void 0:r.totais)==null?void 0:c.total_iva)||(s==null?void 0:s.valor_iva)||0,Status:(s==null?void 0:s.status)||"-",Decisão:((d=r==null?void 0:r.decisao_final)==null?void 0:d.status)||"-",Risco:((I=r==null?void 0:r.decisao_final)==null?void 0:I.nivel_risco)||"-",Itens:((r==null?void 0:r.itens)||[]).map(B=>`${B.descricao} (${B.quantidade}x)`).join("; ")}],Se=R.json_to_sheet(K),he=h();G(he,Se,"Analise"),X(he,`Analise_${s.fileName.replace(/\./g,"_")}.xlsx`)}catch(R){console.error("Export Excel Failed",R),alert("Erro ao gerar Excel. Tente novamente.")}},Ne=()=>N(a=>Math.min(a+.2,5)),ve=()=>N(a=>Math.max(a-.2,.5)),_e=()=>{N(1),O({x:0,y:0})},ye=a=>{const i=a.deltaY>0?-.1:.1;N(m=>Math.min(Math.max(.5,m+i),5))},we=a=>{j<=1||(ee(!0),fe({x:a.clientX-k.x,y:a.clientY-k.y}))},Ae=a=>{z&&O({x:a.clientX-te.x,y:a.clientY-te.y})},ae=()=>{ee(!1)},W=pe.useMemo(()=>{var a;return s.fileUrl&&s.fileUrl.startsWith("http")?s.fileUrl:s.fileBase64?s.fileBase64:(a=s.data)!=null&&a.previewUrl?s.data.previewUrl:(console.warn("[AnalysisViewer] No valid image source found for document:",s.id),null)},[s.fileUrl,s.fileBase64,(oe=s.data)==null?void 0:oe.previewUrl,s.id]);if(!s)return null;const P=s.rawN8nResponse||{};let T=Array.isArray(P)?(ie=P[0])==null?void 0:ie.output:P.output||P.json||s.data||{};if(T&&T.resultado_analise){let a=T.resultado_analise;if(typeof a=="string")try{a.trim().startsWith("{")&&(a=JSON.parse(a),typeof a=="string"&&(a=JSON.parse(a)))}catch(i){console.error("[AnalysisViewer] Failed to parse resultado_analise string:",i)}typeof a=="object"&&a!==null&&(T={...T,...a})}const o=T||{},S={...o.emitente,nif:((ne=o.emitente)==null?void 0:ne.nif)||s.nif_emitente},le=o.cliente||{},n=o.documento||{},C={...o.totais,total_geral:((ce=o.totais)==null?void 0:ce.total_geral)||s.valor_documento,total_iva:((de=o.totais)==null?void 0:de.total_iva)||s.valor_iva,subtotal:((xe=o.totais)==null?void 0:xe.subtotal)||s.valor_base},p=o.resumo_por_agente||{},J=o.classificacao_fiscal||p.classificacao_fiscal||{},q=J.tipo_operacao||"INDETERMINADA",L=o.decisao_final||p.decisao_final||{},u=L.status||s.status,E=(u==null?void 0:u.includes("APROVADA"))||u==="CONFORME",F=u==null?void 0:u.includes("REJEITADA"),H=o.motivos_rejeicao_ou_ressalvas||p.motivos_rejeicao_ou_ressalvas||[],re=o.orientacao_ao_contabilista||p.orientacao_ao_contabilista||{},V=o.impacto_fiscal||p.impacto_fiscal||{},y=o.conclusao_executiva||p.conclusao_executiva||{},Y=p;let Z=Y.agente_6_risco;!Z&&((me=Y.agente_5_compliance)!=null&&me.agente_6_risco)&&(Z=Y.agente_5_compliance.agente_6_risco);const U=[{key:"agente_1_ocr",label:"1 OCR",icon:st},{key:"agente_2_consulta_agt",label:"2 Consulta AGT",icon:Ie},{key:"agente_3_regime_fiscal",label:"3 Regime Fiscal",icon:Le},{key:"agente_4_confronto",label:"4 Confronto",icon:Ve},{key:"agente_5_compliance",label:"5 Compliance",icon:Ue},{key:"agente_6_risco",label:"6 Risco",icon:Be,dataOverride:Z}],ke=Object.keys(p).length>0,Te=async()=>{var a;try{const i=await Q(()=>import("./jspdf.es.min-BXxfUXS_.js").then(c=>c.j),__vite__mapDeps([0,1,2])),m=await Q(()=>import("./jspdf.plugin.autotable-DLiqeKdq.js").then(c=>c.j),__vite__mapDeps([3,1,2,0])),D=i.default,M=m.default||m,t=new D;t.setFillColor(10,10,12),t.rect(0,0,210,30,"F"),t.setFontSize(22),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.text("KwikDocs AI",15,20),t.setFontSize(10),t.setTextColor(150,150,150),t.text("Relatório de Análise Fiscal",200,20,{align:"right"}),t.setFillColor(245,247,250),t.rect(14,40,182,35,"F"),t.setFontSize(14),t.setTextColor(0,0,0),t.text(S.nome||"Emitente Desconhecido",20,52),t.setFontSize(10),t.setTextColor(100,100,100),t.text(`NIF: ${S.nif||"N/A"}`,20,60),t.text(`Data: ${n.data_emissao||((a=s.data)==null?void 0:a.date)||"-"}`,20,66),t.setFillColor(E?220:255,E?255:220,220),t.setTextColor(E?0:200,E?100:0,0),t.setFont("helvetica","bold"),t.text(u||"PENDENTE",188,52,{align:"right"}),t.setFontSize(10),t.setTextColor(100,100,100),t.text("SUBTOTAL",130,95,{align:"right"}),t.text("IVA",130,102,{align:"right"}),t.setFontSize(12),t.setTextColor(0,0,0),t.text(g(C.subtotal||0,n.moeda),190,95,{align:"right"}),t.text(g(C.total_iva||0,n.moeda),190,102,{align:"right"}),t.setDrawColor(200,200,200),t.line(120,108,190,108),t.setFontSize(16),t.setFont("helvetica","bold"),t.setTextColor(0,0,0),t.text("TOTAL",130,118,{align:"right"}),t.text(g(C.total_geral||n.total||0,n.moeda),190,118,{align:"right"});let l=125;if(o.itens&&o.itens.length>0){t.setFontSize(12),t.setTextColor(0,0,0),t.text("Itens da Fatura",14,135);const c=o.itens.map(d=>[d.descricao||"Item",d.quantidade||1,g(d.preco_unitario,n.moeda),`${d.taxa_iva||0}%`,g(d.total_item,n.moeda)]);M(t,{startY:140,head:[["Descrição","Qtd","Preço Unit.","IVA","Total"]],body:c,theme:"grid",headStyles:{fillColor:[10,10,12],textColor:255},styles:{fontSize:8,cellPadding:2}}),l=t.lastAutoTable.finalY+10}else l=135;if(y.resumo_geral){t.setFontSize(12),t.setTextColor(0,100,200),t.text("Conclusão Executiva",14,l),l+=7,t.setFontSize(10),t.setTextColor(50,50,50);const c=t.splitTextToSize(y.resumo_geral,180);t.text(c,14,l),l+=c.length*5+10}else l+=10;U&&U.length>0&&(l>230&&(t.addPage(),l=30),t.setFontSize(14),t.setTextColor(0,0,0),t.setFillColor(240,240,240),t.rect(0,l-10,210,15,"F"),t.text("Detalhamento por Agente AI",15,l),l+=20,U.forEach(c=>{const d=c.dataOverride||p[c.key]||{},I=d.resultado||"N/A";l>250&&(t.addPage(),l=30),t.setFontSize(11),t.setTextColor(0,0,0),t.setFont("helvetica","bold"),t.text(`${c.label}  [${I}]`,15,l),l+=6,t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(80,80,80);const R=t.splitTextToSize(d.objetivo||"Sem descrição.",180);t.text(R,15,l),l+=R.length*4+6,d.detalhes&&Object.entries(d.detalhes).forEach(([X,h])=>{if(h==null||Array.isArray(h)&&h.length===0)return;l>270&&(t.addPage(),l=30);const G=X.replace(/_/g," ").toUpperCase();t.setFont("helvetica","bold"),t.setFontSize(8),t.setTextColor(50,50,50),t.text(G,20,l),l+=4;let f=[];if(t.setFont("helvetica","normal"),t.setTextColor(100,100,100),Array.isArray(h))h.forEach(r=>{const K=typeof r=="string"?`• ${r}`:`• ${r.descricao||JSON.stringify(r)}`;f.push(...t.splitTextToSize(K,170))});else if(typeof h=="object"){const r=JSON.stringify(h);f=t.splitTextToSize(r,170)}else f=t.splitTextToSize(String(h),170);t.text(f,20,l),l+=f.length*4+4}),l+=8})),t.save(`Analise_${s.fileName||"Doc"}.pdf`)}catch(i){console.error("PDF Export Failed",i),alert("Erro ao gerar PDF.")}};return e.jsxs("div",{className:"flex h-full bg-[#080808] overflow-hidden",children:[e.jsxs("div",{className:"hidden lg:flex lg:w-[40%] flex-col border-r border-white/5 relative z-10 bg-[#050505]",children:[e.jsx("div",{ref:ge,className:"flex-1 overflow-hidden flex items-center justify-center p-4 custom-scrollbar relative bg-black/40",onWheel:ye,onMouseDown:we,onMouseMove:Ae,onMouseUp:ae,onMouseLeave:ae,children:W?s.fileName.toLowerCase().endsWith(".pdf")?e.jsx("iframe",{src:`${W}#toolbar=0`,className:"w-full h-full rounded-lg bg-white shadow-2xl"},`pdf-${s.id}`):e.jsx("div",{className:"relative w-full h-full flex items-center justify-center overflow-hidden",children:e.jsx("img",{ref:be,src:W,className:`shadow-2xl transition-transform duration-75 select-none ${z?"cursor-grabbing":j>1?"cursor-grab":"cursor-default"}`,style:{transform:`translate(${k.x}px, ${k.y}px) scale(${j})`,maxHeight:"90%",maxWidth:"90%",objectFit:"contain"},draggable:!1},`img-${s.id}`)}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500 opacity-50",children:[e.jsx(ue,{className:"w-16 h-16 mb-4"}),e.jsx("p",{children:"Sem Pré-visualização"})]})}),e.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 z-50 flex items-center gap-2 bg-black/60 backdrop-blur-md px-3 py-2 rounded-full border border-white/10",children:[e.jsx("button",{onClick:ve,className:"p-2 hover:bg-white/10 rounded-full text-slate-400",children:e.jsx(nt,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-xs font-mono text-cyan-500 w-12 text-center",children:[Math.round(j*100),"%"]}),e.jsx("button",{onClick:Ne,className:"p-2 hover:bg-white/10 rounded-full text-slate-400",children:e.jsx(ot,{className:"w-4 h-4"})}),e.jsx("button",{onClick:_e,className:"p-2 hover:bg-white/10 rounded-full text-slate-400 border-l border-white/10 ml-1",children:e.jsx(et,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col h-full bg-[#080808] custom-scrollbar overflow-y-auto pb-32 pt-6 border-l border-white/5",children:[e.jsx("div",{className:`
                    relative overflow-hidden border-b border-white/5 p-6 flex-shrink-0
                    bg-gradient-to-r ${F?"from-red-900/10":E?"from-emerald-900/10":"from-amber-900/10"} to-transparent
                `,children:e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{color:F?"red":E?"emerald":"amber",children:u}),e.jsx($,{color:q==="SAIDA"?"blue":q==="ENTRADA"?"purple":"slate",children:q})]}),e.jsx("h1",{className:"text-2xl font-bold text-white mt-1",children:S.nome||"Emitente Desconhecido"}),e.jsxs("div",{className:"text-sm text-slate-400 font-mono flex flex-col gap-0.5",children:[e.jsxs("span",{className:"flex items-center gap-2",children:["NIF: ",S.nif||"N/A"]}),e.jsx("span",{className:"text-xs opacity-60 truncate max-w-[300px]",children:S.endereco_completo||"-"})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-3xl font-bold text-amber-500",children:g(C.total_geral,n.moeda)}),e.jsx("p",{className:"text-xs uppercase font-bold text-amber-500/50",children:"Total"})]}),e.jsxs("div",{className:"flex gap-4 text-[10px] font-mono text-slate-400 border-t border-white/5 pt-2 mt-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-slate-600",children:"Sub:"}),e.jsx("span",{children:g(C.subtotal,n.moeda)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-slate-600",children:"IVA:"}),e.jsx("span",{children:g(C.total_iva,n.moeda)})]})]}),e.jsxs("button",{onClick:je,className:"mt-2 flex items-center gap-2 px-3 py-1.5 rounded-lg bg-[#111] hover:bg-white/10 border border-white/5 text-[10px] font-bold uppercase text-slate-400 hover:text-white transition-all",children:[e.jsx("div",{className:"w-3.5 h-3.5 text-emerald-500 border border-emerald-500/50 rounded flex items-center justify-center text-[8px] font-bold",children:"X"})," Excel"]}),e.jsxs("button",{onClick:Te,className:"mt-2 flex items-center gap-2 px-3 py-1.5 rounded-lg bg-[#111] hover:bg-white/10 border border-white/5 text-[10px] font-bold uppercase text-slate-400 hover:text-white transition-all ml-2",children:[e.jsx(Oe,{className:"w-3.5 h-3.5 text-red-500"})," PDF"]})]})]})}),e.jsxs("div",{className:"p-6 grid grid-cols-1 gap-6",children:[(y.resumo_geral||y.descricao_simplificada)&&e.jsx(A,{title:"Conclusão Executiva",icon:ze,color:F?"red":"blue",fullWidth:!0,children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("div",{className:"p-3 bg-white/5 rounded-xl shrink-0",children:e.jsx(Me,{className:`w-6 h-6 ${F?"text-red-400":"text-blue-400"}`})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-white",children:['"',y.resumo_geral||y.descricao_simplificada,'"']}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{color:"slate",children:y.estado_documento_perante_agt||"N/A"}),J.justificacao&&e.jsxs("span",{className:"text-xs text-slate-500 mt-1 italic",children:["- ",J.justificacao]})]})]})]})}),ke&&e.jsx(A,{title:"Análise Multi-Agente AI",icon:Pe,color:"indigo",fullWidth:!0,children:e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-3",children:U.map(a=>{const i=a.dataOverride||p[a.key]||{resultado:"PENDENTE",objetivo:"A aguardar..."},m=i.resultado,D=["CONFORME","COERENTE","BAIXO"].includes(m),M=["INCOMPLETO","INCONSISTENTE","NAO_CONFORME","ALTO","INCOERENTE","NAO_CONFIRMADO"].includes(m);return e.jsxs("div",{className:"p-4 bg-white/[0.02] rounded-xl border border-white/5 hover:bg-white/[0.04] transition-colors flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:a.label})}),e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${D?"bg-emerald-500/10 text-emerald-400":M?"bg-red-500/10 text-red-400":"bg-amber-500/10 text-amber-400"}`,children:m||"N/A"})]}),e.jsx("p",{className:"text-xs text-white font-medium mb-1 line-clamp-2",children:i.objetivo}),e.jsx("div",{className:"mt-auto pt-2 space-y-1",children:i.detalhes&&Object.entries(i.detalhes).map(([t,l])=>{if(l==null)return null;if(Array.isArray(l)&&l.length===0)return e.jsxs("div",{className:"mt-1 text-[10px] text-slate-600 italic",children:["Sem ",t.replace(/_/g," ")]},t);const c=t.replace(/_/g," ");return Array.isArray(l)?e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"text-[9px] uppercase text-slate-600 font-bold mb-0.5",children:c}),l.map((d,I)=>e.jsxs("div",{className:"text-[10px] text-slate-400 flex items-start gap-1 ml-1",children:[e.jsx("span",{className:"w-1 h-1 rounded-full bg-slate-600 mt-1 shrink-0"}),e.jsx("span",{className:"w-full break-words whitespace-pre-wrap",children:typeof d=="string"?d:d.descricao||JSON.stringify(d)})]},I))]},t):e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500",children:[e.jsxs("span",{children:[c,":"]}),e.jsx("span",{className:"text-slate-300 ml-1 break-all",children:typeof l=="string"?l:JSON.stringify(l)})]},t)})})]},a.key)})})}),H&&H.length>0&&e.jsx(A,{title:"Motivos & Ressalvas",icon:Ke,color:"red",fullWidth:!0,children:e.jsx("div",{className:"space-y-3",children:H.map((a,i)=>e.jsxs("div",{className:"flex gap-4 items-start p-3 bg-red-500/5 border border-red-500/10 rounded-xl",children:[e.jsx("div",{className:"p-2 bg-red-500/10 rounded-lg text-red-400 shrink-0",children:e.jsx(We,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[10px] font-bold text-red-400 uppercase tracking-wider",children:a.origem||"SISTEMA"}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-red-900"}),e.jsx("span",{className:"text-[10px] text-red-300/70 uppercase tracking-wider",children:a.gravidade||"ALERTA"})]}),e.jsx("p",{className:"text-sm text-slate-200",children:a.descricao})]})]},i))})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 col-span-1 lg:col-span-2 xl:col-span-3",children:[e.jsx(A,{title:"Decisão & Risco",icon:Ye,color:F?"red":"emerald",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase text-slate-500 font-bold mb-1",children:"Decisão"}),e.jsx("p",{className:`text-lg font-bold ${F?"text-red-400":"text-emerald-400"}`,children:u})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase text-slate-500 font-bold mb-1",children:"Risco"}),e.jsx("p",{className:`text-lg font-bold ${L.nivel_risco==="ALTO"?"text-red-400":"text-white"}`,children:L.nivel_risco})]})]}),e.jsxs("div",{className:"bg-[#111] p-3 rounded-xl border border-white/5",children:[e.jsx("p",{className:"text-[10px] uppercase text-slate-500 font-bold mb-1",children:"Fundamentação"}),e.jsx("p",{className:"text-xs text-slate-300 leading-relaxed",children:L.fundamentacao_tecnica||"Sem dados."})]})]})}),e.jsx(A,{title:"Contabilidade & Compliance",icon:Xe,color:"cyan",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs($,{color:V.iva_dedutivel?"emerald":"amber",children:["IVA DEDUTÍVEL: ",V.iva_dedutivel?"SIM":"NÃO"]}),e.jsxs($,{color:V.risco_multa?"red":"emerald",children:["RISCO MULTA: ",V.risco_multa?"SIM":"NÃO"]})]}),re.acoes_recomendadas&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase text-slate-500 font-bold mb-2",children:"Recomendações"}),e.jsx("ul",{className:"space-y-2",children:re.acoes_recomendadas.map((a,i)=>e.jsxs("li",{className:"flex gap-2 items-start text-xs text-cyan-300",children:[e.jsx(Je,{className:"w-3.5 h-3.5 mt-0.5 shrink-0 text-cyan-500"}),e.jsx("span",{children:a})]},i))})]})]})})]}),o.itens&&o.itens.length>0&&e.jsx(A,{title:`Itens da Fatura (${o.itens.length})`,icon:lt,color:"slate",fullWidth:!0,children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-xs text-slate-400",children:[e.jsx("thead",{className:"text-[10px] uppercase bg-white/5 text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 rounded-l-lg",children:"Descrição"}),e.jsx("th",{className:"p-2 text-right",children:"Qtd"}),e.jsx("th",{className:"p-2 text-right",children:"Preço"}),e.jsx("th",{className:"p-2 text-right",children:"IVA"}),e.jsx("th",{className:"p-2 text-right rounded-r-lg",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:o.itens.map((a,i)=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"p-2 font-medium text-white",children:a.descricao}),e.jsx("td",{className:"p-2 text-right",children:a.quantidade}),e.jsx("td",{className:"p-2 text-right",children:g(a.preco_unitario,n.moeda)}),e.jsxs("td",{className:"p-2 text-right",children:[a.taxa_iva,"%"]}),e.jsx("td",{className:"p-2 text-right font-bold text-slate-200",children:g(a.total_item,n.moeda)})]},i))})]})})}),e.jsx(A,{title:"Detalhes do Documento",icon:ue,color:"slate",fullWidth:!0,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(v,{label:"Número",value:n.numero}),e.jsx(v,{label:"Série",value:n.serie}),e.jsx(v,{label:"Data Emissão",value:n.data_emissao}),e.jsx(v,{label:"Vencimento",value:n.data_fornecimento}),e.jsx(v,{label:"Moeda",value:n.moeda}),e.jsx(v,{label:"Pagamento",value:n.forma_pagamento}),e.jsx(v,{label:"Cliente",value:le.nome,sub:le.nif}),e.jsx(v,{label:"Software",value:S.software_faturacao})]})})]}),e.jsxs("div",{className:"flex justify-center pb-8 border-t border-white/5 pt-6 mx-8 mt-auto",children:[e.jsxs("button",{onClick:()=>b(!x),className:"flex items-center gap-2 px-4 py-2 rounded-xl border border-white/10 text-[10px] font-bold text-slate-500 hover:text-white hover:bg-white/5 transition-all uppercase tracking-wider",children:[x?e.jsx(qe,{className:"w-3 h-3"}):e.jsx(Re,{className:"w-3 h-3"})," ",x?"Ocultar JSON":"Inspecionar JSON"]}),x&&e.jsx("pre",{className:"mt-4 p-4 text-[10px] font-mono text-emerald-500/80 bg-black/50 rounded-xl overflow-x-auto w-full",children:JSON.stringify(o,null,2)})]})]})]})};export{vt as A};
