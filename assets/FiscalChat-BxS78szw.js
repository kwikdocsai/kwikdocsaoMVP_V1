import{a as G,u as z,r as c,j as e,l as Y,g as V,z as H}from"./index-DGClD9bb.js";import{T as J}from"./terminal-DiNP2tT0.js";import{B as _}from"./bot-DhE8vvr-.js";import{U as W}from"./user-Dk73SgFr.js";import{D as Q}from"./database-CwRLQoZ-.js";import{S as X}from"./send-CZR9ptcX.js";import{S as Z}from"./shield-check-BmpD1UBV.js";import{S as ee}from"./sparkles-DoYhhpP3.js";const ie=()=>{var E;const{documents:$,selectedCompany:o,isAccountingMode:j,ragPrompt:F}=G(),{user:v}=z(),[h,L]=c.useState(""),[N,k]=c.useState(!1),[f,D]=c.useState(!1),[S,A]=c.useState([{id:"welcome",role:"model",text:`Sistema KwikDocs Neural Online.
Olá ${(E=v==null?void 0:v.name)==null?void 0:E.split(" ")[0]}. Estou conectado à sua base fiscal via Agente RAG. Pode perguntar sobre valores, impostos ou datas específicas.`,timestamp:new Date}]),C=c.useRef(null),O=()=>{var t;(t=C.current)==null||t.scrollIntoView({behavior:"smooth"})};c.useEffect(()=>{O()},[S,f]);const B=async(t,n)=>{D(!0),await new Promise(s=>setTimeout(s,600));const a=t.toLowerCase(),i=a.split(" ").filter(s=>s.length>2),l=["2022","2023","2024","2025"].filter(s=>a.includes(s)),b=["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"],R=b.filter(s=>a.includes(s)).map(s=>b.indexOf(s)),P=n.map(s=>{var u,p,T;let r=0;const m=new Date(((u=s.data)==null?void 0:u.date)||s.uploadDate),x=m.getFullYear().toString(),g=m.getMonth(),w=JSON.stringify(s.data||{}).toLowerCase(),y=s.fileName.toLowerCase();return l.length>0?l.includes(x)&&(r+=10):x===new Date().getFullYear().toString()&&(r+=1),R.length>0&&R.includes(g)&&(r+=15),i.forEach(U=>{(w.includes(U)||y.includes(U))&&(r+=5)}),(p=s.data)!=null&&p.merchantName&&a.includes(s.data.merchantName.toLowerCase())&&(r+=20),(T=s.data)!=null&&T.category&&a.includes(s.data.category.toLowerCase())&&(r+=10),{doc:s,score:r}});let d=P.filter(s=>s.score>0).sort((s,r)=>r.score-s.score);return d.length===0?d=P.map(s=>({...s,score:1})).slice(0,20):d=d.slice(0,15),D(!1),d.map(s=>{var r,m,x,g,w,y,u,p;return`
            [Documento (Score: ${s.score})]
            ID: ${s.doc.id}
            Data: ${(r=s.doc.data)==null?void 0:r.date}
            Empresa: ${s.doc.companyName}
            Fornecedor: ${(m=s.doc.data)==null?void 0:m.merchantName}
            Valor: ${(x=s.doc.data)==null?void 0:x.totalAmount} ${(g=s.doc.data)==null?void 0:g.currency}
            Categoria: ${(w=s.doc.data)==null?void 0:w.category}
            NIF: ${(u=(y=s.doc.data)==null?void 0:y.issuer_data)==null?void 0:u.nif}
            Resumo: ${(p=s.doc.data)==null?void 0:p.summary}
        `}).join(`
`)},I=async()=>{if(!h.trim())return;const t={id:crypto.randomUUID(),role:"user",text:h,timestamp:new Date};A(a=>[...a,t]),L("");const n=$.filter(a=>a.status!=="COMPLETED"?!1:!j||o==="ALL"?!0:a.companyId===(o==null?void 0:o.id));try{const a=await B(t.text,n);k(!0);const i=j&&o!=="ALL"?o.id:"ALL",l=await H.generateResponse(t.text,S,a,i,F),b={id:crypto.randomUUID(),role:"model",text:l,timestamp:new Date};A(M=>[...M,b])}catch{const i={id:crypto.randomUUID(),role:"model",text:"Falha na conexão com o núcleo de IA.",timestamp:new Date};A(l=>[...l,i])}finally{k(!1),D(!1)}},K=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),I())},q=j?o==="ALL"?"Portfólio Completo":`Empresa: ${o==null?void 0:o.name}`:"Meus Documentos";return e.jsxs("div",{className:"max-w-5xl mx-auto h-[calc(100vh-140px)] flex flex-col animate-in fade-in slide-in-from-bottom-4 duration-500 relative",children:[e.jsxs("div",{className:"absolute inset-0 bg-[#020202] rounded-[32px] border border-white/[0.03] overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-[600px] h-[300px] bg-cyan-500/5 blur-[120px] rounded-full"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-[400px] h-[400px] bg-blue-500/5 blur-[100px] rounded-full"}),e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-5"})]}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full rounded-[32px] overflow-hidden backdrop-blur-sm",children:[e.jsxs("div",{className:"bg-[#0f111a]/80 border-b border-white/5 p-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-[#151515] p-2.5 rounded-xl border border-white/5 text-cyan-400 shadow-[0_0_15px_rgba(6,182,212,0.2)]",children:e.jsx(Y,{className:"w-6 h-6 animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-white text-lg tracking-tight",children:"Agente Fiscal RAG v4.0"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_5px_#10b981]"}),e.jsxs("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:["Conectado: ",q]})]})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs font-mono text-cyan-500/50 bg-cyan-950/20 px-3 py-1.5 rounded-lg border border-cyan-900/30",children:[e.jsx(J,{className:"w-3 h-3"}),"OPENAI_LINKED"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar",children:[S.map(t=>e.jsxs("div",{className:`flex gap-4 max-w-[85%] ${t.role==="user"?"ml-auto flex-row-reverse":""}`,children:[e.jsx("div",{className:`
                                w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg border
                                ${t.role==="model"?"bg-[#151515] text-cyan-400 border-cyan-500/20":"bg-slate-800 text-white border-white/10"}
                            `,children:t.role==="model"?e.jsx(_,{className:"w-5 h-5"}):e.jsx(W,{className:"w-5 h-5"})}),e.jsx("div",{className:`
                                p-5 rounded-2xl text-sm leading-relaxed shadow-xl border backdrop-blur-md
                                ${t.role==="user"?"bg-gradient-to-br from-cyan-600/20 to-blue-600/20 border-cyan-500/30 text-white rounded-tr-none":"bg-[#0a0b10]/90 border-white/5 text-slate-300 rounded-tl-none"}
                            `,children:t.text.split(`
`).map((n,a)=>e.jsx("p",{className:`mb-1 last:mb-0 ${n.startsWith("-")?"pl-2":""}`,children:n},a))})]},t.id)),f&&e.jsxs("div",{className:"flex gap-4 max-w-[85%] animate-in fade-in",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-[#151515] text-cyan-400/50 border border-white/5 flex items-center justify-center flex-shrink-0",children:e.jsx(Q,{className:"w-5 h-5 animate-pulse"})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-mono text-cyan-500/70 py-3",children:[e.jsx(V,{className:"w-3 h-3 animate-spin"}),"Buscando contexto relevante na base de dados..."]})]}),N&&e.jsxs("div",{className:"flex gap-4 max-w-[85%]",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-[#151515] text-cyan-400 border border-cyan-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsxs("div",{className:"bg-[#0a0b10] border border-white/5 px-6 py-5 rounded-2xl rounded-tl-none shadow-xl flex gap-1.5 items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full animate-bounce"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full animate-bounce delay-100"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full animate-bounce delay-200"})]})]}),e.jsx("div",{ref:C})]}),e.jsxs("div",{className:"p-6 bg-[#0f111a] border-t border-white/5",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"text",value:h,onChange:t=>L(t.target.value),onKeyDown:K,placeholder:$.length>0?"Pergunte sobre 'gastos em Agosto' ou 'total da Unitel'...":"Adicione documentos primeiro...",className:"w-full pl-6 pr-16 py-4 bg-[#05060a] border border-white/10 rounded-2xl focus:outline-none focus:border-cyan-500/50 focus:ring-1 focus:ring-cyan-500/20 text-slate-200 placeholder-slate-600 transition-all text-sm font-medium shadow-inner",disabled:N||f}),e.jsx("button",{onClick:I,disabled:!h.trim()||N||f,className:"absolute right-2 top-2 bottom-2 aspect-square bg-cyan-600 text-white rounded-xl hover:bg-cyan-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center shadow-lg shadow-cyan-900/20 group-hover:scale-95 active:scale-90",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex justify-center mt-3 gap-4",children:[e.jsxs("span",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"})," Secure RAG Context"]}),e.jsxs("span",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest flex items-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"})," GPT-4o Mini"]})]})]})]})]})};export{ie as default};
