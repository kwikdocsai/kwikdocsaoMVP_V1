import{d as y,a as I,r as m,j as e,n as D}from"./index-nUqprYZj.js";import{a as o}from"./formatters-DUYcZ69c.js";import{E}from"./jspdf.es.min-Drh3FMap.js";import{a as w}from"./jspdf.plugin.autotable-DFu0IpBf.js";import{utils as b,writeFile as T}from"./xlsx-ebvMUq42.js";import{S as F}from"./scale-CODYyw0O.js";import{C as v}from"./circle-check-BVqa_rYl.js";import{T as V}from"./triangle-alert-DeikG19M.js";import{S as $}from"./shield-check-R0wYdjos.js";import{C as M}from"./calculator-U6QKeZFx.js";import{L as C}from"./landmark-Dv_qv5O1.js";import{F as z}from"./file-check-BuxpiqKM.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],N=y("file-down",P);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],R=y("printer",O),te=()=>{const{selectedCompany:s,isLoadingData:g}=I(),[q,f]=m.useState(!0),[a,A]=m.useState(null),[d,k]=m.useState(new Date().getMonth()+1),[n,_]=m.useState(new Date().getFullYear()),L=async()=>{if(!g){f(!0);try{const t=s==="ALL"?"ALL":s==null?void 0:s.id,[l,c]=await Promise.all([D.getFaturixStats(t,d,n),(async()=>{const h=localStorage.getItem("auth_token");if(!t||t==="ALL")return{documents:[]};const i=await fetch(`/api/reports/vat-map?companyId=${t}&month=${d}&year=${n}`,{headers:{Authorization:`Bearer ${h}`}});return i.ok?await i.json():{documents:[]}})()]);A({...l,documentList:c.documentos||[]})}catch(t){console.error("Failed to load compliance stats:",t)}finally{f(!1)}}},S=async()=>{try{const t=s==null?void 0:s.id;if(!t||t==="ALL"){alert("Por favor selecione uma empresa específica para exportar o SAF-T.");return}const l=localStorage.getItem("auth_token"),c=await fetch(`/api/fiscal/saft?companyId=${t}&month=${d}&year=${n}`,{headers:{Authorization:`Bearer ${l}`}});if(!c.ok)throw new Error("Falha ao gerar SAF-T");const h=await c.blob(),i=window.URL.createObjectURL(h),r=document.createElement("a");r.href=i,r.download=`SAFT_AO_${n}_${d}.xml`,document.body.appendChild(r),r.click(),r.remove()}catch(t){console.error("Export Error:",t),alert("Erro ao exportar SAF-T. Verifique se existem dados aprovados para este período.")}},j=async t=>{try{const l=s==null?void 0:s.id;if(!l||l==="ALL"){alert("Selecione uma empresa.");return}const c=localStorage.getItem("auth_token"),i=await(await fetch(`/api/reports/vat-map?companyId=${l}&month=${d}&year=${n}`,{headers:{Authorization:`Bearer ${c}`}})).json();if(t==="EXCEL"){const r=Array.isArray(i.documentos)?i.documentos:[];if(r.length===0){alert("Não há dados para exportar neste período.");return}const p=b.json_to_sheet(r),u=b.book_new();b.book_append_sheet(u,p,"Mapa IVA"),T(u,`Mapa_IVA_${n}_${d}.xlsx`)}else{const r=new E;r.text(`Mapa de Apuramento do IVA - ${d}/${n}`,14,20);const p=[["Descrição","Valor"],["IVA Liquidado (Vendas)",o(i.resumo.iva_liquidado)],["IVA Dedutível (Compras)",o(i.resumo.iva_dedutivel)],["Posição Líquida",o(i.resumo.saldo_iva)]];w(r,{startY:30,head:[p[0]],body:p.slice(1)}),r.text("Detalhe de Documentos",14,r.lastAutoTable.finalY+15);const u=i.documentos.map(x=>[new Date(x.data_emissao).toLocaleDateString(),x.nif||"N/A",x.fornecedor||"N/A",o(x.total),o(x.iva),x.tipo_movimento]);w(r,{startY:r.lastAutoTable.finalY+20,head:[["Data","NIF","Entidade","Total","IVA","Tipo"]],body:u}),r.save(`Mapa_IVA_${n}_${d}.pdf`)}}catch(l){console.error("Map Export Error:",l),alert("Erro ao gerar mapa.")}};return m.useEffect(()=>{L()},[s,g,d,n]),e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-700 pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-emerald-500/10 rounded-2xl text-emerald-400 border border-emerald-500/20 shadow-lg shadow-emerald-500/5",children:e.jsx(F,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-white tracking-tighter",children:"Certificação & Conformidade AGT"}),e.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Gestão de Auditoria Fiscal e Arquivo Digital Certificado"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex bg-[#0A0A0A] border border-white/10 rounded-xl p-1",children:[e.jsx("select",{value:d,onChange:t=>k(parseInt(t.target.value)),className:"bg-transparent text-white text-xs font-bold px-3 py-2 outline-none",children:Array.from({length:12},(t,l)=>l+1).map(t=>e.jsx("option",{value:t,children:new Date(0,t-1).toLocaleString("pt-AO",{month:"long"})},t))}),e.jsx("div",{className:"w-px bg-white/10 my-1"}),e.jsx("select",{value:n,onChange:t=>_(parseInt(t.target.value)),className:"bg-transparent text-white text-xs font-bold px-3 py-2 outline-none",children:[2024,2025,2026,2027].map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>j("PDF"),className:"px-4 py-3 rounded-2xl bg-white/5 border border-white/10 text-white text-[10px] font-black uppercase tracking-widest hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Mapa IVA (PDF)"]}),e.jsxs("button",{onClick:()=>j("EXCEL"),className:"px-4 py-3 rounded-2xl bg-white/5 border border-white/10 text-white text-[10px] font-black uppercase tracking-widest hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"Excel"]})]}),e.jsxs("button",{onClick:S,className:"px-6 py-3 rounded-2xl bg-emerald-500 text-black text-[10px] font-black uppercase tracking-widest hover:shadow-lg hover:shadow-emerald-500/20 transition-all flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"Exportar SAFT-AO"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-[#080808] border border-white/[0.03] rounded-[32px] p-8 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-emerald-500/5 blur-3xl rounded-full"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("div",{className:"p-3 bg-emerald-500/10 rounded-xl text-emerald-400",children:e.jsx(v,{className:"w-5 h-5"})}),e.jsx("span",{className:"bg-emerald-500/10 text-emerald-400 text-[10px] px-2 py-1 rounded-lg font-black tracking-widest",children:"VALIDADO"})]}),e.jsx("h4",{className:"text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] mb-2",children:"Estado de Transmissão"}),e.jsx("p",{className:"text-white text-sm font-bold",children:"Último SAFT: 15 Jan 2026"})]})]}),e.jsxs("div",{className:"bg-[#080808] border border-white/[0.03] rounded-[32px] p-8 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-amber-500/5 blur-3xl rounded-full"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("div",{className:"p-3 bg-amber-500/10 rounded-xl text-amber-400",children:e.jsx(V,{className:"w-5 h-5"})}),e.jsx("span",{className:"bg-amber-500/10 text-amber-400 text-[10px] px-2 py-1 rounded-lg font-black tracking-widest",children:(a==null?void 0:a.total_retention)>0?"AUTOMÁTICO":"PENDENTE"})]}),e.jsx("h4",{className:"text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] mb-2",children:"Conformidade Retenções"}),e.jsxs("p",{className:"text-white text-sm font-bold",children:["Total Retido: ",o((a==null?void 0:a.total_retention)||0)]})]})]}),e.jsxs("div",{className:"bg-[#080808] border border-white/[0.03] rounded-[32px] p-8 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-cyan-500/5 blur-3xl rounded-full"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("div",{className:"p-3 bg-cyan-500/10 rounded-xl text-cyan-400",children:e.jsx($,{className:"w-5 h-5"})}),e.jsx("span",{className:"bg-cyan-500/10 text-cyan-400 text-[10px] px-2 py-1 rounded-lg font-black tracking-widest",children:"OK"})]}),e.jsx("h4",{className:"text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] mb-2",children:"Software de Faturação"}),e.jsx("p",{className:"text-white text-sm font-bold",children:"Certificação #425/AGT/2026"})]})]})]}),e.jsxs("div",{className:"bg-[#080808] border border-white/[0.03] rounded-[40px] p-10 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-10",children:[e.jsx(M,{className:"w-6 h-6 text-emerald-400"}),e.jsx("h3",{className:"text-xl font-bold text-white tracking-tight",children:"Apuramento de Impostos (Simulação Mensal)"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:[{label:"Total Base Tributável",value:o((a==null?void 0:a.total_sales)||0),desc:"Base para cálculo de IVA/IRT"},{label:"IVA Liquidado",value:o((a==null?void 0:a.vat_payable)||0),desc:"Dívida perante o estado"},{label:"IVA Dedutível",value:o((a==null?void 0:a.vat_deductible)||0),desc:"Recuperação tributária"},{label:"Retenção Fonte (6.5%)",value:o((a==null?void 0:a.total_retention)||0),desc:"Valor retido em Entradas"}].map((t,l)=>e.jsxs("div",{className:"p-6 rounded-[24px] bg-white/[0.01] border border-white/5 hover:bg-white/[0.02] transition-all",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest mb-3",children:t.label}),e.jsx("h4",{className:"text-2xl font-black text-white mb-2",children:t.value}),e.jsx("p",{className:"text-[10px] text-slate-600 font-medium",children:t.desc})]},l))}),e.jsxs("div",{className:"mt-12 p-8 rounded-3xl bg-emerald-500/[0.03] border border-emerald-500/10 flex flex-col md:flex-row justify-between items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-emerald-500 text-black rounded-2xl",children:e.jsx(C,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-bold",children:"Apuramento Líquido de IVA"}),e.jsx("p",{className:"text-slate-500 text-xs",children:"Valor estimado a pagar após deduções permitidas pela AGT"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h3",{className:"text-3xl font-black text-emerald-400 tracking-tighter",children:o(Math.max(0,((a==null?void 0:a.vat_payable)||0)-((a==null?void 0:a.vat_deductible)||0)-((a==null?void 0:a.total_retention)||0)))}),e.jsx("p",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-wider mt-1",children:"Sujeito a conferência SAFT"})]})]})]}),(a==null?void 0:a.documentList)&&a.documentList.length>0&&e.jsxs("div",{className:"bg-[#080808] border border-white/[0.03] rounded-[32px] p-8 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(z,{className:"w-6 h-6 text-slate-400"}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Documentos do Período"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/5 text-[10px] uppercase text-slate-500 font-bold tracking-widest",children:[e.jsx("th",{className:"py-4 pl-4",children:"Data"}),e.jsx("th",{className:"py-4",children:"NIF"}),e.jsx("th",{className:"py-4",children:"Entidade"}),e.jsx("th",{className:"py-4 text-right",children:"Total"}),e.jsx("th",{className:"py-4 text-right",children:"IVA"}),e.jsx("th",{className:"py-4 text-right pr-4",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:a.documentList.map((t,l)=>e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors text-sm text-slate-300",children:[e.jsx("td",{className:"py-4 pl-4 font-mono text-xs",children:new Date(t.data_emissao).toLocaleDateString()}),e.jsx("td",{className:"py-4 font-mono text-xs text-slate-500",children:t.nif||"-"}),e.jsx("td",{className:"py-4 font-bold text-white",children:t.fornecedor||"Consumidor Final"}),e.jsx("td",{className:"py-4 text-right font-mono",children:o(t.total)}),e.jsx("td",{className:"py-4 text-right font-mono text-slate-400",children:o(t.iva)}),e.jsx("td",{className:"py-4 text-right pr-4",children:e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded-md bg-emerald-500/10 text-emerald-400 text-[10px] font-bold uppercase tracking-wide border border-emerald-500/20",children:[e.jsx(v,{className:"w-3 h-3"})," Aprovado"]})})]},l))})]})})]}),e.jsx("div",{className:"absolute top-0 right-0 w-[500px] h-[500px] bg-emerald-500/5 blur-[120px] pointer-events-none rounded-full"})]})};export{te as default};
