const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-js_cOUDW.js","assets/index-CLM23Pdi.css"])))=>i.map(i=>d[i]);
import{d as g,a as L,r as i,D as r,j as e,l as R,i as A,_ as z}from"./index-js_cOUDW.js";import{A as F}from"./AnalysisViewer-CmtQfDZ6.js";import{C as G}from"./chevron-left-CM8xjkRx.js";import{R as E}from"./refresh-cw-DYiTwDlF.js";import{T as C}from"./triangle-alert-B56bs7qN.js";import{C as V}from"./circle-check-D4zvV2ZH.js";import{C as J}from"./clock-BTT0lfYr.js";import{A as $}from"./arrow-right-Br51ahbP.js";import"./formatters-DUYcZ69c.js";import"./download--v8XbRQx.js";import"./target-pVM7DMvK.js";import"./bot-Bi4PzR2b.js";import"./scale-znIUW4NX.js";import"./octagon-alert-CwlA9K8n.js";import"./siren-S_NTgxSC.js";import"./chevron-up-CU1TZYCU.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Q=g("arrow-left",B);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],K=g("circle-plus",H);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],U=g("keyboard",W),me=({onBack:_,onNewAnalysis:O})=>{var y;const{documents:c,lastBatchIds:h,uploadQueue:p,clearUploadQueue:I,refreshData:D,selectedDocument:u,setSelectedDocument:m}=L(),[n,w]=i.useState(0),[N,j]=i.useState(!1),P=async()=>{j(!0);try{await D()}finally{setTimeout(()=>j(!1),1e3)}},l=i.useMemo(()=>{if(u)return[u];if(p.length>0)return p.map(a=>{const d=c.find(x=>x.id===a.id);return d?{...a,...d}:a});if(h.length>0){const a=c.filter(d=>h.includes(d.id));if(a.length>0)return a}const s=c.filter(a=>a.status===r.PROCESSING);return s.length>0?s:c.slice(0,5)},[c,h,p,u]),t=l[n];i.useEffect(()=>{const a=!((t==null?void 0:t.rawN8nResponse)||(t==null?void 0:t.fullAnalysis)||(t==null?void 0:t.data)&&Object.keys(t.data).length>5)&&(t==null?void 0:t.status)!==r.PROCESSING;t&&a&&(console.log(`[AnalysisPage] Fetching full details for ${t.id} (Missing analysis data)`),(async()=>{try{const{documentService:x}=await z(async()=>{const{documentService:M}=await import("./index-js_cOUDW.js").then(S=>S.Q);return{documentService:M}},__vite__mapDeps([0,1])),k=await x.getDocumentById(t.id);k&&m(k)}catch(x){console.error("[AnalysisResultsPage] Failed to auto-fetch doc details:",x)}})())},[t==null?void 0:t.id,t==null?void 0:t.status,t==null?void 0:t.rawN8nResponse,m]);const o=i.useMemo(()=>({total:l.length,processing:l.filter(s=>s.status===r.PROCESSING).length,approved:l.filter(s=>{var a;return(s.status===r.COMPLETED||s.status===r.APROVADO)&&((a=s.data)==null?void 0:a.fiscal_validation)!=="REJEITADO"}).length,attention:l.filter(s=>{var a;return s.status===r.ERROR||s.status===r.REJEITADO||((a=s.data)==null?void 0:a.fiscal_validation)==="REJEITADO"}).length}),[l]),f=i.useCallback(()=>{n<l.length-1&&w(s=>s+1)},[n,l.length]),b=i.useCallback(()=>{n>0&&w(s=>s-1)},[n]);i.useEffect(()=>{const s=a=>{a.key==="ArrowRight"&&f(),a.key==="ArrowLeft"&&b()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[f,b]);const v=()=>{m(null),I(),O()},T=()=>{m(null),_()};return t?e.jsxs("div",{className:"h-[calc(100vh-140px)] flex flex-col animate-in fade-in slide-in-from-bottom-4 duration-500 relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 flex-shrink-0 bg-[#080808] border border-white/[0.03] p-4 rounded-[24px]",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:T,className:"group flex items-center gap-2 px-4 py-2.5 rounded-xl bg-[#111] hover:bg-[#161616] text-slate-400 hover:text-white transition-all border border-white/5",children:[e.jsx(G,{className:"w-4 h-4 group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wide",children:"Documentos"})]}),e.jsx("div",{className:"h-8 w-px bg-white/5"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${o.processing>0?"bg-cyan-500 animate-pulse":"bg-emerald-500"} shadow-[0_0_8px_currentColor]`}),e.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:o.processing>0?"Análise em Tempo Real":"Revisão de Lote"})]}),e.jsx("h1",{className:"text-xl font-bold text-white tracking-tight flex items-center gap-2",children:"Workstation Neural"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"hidden md:flex items-center bg-[#111] border border-white/5 rounded-xl p-1",children:[e.jsxs("div",{className:"px-4 py-1.5 border-r border-white/5 flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:"Total"}),e.jsx("span",{className:"text-sm font-bold text-white",children:o.total})]}),o.processing>0&&e.jsxs("div",{className:"px-4 py-1.5 border-r border-white/5 flex items-center gap-2",children:[e.jsx(A,{className:"w-3 h-3 text-cyan-500 animate-spin"}),e.jsx("span",{className:"text-sm font-bold text-cyan-400",children:o.processing})]}),e.jsxs("div",{className:"px-4 py-1.5 border-r border-white/5 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-sm font-bold text-emerald-400",children:o.approved})]}),e.jsxs("div",{className:"px-4 py-1.5 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),e.jsx("span",{className:"text-sm font-bold text-red-400",children:o.attention})]})]}),e.jsxs("button",{onClick:P,disabled:N,className:"bg-[#111] text-slate-400 hover:text-white px-4 py-2.5 rounded-xl font-bold text-xs uppercase tracking-wide flex items-center gap-2 border border-white/5 transition-all",children:[e.jsx(E,{className:`w-4 h-4 ${N?"animate-spin":""}`})," Sincronizar"]}),e.jsxs("button",{onClick:v,className:"bg-white text-black px-5 py-2.5 rounded-xl font-bold text-xs uppercase tracking-wide flex items-center gap-2 transition-all hover:bg-cyan-50",children:[e.jsx(K,{className:"w-4 h-4"})," Nova Análise"]})]})]}),e.jsxs("div",{className:"flex-1 bg-[#080808] border border-white/[0.03] rounded-[32px] overflow-hidden flex flex-col relative shadow-2xl",children:[e.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(rgba(6,182,212,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(6,182,212,0.02)_1px,transparent_1px)] bg-[size:20px_20px] pointer-events-none"}),e.jsx("div",{className:"flex-1 h-full w-full p-4 md:p-6 relative z-10",children:t.status===r.PROCESSING||(t.status===r.COMPLETED||t.status===r.APROVADO||t.status===r.REJEITADO)&&(!t.data||Object.keys(t.data).length===0)?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center animate-in fade-in duration-700 py-20",children:[e.jsxs("div",{className:"relative mb-10",children:[e.jsx("div",{className:"absolute inset-0 bg-cyan-500/20 blur-[60px] rounded-full animate-pulse"}),e.jsx("div",{className:"relative w-32 h-32 border-4 border-[#111] border-t-cyan-500 rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(R,{className:"w-12 h-12 text-cyan-400 animate-pulse"})})]}),e.jsx("h3",{className:"text-3xl font-black text-white mb-3 tracking-tight",children:"Extraindo Inteligência Fiscal"}),e.jsxs("p",{className:"text-slate-400 max-w-md text-sm leading-relaxed mb-8",children:["O motor neural está a digitalizar ",e.jsx("span",{className:"text-cyan-400 font-mono",children:t.fileName}),". A validar NIFs, cálculos e regras AGT em tempo real."]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:"OCR v3.0 Active"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:"AGT Cloud Link"})]})]}):t.status===r.ERROR&&!t.data?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"p-6 bg-red-500/10 rounded-full mb-6 border border-red-500/20 shadow-[0_0_30px_rgba(239,68,68,0.2)]",children:e.jsx(C,{className:"w-12 h-12 text-red-500"})}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Interrupção no Processamento"}),e.jsx("p",{className:"text-slate-400 max-w-md mb-6",children:"Houve um problema ao ler este ficheiro. Isto pode acontecer se o documento estiver muito ilegível ou se o servidor n8n atingiu um limite."}),e.jsxs("div",{className:"bg-[#111] border border-red-500/20 p-4 rounded-xl max-w-lg text-left w-full shadow-lg",children:[e.jsxs("div",{className:"text-[10px] text-red-400 font-bold uppercase mb-2 flex items-center gap-2",children:[e.jsx(E,{className:"w-3 h-3"})," Detalhes do Log"]}),e.jsx("code",{className:"text-xs text-red-200/70 font-mono break-all leading-relaxed",children:((y=t.rawData)==null?void 0:y.error)||t.rawText||"Causa provável: Timeout na resposta da IA ou ficheiro corrompido."})]})]}):e.jsx(F,{document:t})}),e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-50 animate-in slide-in-from-bottom-10 fade-in duration-500",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 bg-[#0f111a]/90 backdrop-blur-xl border border-white/10 p-1.5 sm:p-2 pl-2 sm:pl-3 pr-1.5 sm:pr-2 rounded-2xl shadow-[0_0_50px_rgba(0,0,0,0.8)] ring-1 ring-white/5 w-[calc(100vw-32px)] sm:w-auto overflow-hidden",children:[e.jsx("button",{onClick:b,disabled:n===0,className:"p-3 rounded-xl bg-white/5 hover:bg-white/10 disabled:opacity-20 disabled:cursor-not-allowed transition-all text-white border border-white/5 hover:border-cyan-500/30 group active:scale-95",children:e.jsx(Q,{className:"w-5 h-5 group-hover:-translate-x-0.5 transition-transform"})}),e.jsxs("div",{className:"flex flex-col items-center flex-1 sm:flex-none min-w-0 sm:min-w-[280px] px-2",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("span",{className:"text-[9px] sm:text-[10px] font-bold text-slate-500 uppercase tracking-widest whitespace-nowrap",children:["Doc ",n+1," de ",l.length]})}),e.jsxs("div",{className:"flex items-center gap-2 max-w-[120px] sm:max-w-[240px]",children:[t.status===r.COMPLETED||t.status===r.APROVADO?e.jsx(V,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 text-emerald-400 flex-shrink-0"}):t.status===r.ERROR||t.status===r.REJEITADO?e.jsx(C,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 text-red-400 flex-shrink-0"}):t.status===r.PENDING_REVIEW?e.jsx(J,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 text-amber-400 flex-shrink-0"}):e.jsx(A,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 text-cyan-400 animate-spin flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm font-bold text-white truncate",children:t.fileName})]})]}),e.jsx("button",{onClick:f,disabled:n===l.length-1,className:"p-3 rounded-xl bg-white/5 hover:bg-white/10 disabled:opacity-20 disabled:cursor-not-allowed transition-all text-white border border-white/5 hover:border-cyan-500/30 group active:scale-95",children:e.jsx($,{className:"w-5 h-5 group-hover:translate-x-0.5 transition-transform"})}),e.jsx("div",{className:"h-8 w-px bg-white/10 mx-1"}),e.jsxs("div",{className:"pr-2 flex flex-col justify-center items-center gap-1 opacity-40",children:[e.jsx(U,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-[8px] font-bold text-slate-500 uppercase",children:"Nav"})]})]})})]})]}):e.jsxs("div",{className:"h-[calc(100vh-140px)] flex flex-col items-center justify-center text-slate-500 bg-[#080808] rounded-[32px] border border-white/5 border-dashed",children:[e.jsx(R,{className:"w-12 h-12 mb-4 opacity-20 animate-pulse"}),e.jsx("h3",{className:"text-white font-bold",children:"Nenhum processo ativo"}),e.jsx("p",{className:"text-sm mt-2",children:"Inicie uma nova análise no portal."}),e.jsx("button",{onClick:v,className:"mt-6 px-6 py-2 bg-white text-black font-bold rounded-xl text-xs uppercase tracking-widest",children:"Nova Análise"})]})};export{me as default};
