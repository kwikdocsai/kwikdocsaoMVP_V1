import{a as K,u as Y,r as i,j as e,l as G,g as H,H as V}from"./index-J78_TlI6.js";import{T as J}from"./terminal-DPTCdUNc.js";import{B as F}from"./bot-BI8oJrgp.js";import{U as W}from"./user-B17Erjve.js";import{D as Q}from"./database-BAEIWYTg.js";import{S as X}from"./send-DUro_Yo1.js";import{S as Z}from"./shield-check-BAy-76FJ.js";import{S as ee}from"./sparkles-Cd9PslOP.js";const ce=()=>{var E;const{documents:A,selectedCompany:o,isAccountingMode:j,ragPrompt:P}=K(),{user:v}=Y(),[h,z]=i.useState(""),[N,$]=i.useState(!1),[f,D]=i.useState(!1),[k,S]=i.useState([{id:"welcome",role:"model",text:`Sistema KwikDocs Neural Online.
Olá ${(E=v==null?void 0:v.name)==null?void 0:E.split(" ")[0]}. Estou conectado à sua base fiscal via Agente RAG. Pode perguntar sobre valores, impostos ou datas específicas.`,timestamp:new Date}]),L=i.useRef(null),_=()=>{var t;(t=L.current)==null||t.scrollIntoView({behavior:"smooth"})};i.useEffect(()=>{_()},[k,f]);const O=async(t,n)=>{D(!0),await new Promise(a=>setTimeout(a,600));const s=t.toLowerCase(),c=s.split(" ").filter(a=>a.length>2),l=["2022","2023","2024","2025"].filter(a=>s.includes(a)),b=["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"],M=b.filter(a=>s.includes(a)).map(a=>b.indexOf(a)),R=n.map(a=>{var u,p,U;let r=0;const m=new Date(((u=a.data)==null?void 0:u.date)||a.uploadDate),x=m.getFullYear().toString(),g=m.getMonth(),w=JSON.stringify(a.data||{}).toLowerCase(),y=a.fileName.toLowerCase();return l.length>0?l.includes(x)&&(r+=10):x===new Date().getFullYear().toString()&&(r+=1),M.length>0&&M.includes(g)&&(r+=15),c.forEach(T=>{(w.includes(T)||y.includes(T))&&(r+=5)}),(p=a.data)!=null&&p.merchantName&&s.includes(a.data.merchantName.toLowerCase())&&(r+=20),(U=a.data)!=null&&U.category&&s.includes(a.data.category.toLowerCase())&&(r+=10),{doc:a,score:r}});let d=R.filter(a=>a.score>0).sort((a,r)=>r.score-a.score);return d.length===0?d=R.map(a=>({...a,score:1})).slice(0,20):d=d.slice(0,15),D(!1),d.map(a=>{var r,m,x,g,w,y,u,p;return`
            [Documento (Score: ${a.score})]
            ID: ${a.doc.id}
            Data: ${(r=a.doc.data)==null?void 0:r.date}
            Empresa: ${a.doc.companyName}
            Fornecedor: ${(m=a.doc.data)==null?void 0:m.merchantName}
            Valor: ${(x=a.doc.data)==null?void 0:x.totalAmount} ${(g=a.doc.data)==null?void 0:g.currency}
            Categoria: ${(w=a.doc.data)==null?void 0:w.category}
            NIF: ${(u=(y=a.doc.data)==null?void 0:y.issuer_data)==null?void 0:u.nif}
            Resumo: ${(p=a.doc.data)==null?void 0:p.summary}
        `}).join(`
`)},C=async()=>{if(!h.trim())return;const t={id:crypto.randomUUID(),role:"user",text:h,timestamp:new Date};S(s=>[...s,t]),z("");const n=A.filter(s=>s.status!=="COMPLETED"?!1:!j||o==="ALL"?!0:s.companyId===(o==null?void 0:o.id));try{const s=await O(t.text,n);$(!0);const c=j&&o!=="ALL"?o.id:"ALL",l=await V.generateResponse(t.text,k,s,c,P),b={id:crypto.randomUUID(),role:"model",text:l,timestamp:new Date};S(I=>[...I,b])}catch{const c={id:crypto.randomUUID(),role:"model",text:"Falha na conexão com o núcleo de IA.",timestamp:new Date};S(l=>[...l,c])}finally{$(!1),D(!1)}},q=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),C())},B=j?o==="ALL"?"Portfólio Completo":`Empresa: ${o==null?void 0:o.name}`:"Meus Documentos";return e.jsxs("div",{className:"max-w-5xl mx-auto h-[calc(100vh-140px)] flex flex-col animate-in fade-in slide-in-from-bottom-4 duration-500 relative",children:[e.jsxs("div",{className:"absolute inset-0 bg-[#020202] rounded-[32px] border border-white/[0.03] overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-[600px] h-[300px] bg-cyan-500/5 blur-[120px] rounded-full"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-[400px] h-[400px] bg-blue-500/5 blur-[100px] rounded-full"}),e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-5"})]}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full rounded-[32px] overflow-hidden backdrop-blur-2xl bg-[#050505]/80 ring-1 ring-white/5 shadow-2xl",children:[e.jsxs("div",{className:"bg-gradient-to-b from-zinc-900/50 to-transparent border-b border-white/5 p-6 flex items-center justify-between backdrop-blur-md",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cyan-500/10 to-blue-600/10 p-3 rounded-2xl border border-white/5 text-cyan-400 shadow-[0_0_20px_rgba(6,182,212,0.15)] relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-cyan-500 blur-xl opacity-20 group-hover:opacity-40 transition-opacity"}),e.jsx(G,{className:"w-6 h-6 relative z-10"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-black text-white text-xl tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-white to-zinc-400",children:"Agente Fiscal RAG v4.0"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_#10b981] animate-pulse"}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-[0.15em]",children:B})]})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-[10px] font-black tracking-wider text-cyan-500/50 bg-cyan-950/10 px-4 py-2 rounded-xl border border-cyan-900/20 uppercase",children:[e.jsx(J,{className:"w-3 h-3"}),"System Ready"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-8 space-y-8 custom-scrollbar scroll-smooth",children:[k.map(t=>e.jsxs("div",{className:`flex gap-5 max-w-[85%] group animate-in slide-in-from-bottom-4 duration-500 ${t.role==="user"?"ml-auto flex-row-reverse":""}`,children:[e.jsx("div",{className:`
                                w-11 h-11 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-lg border backdrop-blur-md transition-transform group-hover:scale-105 duration-300
                                ${t.role==="model"?"bg-zinc-900/80 text-cyan-400 border-white/5":"bg-zinc-800/50 text-white border-white/5"}
                            `,children:t.role==="model"?e.jsx(F,{className:"w-5 h-5"}):e.jsx(W,{className:"w-5 h-5"})}),e.jsx("div",{className:`
                                p-6 rounded-[1.5rem] text-sm leading-relaxed shadow-xl border backdrop-blur-md transition-all duration-300 hover:shadow-2xl
                                ${t.role==="user"?"bg-gradient-to-br from-cyan-600 to-blue-600 border-white/10 text-white rounded-tr-sm shadow-cyan-900/20":"bg-[#0a0a0a]/90 border-white/5 text-zinc-300 rounded-tl-sm"}
                            `,children:t.text.split(`
`).map((n,s)=>e.jsx("p",{className:`mb-1.5 last:mb-0 ${n.startsWith("-")?"pl-2 text-cyan-100/80":""}`,children:n},s))})]},t.id)),f&&e.jsxs("div",{className:"flex gap-5 max-w-[85%] animate-in fade-in duration-500 pl-2",children:[e.jsx("div",{className:"w-11 h-11 rounded-2xl bg-zinc-900/50 text-cyan-400/50 border border-white/5 flex items-center justify-center flex-shrink-0",children:e.jsx(Q,{className:"w-5 h-5 animate-pulse"})}),e.jsxs("div",{className:"flex items-center gap-3 text-xs font-bold tracking-wide text-cyan-500/60 py-3 bg-cyan-950/10 px-5 rounded-2xl border border-cyan-500/10",children:[e.jsx(H,{className:"w-3.5 h-3.5 animate-spin"}),e.jsx("span",{className:"animate-pulse",children:"Analisando base fiscal..."})]})]}),N&&e.jsxs("div",{className:"flex gap-5 max-w-[85%] animate-in fade-in pl-2",children:[e.jsx("div",{className:"w-11 h-11 rounded-2xl bg-zinc-900/80 text-cyan-400 border border-cyan-500/20 flex items-center justify-center flex-shrink-0 shadow-lg shadow-cyan-500/10",children:e.jsx(F,{className:"w-5 h-5"})}),e.jsxs("div",{className:"bg-zinc-900/80 border border-white/5 px-6 py-5 rounded-[1.5rem] rounded-tl-sm shadow-xl flex gap-1.5 items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full animate-bounce"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full animate-bounce delay-100"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full animate-bounce delay-200"})]})]}),e.jsx("div",{ref:L})]}),e.jsxs("div",{className:"p-6 bg-[#050505]/95 border-t border-white/5 backdrop-blur-xl",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"text",value:h,onChange:t=>z(t.target.value),onKeyDown:q,placeholder:A.length>0?"Pergunte sobre 'gastos em Agosto' ou 'total da Unitel'...":"Adicione documentos para começar...",className:"w-full pl-6 pr-16 py-5 bg-zinc-900/50 border border-white/10 rounded-2xl focus:outline-none focus:border-cyan-500/50 focus:ring-4 focus:ring-cyan-500/10 text-slate-200 placeholder-zinc-600 transition-all text-sm font-medium shadow-inner",disabled:N||f}),e.jsx("button",{onClick:C,disabled:!h.trim()||N||f,className:"absolute right-2 top-2 bottom-2 aspect-square bg-gradient-to-br from-cyan-600 to-blue-600 text-white rounded-xl hover:scale-105 hover:shadow-cyan-500/25 transition-all flex items-center justify-center shadow-lg disabled:opacity-50 disabled:scale-100 disabled:shadow-none",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex justify-center mt-4 gap-6 opacity-60 hover:opacity-100 transition-opacity",children:[e.jsxs("span",{className:"text-[9px] font-black text-zinc-600 uppercase tracking-[0.2em] flex items-center gap-1.5",children:[e.jsx(Z,{className:"w-3 h-3 text-emerald-500/50"})," Secure Context"]}),e.jsxs("span",{className:"text-[9px] font-black text-zinc-600 uppercase tracking-[0.2em] flex items-center gap-1.5",children:[e.jsx(ee,{className:"w-3 h-3 text-cyan-500/50"})," Neural Engine Active"]})]})]})]})]})};export{ce as default};
